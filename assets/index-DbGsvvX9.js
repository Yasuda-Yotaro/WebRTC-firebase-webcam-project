(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();let _e,To=[],Io,It,Tn={},Pt={},Hn={},ku,qt=[],na=!1,In="sender",Hr=null,Ht=null,vn="camera1",Br={camera1:null,camera2:null},Nr={camera1:[],camera2:[]},ra={camera1:!1,camera2:!1};function ia(n){_e=n}function Ru(n){To=n}function sa(n){Io=n}function oa(n){It=n}function Ef(n){Tn=n}function Pu(n){Pt=n}function xu(n){Hn=n}function wf(n){ku=n}function Du(n){qt=n}function Vu(n){na=n}function Tf(n){In=n}function ns(n){Hr=n}function rs(n){Ht=n}function Bu(n){vn=n}function Nu(n,e){Br[n]=e}function Lu(n,e){Nr[n]=e}function is(n,e){ra[n]=e}const If=document.querySelectorAll('input[name="role"]'),bf=document.getElementById("senderControls"),Af=document.getElementById("receiverControls"),aa=document.getElementById("callControls"),Mu=document.getElementById("statsControls"),ss=document.getElementById("ptzControls"),la=document.getElementById("cameraCount"),Mn=document.getElementById("cameraSelect1"),hn=document.getElementById("cameraSelect2"),Sf=document.getElementById("cameraSelect2Container"),Cf=document.getElementById("resolution"),kf=document.getElementById("framerate"),Rf=document.getElementById("codecSelect"),Wr=document.getElementById("startCamera"),os=document.getElementById("joinCall"),Pf=document.getElementById("hangUpBtn"),Ou=document.getElementById("callIdInput"),Ss=document.getElementById("callIdDisplay"),ji=document.getElementById("copyCallId"),Gr=document.getElementById("localVideo1"),fn=document.getElementById("localVideo2"),ca=document.getElementById("remoteVideo1"),ua=document.getElementById("remoteVideo2"),Lr=document.getElementById("remoteVideoContainer1"),Wn=document.getElementById("remoteVideoContainer2"),ha=document.getElementById("resolutionDisplay1"),da=document.getElementById("resolutionDisplay2"),Kl=document.getElementById("fullscreenBtn1"),Ql=document.getElementById("fullscreenBtn2"),Cs=document.getElementById("startStatsRecording"),ks=document.getElementById("stopStatsRecording"),Rs=document.getElementById("downloadStats"),as=document.getElementById("statsDisplay");document.getElementById("zoomInBtn");document.getElementById("zoomOutBtn");const xf=document.getElementById("zoomSlider");document.getElementById("zoomValue");document.getElementById("tiltUpBtn");document.getElementById("tiltDownBtn");const Df=document.getElementById("tiltSlider");document.getElementById("tiltValue");document.getElementById("panLeftBtn");document.getElementById("panRightBtn");const Vf=document.getElementById("panSlider");document.getElementById("panValue");const Bf=document.getElementById("ptzResetBtn"),Nf=document.querySelectorAll('input[name="ptzTarget"]'),bo=document.getElementById("ptzTargetCamera2Label"),fa=document.getElementById("startRecording1"),ma=document.getElementById("stopRecording1"),pa=document.getElementById("downloadVideo1"),Fu=document.getElementById("recordingStatus1"),ga=document.getElementById("startRecording2"),ya=document.getElementById("stopRecording2"),va=document.getElementById("downloadVideo2"),Uu=document.getElementById("recordingStatus2"),Lf=document.getElementById("arucoControls"),$i=document.getElementById("arucoTargetSelect"),zi=document.getElementById("startArucoTrackingBtn"),qi=document.getElementById("stopArucoTrackingBtn"),Zn=document.getElementById("arucoTrackingStatus"),Xl=document.getElementById("enableImuCheckbox"),Si=document.getElementById("connectImuBtn"),Ci=document.getElementById("disconnectImuBtn"),Yl=document.getElementById("calibrateImuBtn");function Kr(){Gr.srcObject=null,fn.srcObject=null,ca.srcObject=null,ua.srcObject=null,Gr.style.display="none",fn.style.display="none",Lr.style.display="none",Wn.style.display="none",ha.style.display="none",da.style.display="none",ss.style.display="none",aa.style.display="none",Mu.style.display="none",Lf.style.display="none",Ss.textContent="",Ou.value="",ji.textContent="コピー",Wr.disabled=!1,os.disabled=!1,as.textContent="",Du([]),ns(null),Cs.disabled=!1,ks.disabled=!0,Rs.disabled=!0,zi.disabled=!1,qi.disabled=!0,$i.disabled=!1,Zn.textContent="",["camera1","camera2"].forEach(n=>{Br[n]&&Br[n].state!=="inactive"&&Br[n].stop(),Nu(n,null),Lu(n,[]),is(n,!1)}),fa.disabled=!1,ma.disabled=!0,pa.disabled=!0,Fu.textContent="",ga.disabled=!1,ya.disabled=!0,va.disabled=!0,Uu.textContent="",It&&(It.close(),oa(null)),Ht&&(clearInterval(Ht),rs(null))}function ju(n){Tf(n),bf.style.display=n==="sender"?"block":"none",Af.style.display=n==="receiver"?"block":"none",Kr()}async function Mf(){try{const e=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput");if(Mn.innerHTML="",hn.innerHTML="",e.length===0){const t="<option>カメラが見つかりません</option>";Mn.innerHTML=t,hn.innerHTML=t,Mn.disabled=!0,hn.disabled=!0,Wr.disabled=!0;return}e.forEach((t,r)=>{const i=document.createElement("option");i.value=t.deviceId,i.text=t.label||`カメラ ${r+1}`,Mn.appendChild(i);const s=document.createElement("option");s.value=t.deviceId,s.text=t.label||`カメラ ${r+1}`,hn.appendChild(s)}),e.length>1&&(hn.selectedIndex=1),Mn.disabled=!1,hn.disabled=e.length<2,Wr.disabled=!1,$u()}catch(n){console.error("Error enumerating devices:",n),alert("カメラデバイスの取得に失敗しました。")}}function $u(){const n=parseInt(la.value,10);Sf.style.display=n===2?"block":"none"}const Of=()=>{};var Jl={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zu=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Ff=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],a=n[t++],l=n[t++],d=((i&7)<<18|(s&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(d>>10)),e[r++]=String.fromCharCode(56320+(d&1023))}else{const s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},qu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],a=i+1<n.length,l=a?n[i+1]:0,d=i+2<n.length,f=d?n[i+2]:0,g=s>>2,A=(s&3)<<4|l>>4;let k=(l&15)<<2|f>>6,C=f&63;d||(C=64,a||(k=64)),r.push(t[g],t[A],t[k],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(zu(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Ff(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const f=i<n.length?t[n.charAt(i)]:64;++i;const A=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||l==null||f==null||A==null)throw new Uf;const k=s<<2|l>>4;if(r.push(k),f!==64){const C=l<<4&240|f>>2;if(r.push(C),A!==64){const x=f<<6&192|A;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Uf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const jf=function(n){const e=zu(n);return qu.encodeByteArray(e,!0)},ls=function(n){return jf(n).replace(/\./g,"")},$f=function(n){try{return qu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qf=()=>zf().__FIREBASE_DEFAULTS__,Hf=()=>{if(typeof process>"u"||typeof Jl>"u")return;const n=Jl.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Wf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&$f(n[1]);return e&&JSON.parse(e)},_a=()=>{try{return Of()||qf()||Hf()||Wf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Gf=n=>{var e,t;return(t=(e=_a())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Kf=n=>{const e=Gf(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Hu=()=>{var n;return(n=_a())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ea(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Xf(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ls(JSON.stringify(t)),ls(JSON.stringify(a)),""].join(".")}const Mr={};function Jf(){const n={prod:[],emulator:[]};for(const e of Object.keys(Mr))Mr[e]?n.emulator.push(e):n.prod.push(e);return n}function Zf(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Zl=!1;function em(n,e){if(typeof window>"u"||typeof document>"u"||!Ea(window.location.host)||Mr[n]===e||Mr[n]||Zl)return;Mr[n]=e;function t(k){return`__firebase__banner__${k}`}const r="__firebase__banner",s=Jf().prod.length>0;function a(){const k=document.getElementById(r);k&&k.remove()}function l(k){k.style.display="flex",k.style.background="#7faaf0",k.style.position="fixed",k.style.bottom="5px",k.style.left="5px",k.style.padding=".5em",k.style.borderRadius="5px",k.style.alignItems="center"}function d(k,C){k.setAttribute("width","24"),k.setAttribute("id",C),k.setAttribute("height","24"),k.setAttribute("viewBox","0 0 24 24"),k.setAttribute("fill","none"),k.style.marginLeft="-6px"}function f(){const k=document.createElement("span");return k.style.cursor="pointer",k.style.marginLeft="16px",k.style.fontSize="24px",k.innerHTML=" &times;",k.onclick=()=>{Zl=!0,a()},k}function g(k,C){k.setAttribute("id",C),k.innerText="Learn more",k.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",k.setAttribute("target","__blank"),k.style.paddingLeft="5px",k.style.textDecoration="underline"}function A(){const k=Zf(r),C=t("text"),x=document.getElementById(C)||document.createElement("span"),N=t("learnmore"),M=document.getElementById(N)||document.createElement("a"),z=t("preprendIcon"),q=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(k.created){const W=k.element;l(W),g(M,N);const L=f();d(q,z),W.append(q,x,M,L),document.body.appendChild(W)}s?(x.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",A):A()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tm(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function nm(){var n;const e=(n=_a())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function rm(){return!nm()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function im(){try{return typeof indexedDB=="object"}catch{return!1}}function sm(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const om="FirebaseError";class lr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=om,Object.setPrototypeOf(this,lr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Wu.prototype.create)}}class Wu{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?am(s,r):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new lr(i,l,r)}}function am(n,e){return n.replace(lm,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const lm=/\{\$([^}]+)}/g;function cs(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],a=e[i];if(ec(s)&&ec(a)){if(!cs(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function ec(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function er(n){return n&&n._delegate?n._delegate:n}class Qr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Qf;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(hm(e))try{this.getOrInitializeService({instanceIdentifier:dn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=dn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=dn){return this.instances.has(e)}getOptions(e=dn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);r===l&&a.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:um(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=dn){return this.component?this.component.multipleInstances?e:dn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function um(n){return n===dn?void 0:n}function hm(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dm{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new cm(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ce;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ce||(ce={}));const fm={debug:ce.DEBUG,verbose:ce.VERBOSE,info:ce.INFO,warn:ce.WARN,error:ce.ERROR,silent:ce.SILENT},mm=ce.INFO,pm={[ce.DEBUG]:"log",[ce.VERBOSE]:"log",[ce.INFO]:"info",[ce.WARN]:"warn",[ce.ERROR]:"error"},gm=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=pm[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Gu{constructor(e){this.name=e,this._logLevel=mm,this._logHandler=gm,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ce))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?fm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ce.DEBUG,...e),this._logHandler(this,ce.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ce.VERBOSE,...e),this._logHandler(this,ce.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ce.INFO,...e),this._logHandler(this,ce.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ce.WARN,...e),this._logHandler(this,ce.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ce.ERROR,...e),this._logHandler(this,ce.ERROR,...e)}}const ym=(n,e)=>e.some(t=>n instanceof t);let tc,nc;function vm(){return tc||(tc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _m(){return nc||(nc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ku=new WeakMap,Ao=new WeakMap,Qu=new WeakMap,so=new WeakMap,wa=new WeakMap;function Em(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(Wt(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Ku.set(t,n)}).catch(()=>{}),wa.set(e,n),e}function wm(n){if(Ao.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});Ao.set(n,e)}let So={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ao.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Qu.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Wt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Tm(n){So=n(So)}function Im(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(oo(this),e,...t);return Qu.set(r,e.sort?e.sort():[e]),Wt(r)}:_m().includes(n)?function(...e){return n.apply(oo(this),e),Wt(Ku.get(this))}:function(...e){return Wt(n.apply(oo(this),e))}}function bm(n){return typeof n=="function"?Im(n):(n instanceof IDBTransaction&&wm(n),ym(n,vm())?new Proxy(n,So):n)}function Wt(n){if(n instanceof IDBRequest)return Em(n);if(so.has(n))return so.get(n);const e=bm(n);return e!==n&&(so.set(n,e),wa.set(e,n)),e}const oo=n=>wa.get(n);function Am(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(n,e),l=Wt(a);return r&&a.addEventListener("upgradeneeded",d=>{r(Wt(a.result),d.oldVersion,d.newVersion,Wt(a.transaction),d)}),t&&a.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),l.then(d=>{s&&d.addEventListener("close",()=>s()),i&&d.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}const Sm=["get","getKey","getAll","getAllKeys","count"],Cm=["put","add","delete","clear"],ao=new Map;function rc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ao.get(e))return ao.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=Cm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Sm.includes(t)))return;const s=async function(a,...l){const d=this.transaction(a,i?"readwrite":"readonly");let f=d.store;return r&&(f=f.index(l.shift())),(await Promise.all([f[t](...l),i&&d.done]))[0]};return ao.set(e,s),s}Tm(n=>({...n,get:(e,t,r)=>rc(e,t)||n.get(e,t,r),has:(e,t)=>!!rc(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Rm(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Rm(n){const e=n.getComponent();return e?.type==="VERSION"}const Co="@firebase/app",ic="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dt=new Gu("@firebase/app"),Pm="@firebase/app-compat",xm="@firebase/analytics-compat",Dm="@firebase/analytics",Vm="@firebase/app-check-compat",Bm="@firebase/app-check",Nm="@firebase/auth",Lm="@firebase/auth-compat",Mm="@firebase/database",Om="@firebase/data-connect",Fm="@firebase/database-compat",Um="@firebase/functions",jm="@firebase/functions-compat",$m="@firebase/installations",zm="@firebase/installations-compat",qm="@firebase/messaging",Hm="@firebase/messaging-compat",Wm="@firebase/performance",Gm="@firebase/performance-compat",Km="@firebase/remote-config",Qm="@firebase/remote-config-compat",Xm="@firebase/storage",Ym="@firebase/storage-compat",Jm="@firebase/firestore",Zm="@firebase/ai",ep="@firebase/firestore-compat",tp="firebase",np="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ko="[DEFAULT]",rp={[Co]:"fire-core",[Pm]:"fire-core-compat",[Dm]:"fire-analytics",[xm]:"fire-analytics-compat",[Bm]:"fire-app-check",[Vm]:"fire-app-check-compat",[Nm]:"fire-auth",[Lm]:"fire-auth-compat",[Mm]:"fire-rtdb",[Om]:"fire-data-connect",[Fm]:"fire-rtdb-compat",[Um]:"fire-fn",[jm]:"fire-fn-compat",[$m]:"fire-iid",[zm]:"fire-iid-compat",[qm]:"fire-fcm",[Hm]:"fire-fcm-compat",[Wm]:"fire-perf",[Gm]:"fire-perf-compat",[Km]:"fire-rc",[Qm]:"fire-rc-compat",[Xm]:"fire-gcs",[Ym]:"fire-gcs-compat",[Jm]:"fire-fst",[ep]:"fire-fst-compat",[Zm]:"fire-vertex","fire-js":"fire-js",[tp]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const us=new Map,ip=new Map,Ro=new Map;function sc(n,e){try{n.container.addComponent(e)}catch(t){Dt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function hs(n){const e=n.name;if(Ro.has(e))return Dt.debug(`There were multiple attempts to register component ${e}.`),!1;Ro.set(e,n);for(const t of us.values())sc(t,n);for(const t of ip.values())sc(t,n);return!0}function sp(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function op(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Gt=new Wu("app","Firebase",ap);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lp{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Qr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Gt.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cp=np;function Xu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ko,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw Gt.create("bad-app-name",{appName:String(i)});if(t||(t=Hu()),!t)throw Gt.create("no-options");const s=us.get(i);if(s){if(cs(t,s.options)&&cs(r,s.config))return s;throw Gt.create("duplicate-app",{appName:i})}const a=new dm(i);for(const d of Ro.values())a.addComponent(d);const l=new lp(t,r,a);return us.set(i,l),l}function up(n=ko){const e=us.get(n);if(!e&&n===ko&&Hu())return Xu();if(!e)throw Gt.create("no-app",{appName:n});return e}function Gn(n,e,t){var r;let i=(r=rp[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const l=[`Unable to register library "${i}" with version "${e}":`];s&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Dt.warn(l.join(" "));return}hs(new Qr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hp="firebase-heartbeat-database",dp=1,Xr="firebase-heartbeat-store";let lo=null;function Yu(){return lo||(lo=Am(hp,dp,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Xr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Gt.create("idb-open",{originalErrorMessage:n.message})})),lo}async function fp(n){try{const t=(await Yu()).transaction(Xr),r=await t.objectStore(Xr).get(Ju(n));return await t.done,r}catch(e){if(e instanceof lr)Dt.warn(e.message);else{const t=Gt.create("idb-get",{originalErrorMessage:e?.message});Dt.warn(t.message)}}}async function oc(n,e){try{const r=(await Yu()).transaction(Xr,"readwrite");await r.objectStore(Xr).put(e,Ju(n)),await r.done}catch(t){if(t instanceof lr)Dt.warn(t.message);else{const r=Gt.create("idb-set",{originalErrorMessage:t?.message});Dt.warn(r.message)}}}function Ju(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp=1024,pp=30;class gp{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vp(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=ac();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>pp){const a=_p(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Dt.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ac(),{heartbeatsToSend:r,unsentEntries:i}=yp(this._heartbeatsCache.heartbeats),s=ls(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Dt.warn(t),""}}}function ac(){return new Date().toISOString().substring(0,10)}function yp(n,e=mp){const t=[];let r=n.slice();for(const i of n){const s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),lc(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),lc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class vp{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return im()?sm().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await fp(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return oc(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return oc(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function lc(n){return ls(JSON.stringify({version:2,heartbeats:n})).length}function _p(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ep(n){hs(new Qr("platform-logger",e=>new km(e),"PRIVATE")),hs(new Qr("heartbeat",e=>new gp(e),"PRIVATE")),Gn(Co,ic,n),Gn(Co,ic,"esm2017"),Gn("fire-js","")}Ep("");var wp="firebase",Tp="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Gn(wp,Tp,"app");var cc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Kt,Zu;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,y){function T(){}T.prototype=y.prototype,E.D=y.prototype,E.prototype=new T,E.prototype.constructor=E,E.C=function(v,w,S){for(var b=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)b[Y-2]=arguments[Y];return y.prototype[w].apply(v,b)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,y,T){T||(T=0);var v=Array(16);if(typeof y=="string")for(var w=0;16>w;++w)v[w]=y.charCodeAt(T++)|y.charCodeAt(T++)<<8|y.charCodeAt(T++)<<16|y.charCodeAt(T++)<<24;else for(w=0;16>w;++w)v[w]=y[T++]|y[T++]<<8|y[T++]<<16|y[T++]<<24;y=E.g[0],T=E.g[1],w=E.g[2];var S=E.g[3],b=y+(S^T&(w^S))+v[0]+3614090360&4294967295;y=T+(b<<7&4294967295|b>>>25),b=S+(w^y&(T^w))+v[1]+3905402710&4294967295,S=y+(b<<12&4294967295|b>>>20),b=w+(T^S&(y^T))+v[2]+606105819&4294967295,w=S+(b<<17&4294967295|b>>>15),b=T+(y^w&(S^y))+v[3]+3250441966&4294967295,T=w+(b<<22&4294967295|b>>>10),b=y+(S^T&(w^S))+v[4]+4118548399&4294967295,y=T+(b<<7&4294967295|b>>>25),b=S+(w^y&(T^w))+v[5]+1200080426&4294967295,S=y+(b<<12&4294967295|b>>>20),b=w+(T^S&(y^T))+v[6]+2821735955&4294967295,w=S+(b<<17&4294967295|b>>>15),b=T+(y^w&(S^y))+v[7]+4249261313&4294967295,T=w+(b<<22&4294967295|b>>>10),b=y+(S^T&(w^S))+v[8]+1770035416&4294967295,y=T+(b<<7&4294967295|b>>>25),b=S+(w^y&(T^w))+v[9]+2336552879&4294967295,S=y+(b<<12&4294967295|b>>>20),b=w+(T^S&(y^T))+v[10]+4294925233&4294967295,w=S+(b<<17&4294967295|b>>>15),b=T+(y^w&(S^y))+v[11]+2304563134&4294967295,T=w+(b<<22&4294967295|b>>>10),b=y+(S^T&(w^S))+v[12]+1804603682&4294967295,y=T+(b<<7&4294967295|b>>>25),b=S+(w^y&(T^w))+v[13]+4254626195&4294967295,S=y+(b<<12&4294967295|b>>>20),b=w+(T^S&(y^T))+v[14]+2792965006&4294967295,w=S+(b<<17&4294967295|b>>>15),b=T+(y^w&(S^y))+v[15]+1236535329&4294967295,T=w+(b<<22&4294967295|b>>>10),b=y+(w^S&(T^w))+v[1]+4129170786&4294967295,y=T+(b<<5&4294967295|b>>>27),b=S+(T^w&(y^T))+v[6]+3225465664&4294967295,S=y+(b<<9&4294967295|b>>>23),b=w+(y^T&(S^y))+v[11]+643717713&4294967295,w=S+(b<<14&4294967295|b>>>18),b=T+(S^y&(w^S))+v[0]+3921069994&4294967295,T=w+(b<<20&4294967295|b>>>12),b=y+(w^S&(T^w))+v[5]+3593408605&4294967295,y=T+(b<<5&4294967295|b>>>27),b=S+(T^w&(y^T))+v[10]+38016083&4294967295,S=y+(b<<9&4294967295|b>>>23),b=w+(y^T&(S^y))+v[15]+3634488961&4294967295,w=S+(b<<14&4294967295|b>>>18),b=T+(S^y&(w^S))+v[4]+3889429448&4294967295,T=w+(b<<20&4294967295|b>>>12),b=y+(w^S&(T^w))+v[9]+568446438&4294967295,y=T+(b<<5&4294967295|b>>>27),b=S+(T^w&(y^T))+v[14]+3275163606&4294967295,S=y+(b<<9&4294967295|b>>>23),b=w+(y^T&(S^y))+v[3]+4107603335&4294967295,w=S+(b<<14&4294967295|b>>>18),b=T+(S^y&(w^S))+v[8]+1163531501&4294967295,T=w+(b<<20&4294967295|b>>>12),b=y+(w^S&(T^w))+v[13]+2850285829&4294967295,y=T+(b<<5&4294967295|b>>>27),b=S+(T^w&(y^T))+v[2]+4243563512&4294967295,S=y+(b<<9&4294967295|b>>>23),b=w+(y^T&(S^y))+v[7]+1735328473&4294967295,w=S+(b<<14&4294967295|b>>>18),b=T+(S^y&(w^S))+v[12]+2368359562&4294967295,T=w+(b<<20&4294967295|b>>>12),b=y+(T^w^S)+v[5]+4294588738&4294967295,y=T+(b<<4&4294967295|b>>>28),b=S+(y^T^w)+v[8]+2272392833&4294967295,S=y+(b<<11&4294967295|b>>>21),b=w+(S^y^T)+v[11]+1839030562&4294967295,w=S+(b<<16&4294967295|b>>>16),b=T+(w^S^y)+v[14]+4259657740&4294967295,T=w+(b<<23&4294967295|b>>>9),b=y+(T^w^S)+v[1]+2763975236&4294967295,y=T+(b<<4&4294967295|b>>>28),b=S+(y^T^w)+v[4]+1272893353&4294967295,S=y+(b<<11&4294967295|b>>>21),b=w+(S^y^T)+v[7]+4139469664&4294967295,w=S+(b<<16&4294967295|b>>>16),b=T+(w^S^y)+v[10]+3200236656&4294967295,T=w+(b<<23&4294967295|b>>>9),b=y+(T^w^S)+v[13]+681279174&4294967295,y=T+(b<<4&4294967295|b>>>28),b=S+(y^T^w)+v[0]+3936430074&4294967295,S=y+(b<<11&4294967295|b>>>21),b=w+(S^y^T)+v[3]+3572445317&4294967295,w=S+(b<<16&4294967295|b>>>16),b=T+(w^S^y)+v[6]+76029189&4294967295,T=w+(b<<23&4294967295|b>>>9),b=y+(T^w^S)+v[9]+3654602809&4294967295,y=T+(b<<4&4294967295|b>>>28),b=S+(y^T^w)+v[12]+3873151461&4294967295,S=y+(b<<11&4294967295|b>>>21),b=w+(S^y^T)+v[15]+530742520&4294967295,w=S+(b<<16&4294967295|b>>>16),b=T+(w^S^y)+v[2]+3299628645&4294967295,T=w+(b<<23&4294967295|b>>>9),b=y+(w^(T|~S))+v[0]+4096336452&4294967295,y=T+(b<<6&4294967295|b>>>26),b=S+(T^(y|~w))+v[7]+1126891415&4294967295,S=y+(b<<10&4294967295|b>>>22),b=w+(y^(S|~T))+v[14]+2878612391&4294967295,w=S+(b<<15&4294967295|b>>>17),b=T+(S^(w|~y))+v[5]+4237533241&4294967295,T=w+(b<<21&4294967295|b>>>11),b=y+(w^(T|~S))+v[12]+1700485571&4294967295,y=T+(b<<6&4294967295|b>>>26),b=S+(T^(y|~w))+v[3]+2399980690&4294967295,S=y+(b<<10&4294967295|b>>>22),b=w+(y^(S|~T))+v[10]+4293915773&4294967295,w=S+(b<<15&4294967295|b>>>17),b=T+(S^(w|~y))+v[1]+2240044497&4294967295,T=w+(b<<21&4294967295|b>>>11),b=y+(w^(T|~S))+v[8]+1873313359&4294967295,y=T+(b<<6&4294967295|b>>>26),b=S+(T^(y|~w))+v[15]+4264355552&4294967295,S=y+(b<<10&4294967295|b>>>22),b=w+(y^(S|~T))+v[6]+2734768916&4294967295,w=S+(b<<15&4294967295|b>>>17),b=T+(S^(w|~y))+v[13]+1309151649&4294967295,T=w+(b<<21&4294967295|b>>>11),b=y+(w^(T|~S))+v[4]+4149444226&4294967295,y=T+(b<<6&4294967295|b>>>26),b=S+(T^(y|~w))+v[11]+3174756917&4294967295,S=y+(b<<10&4294967295|b>>>22),b=w+(y^(S|~T))+v[2]+718787259&4294967295,w=S+(b<<15&4294967295|b>>>17),b=T+(S^(w|~y))+v[9]+3951481745&4294967295,E.g[0]=E.g[0]+y&4294967295,E.g[1]=E.g[1]+(w+(b<<21&4294967295|b>>>11))&4294967295,E.g[2]=E.g[2]+w&4294967295,E.g[3]=E.g[3]+S&4294967295}r.prototype.u=function(E,y){y===void 0&&(y=E.length);for(var T=y-this.blockSize,v=this.B,w=this.h,S=0;S<y;){if(w==0)for(;S<=T;)i(this,E,S),S+=this.blockSize;if(typeof E=="string"){for(;S<y;)if(v[w++]=E.charCodeAt(S++),w==this.blockSize){i(this,v),w=0;break}}else for(;S<y;)if(v[w++]=E[S++],w==this.blockSize){i(this,v),w=0;break}}this.h=w,this.o+=y},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var y=1;y<E.length-8;++y)E[y]=0;var T=8*this.o;for(y=E.length-8;y<E.length;++y)E[y]=T&255,T/=256;for(this.u(E),E=Array(16),y=T=0;4>y;++y)for(var v=0;32>v;v+=8)E[T++]=this.g[y]>>>v&255;return E};function s(E,y){var T=l;return Object.prototype.hasOwnProperty.call(T,E)?T[E]:T[E]=y(E)}function a(E,y){this.h=y;for(var T=[],v=!0,w=E.length-1;0<=w;w--){var S=E[w]|0;v&&S==y||(T[w]=S,v=!1)}this.g=T}var l={};function d(E){return-128<=E&&128>E?s(E,function(y){return new a([y|0],0>y?-1:0)}):new a([E|0],0>E?-1:0)}function f(E){if(isNaN(E)||!isFinite(E))return A;if(0>E)return M(f(-E));for(var y=[],T=1,v=0;E>=T;v++)y[v]=E/T|0,T*=4294967296;return new a(y,0)}function g(E,y){if(E.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(E.charAt(0)=="-")return M(g(E.substring(1),y));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=f(Math.pow(y,8)),v=A,w=0;w<E.length;w+=8){var S=Math.min(8,E.length-w),b=parseInt(E.substring(w,w+S),y);8>S?(S=f(Math.pow(y,S)),v=v.j(S).add(f(b))):(v=v.j(T),v=v.add(f(b)))}return v}var A=d(0),k=d(1),C=d(16777216);n=a.prototype,n.m=function(){if(N(this))return-M(this).m();for(var E=0,y=1,T=0;T<this.g.length;T++){var v=this.i(T);E+=(0<=v?v:4294967296+v)*y,y*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(x(this))return"0";if(N(this))return"-"+M(this).toString(E);for(var y=f(Math.pow(E,6)),T=this,v="";;){var w=L(T,y).g;T=z(T,w.j(y));var S=((0<T.g.length?T.g[0]:T.h)>>>0).toString(E);if(T=w,x(T))return S+v;for(;6>S.length;)S="0"+S;v=S+v}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function x(E){if(E.h!=0)return!1;for(var y=0;y<E.g.length;y++)if(E.g[y]!=0)return!1;return!0}function N(E){return E.h==-1}n.l=function(E){return E=z(this,E),N(E)?-1:x(E)?0:1};function M(E){for(var y=E.g.length,T=[],v=0;v<y;v++)T[v]=~E.g[v];return new a(T,~E.h).add(k)}n.abs=function(){return N(this)?M(this):this},n.add=function(E){for(var y=Math.max(this.g.length,E.g.length),T=[],v=0,w=0;w<=y;w++){var S=v+(this.i(w)&65535)+(E.i(w)&65535),b=(S>>>16)+(this.i(w)>>>16)+(E.i(w)>>>16);v=b>>>16,S&=65535,b&=65535,T[w]=b<<16|S}return new a(T,T[T.length-1]&-2147483648?-1:0)};function z(E,y){return E.add(M(y))}n.j=function(E){if(x(this)||x(E))return A;if(N(this))return N(E)?M(this).j(M(E)):M(M(this).j(E));if(N(E))return M(this.j(M(E)));if(0>this.l(C)&&0>E.l(C))return f(this.m()*E.m());for(var y=this.g.length+E.g.length,T=[],v=0;v<2*y;v++)T[v]=0;for(v=0;v<this.g.length;v++)for(var w=0;w<E.g.length;w++){var S=this.i(v)>>>16,b=this.i(v)&65535,Y=E.i(w)>>>16,ae=E.i(w)&65535;T[2*v+2*w]+=b*ae,q(T,2*v+2*w),T[2*v+2*w+1]+=S*ae,q(T,2*v+2*w+1),T[2*v+2*w+1]+=b*Y,q(T,2*v+2*w+1),T[2*v+2*w+2]+=S*Y,q(T,2*v+2*w+2)}for(v=0;v<y;v++)T[v]=T[2*v+1]<<16|T[2*v];for(v=y;v<2*y;v++)T[v]=0;return new a(T,0)};function q(E,y){for(;(E[y]&65535)!=E[y];)E[y+1]+=E[y]>>>16,E[y]&=65535,y++}function W(E,y){this.g=E,this.h=y}function L(E,y){if(x(y))throw Error("division by zero");if(x(E))return new W(A,A);if(N(E))return y=L(M(E),y),new W(M(y.g),M(y.h));if(N(y))return y=L(E,M(y)),new W(M(y.g),y.h);if(30<E.g.length){if(N(E)||N(y))throw Error("slowDivide_ only works with positive integers.");for(var T=k,v=y;0>=v.l(E);)T=O(T),v=O(v);var w=P(T,1),S=P(v,1);for(v=P(v,2),T=P(T,2);!x(v);){var b=S.add(v);0>=b.l(E)&&(w=w.add(T),S=b),v=P(v,1),T=P(T,1)}return y=z(E,w.j(y)),new W(w,y)}for(w=A;0<=E.l(y);){for(T=Math.max(1,Math.floor(E.m()/y.m())),v=Math.ceil(Math.log(T)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),S=f(T),b=S.j(y);N(b)||0<b.l(E);)T-=v,S=f(T),b=S.j(y);x(S)&&(S=k),w=w.add(S),E=z(E,b)}return new W(w,E)}n.A=function(E){return L(this,E).h},n.and=function(E){for(var y=Math.max(this.g.length,E.g.length),T=[],v=0;v<y;v++)T[v]=this.i(v)&E.i(v);return new a(T,this.h&E.h)},n.or=function(E){for(var y=Math.max(this.g.length,E.g.length),T=[],v=0;v<y;v++)T[v]=this.i(v)|E.i(v);return new a(T,this.h|E.h)},n.xor=function(E){for(var y=Math.max(this.g.length,E.g.length),T=[],v=0;v<y;v++)T[v]=this.i(v)^E.i(v);return new a(T,this.h^E.h)};function O(E){for(var y=E.g.length+1,T=[],v=0;v<y;v++)T[v]=E.i(v)<<1|E.i(v-1)>>>31;return new a(T,E.h)}function P(E,y){var T=y>>5;y%=32;for(var v=E.g.length-T,w=[],S=0;S<v;S++)w[S]=0<y?E.i(S+T)>>>y|E.i(S+T+1)<<32-y:E.i(S+T);return new a(w,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Zu=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=g,Kt=a}).apply(typeof cc<"u"?cc:typeof self<"u"?self:typeof window<"u"?window:{});var ki=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var eh,kr,th,Hi,Po,nh,rh,ih;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,m){return o==Array.prototype||o==Object.prototype||(o[c]=m.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ki=="object"&&ki];for(var c=0;c<o.length;++c){var m=o[c];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function i(o,c){if(c)e:{var m=r;o=o.split(".");for(var _=0;_<o.length-1;_++){var D=o[_];if(!(D in m))break e;m=m[D]}o=o[o.length-1],_=m[o],c=c(_),c!=_&&c!=null&&e(m,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var m=0,_=!1,D={next:function(){if(!_&&m<o.length){var B=m++;return{value:c(B,o[B]),done:!1}}return _=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function d(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function f(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function g(o,c,m){return o.call.apply(o.bind,arguments)}function A(o,c,m){if(!o)throw Error();if(2<arguments.length){var _=Array.prototype.slice.call(arguments,2);return function(){var D=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(D,_),o.apply(c,D)}}return function(){return o.apply(c,arguments)}}function k(o,c,m){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:A,k.apply(null,arguments)}function C(o,c){var m=Array.prototype.slice.call(arguments,1);return function(){var _=m.slice();return _.push.apply(_,arguments),o.apply(this,_)}}function x(o,c){function m(){}m.prototype=c.prototype,o.aa=c.prototype,o.prototype=new m,o.prototype.constructor=o,o.Qb=function(_,D,B){for(var $=Array(arguments.length-2),pe=2;pe<arguments.length;pe++)$[pe-2]=arguments[pe];return c.prototype[D].apply(_,$)}}function N(o){const c=o.length;if(0<c){const m=Array(c);for(let _=0;_<c;_++)m[_]=o[_];return m}return[]}function M(o,c){for(let m=1;m<arguments.length;m++){const _=arguments[m];if(d(_)){const D=o.length||0,B=_.length||0;o.length=D+B;for(let $=0;$<B;$++)o[D+$]=_[$]}else o.push(_)}}class z{constructor(c,m){this.i=c,this.j=m,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function q(o){return/^[\s\xa0]*$/.test(o)}function W(){var o=l.navigator;return o&&(o=o.userAgent)?o:""}function L(o){return L[" "](o),o}L[" "]=function(){};var O=W().indexOf("Gecko")!=-1&&!(W().toLowerCase().indexOf("webkit")!=-1&&W().indexOf("Edge")==-1)&&!(W().indexOf("Trident")!=-1||W().indexOf("MSIE")!=-1)&&W().indexOf("Edge")==-1;function P(o,c,m){for(const _ in o)c.call(m,o[_],_,o)}function E(o,c){for(const m in o)c.call(void 0,o[m],m,o)}function y(o){const c={};for(const m in o)c[m]=o[m];return c}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function v(o,c){let m,_;for(let D=1;D<arguments.length;D++){_=arguments[D];for(m in _)o[m]=_[m];for(let B=0;B<T.length;B++)m=T[B],Object.prototype.hasOwnProperty.call(_,m)&&(o[m]=_[m])}}function w(o){var c=1;o=o.split(":");const m=[];for(;0<c&&o.length;)m.push(o.shift()),c--;return o.length&&m.push(o.join(":")),m}function S(o){l.setTimeout(()=>{throw o},0)}function b(){var o=He;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class Y{constructor(){this.h=this.g=null}add(c,m){const _=ae.get();_.set(c,m),this.h?this.h.next=_:this.g=_,this.h=_}}var ae=new z(()=>new be,o=>o.reset());class be{constructor(){this.next=this.g=this.h=null}set(c,m){this.h=c,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let Ee,Ae=!1,He=new Y,ct=()=>{const o=l.Promise.resolve(void 0);Ee=()=>{o.then(ue)}};var ue=()=>{for(var o;o=b();){try{o.h.call(o.g)}catch(m){S(m)}var c=ae;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}Ae=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ge(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}ge.prototype.h=function(){this.defaultPrevented=!0};var Ce=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const m=()=>{};l.addEventListener("test",m,c),l.removeEventListener("test",m,c)}catch{}return o}();function Me(o,c){if(ge.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var m=this.type=o.type,_=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(O){e:{try{L(c.nodeName);var D=!0;break e}catch{}D=!1}D||(c=null)}}else m=="mouseover"?c=o.fromElement:m=="mouseout"&&(c=o.toElement);this.relatedTarget=c,_?(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:ut[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Me.aa.h.call(this)}}x(Me,ge);var ut={2:"touch",3:"pen",4:"mouse"};Me.prototype.h=function(){Me.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Xe="closure_listenable_"+(1e6*Math.random()|0),Oe=0;function te(o,c,m,_,D){this.listener=o,this.proxy=null,this.src=c,this.type=m,this.capture=!!_,this.ha=D,this.key=++Oe,this.da=this.fa=!1}function Q(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function J(o){this.src=o,this.g={},this.h=0}J.prototype.add=function(o,c,m,_,D){var B=o.toString();o=this.g[B],o||(o=this.g[B]=[],this.h++);var $=de(o,c,_,D);return-1<$?(c=o[$],m||(c.fa=!1)):(c=new te(c,this.src,B,!!_,D),c.fa=m,o.push(c)),c};function re(o,c){var m=c.type;if(m in o.g){var _=o.g[m],D=Array.prototype.indexOf.call(_,c,void 0),B;(B=0<=D)&&Array.prototype.splice.call(_,D,1),B&&(Q(c),o.g[m].length==0&&(delete o.g[m],o.h--))}}function de(o,c,m,_){for(var D=0;D<o.length;++D){var B=o[D];if(!B.da&&B.listener==c&&B.capture==!!m&&B.ha==_)return D}return-1}var Re="closure_lm_"+(1e6*Math.random()|0),je={};function $e(o,c,m,_,D){if(Array.isArray(c)){for(var B=0;B<c.length;B++)$e(o,c[B],m,_,D);return null}return m=dt(m),o&&o[Xe]?o.K(c,m,f(_)?!!_.capture:!1,D):ht(o,c,m,!1,_,D)}function ht(o,c,m,_,D,B){if(!c)throw Error("Invalid event type");var $=f(D)?!!D.capture:!!D,pe=sn(o);if(pe||(o[Re]=pe=new J(o)),m=pe.add(c,m,_,$,B),m.proxy)return m;if(_=pt(),m.proxy=_,_.src=o,_.listener=m,o.addEventListener)Ce||(D=$),D===void 0&&(D=!1),o.addEventListener(c.toString(),_,D);else if(o.attachEvent)o.attachEvent(St(c.toString()),_);else if(o.addListener&&o.removeListener)o.addListener(_);else throw Error("addEventListener and attachEvent are unavailable.");return m}function pt(){function o(m){return c.call(o.src,o.listener,m)}const c=st;return o}function kn(o,c,m,_,D){if(Array.isArray(c))for(var B=0;B<c.length;B++)kn(o,c[B],m,_,D);else _=f(_)?!!_.capture:!!_,m=dt(m),o&&o[Xe]?(o=o.i,c=String(c).toString(),c in o.g&&(B=o.g[c],m=de(B,m,_,D),-1<m&&(Q(B[m]),Array.prototype.splice.call(B,m,1),B.length==0&&(delete o.g[c],o.h--)))):o&&(o=sn(o))&&(c=o.g[c.toString()],o=-1,c&&(o=de(c,m,_,D)),(m=-1<o?c[o]:null)&&gt(m))}function gt(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Xe])re(c.i,o);else{var m=o.type,_=o.proxy;c.removeEventListener?c.removeEventListener(m,_,o.capture):c.detachEvent?c.detachEvent(St(m),_):c.addListener&&c.removeListener&&c.removeListener(_),(m=sn(c))?(re(m,o),m.h==0&&(m.src=null,c[Re]=null)):Q(o)}}}function St(o){return o in je?je[o]:je[o]="on"+o}function st(o,c){if(o.da)o=!0;else{c=new Me(c,this);var m=o.listener,_=o.ha||o.src;o.fa&&gt(o),o=m.call(_,c)}return o}function sn(o){return o=o[Re],o instanceof J?o:null}var fr="__closure_events_fn_"+(1e9*Math.random()>>>0);function dt(o){return typeof o=="function"?o:(o[fr]||(o[fr]=function(c){return o.handleEvent(c)}),o[fr])}function ze(){Z.call(this),this.i=new J(this),this.M=this,this.F=null}x(ze,Z),ze.prototype[Xe]=!0,ze.prototype.removeEventListener=function(o,c,m,_){kn(this,o,c,m,_)};function p(o,c){var m,_=o.F;if(_)for(m=[];_;_=_.F)m.push(_);if(o=o.M,_=c.type||c,typeof c=="string")c=new ge(c,o);else if(c instanceof ge)c.target=c.target||o;else{var D=c;c=new ge(_,o),v(c,D)}if(D=!0,m)for(var B=m.length-1;0<=B;B--){var $=c.g=m[B];D=u($,_,!0,c)&&D}if($=c.g=o,D=u($,_,!0,c)&&D,D=u($,_,!1,c)&&D,m)for(B=0;B<m.length;B++)$=c.g=m[B],D=u($,_,!1,c)&&D}ze.prototype.N=function(){if(ze.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var m=o.g[c],_=0;_<m.length;_++)Q(m[_]);delete o.g[c],o.h--}}this.F=null},ze.prototype.K=function(o,c,m,_){return this.i.add(String(o),c,!1,m,_)},ze.prototype.L=function(o,c,m,_){return this.i.add(String(o),c,!0,m,_)};function u(o,c,m,_){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var D=!0,B=0;B<c.length;++B){var $=c[B];if($&&!$.da&&$.capture==m){var pe=$.listener,We=$.ha||$.src;$.fa&&re(o.i,$),D=pe.call(We,_)!==!1&&D}}return D&&!_.defaultPrevented}function h(o,c,m){if(typeof o=="function")m&&(o=k(o,m));else if(o&&typeof o.handleEvent=="function")o=k(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:l.setTimeout(o,c||0)}function I(o){o.g=h(()=>{o.g=null,o.i&&(o.i=!1,I(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class R extends Z{constructor(c,m){super(),this.m=c,this.l=m,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:I(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function V(o){Z.call(this),this.h=o,this.g={}}x(V,Z);var F=[];function ie(o){P(o.g,function(c,m){this.g.hasOwnProperty(m)&&gt(c)},o),o.g={}}V.prototype.N=function(){V.aa.N.call(this),ie(this)},V.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ye=l.JSON.stringify,ve=l.JSON.parse,Se=class{stringify(o){return l.JSON.stringify(o,void 0)}parse(o){return l.JSON.parse(o,void 0)}};function fe(){}fe.prototype.h=null;function rl(o){return o.h||(o.h=o.i())}function il(){}var mr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Hs(){ge.call(this,"d")}x(Hs,ge);function Ws(){ge.call(this,"c")}x(Ws,ge);var on={},sl=null;function hi(){return sl=sl||new ze}on.La="serverreachability";function ol(o){ge.call(this,on.La,o)}x(ol,ge);function pr(o){const c=hi();p(c,new ol(c))}on.STAT_EVENT="statevent";function al(o,c){ge.call(this,on.STAT_EVENT,o),this.stat=c}x(al,ge);function nt(o){const c=hi();p(c,new al(c,o))}on.Ma="timingevent";function ll(o,c){ge.call(this,on.Ma,o),this.size=c}x(ll,ge);function gr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){o()},c)}function yr(){this.g=!0}yr.prototype.xa=function(){this.g=!1};function Xd(o,c,m,_,D,B){o.info(function(){if(o.g)if(B)for(var $="",pe=B.split("&"),We=0;We<pe.length;We++){var he=pe[We].split("=");if(1<he.length){var Ye=he[0];he=he[1];var Je=Ye.split("_");$=2<=Je.length&&Je[1]=="type"?$+(Ye+"="+he+"&"):$+(Ye+"=redacted&")}}else $=null;else $=B;return"XMLHTTP REQ ("+_+") [attempt "+D+"]: "+c+`
`+m+`
`+$})}function Yd(o,c,m,_,D,B,$){o.info(function(){return"XMLHTTP RESP ("+_+") [ attempt "+D+"]: "+c+`
`+m+`
`+B+" "+$})}function Rn(o,c,m,_){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Zd(o,m)+(_?" "+_:"")})}function Jd(o,c){o.info(function(){return"TIMEOUT: "+c})}yr.prototype.info=function(){};function Zd(o,c){if(!o.g)return c;if(!c)return null;try{var m=JSON.parse(c);if(m){for(o=0;o<m.length;o++)if(Array.isArray(m[o])){var _=m[o];if(!(2>_.length)){var D=_[1];if(Array.isArray(D)&&!(1>D.length)){var B=D[0];if(B!="noop"&&B!="stop"&&B!="close")for(var $=1;$<D.length;$++)D[$]=""}}}}return ye(m)}catch{return c}}var di={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},cl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Gs;function fi(){}x(fi,fe),fi.prototype.g=function(){return new XMLHttpRequest},fi.prototype.i=function(){return{}},Gs=new fi;function Nt(o,c,m,_){this.j=o,this.i=c,this.l=m,this.R=_||1,this.U=new V(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ul}function ul(){this.i=null,this.g="",this.h=!1}var hl={},Ks={};function Qs(o,c,m){o.L=1,o.v=yi(Ct(c)),o.m=m,o.P=!0,dl(o,null)}function dl(o,c){o.F=Date.now(),mi(o),o.A=Ct(o.v);var m=o.A,_=o.R;Array.isArray(_)||(_=[String(_)]),Sl(m.i,"t",_),o.C=0,m=o.j.J,o.h=new ul,o.g=ql(o.j,m?c:null,!o.m),0<o.O&&(o.M=new R(k(o.Y,o,o.g),o.O)),c=o.U,m=o.g,_=o.ca;var D="readystatechange";Array.isArray(D)||(D&&(F[0]=D.toString()),D=F);for(var B=0;B<D.length;B++){var $=$e(m,D[B],_||c.handleEvent,!1,c.h||c);if(!$)break;c.g[$.key]=$}c=o.H?y(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),pr(),Xd(o.i,o.u,o.A,o.l,o.R,o.m)}Nt.prototype.ca=function(o){o=o.target;const c=this.M;c&&kt(o)==3?c.j():this.Y(o)},Nt.prototype.Y=function(o){try{if(o==this.g)e:{const Je=kt(this.g);var c=this.g.Ba();const Dn=this.g.Z();if(!(3>Je)&&(Je!=3||this.g&&(this.h.h||this.g.oa()||Vl(this.g)))){this.J||Je!=4||c==7||(c==8||0>=Dn?pr(3):pr(2)),Xs(this);var m=this.g.Z();this.X=m;t:if(fl(this)){var _=Vl(this.g);o="";var D=_.length,B=kt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){an(this),vr(this);var $="";break t}this.h.i=new l.TextDecoder}for(c=0;c<D;c++)this.h.h=!0,o+=this.h.i.decode(_[c],{stream:!(B&&c==D-1)});_.length=0,this.h.g+=o,this.C=0,$=this.h.g}else $=this.g.oa();if(this.o=m==200,Yd(this.i,this.u,this.A,this.l,this.R,Je,m),this.o){if(this.T&&!this.K){t:{if(this.g){var pe,We=this.g;if((pe=We.g?We.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(pe)){var he=pe;break t}}he=null}if(m=he)Rn(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ys(this,m);else{this.o=!1,this.s=3,nt(12),an(this),vr(this);break e}}if(this.P){m=!0;let ft;for(;!this.J&&this.C<$.length;)if(ft=ef(this,$),ft==Ks){Je==4&&(this.s=4,nt(14),m=!1),Rn(this.i,this.l,null,"[Incomplete Response]");break}else if(ft==hl){this.s=4,nt(15),Rn(this.i,this.l,$,"[Invalid Chunk]"),m=!1;break}else Rn(this.i,this.l,ft,null),Ys(this,ft);if(fl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Je!=4||$.length!=0||this.h.h||(this.s=1,nt(16),m=!1),this.o=this.o&&m,!m)Rn(this.i,this.l,$,"[Invalid Chunked Response]"),an(this),vr(this);else if(0<$.length&&!this.W){this.W=!0;var Ye=this.j;Ye.g==this&&Ye.ba&&!Ye.M&&(Ye.j.info("Great, no buffering proxy detected. Bytes received: "+$.length),ro(Ye),Ye.M=!0,nt(11))}}else Rn(this.i,this.l,$,null),Ys(this,$);Je==4&&an(this),this.o&&!this.J&&(Je==4?Ul(this.j,this):(this.o=!1,mi(this)))}else vf(this.g),m==400&&0<$.indexOf("Unknown SID")?(this.s=3,nt(12)):(this.s=0,nt(13)),an(this),vr(this)}}}catch{}finally{}};function fl(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function ef(o,c){var m=o.C,_=c.indexOf(`
`,m);return _==-1?Ks:(m=Number(c.substring(m,_)),isNaN(m)?hl:(_+=1,_+m>c.length?Ks:(c=c.slice(_,_+m),o.C=_+m,c)))}Nt.prototype.cancel=function(){this.J=!0,an(this)};function mi(o){o.S=Date.now()+o.I,ml(o,o.I)}function ml(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=gr(k(o.ba,o),c)}function Xs(o){o.B&&(l.clearTimeout(o.B),o.B=null)}Nt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(Jd(this.i,this.A),this.L!=2&&(pr(),nt(17)),an(this),this.s=2,vr(this)):ml(this,this.S-o)};function vr(o){o.j.G==0||o.J||Ul(o.j,o)}function an(o){Xs(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,ie(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function Ys(o,c){try{var m=o.j;if(m.G!=0&&(m.g==o||Js(m.h,o))){if(!o.K&&Js(m.h,o)&&m.G==3){try{var _=m.Da.g.parse(c)}catch{_=null}if(Array.isArray(_)&&_.length==3){var D=_;if(D[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<o.F)Ii(m),wi(m);else break e;no(m),nt(18)}}else m.za=D[1],0<m.za-m.T&&37500>D[2]&&m.F&&m.v==0&&!m.C&&(m.C=gr(k(m.Za,m),6e3));if(1>=yl(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else cn(m,11)}else if((o.K||m.g==o)&&Ii(m),!q(c))for(D=m.Da.g.parse(c),c=0;c<D.length;c++){let he=D[c];if(m.T=he[0],he=he[1],m.G==2)if(he[0]=="c"){m.K=he[1],m.ia=he[2];const Ye=he[3];Ye!=null&&(m.la=Ye,m.j.info("VER="+m.la));const Je=he[4];Je!=null&&(m.Aa=Je,m.j.info("SVER="+m.Aa));const Dn=he[5];Dn!=null&&typeof Dn=="number"&&0<Dn&&(_=1.5*Dn,m.L=_,m.j.info("backChannelRequestTimeoutMs_="+_)),_=m;const ft=o.g;if(ft){const Ai=ft.g?ft.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ai){var B=_.h;B.g||Ai.indexOf("spdy")==-1&&Ai.indexOf("quic")==-1&&Ai.indexOf("h2")==-1||(B.j=B.l,B.g=new Set,B.h&&(Zs(B,B.h),B.h=null))}if(_.D){const io=ft.g?ft.g.getResponseHeader("X-HTTP-Session-Id"):null;io&&(_.ya=io,we(_.I,_.D,io))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-o.F,m.j.info("Handshake RTT: "+m.R+"ms")),_=m;var $=o;if(_.qa=zl(_,_.J?_.ia:null,_.W),$.K){vl(_.h,$);var pe=$,We=_.L;We&&(pe.I=We),pe.B&&(Xs(pe),mi(pe)),_.g=$}else Ol(_);0<m.i.length&&Ti(m)}else he[0]!="stop"&&he[0]!="close"||cn(m,7);else m.G==3&&(he[0]=="stop"||he[0]=="close"?he[0]=="stop"?cn(m,7):to(m):he[0]!="noop"&&m.l&&m.l.ta(he),m.v=0)}}pr(4)}catch{}}var tf=class{constructor(o,c){this.g=o,this.map=c}};function pl(o){this.l=o||10,l.PerformanceNavigationTiming?(o=l.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function gl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function yl(o){return o.h?1:o.g?o.g.size:0}function Js(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Zs(o,c){o.g?o.g.add(c):o.h=c}function vl(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}pl.prototype.cancel=function(){if(this.i=_l(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function _l(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const m of o.g.values())c=c.concat(m.D);return c}return N(o.i)}function nf(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(d(o)){for(var c=[],m=o.length,_=0;_<m;_++)c.push(o[_]);return c}c=[],m=0;for(_ in o)c[m++]=o[_];return c}function rf(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(d(o)||typeof o=="string"){var c=[];o=o.length;for(var m=0;m<o;m++)c.push(m);return c}c=[],m=0;for(const _ in o)c[m++]=_;return c}}}function El(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(d(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var m=rf(o),_=nf(o),D=_.length,B=0;B<D;B++)c.call(void 0,_[B],m&&m[B],o)}var wl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sf(o,c){if(o){o=o.split("&");for(var m=0;m<o.length;m++){var _=o[m].indexOf("="),D=null;if(0<=_){var B=o[m].substring(0,_);D=o[m].substring(_+1)}else B=o[m];c(B,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}function ln(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof ln){this.h=o.h,pi(this,o.j),this.o=o.o,this.g=o.g,gi(this,o.s),this.l=o.l;var c=o.i,m=new wr;m.i=c.i,c.g&&(m.g=new Map(c.g),m.h=c.h),Tl(this,m),this.m=o.m}else o&&(c=String(o).match(wl))?(this.h=!1,pi(this,c[1]||"",!0),this.o=_r(c[2]||""),this.g=_r(c[3]||"",!0),gi(this,c[4]),this.l=_r(c[5]||"",!0),Tl(this,c[6]||"",!0),this.m=_r(c[7]||"")):(this.h=!1,this.i=new wr(null,this.h))}ln.prototype.toString=function(){var o=[],c=this.j;c&&o.push(Er(c,Il,!0),":");var m=this.g;return(m||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Er(c,Il,!0),"@"),o.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&o.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&o.push("/"),o.push(Er(m,m.charAt(0)=="/"?lf:af,!0))),(m=this.i.toString())&&o.push("?",m),(m=this.m)&&o.push("#",Er(m,uf)),o.join("")};function Ct(o){return new ln(o)}function pi(o,c,m){o.j=m?_r(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function gi(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Tl(o,c,m){c instanceof wr?(o.i=c,hf(o.i,o.h)):(m||(c=Er(c,cf)),o.i=new wr(c,o.h))}function we(o,c,m){o.i.set(c,m)}function yi(o){return we(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function _r(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Er(o,c,m){return typeof o=="string"?(o=encodeURI(o).replace(c,of),m&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function of(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Il=/[#\/\?@]/g,af=/[#\?:]/g,lf=/[#\?]/g,cf=/[#\?@]/g,uf=/#/g;function wr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Lt(o){o.g||(o.g=new Map,o.h=0,o.i&&sf(o.i,function(c,m){o.add(decodeURIComponent(c.replace(/\+/g," ")),m)}))}n=wr.prototype,n.add=function(o,c){Lt(this),this.i=null,o=Pn(this,o);var m=this.g.get(o);return m||this.g.set(o,m=[]),m.push(c),this.h+=1,this};function bl(o,c){Lt(o),c=Pn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Al(o,c){return Lt(o),c=Pn(o,c),o.g.has(c)}n.forEach=function(o,c){Lt(this),this.g.forEach(function(m,_){m.forEach(function(D){o.call(c,D,_,this)},this)},this)},n.na=function(){Lt(this);const o=Array.from(this.g.values()),c=Array.from(this.g.keys()),m=[];for(let _=0;_<c.length;_++){const D=o[_];for(let B=0;B<D.length;B++)m.push(c[_])}return m},n.V=function(o){Lt(this);let c=[];if(typeof o=="string")Al(this,o)&&(c=c.concat(this.g.get(Pn(this,o))));else{o=Array.from(this.g.values());for(let m=0;m<o.length;m++)c=c.concat(o[m])}return c},n.set=function(o,c){return Lt(this),this.i=null,o=Pn(this,o),Al(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function Sl(o,c,m){bl(o,c),0<m.length&&(o.i=null,o.g.set(Pn(o,c),N(m)),o.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(var m=0;m<c.length;m++){var _=c[m];const B=encodeURIComponent(String(_)),$=this.V(_);for(_=0;_<$.length;_++){var D=B;$[_]!==""&&(D+="="+encodeURIComponent(String($[_]))),o.push(D)}}return this.i=o.join("&")};function Pn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function hf(o,c){c&&!o.j&&(Lt(o),o.i=null,o.g.forEach(function(m,_){var D=_.toLowerCase();_!=D&&(bl(this,_),Sl(this,D,m))},o)),o.j=c}function df(o,c){const m=new yr;if(l.Image){const _=new Image;_.onload=C(Mt,m,"TestLoadImage: loaded",!0,c,_),_.onerror=C(Mt,m,"TestLoadImage: error",!1,c,_),_.onabort=C(Mt,m,"TestLoadImage: abort",!1,c,_),_.ontimeout=C(Mt,m,"TestLoadImage: timeout",!1,c,_),l.setTimeout(function(){_.ontimeout&&_.ontimeout()},1e4),_.src=o}else c(!1)}function ff(o,c){const m=new yr,_=new AbortController,D=setTimeout(()=>{_.abort(),Mt(m,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:_.signal}).then(B=>{clearTimeout(D),B.ok?Mt(m,"TestPingServer: ok",!0,c):Mt(m,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(D),Mt(m,"TestPingServer: error",!1,c)})}function Mt(o,c,m,_,D){try{D&&(D.onload=null,D.onerror=null,D.onabort=null,D.ontimeout=null),_(m)}catch{}}function mf(){this.g=new Se}function pf(o,c,m){const _=m||"";try{El(o,function(D,B){let $=D;f(D)&&($=ye(D)),c.push(_+B+"="+encodeURIComponent($))})}catch(D){throw c.push(_+"type="+encodeURIComponent("_badmap")),D}}function vi(o){this.l=o.Ub||null,this.j=o.eb||!1}x(vi,fe),vi.prototype.g=function(){return new _i(this.l,this.j)},vi.prototype.i=function(o){return function(){return o}}({});function _i(o,c){ze.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(_i,ze),n=_i.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,Ir(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||l).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Tr(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Ir(this)),this.g&&(this.readyState=3,Ir(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Cl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Cl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Tr(this):Ir(this),this.readyState==3&&Cl(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Tr(this))},n.Qa=function(o){this.g&&(this.response=o,Tr(this))},n.ga=function(){this.g&&Tr(this)};function Tr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Ir(o)}n.setRequestHeader=function(o,c){this.u.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var m=c.next();!m.done;)m=m.value,o.push(m[0]+": "+m[1]),m=c.next();return o.join(`\r
`)};function Ir(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(_i.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function kl(o){let c="";return P(o,function(m,_){c+=_,c+=":",c+=m,c+=`\r
`}),c}function eo(o,c,m){e:{for(_ in m){var _=!1;break e}_=!0}_||(m=kl(m),typeof o=="string"?m!=null&&encodeURIComponent(String(m)):we(o,c,m))}function Pe(o){ze.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Pe,ze);var gf=/^https?$/i,yf=["POST","PUT"];n=Pe.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,c,m,_){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Gs.g(),this.v=this.o?rl(this.o):rl(Gs),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(B){Rl(this,B);return}if(o=m||"",m=new Map(this.headers),_)if(Object.getPrototypeOf(_)===Object.prototype)for(var D in _)m.set(D,_[D]);else if(typeof _.keys=="function"&&typeof _.get=="function")for(const B of _.keys())m.set(B,_.get(B));else throw Error("Unknown input type for opt_headers: "+String(_));_=Array.from(m.keys()).find(B=>B.toLowerCase()=="content-type"),D=l.FormData&&o instanceof l.FormData,!(0<=Array.prototype.indexOf.call(yf,c,void 0))||_||D||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[B,$]of m)this.g.setRequestHeader(B,$);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Dl(this),this.u=!0,this.g.send(o),this.u=!1}catch(B){Rl(this,B)}};function Rl(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,Pl(o),Ei(o)}function Pl(o){o.A||(o.A=!0,p(o,"complete"),p(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,p(this,"complete"),p(this,"abort"),Ei(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ei(this,!0)),Pe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?xl(this):this.bb())},n.bb=function(){xl(this)};function xl(o){if(o.h&&typeof a<"u"&&(!o.v[1]||kt(o)!=4||o.Z()!=2)){if(o.u&&kt(o)==4)h(o.Ea,0,o);else if(p(o,"readystatechange"),kt(o)==4){o.h=!1;try{const $=o.Z();e:switch($){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var m;if(!(m=c)){var _;if(_=$===0){var D=String(o.D).match(wl)[1]||null;!D&&l.self&&l.self.location&&(D=l.self.location.protocol.slice(0,-1)),_=!gf.test(D?D.toLowerCase():"")}m=_}if(m)p(o,"complete"),p(o,"success");else{o.m=6;try{var B=2<kt(o)?o.g.statusText:""}catch{B=""}o.l=B+" ["+o.Z()+"]",Pl(o)}}finally{Ei(o)}}}}function Ei(o,c){if(o.g){Dl(o);const m=o.g,_=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||p(o,"ready");try{m.onreadystatechange=_}catch{}}}function Dl(o){o.I&&(l.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function kt(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<kt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),ve(c)}};function Vl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function vf(o){const c={};o=(o.g&&2<=kt(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let _=0;_<o.length;_++){if(q(o[_]))continue;var m=w(o[_]);const D=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const B=c[D]||[];c[D]=B,B.push(m)}E(c,function(_){return _.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function br(o,c,m){return m&&m.internalChannelParams&&m.internalChannelParams[o]||c}function Bl(o){this.Aa=0,this.i=[],this.j=new yr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=br("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=br("baseRetryDelayMs",5e3,o),this.cb=br("retryDelaySeedMs",1e4,o),this.Wa=br("forwardChannelMaxRetries",2,o),this.wa=br("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new pl(o&&o.concurrentRequestLimit),this.Da=new mf,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Bl.prototype,n.la=8,n.G=1,n.connect=function(o,c,m,_){nt(0),this.W=o,this.H=c||{},m&&_!==void 0&&(this.H.OSID=m,this.H.OAID=_),this.F=this.X,this.I=zl(this,null,this.W),Ti(this)};function to(o){if(Nl(o),o.G==3){var c=o.U++,m=Ct(o.I);if(we(m,"SID",o.K),we(m,"RID",c),we(m,"TYPE","terminate"),Ar(o,m),c=new Nt(o,o.j,c),c.L=2,c.v=yi(Ct(m)),m=!1,l.navigator&&l.navigator.sendBeacon)try{m=l.navigator.sendBeacon(c.v.toString(),"")}catch{}!m&&l.Image&&(new Image().src=c.v,m=!0),m||(c.g=ql(c.j,null),c.g.ea(c.v)),c.F=Date.now(),mi(c)}$l(o)}function wi(o){o.g&&(ro(o),o.g.cancel(),o.g=null)}function Nl(o){wi(o),o.u&&(l.clearTimeout(o.u),o.u=null),Ii(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&l.clearTimeout(o.s),o.s=null)}function Ti(o){if(!gl(o.h)&&!o.s){o.s=!0;var c=o.Ga;Ee||ct(),Ae||(Ee(),Ae=!0),He.add(c,o),o.B=0}}function _f(o,c){return yl(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=gr(k(o.Ga,o,c),jl(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const D=new Nt(this,this.j,o);let B=this.o;if(this.S&&(B?(B=y(B),v(B,this.S)):B=this.S),this.m!==null||this.O||(D.H=B,B=null),this.P)e:{for(var c=0,m=0;m<this.i.length;m++){t:{var _=this.i[m];if("__data__"in _.map&&(_=_.map.__data__,typeof _=="string")){_=_.length;break t}_=void 0}if(_===void 0)break;if(c+=_,4096<c){c=m;break e}if(c===4096||m===this.i.length-1){c=m+1;break e}}c=1e3}else c=1e3;c=Ml(this,D,c),m=Ct(this.I),we(m,"RID",o),we(m,"CVER",22),this.D&&we(m,"X-HTTP-Session-Id",this.D),Ar(this,m),B&&(this.O?c="headers="+encodeURIComponent(String(kl(B)))+"&"+c:this.m&&eo(m,this.m,B)),Zs(this.h,D),this.Ua&&we(m,"TYPE","init"),this.P?(we(m,"$req",c),we(m,"SID","null"),D.T=!0,Qs(D,m,null)):Qs(D,m,c),this.G=2}}else this.G==3&&(o?Ll(this,o):this.i.length==0||gl(this.h)||Ll(this))};function Ll(o,c){var m;c?m=c.l:m=o.U++;const _=Ct(o.I);we(_,"SID",o.K),we(_,"RID",m),we(_,"AID",o.T),Ar(o,_),o.m&&o.o&&eo(_,o.m,o.o),m=new Nt(o,o.j,m,o.B+1),o.m===null&&(m.H=o.o),c&&(o.i=c.D.concat(o.i)),c=Ml(o,m,1e3),m.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Zs(o.h,m),Qs(m,_,c)}function Ar(o,c){o.H&&P(o.H,function(m,_){we(c,_,m)}),o.l&&El({},function(m,_){we(c,_,m)})}function Ml(o,c,m){m=Math.min(o.i.length,m);var _=o.l?k(o.l.Na,o.l,o):null;e:{var D=o.i;let B=-1;for(;;){const $=["count="+m];B==-1?0<m?(B=D[0].g,$.push("ofs="+B)):B=0:$.push("ofs="+B);let pe=!0;for(let We=0;We<m;We++){let he=D[We].g;const Ye=D[We].map;if(he-=B,0>he)B=Math.max(0,D[We].g-100),pe=!1;else try{pf(Ye,$,"req"+he+"_")}catch{_&&_(Ye)}}if(pe){_=$.join("&");break e}}}return o=o.i.splice(0,m),c.D=o,_}function Ol(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Ee||ct(),Ae||(Ee(),Ae=!0),He.add(c,o),o.v=0}}function no(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=gr(k(o.Fa,o),jl(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,Fl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=gr(k(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,nt(10),wi(this),Fl(this))};function ro(o){o.A!=null&&(l.clearTimeout(o.A),o.A=null)}function Fl(o){o.g=new Nt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=Ct(o.qa);we(c,"RID","rpc"),we(c,"SID",o.K),we(c,"AID",o.T),we(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&we(c,"TO",o.ja),we(c,"TYPE","xmlhttp"),Ar(o,c),o.m&&o.o&&eo(c,o.m,o.o),o.L&&(o.g.I=o.L);var m=o.g;o=o.ia,m.L=1,m.v=yi(Ct(c)),m.m=null,m.P=!0,dl(m,o)}n.Za=function(){this.C!=null&&(this.C=null,wi(this),no(this),nt(19))};function Ii(o){o.C!=null&&(l.clearTimeout(o.C),o.C=null)}function Ul(o,c){var m=null;if(o.g==c){Ii(o),ro(o),o.g=null;var _=2}else if(Js(o.h,c))m=c.D,vl(o.h,c),_=1;else return;if(o.G!=0){if(c.o)if(_==1){m=c.m?c.m.length:0,c=Date.now()-c.F;var D=o.B;_=hi(),p(_,new ll(_,m)),Ti(o)}else Ol(o);else if(D=c.s,D==3||D==0&&0<c.X||!(_==1&&_f(o,c)||_==2&&no(o)))switch(m&&0<m.length&&(c=o.h,c.i=c.i.concat(m)),D){case 1:cn(o,5);break;case 4:cn(o,10);break;case 3:cn(o,6);break;default:cn(o,2)}}}function jl(o,c){let m=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(m*=2),m*c}function cn(o,c){if(o.j.info("Error code "+c),c==2){var m=k(o.fb,o),_=o.Xa;const D=!_;_=new ln(_||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||pi(_,"https"),yi(_),D?df(_.toString(),m):ff(_.toString(),m)}else nt(2);o.G=0,o.l&&o.l.sa(c),$l(o),Nl(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),nt(2)):(this.j.info("Failed to ping google.com"),nt(1))};function $l(o){if(o.G=0,o.ka=[],o.l){const c=_l(o.h);(c.length!=0||o.i.length!=0)&&(M(o.ka,c),M(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function zl(o,c,m){var _=m instanceof ln?Ct(m):new ln(m);if(_.g!="")c&&(_.g=c+"."+_.g),gi(_,_.s);else{var D=l.location;_=D.protocol,c=c?c+"."+D.hostname:D.hostname,D=+D.port;var B=new ln(null);_&&pi(B,_),c&&(B.g=c),D&&gi(B,D),m&&(B.l=m),_=B}return m=o.D,c=o.ya,m&&c&&we(_,m,c),we(_,"VER",o.la),Ar(o,_),_}function ql(o,c,m){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new Pe(new vi({eb:m})):new Pe(o.pa),c.Ha(o.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Hl(){}n=Hl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function bi(){}bi.prototype.g=function(o,c){return new it(o,c)};function it(o,c){ze.call(this),this.g=new Bl(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!q(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!q(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new xn(this)}x(it,ze),it.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},it.prototype.close=function(){to(this.g)},it.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var m={};m.__data__=o,o=m}else this.u&&(m={},m.__data__=ye(o),o=m);c.i.push(new tf(c.Ya++,o)),c.G==3&&Ti(c)},it.prototype.N=function(){this.g.l=null,delete this.j,to(this.g),delete this.g,it.aa.N.call(this)};function Wl(o){Hs.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const m in c){o=m;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}x(Wl,Hs);function Gl(){Ws.call(this),this.status=1}x(Gl,Ws);function xn(o){this.g=o}x(xn,Hl),xn.prototype.ua=function(){p(this.g,"a")},xn.prototype.ta=function(o){p(this.g,new Wl(o))},xn.prototype.sa=function(o){p(this.g,new Gl)},xn.prototype.ra=function(){p(this.g,"b")},bi.prototype.createWebChannel=bi.prototype.g,it.prototype.send=it.prototype.o,it.prototype.open=it.prototype.m,it.prototype.close=it.prototype.close,ih=function(){return new bi},rh=function(){return hi()},nh=on,Po={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},di.NO_ERROR=0,di.TIMEOUT=8,di.HTTP_ERROR=6,Hi=di,cl.COMPLETE="complete",th=cl,il.EventType=mr,mr.OPEN="a",mr.CLOSE="b",mr.ERROR="c",mr.MESSAGE="d",ze.prototype.listen=ze.prototype.K,kr=il,Pe.prototype.listenOnce=Pe.prototype.L,Pe.prototype.getLastError=Pe.prototype.Ka,Pe.prototype.getLastErrorCode=Pe.prototype.Ba,Pe.prototype.getStatus=Pe.prototype.Z,Pe.prototype.getResponseJson=Pe.prototype.Oa,Pe.prototype.getResponseText=Pe.prototype.oa,Pe.prototype.send=Pe.prototype.ea,Pe.prototype.setWithCredentials=Pe.prototype.Ha,eh=Pe}).apply(typeof ki<"u"?ki:typeof self<"u"?self:typeof window<"u"?window:{});const uc="@firebase/firestore",hc="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}et.UNAUTHENTICATED=new et(null),et.GOOGLE_CREDENTIALS=new et("google-credentials-uid"),et.FIRST_PARTY=new et("first-party-uid"),et.MOCK_USER=new et("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cr="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _n=new Gu("@firebase/firestore");function On(){return _n.logLevel}function H(n,...e){if(_n.logLevel<=ce.DEBUG){const t=e.map(Ta);_n.debug(`Firestore (${cr}): ${n}`,...t)}}function Vt(n,...e){if(_n.logLevel<=ce.ERROR){const t=e.map(Ta);_n.error(`Firestore (${cr}): ${n}`,...t)}}function Yt(n,...e){if(_n.logLevel<=ce.WARN){const t=e.map(Ta);_n.warn(`Firestore (${cr}): ${n}`,...t)}}function Ta(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,sh(n,r,t)}function sh(n,e,t){let r=`FIRESTORE (${cr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Vt(r),new Error(r)}function me(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||sh(e,i,r)}function ne(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class G extends lr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ip{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(et.UNAUTHENTICATED))}shutdown(){}}class bp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ap{constructor(e){this.t=e,this.currentUser=et.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){me(this.o===void 0,42304);let r=this.i;const i=d=>this.i!==r?(r=this.i,t(d)):Promise.resolve();let s=new Qt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Qt,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const d=s;e.enqueueRetryable(async()=>{await d.promise,await i(this.currentUser)})},l=d=>{H("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(d=>l(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?l(d):(H("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Qt)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(H("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(me(typeof r.accessToken=="string",31837,{l:r}),new oh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return me(e===null||typeof e=="string",2055,{h:e}),new et(e)}}class Sp{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=et.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Cp{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Sp(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(et.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class kp{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,op(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){me(this.o===void 0,3512);const r=s=>{s.error!=null&&H("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,H("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{H("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):H("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new dc(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(me(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new dc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rp(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=Rp(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}}function se(n,e){return n<e?-1:n>e?1:0}function xo(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return se(r,i);{const s=ah(),a=Pp(s.encode(fc(n,t)),s.encode(fc(e,t)));return a!==0?a:se(r,i)}}t+=r>65535?2:1}return se(n.length,e.length)}function fc(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function Pp(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return se(n[t],e[t]);return se(n.length,e.length)}function tr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc="__name__";class yt{constructor(e,t,r){t===void 0?t=0:t>e.length&&X(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&X(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return yt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof yt?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=yt.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return se(e.length,t.length)}static compareSegments(e,t){const r=yt.isNumericId(e),i=yt.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?yt.extractNumericId(e).compare(yt.extractNumericId(t)):xo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Kt.fromString(e.substring(4,e.length-2))}}class Te extends yt{construct(e,t,r){return new Te(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new G(j.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new Te(t)}static emptyPath(){return new Te([])}}const xp=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ke extends yt{construct(e,t,r){return new Ke(e,t,r)}static isValidIdentifier(e){return xp.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ke.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===mc}static keyField(){return new Ke([mc])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new G(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new G(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new G(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(r+=l,i++):(s(),i++)}if(s(),a)throw new G(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ke(t)}static emptyPath(){return new Ke([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(e){this.path=e}static fromPath(e){return new K(Te.fromString(e))}static fromName(e){return new K(Te.fromString(e).popFirst(5))}static empty(){return new K(Te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new K(new Te(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lh(n,e,t){if(!t)throw new G(j.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Dp(n,e,t,r){if(e===!0&&r===!0)throw new G(j.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pc(n){if(!K.isDocumentKey(n))throw new G(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function gc(n){if(K.isDocumentKey(n))throw new G(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ch(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ba(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":X(12329,{type:typeof n})}function xt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new G(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ba(n);throw new G(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n,e){const t={typeString:n};return e&&(t.value=e),t}function oi(n,e){if(!ch(n))throw new G(j.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new G(j.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yc=-62135596800,vc=1e6;class Ie{static now(){return Ie.fromMillis(Date.now())}static fromDate(e){return Ie.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*vc);return new Ie(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new G(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new G(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<yc)throw new G(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new G(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/vc}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ie._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(oi(e,Ie._jsonSchema))return new Ie(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-yc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ie._jsonSchemaVersion="firestore/timestamp/1.0",Ie._jsonSchema={type:Ne("string",Ie._jsonSchemaVersion),seconds:Ne("number"),nanoseconds:Ne("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{static fromTimestamp(e){return new ee(e)}static min(){return new ee(new Ie(0,0))}static max(){return new ee(new Ie(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yr=-1;function Vp(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ee.fromTimestamp(r===1e9?new Ie(t+1,0):new Ie(t,r));return new Jt(i,K.empty(),e)}function Bp(n){return new Jt(n.readTime,n.key,Yr)}class Jt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Jt(ee.min(),K.empty(),Yr)}static max(){return new Jt(ee.max(),K.empty(),Yr)}}function Np(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=K.comparator(n.documentKey,e.documentKey),t!==0?t:se(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Mp{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ur(n){if(n.code!==j.FAILED_PRECONDITION||n.message!==Lp)throw n;H("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&X(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new U((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof U?t:U.resolve(t)}catch(t){return U.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):U.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):U.reject(t)}static resolve(e){return new U((t,r)=>{t(e)})}static reject(e){return new U((t,r)=>{r(e)})}static waitFor(e){return new U((t,r)=>{let i=0,s=0,a=!1;e.forEach(l=>{++i,l.next(()=>{++s,a&&s===i&&t()},d=>r(d))}),a=!0,s===i&&t()})}static or(e){let t=U.resolve(!1);for(const r of e)t=t.next(i=>i?U.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new U((r,i)=>{const s=e.length,a=new Array(s);let l=0;for(let d=0;d<s;d++){const f=d;t(e[f]).next(g=>{a[f]=g,++l,l===s&&r(a)},g=>i(g))}})}static doWhile(e,t){return new U((r,i)=>{const s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}}function Op(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function hr(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this._e(r),this.ae=r=>t.writeSequenceNumber(r))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}Ps.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aa=-1;function xs(n){return n==null}function ds(n){return n===0&&1/n==-1/0}function Fp(n){return typeof n=="number"&&Number.isInteger(n)&&!ds(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uh="";function Up(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=_c(e)),e=jp(n.get(t),e);return _c(e)}function jp(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case uh:t+="";break;default:t+=s}}return t}function _c(n){return n+uh+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function bn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function hh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(e,t){this.comparator=e,this.root=t||Ge.EMPTY}insert(e,t){return new ke(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ge.BLACK,null,null))}remove(e){return new ke(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ge.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ri(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ri(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ri(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ri(this.root,e,this.comparator,!0)}}class Ri{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ge{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Ge.RED,this.left=i??Ge.EMPTY,this.right=s??Ge.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Ge(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ge.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Ge.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ge.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ge.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw X(43730,{key:this.key,value:this.value});if(this.right.isRed())throw X(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw X(27949);return e+(this.isRed()?0:1)}}Ge.EMPTY=null,Ge.RED=!0,Ge.BLACK=!1;Ge.EMPTY=new class{constructor(){this.size=0}get key(){throw X(57766)}get value(){throw X(16141)}get color(){throw X(16727)}get left(){throw X(29726)}get right(){throw X(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ge(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.comparator=e,this.data=new ke(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new wc(this.data.getIterator())}getIteratorFrom(e){return new wc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ue)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ue(this.comparator);return t.data=e,t}}class wc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e){this.fields=e,e.sort(Ke.comparator)}static empty(){return new mt([])}unionWith(e){let t=new Ue(Ke.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new mt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new dh("Invalid base64 string: "+s):s}}(e);return new Qe(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new Qe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qe.EMPTY_BYTE_STRING=new Qe("");const $p=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zt(n){if(me(!!n,39018),typeof n=="string"){let e=0;const t=$p.exec(n);if(me(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ve(n.seconds),nanos:Ve(n.nanos)}}function Ve(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function en(n){return typeof n=="string"?Qe.fromBase64String(n):Qe.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fh="server_timestamp",mh="__type__",ph="__previous_value__",gh="__local_write_time__";function Sa(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[mh])===null||t===void 0?void 0:t.stringValue)===fh}function Ds(n){const e=n.mapValue.fields[ph];return Sa(e)?Ds(e):e}function Jr(n){const e=Zt(n.mapValue.fields[gh].timestampValue);return new Ie(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,t,r,i,s,a,l,d,f,g){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=d,this.useFetchStreams=f,this.isUsingEmulator=g}}const fs="(default)";class Zr{constructor(e,t){this.projectId=e,this.database=t||fs}static empty(){return new Zr("","")}get isDefaultDatabase(){return this.database===fs}isEqual(e){return e instanceof Zr&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yh="__type__",qp="__max__",Pi={mapValue:{}},vh="__vector__",ms="value";function tn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Sa(n)?4:Wp(n)?9007199254740991:Hp(n)?10:11:X(28295,{value:n})}function bt(n,e){if(n===e)return!0;const t=tn(n);if(t!==tn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Jr(n).isEqual(Jr(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Zt(i.timestampValue),l=Zt(s.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return en(i.bytesValue).isEqual(en(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Ve(i.geoPointValue.latitude)===Ve(s.geoPointValue.latitude)&&Ve(i.geoPointValue.longitude)===Ve(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ve(i.integerValue)===Ve(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Ve(i.doubleValue),l=Ve(s.doubleValue);return a===l?ds(a)===ds(l):isNaN(a)&&isNaN(l)}return!1}(n,e);case 9:return tr(n.arrayValue.values||[],e.arrayValue.values||[],bt);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},l=s.mapValue.fields||{};if(Ec(a)!==Ec(l))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(l[d]===void 0||!bt(a[d],l[d])))return!1;return!0}(n,e);default:return X(52216,{left:n})}}function ei(n,e){return(n.values||[]).find(t=>bt(t,e))!==void 0}function nr(n,e){if(n===e)return 0;const t=tn(n),r=tn(e);if(t!==r)return se(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(n.booleanValue,e.booleanValue);case 2:return function(s,a){const l=Ve(s.integerValue||s.doubleValue),d=Ve(a.integerValue||a.doubleValue);return l<d?-1:l>d?1:l===d?0:isNaN(l)?isNaN(d)?0:-1:1}(n,e);case 3:return Tc(n.timestampValue,e.timestampValue);case 4:return Tc(Jr(n),Jr(e));case 5:return xo(n.stringValue,e.stringValue);case 6:return function(s,a){const l=en(s),d=en(a);return l.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const l=s.split("/"),d=a.split("/");for(let f=0;f<l.length&&f<d.length;f++){const g=se(l[f],d[f]);if(g!==0)return g}return se(l.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const l=se(Ve(s.latitude),Ve(a.latitude));return l!==0?l:se(Ve(s.longitude),Ve(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Ic(n.arrayValue,e.arrayValue);case 10:return function(s,a){var l,d,f,g;const A=s.fields||{},k=a.fields||{},C=(l=A[ms])===null||l===void 0?void 0:l.arrayValue,x=(d=k[ms])===null||d===void 0?void 0:d.arrayValue,N=se(((f=C?.values)===null||f===void 0?void 0:f.length)||0,((g=x?.values)===null||g===void 0?void 0:g.length)||0);return N!==0?N:Ic(C,x)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===Pi.mapValue&&a===Pi.mapValue)return 0;if(s===Pi.mapValue)return 1;if(a===Pi.mapValue)return-1;const l=s.fields||{},d=Object.keys(l),f=a.fields||{},g=Object.keys(f);d.sort(),g.sort();for(let A=0;A<d.length&&A<g.length;++A){const k=xo(d[A],g[A]);if(k!==0)return k;const C=nr(l[d[A]],f[g[A]]);if(C!==0)return C}return se(d.length,g.length)}(n.mapValue,e.mapValue);default:throw X(23264,{le:t})}}function Tc(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return se(n,e);const t=Zt(n),r=Zt(e),i=se(t.seconds,r.seconds);return i!==0?i:se(t.nanos,r.nanos)}function Ic(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=nr(t[i],r[i]);if(s)return s}return se(t.length,r.length)}function rr(n){return Do(n)}function Do(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Zt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return en(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return K.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Do(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${Do(t.fields[a])}`;return i+"}"}(n.mapValue):X(61005,{value:n})}function Wi(n){switch(tn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ds(n);return e?16+Wi(e):16;case 5:return 2*n.stringValue.length;case 6:return en(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+Wi(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return bn(r.fields,(s,a)=>{i+=s.length+Wi(a)}),i}(n.mapValue);default:throw X(13486,{value:n})}}function Vo(n){return!!n&&"integerValue"in n}function Ca(n){return!!n&&"arrayValue"in n}function bc(n){return!!n&&"nullValue"in n}function Ac(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Gi(n){return!!n&&"mapValue"in n}function Hp(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[yh])===null||t===void 0?void 0:t.stringValue)===vh}function Or(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return bn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Or(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Or(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Wp(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===qp}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e){this.value=e}static empty(){return new at({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Gi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Or(t)}setAll(e){let t=Ke.emptyPath(),r={},i=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=l.popLast()}a?r[l.lastSegment()]=Or(a):i.push(l.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Gi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return bt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Gi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){bn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new at(Or(this.value))}}function _h(n){const e=[];return bn(n.fields,(t,r)=>{const i=new Ke([t]);if(Gi(r)){const s=_h(r.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new mt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e,t,r,i,s,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=l}static newInvalidDocument(e){return new tt(e,0,ee.min(),ee.min(),ee.min(),at.empty(),0)}static newFoundDocument(e,t,r,i){return new tt(e,1,t,ee.min(),r,i,0)}static newNoDocument(e,t){return new tt(e,2,t,ee.min(),ee.min(),at.empty(),0)}static newUnknownDocument(e,t){return new tt(e,3,t,ee.min(),ee.min(),at.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ee.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=at.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=at.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e,t){this.position=e,this.inclusive=t}}function Sc(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(s.field.isKeyField()?r=K.comparator(K.fromName(a.referenceValue),t.key):r=nr(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Cc(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!bt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e,t="asc"){this.field=e,this.dir=t}}function Gp(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{}class Fe extends Eh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Qp(e,t,r):t==="array-contains"?new Jp(e,r):t==="in"?new Zp(e,r):t==="not-in"?new eg(e,r):t==="array-contains-any"?new tg(e,r):new Fe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Xp(e,r):new Yp(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(nr(t,this.value)):t!==null&&tn(this.value)===tn(t)&&this.matchesComparison(nr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return X(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class At extends Eh{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new At(e,t)}matches(e){return wh(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function wh(n){return n.op==="and"}function Th(n){return Kp(n)&&wh(n)}function Kp(n){for(const e of n.filters)if(e instanceof At)return!1;return!0}function Bo(n){if(n instanceof Fe)return n.field.canonicalString()+n.op.toString()+rr(n.value);if(Th(n))return n.filters.map(e=>Bo(e)).join(",");{const e=n.filters.map(t=>Bo(t)).join(",");return`${n.op}(${e})`}}function Ih(n,e){return n instanceof Fe?function(r,i){return i instanceof Fe&&r.op===i.op&&r.field.isEqual(i.field)&&bt(r.value,i.value)}(n,e):n instanceof At?function(r,i){return i instanceof At&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,l)=>s&&Ih(a,i.filters[l]),!0):!1}(n,e):void X(19439)}function bh(n){return n instanceof Fe?function(t){return`${t.field.canonicalString()} ${t.op} ${rr(t.value)}`}(n):n instanceof At?function(t){return t.op.toString()+" {"+t.getFilters().map(bh).join(" ,")+"}"}(n):"Filter"}class Qp extends Fe{constructor(e,t,r){super(e,t,r),this.key=K.fromName(r.referenceValue)}matches(e){const t=K.comparator(e.key,this.key);return this.matchesComparison(t)}}class Xp extends Fe{constructor(e,t){super(e,"in",t),this.keys=Ah("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Yp extends Fe{constructor(e,t){super(e,"not-in",t),this.keys=Ah("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ah(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>K.fromName(r.referenceValue))}class Jp extends Fe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ca(t)&&ei(t.arrayValue,this.value)}}class Zp extends Fe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ei(this.value.arrayValue,t)}}class eg extends Fe{constructor(e,t){super(e,"not-in",t)}matches(e){if(ei(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ei(this.value.arrayValue,t)}}class tg extends Fe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ca(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ei(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e,t=null,r=[],i=[],s=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=l,this.Pe=null}}function kc(n,e=null,t=[],r=[],i=null,s=null,a=null){return new ng(n,e,t,r,i,s,a)}function ka(n){const e=ne(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Bo(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),xs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>rr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>rr(r)).join(",")),e.Pe=t}return e.Pe}function Ra(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Gp(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Ih(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Cc(n.startAt,e.startAt)&&Cc(n.endAt,e.endAt)}function No(n){return K.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(e,t=null,r=[],i=[],s=null,a="F",l=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=l,this.endAt=d,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function rg(n,e,t,r,i,s,a,l){return new Vs(n,e,t,r,i,s,a,l)}function Bs(n){return new Vs(n)}function Rc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ig(n){return n.collectionGroup!==null}function Fr(n){const e=ne(n);if(e.Te===null){e.Te=[];const t=new Set;for(const s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new Ue(Ke.comparator);return a.filters.forEach(d=>{d.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new gs(s,r))}),t.has(Ke.keyField().canonicalString())||e.Te.push(new gs(Ke.keyField(),r))}return e.Te}function vt(n){const e=ne(n);return e.Ie||(e.Ie=sg(e,Fr(n))),e.Ie}function sg(n,e){if(n.limitType==="F")return kc(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new gs(i.field,s)});const t=n.endAt?new ps(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ps(n.startAt.position,n.startAt.inclusive):null;return kc(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Lo(n,e,t){return new Vs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ns(n,e){return Ra(vt(n),vt(e))&&n.limitType===e.limitType}function Sh(n){return`${ka(vt(n))}|lt:${n.limitType}`}function Fn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>bh(i)).join(", ")}]`),xs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>rr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>rr(i)).join(",")),`Target(${r})`}(vt(n))}; limitType=${n.limitType})`}function Ls(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):K.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Fr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,l,d){const f=Sc(a,l,d);return a.inclusive?f<=0:f<0}(r.startAt,Fr(r),i)||r.endAt&&!function(a,l,d){const f=Sc(a,l,d);return a.inclusive?f>=0:f>0}(r.endAt,Fr(r),i))}(n,e)}function og(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Ch(n){return(e,t)=>{let r=!1;for(const i of Fr(n)){const s=ag(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function ag(n,e,t){const r=n.field.isKeyField()?K.comparator(e.key,t.key):function(s,a,l){const d=a.data.field(s),f=l.data.field(s);return d!==null&&f!==null?nr(d,f):X(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return X(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){bn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return hh(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lg=new ke(K.comparator);function Bt(){return lg}const kh=new ke(K.comparator);function Rr(...n){let e=kh;for(const t of n)e=e.insert(t.key,t);return e}function Rh(n){let e=kh;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function mn(){return Ur()}function Ph(){return Ur()}function Ur(){return new An(n=>n.toString(),(n,e)=>n.isEqual(e))}const cg=new ke(K.comparator),ug=new Ue(K.comparator);function oe(...n){let e=ug;for(const t of n)e=e.add(t);return e}const hg=new Ue(se);function dg(){return hg}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pa(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ds(e)?"-0":e}}function xh(n){return{integerValue:""+n}}function fg(n,e){return Fp(e)?xh(e):Pa(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(){this._=void 0}}function mg(n,e,t){return n instanceof ys?function(i,s){const a={fields:{[mh]:{stringValue:fh},[gh]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Sa(s)&&(s=Ds(s)),s&&(a.fields[ph]=s),{mapValue:a}}(t,e):n instanceof ti?Vh(n,e):n instanceof ni?Bh(n,e):function(i,s){const a=Dh(i,s),l=Pc(a)+Pc(i.Ee);return Vo(a)&&Vo(i.Ee)?xh(l):Pa(i.serializer,l)}(n,e)}function pg(n,e,t){return n instanceof ti?Vh(n,e):n instanceof ni?Bh(n,e):t}function Dh(n,e){return n instanceof vs?function(r){return Vo(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class ys extends Ms{}class ti extends Ms{constructor(e){super(),this.elements=e}}function Vh(n,e){const t=Nh(e);for(const r of n.elements)t.some(i=>bt(i,r))||t.push(r);return{arrayValue:{values:t}}}class ni extends Ms{constructor(e){super(),this.elements=e}}function Bh(n,e){let t=Nh(e);for(const r of n.elements)t=t.filter(i=>!bt(i,r));return{arrayValue:{values:t}}}class vs extends Ms{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Pc(n){return Ve(n.integerValue||n.doubleValue)}function Nh(n){return Ca(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function gg(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof ti&&i instanceof ti||r instanceof ni&&i instanceof ni?tr(r.elements,i.elements,bt):r instanceof vs&&i instanceof vs?bt(r.Ee,i.Ee):r instanceof ys&&i instanceof ys}(n.transform,e.transform)}class yg{constructor(e,t){this.version=e,this.transformResults=t}}class _t{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new _t}static exists(e){return new _t(void 0,e)}static updateTime(e){return new _t(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ki(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Os{}function Lh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new xa(n.key,_t.none()):new ai(n.key,n.data,_t.none());{const t=n.data,r=at.empty();let i=new Ue(Ke.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new Sn(n.key,r,new mt(i.toArray()),_t.none())}}function vg(n,e,t){n instanceof ai?function(i,s,a){const l=i.value.clone(),d=Dc(i.fieldTransforms,s,a.transformResults);l.setAll(d),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):n instanceof Sn?function(i,s,a){if(!Ki(i.precondition,s))return void s.convertToUnknownDocument(a.version);const l=Dc(i.fieldTransforms,s,a.transformResults),d=s.data;d.setAll(Mh(i)),d.setAll(l),s.convertToFoundDocument(a.version,d).setHasCommittedMutations()}(n,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function jr(n,e,t,r){return n instanceof ai?function(s,a,l,d){if(!Ki(s.precondition,a))return l;const f=s.value.clone(),g=Vc(s.fieldTransforms,d,a);return f.setAll(g),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof Sn?function(s,a,l,d){if(!Ki(s.precondition,a))return l;const f=Vc(s.fieldTransforms,d,a),g=a.data;return g.setAll(Mh(s)),g.setAll(f),a.convertToFoundDocument(a.version,g).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(A=>A.field))}(n,e,t,r):function(s,a,l){return Ki(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,e,t)}function _g(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=Dh(r.transform,i||null);s!=null&&(t===null&&(t=at.empty()),t.set(r.field,s))}return t||null}function xc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&tr(r,i,(s,a)=>gg(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ai extends Os{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Sn extends Os{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Mh(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Dc(n,e,t){const r=new Map;me(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,l=e.data.field(s.field);r.set(s.field,pg(a,l,t[i]))}return r}function Vc(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,mg(s,a,e))}return r}class xa extends Os{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Eg extends Os{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&vg(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=jr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=jr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Ph();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let l=this.applyToLocalView(a,s.mutatedFields);l=t.has(i.key)?null:l;const d=Lh(a,l);d!==null&&r.set(i.key,d),a.isValidDocument()||a.convertToNoDocument(ee.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oe())}isEqual(e){return this.batchId===e.batchId&&tr(this.mutations,e.mutations,(t,r)=>xc(t,r))&&tr(this.baseMutations,e.baseMutations,(t,r)=>xc(t,r))}}class Da{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){me(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=function(){return cg}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new Da(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Be,le;function bg(n){switch(n){case j.OK:return X(64938);case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0;default:return X(15467,{code:n})}}function Oh(n){if(n===void 0)return Vt("GRPC error has no .code"),j.UNKNOWN;switch(n){case Be.OK:return j.OK;case Be.CANCELLED:return j.CANCELLED;case Be.UNKNOWN:return j.UNKNOWN;case Be.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case Be.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case Be.INTERNAL:return j.INTERNAL;case Be.UNAVAILABLE:return j.UNAVAILABLE;case Be.UNAUTHENTICATED:return j.UNAUTHENTICATED;case Be.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case Be.NOT_FOUND:return j.NOT_FOUND;case Be.ALREADY_EXISTS:return j.ALREADY_EXISTS;case Be.PERMISSION_DENIED:return j.PERMISSION_DENIED;case Be.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case Be.ABORTED:return j.ABORTED;case Be.OUT_OF_RANGE:return j.OUT_OF_RANGE;case Be.UNIMPLEMENTED:return j.UNIMPLEMENTED;case Be.DATA_LOSS:return j.DATA_LOSS;default:return X(39323,{code:n})}}(le=Be||(Be={}))[le.OK=0]="OK",le[le.CANCELLED=1]="CANCELLED",le[le.UNKNOWN=2]="UNKNOWN",le[le.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",le[le.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",le[le.NOT_FOUND=5]="NOT_FOUND",le[le.ALREADY_EXISTS=6]="ALREADY_EXISTS",le[le.PERMISSION_DENIED=7]="PERMISSION_DENIED",le[le.UNAUTHENTICATED=16]="UNAUTHENTICATED",le[le.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",le[le.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",le[le.ABORTED=10]="ABORTED",le[le.OUT_OF_RANGE=11]="OUT_OF_RANGE",le[le.UNIMPLEMENTED=12]="UNIMPLEMENTED",le[le.INTERNAL=13]="INTERNAL",le[le.UNAVAILABLE=14]="UNAVAILABLE",le[le.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ag=new Kt([4294967295,4294967295],0);function Bc(n){const e=ah().encode(n),t=new Zu;return t.update(e),new Uint8Array(t.digest())}function Nc(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Kt([t,r],0),new Kt([i,s],0)]}class Va{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Pr(`Invalid padding: ${t}`);if(r<0)throw new Pr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Pr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Pr(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Kt.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(Kt.fromNumber(r)));return i.compare(Ag)===1&&(i=new Kt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;const t=Bc(e),[r,i]=Nc(t);for(let s=0;s<this.hashCount;s++){const a=this.pe(r,i,s);if(!this.ye(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Va(s,i,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.fe===0)return;const t=Bc(e),[r,i]=Nc(t);for(let s=0;s<this.hashCount;s++){const a=this.pe(r,i,s);this.we(a)}}we(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Pr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,li.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Fs(ee.min(),i,new ke(se),Bt(),oe())}}class li{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new li(r,t,oe(),oe(),oe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}}class Fh{constructor(e,t){this.targetId=e,this.De=t}}class Uh{constructor(e,t,r=Qe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Lc{constructor(){this.ve=0,this.Ce=Mc(),this.Fe=Qe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=oe(),t=oe(),r=oe();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:X(38017,{changeType:s})}}),new li(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=Mc()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,me(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class Sg{constructor(e){this.We=e,this.Ge=new Map,this.ze=Bt(),this.je=xi(),this.Je=xi(),this.He=new ke(se)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:X(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){const t=e.targetId,r=e.De.count,i=this.st(t);if(i){const s=i.target;if(No(s))if(r===0){const a=new K(s.path);this.Xe(t,a,tt.newNoDocument(a,ee.min()))}else me(r===1,20013,{expectedCount:r});else{const a=this.ot(t);if(a!==r){const l=this._t(e),d=l?this.ut(l,e,a):1;if(d!==0){this.rt(t);const f=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,f)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let a,l;try{a=en(r).toUint8Array()}catch(d){if(d instanceof dh)return Yt("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{l=new Va(a,i,s)}catch(d){return Yt(d instanceof Pr?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return l.fe===0?null:l}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){const r=this.We.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const a=this.We.lt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.Xe(t,s,null),i++)}),i}Pt(e){const t=new Map;this.Ge.forEach((s,a)=>{const l=this.st(a);if(l){if(s.current&&No(l.target)){const d=new K(l.target.path);this.Tt(d).has(a)||this.It(a,d)||this.Xe(a,d,tt.newNoDocument(d,e))}s.Ne&&(t.set(a,s.Le()),s.ke())}});let r=oe();this.Je.forEach((s,a)=>{let l=!0;a.forEachWhile(d=>{const f=this.st(d);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(e));const i=new Fs(e,t,this.He,this.ze,r);return this.ze=Bt(),this.je=xi(),this.Je=xi(),this.He=new ke(se),i}Ze(e,t){if(!this.nt(e))return;const r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;const i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Lc,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new Ue(se),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new Ue(se),this.je=this.je.insert(e,t)),t}nt(e){const t=this.st(e)!==null;return t||H("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Lc),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function xi(){return new ke(K.comparator)}function Mc(){return new ke(K.comparator)}const Cg={asc:"ASCENDING",desc:"DESCENDING"},kg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Rg={and:"AND",or:"OR"};class Pg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Mo(n,e){return n.useProto3Json||xs(e)?e:{value:e}}function _s(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function xg(n,e){return _s(n,e.toTimestamp())}function Et(n){return me(!!n,49232),ee.fromTimestamp(function(t){const r=Zt(t);return new Ie(r.seconds,r.nanos)}(n))}function Ba(n,e){return Oo(n,e).canonicalString()}function Oo(n,e){const t=function(i){return new Te(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function $h(n){const e=Te.fromString(n);return me(Gh(e),10190,{key:e.toString()}),e}function Fo(n,e){return Ba(n.databaseId,e.path)}function co(n,e){const t=$h(e);if(t.get(1)!==n.databaseId.projectId)throw new G(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new G(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new K(qh(t))}function zh(n,e){return Ba(n.databaseId,e)}function Dg(n){const e=$h(n);return e.length===4?Te.emptyPath():qh(e)}function Uo(n){return new Te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function qh(n){return me(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Oc(n,e,t){return{name:Fo(n,e),fields:t.value.mapValue.fields}}function Vg(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:X(39313,{state:f})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(f,g){return f.useProto3Json?(me(g===void 0||typeof g=="string",58123),Qe.fromBase64String(g||"")):(me(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),Qe.fromUint8Array(g||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(f){const g=f.code===void 0?j.UNKNOWN:Oh(f.code);return new G(g,f.message||"")}(a);t=new Uh(r,i,s,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=co(n,r.document.name),s=Et(r.document.updateTime),a=r.document.createTime?Et(r.document.createTime):ee.min(),l=new at({mapValue:{fields:r.document.fields}}),d=tt.newFoundDocument(i,s,a,l),f=r.targetIds||[],g=r.removedTargetIds||[];t=new Qi(f,g,d.key,d)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=co(n,r.document),s=r.readTime?Et(r.readTime):ee.min(),a=tt.newNoDocument(i,s),l=r.removedTargetIds||[];t=new Qi([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=co(n,r.document),s=r.removedTargetIds||[];t=new Qi([],s,i,null)}else{if(!("filter"in e))return X(11601,{At:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new Ig(i,s),l=r.targetId;t=new Fh(l,a)}}return t}function Bg(n,e){let t;if(e instanceof ai)t={update:Oc(n,e.key,e.value)};else if(e instanceof xa)t={delete:Fo(n,e.key)};else if(e instanceof Sn)t={update:Oc(n,e.key,e.data),updateMask:zg(e.fieldMask)};else{if(!(e instanceof Eg))return X(16599,{Rt:e.type});t={verify:Fo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const l=a.transform;if(l instanceof ys)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ti)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ni)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof vs)return{fieldPath:a.field.canonicalString(),increment:l.Ee};throw X(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:xg(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:X(27497)}(n,e.precondition)),t}function Ng(n,e){return n&&n.length>0?(me(e!==void 0,14353),n.map(t=>function(i,s){let a=i.updateTime?Et(i.updateTime):Et(s);return a.isEqual(ee.min())&&(a=Et(s)),new yg(a,i.transformResults||[])}(t,e))):[]}function Lg(n,e){return{documents:[zh(n,e.path)]}}function Mg(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=zh(n,i);const s=function(f){if(f.length!==0)return Wh(At.create(f,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(f){if(f.length!==0)return f.map(g=>function(k){return{field:Un(k.field),direction:Ug(k.dir)}}(g))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=Mo(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{Vt:t,parent:i}}function Og(n){let e=Dg(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){me(r===1,65062);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(A){const k=Hh(A);return k instanceof At&&Th(k)?k.getFilters():[k]}(t.where));let a=[];t.orderBy&&(a=function(A){return A.map(k=>function(x){return new gs(jn(x.field),function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(k))}(t.orderBy));let l=null;t.limit&&(l=function(A){let k;return k=typeof A=="object"?A.value:A,xs(k)?null:k}(t.limit));let d=null;t.startAt&&(d=function(A){const k=!!A.before,C=A.values||[];return new ps(C,k)}(t.startAt));let f=null;return t.endAt&&(f=function(A){const k=!A.before,C=A.values||[];return new ps(C,k)}(t.endAt)),rg(e,i,a,s,l,"F",d,f)}function Fg(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return X(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Hh(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=jn(t.unaryFilter.field);return Fe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=jn(t.unaryFilter.field);return Fe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=jn(t.unaryFilter.field);return Fe.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=jn(t.unaryFilter.field);return Fe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return X(61313);default:return X(60726)}}(n):n.fieldFilter!==void 0?function(t){return Fe.create(jn(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return X(58110);default:return X(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return At.create(t.compositeFilter.filters.map(r=>Hh(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return X(1026)}}(t.compositeFilter.op))}(n):X(30097,{filter:n})}function Ug(n){return Cg[n]}function jg(n){return kg[n]}function $g(n){return Rg[n]}function Un(n){return{fieldPath:n.canonicalString()}}function jn(n){return Ke.fromServerFormat(n.fieldPath)}function Wh(n){return n instanceof Fe?function(t){if(t.op==="=="){if(Ac(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NAN"}};if(bc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ac(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NAN"}};if(bc(t.value))return{unaryFilter:{field:Un(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Un(t.field),op:jg(t.op),value:t.value}}}(n):n instanceof At?function(t){const r=t.getFilters().map(i=>Wh(i));return r.length===1?r[0]:{compositeFilter:{op:$g(t.op),filters:r}}}(n):X(54877,{filter:n})}function zg(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Gh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e,t,r,i,s=ee.min(),a=ee.min(),l=Qe.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=d}withSequenceNumber(e){return new zt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new zt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new zt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new zt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg{constructor(e){this.gt=e}}function Hg(n){const e=Og({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Lo(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(){this.Dn=new Gg}addToCollectionParentIndex(e,t){return this.Dn.add(t),U.resolve()}getCollectionParents(e,t){return U.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return U.resolve()}deleteFieldIndex(e,t){return U.resolve()}deleteAllFieldIndexes(e){return U.resolve()}createTargetIndexes(e,t){return U.resolve()}getDocumentsMatchingTarget(e,t){return U.resolve(null)}getIndexType(e,t){return U.resolve(0)}getFieldIndexes(e,t){return U.resolve([])}getNextCollectionGroupToUpdate(e){return U.resolve(null)}getMinOffset(e,t){return U.resolve(Jt.min())}getMinOffsetFromCollectionGroup(e,t){return U.resolve(Jt.min())}updateCollectionGroup(e,t,r){return U.resolve()}updateIndexEntries(e,t){return U.resolve()}}class Gg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ue(Te.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ue(Te.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Kh=41943040;class rt{static withCacheSize(e){return new rt(e,rt.DEFAULT_COLLECTION_PERCENTILE,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rt.DEFAULT_COLLECTION_PERCENTILE=10,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rt.DEFAULT=new rt(Kh,rt.DEFAULT_COLLECTION_PERCENTILE,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rt.DISABLED=new rt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new ir(0)}static ur(){return new ir(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uc="LruGarbageCollector",Kg=1048576;function jc([n,e],[t,r]){const i=se(n,t);return i===0?se(e,r):i}class Qg{constructor(e){this.Tr=e,this.buffer=new Ue(jc),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();jc(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Xg{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){H(Uc,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){hr(t)?H(Uc,"Ignoring IndexedDB error during garbage collection: ",t):await ur(t)}await this.Rr(3e5)})}}class Yg{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return U.resolve(Ps.ue);const r=new Qg(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(H("LruGarbageCollector","Garbage collection skipped; disabled"),U.resolve(Fc)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(H("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fc):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,a,l,d,f;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(H("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),i=this.params.maximumSequenceNumbersToCollect):i=A,a=Date.now(),this.nthSequenceNumber(e,i))).next(A=>(r=A,l=Date.now(),this.removeTargets(e,r,t))).next(A=>(s=A,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(A=>(f=Date.now(),On()<=ce.DEBUG&&H("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-g}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${s} targets in `+(d-l)+`ms
	Removed ${A} documents in `+(f-d)+`ms
Total Duration: ${f-g}ms`),U.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:A})))}}function Jg(n,e){return new Yg(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zg{constructor(){this.changes=new An(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?U.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ey{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&jr(r.mutation,i,mt.empty(),Ie.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,oe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=oe()){const i=mn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=Rr();return s.forEach((l,d)=>{a=a.insert(l,d.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=mn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oe()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,i){let s=Bt();const a=Ur(),l=function(){return Ur()}();return t.forEach((d,f)=>{const g=r.get(f.key);i.has(f.key)&&(g===void 0||g.mutation instanceof Sn)?s=s.insert(f.key,f):g!==void 0?(a.set(f.key,g.mutation.getFieldMask()),jr(g.mutation,f,g.mutation.getFieldMask(),Ie.now())):a.set(f.key,mt.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((f,g)=>a.set(f,g)),t.forEach((f,g)=>{var A;return l.set(f,new ey(g,(A=a.get(f))!==null&&A!==void 0?A:null))}),l))}recalculateAndSaveOverlays(e,t){const r=Ur();let i=new ke((a,l)=>a-l),s=oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const l of a)l.keys().forEach(d=>{const f=t.get(d);if(f===null)return;let g=r.get(d)||mt.empty();g=l.applyToLocalView(f,g),r.set(d,g);const A=(i.get(l.batchId)||oe()).add(d);i=i.insert(l.batchId,A)})}).next(()=>{const a=[],l=i.getReverseIterator();for(;l.hasNext();){const d=l.getNext(),f=d.key,g=d.value,A=Ph();g.forEach(k=>{if(!s.has(k)){const C=Lh(t.get(k),r.get(k));C!==null&&A.set(k,C),s=s.add(k)}}),a.push(this.documentOverlayCache.saveOverlays(e,f,A))}return U.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return K.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ig(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):U.resolve(mn());let l=Yr,d=s;return a.next(f=>U.forEach(f,(g,A)=>(l<A.largestBatchId&&(l=A.largestBatchId),s.get(g)?U.resolve():this.remoteDocumentCache.getEntry(e,g).next(k=>{d=d.insert(g,k)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,d,f,oe())).next(g=>({batchId:l,changes:Rh(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new K(t)).next(r=>{let i=Rr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let a=Rr();return this.indexManager.getCollectionParents(e,s).next(l=>U.forEach(l,d=>{const f=function(A,k){return new Vs(k,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(t,d.child(s));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(g=>{g.forEach((A,k)=>{a=a.insert(A,k)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((d,f)=>{const g=f.getKey();a.get(g)===null&&(a=a.insert(g,tt.newInvalidDocument(g)))});let l=Rr();return a.forEach((d,f)=>{const g=s.get(d);g!==void 0&&jr(g.mutation,f,mt.empty(),Ie.now()),Ls(t,f)&&(l=l.insert(d,f))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ny{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return U.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Et(i.createTime)}}(t)),U.resolve()}getNamedQuery(e,t){return U.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(i){return{name:i.name,query:Hg(i.bundledQuery),readTime:Et(i.readTime)}}(t)),U.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry{constructor(){this.overlays=new ke(K.comparator),this.kr=new Map}getOverlay(e,t){return U.resolve(this.overlays.get(t))}getOverlays(e,t){const r=mn();return U.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),U.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),U.resolve()}getOverlaysForCollection(e,t,r){const i=mn(),s=t.length+1,a=new K(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const d=l.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return U.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ke((f,g)=>f-g);const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let g=s.get(f.largestBatchId);g===null&&(g=mn(),s=s.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const l=mn(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((f,g)=>l.set(f,g)),!(l.size()>=i)););return U.resolve(l)}wt(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Tg(t,r));let s=this.kr.get(t);s===void 0&&(s=oe(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iy{constructor(){this.sessionToken=Qe.EMPTY_BYTE_STRING}getSessionToken(e){return U.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,U.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(){this.qr=new Ue(qe.Qr),this.$r=new Ue(qe.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const r=new qe(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new qe(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){const t=new K(new Te([])),r=new qe(t,e),i=new qe(t,e+1),s=[];return this.$r.forEachInRange([r,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new K(new Te([])),r=new qe(t,e),i=new qe(t,e+1);let s=oe();return this.$r.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new qe(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class qe{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return K.comparator(e.key,t.key)||se(e.Hr,t.Hr)}static Ur(e,t){return se(e.Hr,t.Hr)||K.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Ue(qe.Qr)}checkEmpty(e){return U.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new wg(s,t,r,i);this.mutationQueue.push(a);for(const l of i)this.Yr=this.Yr.add(new qe(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return U.resolve(a)}lookupMutationBatch(e,t){return U.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.Xr(r),s=i<0?0:i;return U.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return U.resolve(this.mutationQueue.length===0?Aa:this.er-1)}getAllMutationBatches(e){return U.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new qe(t,0),i=new qe(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],a=>{const l=this.Zr(a.Hr);s.push(l)}),U.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ue(se);return t.forEach(i=>{const s=new qe(i,0),a=new qe(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],l=>{r=r.add(l.Hr)})}),U.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;K.isDocumentKey(s)||(s=s.child(""));const a=new qe(new K(s),0);let l=new Ue(se);return this.Yr.forEachWhile(d=>{const f=d.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(l=l.add(d.Hr)),!0)},a),U.resolve(this.ei(l))}ei(e){const t=[];return e.forEach(r=>{const i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){me(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return U.forEach(t.mutations,i=>{const s=new qe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){const r=new qe(t,0),i=this.Yr.firstAfterOrEqual(r);return U.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,U.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy{constructor(e){this.ni=e,this.docs=function(){return new ke(K.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return U.resolve(r?r.document.mutableCopy():tt.newInvalidDocument(t))}getEntries(e,t){let r=Bt();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():tt.newInvalidDocument(i))}),U.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Bt();const a=t.path,l=new K(a.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(l);for(;d.hasNext();){const{key:f,value:{document:g}}=d.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||Np(Bp(g),r)<=0||(i.has(g.key)||Ls(t,g))&&(s=s.insert(g.key,g.mutableCopy()))}return U.resolve(s)}getAllFromCollectionGroup(e,t,r,i){X(9500)}ri(e,t){return U.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ay(this)}getSize(e){return U.resolve(this.size)}}class ay extends Zg{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),U.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(e){this.persistence=e,this.ii=new An(t=>ka(t),Ra),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this.si=0,this.oi=new Na,this.targetCount=0,this._i=ir.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),U.resolve()}getLastRemoteSnapshotVersion(e){return U.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return U.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),U.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),U.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new ir(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,U.resolve()}updateTargetData(e,t){return this.hr(t),U.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,U.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.ii.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),U.waitFor(s).next(()=>i)}getTargetCount(e){return U.resolve(this.targetCount)}getTargetData(e,t){const r=this.ii.get(t)||null;return U.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),U.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),U.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),U.resolve()}getMatchingKeysForTargetId(e,t){const r=this.oi.Jr(t);return U.resolve(r)}containsKey(e,t){return U.resolve(this.oi.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh{constructor(e,t){this.ai={},this.overlays={},this.ui=new Ps(0),this.ci=!1,this.ci=!0,this.li=new iy,this.referenceDelegate=e(this),this.hi=new ly(this),this.indexManager=new Wg,this.remoteDocumentCache=function(i){return new oy(i)}(r=>this.referenceDelegate.Pi(r)),this.serializer=new qg(t),this.Ti=new ny(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ry,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new sy(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){H("MemoryPersistence","Starting transaction:",e);const i=new cy(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return U.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}}class cy extends Mp{constructor(e){super(),this.currentSequenceNumber=e}}class La{constructor(e){this.persistence=e,this.Ai=new Na,this.Ri=null}static Vi(e){return new La(e)}get mi(){if(this.Ri)return this.Ri;throw X(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),U.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),U.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),U.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return U.forEach(this.mi,r=>{const i=K.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,ee.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return U.or([()=>U.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Es{constructor(e,t){this.persistence=e,this.gi=new An(r=>Up(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=Jg(this,t)}static Vi(e,t){return new Es(e,t)}Ii(){}di(e){return U.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return U.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?U.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(l=>{l||(r++,s.removeEntry(a,ee.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),U.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),U.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),U.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),U.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Wi(e.data.value)),t}Sr(e,t,r){return U.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.gi.get(t);return U.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=oe(),i=oe();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ma(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return rm()?8:Op(tm())>0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ps(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new uy;return this.ws(e,t,a).next(l=>{if(s.result=l,this.Rs)return this.Ss(e,t,a,l.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(On()<=ce.DEBUG&&H("QueryEngine","SDK will not create cache indexes for query:",Fn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),U.resolve()):(On()<=ce.DEBUG&&H("QueryEngine","Query:",Fn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(On()<=ce.DEBUG&&H("QueryEngine","The SDK decides to create cache indexes for query:",Fn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vt(t))):U.resolve())}ps(e,t){if(Rc(t))return U.resolve(null);let r=vt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Lo(t,null,"F"),r=vt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=oe(...s);return this.gs.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(d=>{const f=this.bs(t,l);return this.Ds(t,f,a,d.readTime)?this.ps(e,Lo(t,null,"F")):this.vs(e,f,t,d)}))})))}ys(e,t,r,i){return Rc(t)||i.isEqual(ee.min())?U.resolve(null):this.gs.getDocuments(e,r).next(s=>{const a=this.bs(t,s);return this.Ds(t,a,r,i)?U.resolve(null):(On()<=ce.DEBUG&&H("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Fn(t)),this.vs(e,a,t,Vp(i,Yr)).next(l=>l))})}bs(e,t){let r=new Ue(Ch(e));return t.forEach((i,s)=>{Ls(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return On()<=ce.DEBUG&&H("QueryEngine","Using full collection scan to execute query:",Fn(t)),this.gs.getDocumentsMatchingQuery(e,t,Jt.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oa="LocalStore",dy=3e8;class fy{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new ke(se),this.Ms=new An(s=>ka(s),Ra),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ty(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}function my(n,e,t,r){return new fy(n,e,t,r)}async function Xh(n,e){const t=ne(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],l=[];let d=oe();for(const f of i){a.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}for(const f of s){l.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(r,d).next(f=>({Bs:f,removedBatchIds:a,addedBatchIds:l}))})})}function py(n,e){const t=ne(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(l,d,f,g){const A=f.batch,k=A.keys();let C=U.resolve();return k.forEach(x=>{C=C.next(()=>g.getEntry(d,x)).next(N=>{const M=f.docVersions.get(x);me(M!==null,48541),N.version.compareTo(M)<0&&(A.applyToRemoteDocument(N,f),N.isValidDocument()&&(N.setReadTime(f.commitVersion),g.addEntry(N)))})}),C.next(()=>l.mutationQueue.removeMutationBatch(d,A))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let d=oe();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(d=d.add(l.batch.mutations[f].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Yh(n){const e=ne(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function gy(n,e){const t=ne(n),r=e.snapshotVersion;let i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;const l=[];e.targetChanges.forEach((g,A)=>{const k=i.get(A);if(!k)return;l.push(t.hi.removeMatchingKeys(s,g.removedDocuments,A).next(()=>t.hi.addMatchingKeys(s,g.addedDocuments,A)));let C=k.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(A)!==null?C=C.withResumeToken(Qe.EMPTY_BYTE_STRING,ee.min()).withLastLimboFreeSnapshotVersion(ee.min()):g.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(g.resumeToken,r)),i=i.insert(A,C),function(N,M,z){return N.resumeToken.approximateByteSize()===0||M.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=dy?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(k,C,g)&&l.push(t.hi.updateTargetData(s,C))});let d=Bt(),f=oe();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),l.push(yy(s,a,e.documentUpdates).next(g=>{d=g.Ls,f=g.ks})),!r.isEqual(ee.min())){const g=t.hi.getLastRemoteSnapshotVersion(s).next(A=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));l.push(g)}return U.waitFor(l).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,f)).next(()=>d)}).then(s=>(t.Fs=i,s))}function yy(n,e,t){let r=oe(),i=oe();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=Bt();return t.forEach((l,d)=>{const f=s.get(l);d.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(l)),d.isNoDocument()&&d.version.isEqual(ee.min())?(e.removeEntry(l,d.readTime),a=a.insert(l,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||d.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(d),a=a.insert(l,d)):H(Oa,"Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",d.version)}),{Ls:a,ks:i}})}function vy(n,e){const t=ne(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Aa),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function _y(n,e){const t=ne(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,U.resolve(i)):t.hi.allocateTargetId(r).next(a=>(i=new zt(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}async function jo(n,e,t){const r=ne(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!hr(a))throw a;H(Oa,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)}function $c(n,e,t){const r=ne(n);let i=ee.min(),s=oe();return r.persistence.runTransaction("Execute query","readwrite",a=>function(d,f,g){const A=ne(d),k=A.Ms.get(g);return k!==void 0?U.resolve(A.Fs.get(k)):A.hi.getTargetData(f,g)}(r,a,vt(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(a,l.targetId).next(d=>{s=d})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:ee.min(),t?s:oe())).next(l=>(Ey(r,og(e),l),{documents:l,qs:s})))}function Ey(n,e,t){let r=n.xs.get(e)||ee.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}class zc{constructor(){this.activeTargetIds=dg()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class wy{constructor(){this.Fo=new zc,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new zc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ty{xo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qc="ConnectivityMonitor";class Hc{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){H(qc,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){H(qc,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Di=null;function $o(){return Di===null?Di=function(){return 268435456+Math.round(2147483648*Math.random())}():Di++,"0x"+Di.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uo="RestConnection",Iy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class by{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===fs?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){const a=$o(),l=this.Go(e,t.toUriEncodedString());H(uo,`Sending RPC '${e}' ${a}:`,l,r);const d={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(d,i,s);const{host:f}=new URL(l),g=Ea(f);return this.jo(e,l,d,r,g).then(A=>(H(uo,`Received RPC '${e}' ${a}: `,A),A),A=>{throw Yt(uo,`RPC '${e}' ${a} failed with error: `,A,"url: ",l,"request:",r),A})}Jo(e,t,r,i,s,a){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+cr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){const r=Iy[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ze="WebChannelConnection";class Sy extends by{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){const a=$o();return new Promise((l,d)=>{const f=new eh;f.setWithCredentials(!0),f.listenOnce(th.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case Hi.NO_ERROR:const A=f.getResponseJson();H(Ze,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(A)),l(A);break;case Hi.TIMEOUT:H(Ze,`RPC '${e}' ${a} timed out`),d(new G(j.DEADLINE_EXCEEDED,"Request time out"));break;case Hi.HTTP_ERROR:const k=f.getStatus();if(H(Ze,`RPC '${e}' ${a} failed with status:`,k,"response text:",f.getResponseText()),k>0){let C=f.getResponseJson();Array.isArray(C)&&(C=C[0]);const x=C?.error;if(x&&x.status&&x.message){const N=function(z){const q=z.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(q)>=0?q:j.UNKNOWN}(x.status);d(new G(N,x.message))}else d(new G(j.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new G(j.UNAVAILABLE,"Connection failed."));break;default:X(9055,{c_:e,streamId:a,l_:f.getLastErrorCode(),h_:f.getLastError()})}}finally{H(Ze,`RPC '${e}' ${a} completed.`)}});const g=JSON.stringify(i);H(Ze,`RPC '${e}' ${a} sending request:`,i),f.send(t,"POST",g,r,15)})}P_(e,t,r){const i=$o(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=ih(),l=rh(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(d.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(d.useFetchStreams=!0),this.zo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const g=s.join("");H(Ze,`Creating RPC '${e}' stream ${i}: ${g}`,d);const A=a.createWebChannel(g,d);this.T_(A);let k=!1,C=!1;const x=new Ay({Ho:M=>{C?H(Ze,`Not sending because RPC '${e}' stream ${i} is closed:`,M):(k||(H(Ze,`Opening RPC '${e}' stream ${i} transport.`),A.open(),k=!0),H(Ze,`RPC '${e}' stream ${i} sending:`,M),A.send(M))},Yo:()=>A.close()}),N=(M,z,q)=>{M.listen(z,W=>{try{q(W)}catch(L){setTimeout(()=>{throw L},0)}})};return N(A,kr.EventType.OPEN,()=>{C||(H(Ze,`RPC '${e}' stream ${i} transport opened.`),x.s_())}),N(A,kr.EventType.CLOSE,()=>{C||(C=!0,H(Ze,`RPC '${e}' stream ${i} transport closed`),x.__(),this.I_(A))}),N(A,kr.EventType.ERROR,M=>{C||(C=!0,Yt(Ze,`RPC '${e}' stream ${i} transport errored. Name:`,M.name,"Message:",M.message),x.__(new G(j.UNAVAILABLE,"The operation could not be completed")))}),N(A,kr.EventType.MESSAGE,M=>{var z;if(!C){const q=M.data[0];me(!!q,16349);const W=q,L=W?.error||((z=W[0])===null||z===void 0?void 0:z.error);if(L){H(Ze,`RPC '${e}' stream ${i} received error:`,L);const O=L.status;let P=function(T){const v=Be[T];if(v!==void 0)return Oh(v)}(O),E=L.message;P===void 0&&(P=j.INTERNAL,E="Unknown error status: "+O+" with message "+L.message),C=!0,x.__(new G(P,E)),A.close()}else H(Ze,`RPC '${e}' stream ${i} received:`,q),x.a_(q)}}),N(l,nh.STAT_EVENT,M=>{M.stat===Po.PROXY?H(Ze,`RPC '${e}' stream ${i} detected buffering proxy`):M.stat===Po.NOPROXY&&H(Ze,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.o_()},0),x}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function ho(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Us(n){return new Pg(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&H("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wc="PersistentStream";class Zh{constructor(e,t,r,i,s,a,l,d){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Jh(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(Vt(t.toString()),Vt("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{const i=new G(j.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){const r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return H(Wc,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(H(Wc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Cy extends Zh{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=Vg(this.serializer,e),r=function(s){if(!("targetChange"in s))return ee.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?ee.min():a.readTime?Et(a.readTime):ee.min()}(e);return this.listener.J_(t,r)}H_(e){const t={};t.database=Uo(this.serializer),t.addTarget=function(s,a){let l;const d=a.target;if(l=No(d)?{documents:Lg(s,d)}:{query:Mg(s,d).Vt},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=jh(s,a.resumeToken);const f=Mo(s,a.expectedCount);f!==null&&(l.expectedCount=f)}else if(a.snapshotVersion.compareTo(ee.min())>0){l.readTime=_s(s,a.snapshotVersion.toTimestamp());const f=Mo(s,a.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,e);const r=Fg(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){const t={};t.database=Uo(this.serializer),t.removeTarget=e,this.k_(t)}}class ky extends Zh{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return me(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,me(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){me(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=Ng(e.writeResults,e.commitTime),r=Et(e.commitTime);return this.listener.ta(r,t)}na(){const e={};e.database=Uo(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Bg(this.serializer,r))};this.k_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ry{}class Py extends Ry{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new G(j.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,Oo(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new G(j.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Jo(e,Oo(t,r),i,a,l,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new G(j.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class xy{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Vt(t),this._a=!1):H("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const En="RemoteStore";class Dy{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{r.enqueueAndForget(async()=>{Cn(this)&&(H(En,"Restarting streams for network reachability change."),await async function(d){const f=ne(d);f.Ia.add(4),await ci(f),f.Aa.set("Unknown"),f.Ia.delete(4),await js(f)}(this))})}),this.Aa=new xy(r,i)}}async function js(n){if(Cn(n))for(const e of n.da)await e(!0)}async function ci(n){for(const e of n.da)await e(!1)}function ed(n,e){const t=ne(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),$a(t)?ja(t):dr(t).x_()&&Ua(t,e))}function Fa(n,e){const t=ne(n),r=dr(t);t.Ta.delete(e),r.x_()&&td(t,e),t.Ta.size===0&&(r.x_()?r.B_():Cn(t)&&t.Aa.set("Unknown"))}function Ua(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ee.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}dr(n).H_(e)}function td(n,e){n.Ra.$e(e),dr(n).Y_(e)}function ja(n){n.Ra=new Sg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),dr(n).start(),n.Aa.aa()}function $a(n){return Cn(n)&&!dr(n).M_()&&n.Ta.size>0}function Cn(n){return ne(n).Ia.size===0}function nd(n){n.Ra=void 0}async function Vy(n){n.Aa.set("Online")}async function By(n){n.Ta.forEach((e,t)=>{Ua(n,e)})}async function Ny(n,e){nd(n),$a(n)?(n.Aa.la(e),ja(n)):n.Aa.set("Unknown")}async function Ly(n,e,t){if(n.Aa.set("Online"),e instanceof Uh&&e.state===2&&e.cause)try{await async function(i,s){const a=s.cause;for(const l of s.targetIds)i.Ta.has(l)&&(await i.remoteSyncer.rejectListen(l,a),i.Ta.delete(l),i.Ra.removeTarget(l))}(n,e)}catch(r){H(En,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await ws(n,r)}else if(e instanceof Qi?n.Ra.Ye(e):e instanceof Fh?n.Ra.it(e):n.Ra.et(e),!t.isEqual(ee.min()))try{const r=await Yh(n.localStore);t.compareTo(r)>=0&&await function(s,a){const l=s.Ra.Pt(a);return l.targetChanges.forEach((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const g=s.Ta.get(f);g&&s.Ta.set(f,g.withResumeToken(d.resumeToken,a))}}),l.targetMismatches.forEach((d,f)=>{const g=s.Ta.get(d);if(!g)return;s.Ta.set(d,g.withResumeToken(Qe.EMPTY_BYTE_STRING,g.snapshotVersion)),td(s,d);const A=new zt(g.target,d,f,g.sequenceNumber);Ua(s,A)}),s.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(r){H(En,"Failed to raise snapshot:",r),await ws(n,r)}}async function ws(n,e,t){if(!hr(e))throw e;n.Ia.add(1),await ci(n),n.Aa.set("Offline"),t||(t=()=>Yh(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{H(En,"Retrying IndexedDB access"),await t(),n.Ia.delete(1),await js(n)})}function rd(n,e){return e().catch(t=>ws(n,t,e))}async function $s(n){const e=ne(n),t=nn(e);let r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Aa;for(;My(e);)try{const i=await vy(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,Oy(e,i)}catch(i){await ws(e,i)}id(e)&&sd(e)}function My(n){return Cn(n)&&n.Pa.length<10}function Oy(n,e){n.Pa.push(e);const t=nn(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function id(n){return Cn(n)&&!nn(n).M_()&&n.Pa.length>0}function sd(n){nn(n).start()}async function Fy(n){nn(n).na()}async function Uy(n){const e=nn(n);for(const t of n.Pa)e.X_(t.mutations)}async function jy(n,e,t){const r=n.Pa.shift(),i=Da.from(r,e,t);await rd(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await $s(n)}async function $y(n,e){e&&nn(n).Z_&&await async function(r,i){if(function(a){return bg(a)&&a!==j.ABORTED}(i.code)){const s=r.Pa.shift();nn(r).N_(),await rd(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await $s(r)}}(n,e),id(n)&&sd(n)}async function Gc(n,e){const t=ne(n);t.asyncQueue.verifyOperationInProgress(),H(En,"RemoteStore received new credentials");const r=Cn(t);t.Ia.add(3),await ci(t),r&&t.Aa.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),await js(t)}async function zy(n,e){const t=ne(n);e?(t.Ia.delete(2),await js(t)):e||(t.Ia.add(2),await ci(t),t.Aa.set("Unknown"))}function dr(n){return n.Va||(n.Va=function(t,r,i){const s=ne(t);return s.ia(),new Cy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:Vy.bind(null,n),e_:By.bind(null,n),n_:Ny.bind(null,n),J_:Ly.bind(null,n)}),n.da.push(async e=>{e?(n.Va.N_(),$a(n)?ja(n):n.Aa.set("Unknown")):(await n.Va.stop(),nd(n))})),n.Va}function nn(n){return n.ma||(n.ma=function(t,r,i){const s=ne(t);return s.ia(),new ky(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:Fy.bind(null,n),n_:$y.bind(null,n),ea:Uy.bind(null,n),ta:jy.bind(null,n)}),n.da.push(async e=>{e?(n.ma.N_(),await $s(n)):(await n.ma.stop(),n.Pa.length>0&&(H(En,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))})),n.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class za{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Qt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,l=new za(e,t,a,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new G(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qa(n,e){if(Vt("AsyncQueue",`${e}: ${n}`),hr(n))return new G(j.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{static emptySet(e){return new Kn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||K.comparator(t.key,r.key):(t,r)=>K.comparator(t.key,r.key),this.keyedMap=Rr(),this.sortedSet=new ke(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Kn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Kn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(){this.fa=new ke(K.comparator)}track(e){const t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):X(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}}class sr{constructor(e,t,r,i,s,a,l,d,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new sr(e,t,Kn.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ns(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class Hy{constructor(){this.queries=Qc(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){const i=ne(t),s=i.queries;i.queries=Qc(),s.forEach((a,l)=>{for(const d of l.wa)d.onError(r)})})(this,new G(j.ABORTED,"Firestore shutting down"))}}function Qc(){return new An(n=>Sh(n),Ns)}async function od(n,e){const t=ne(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new qy,r=e.ba()?0:1);try{switch(r){case 0:s.ya=await t.onListen(i,!0);break;case 1:s.ya=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const l=qa(a,`Initialization of query '${Fn(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Ha(t)}async function ad(n,e){const t=ne(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const a=s.wa.indexOf(e);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Wy(n,e){const t=ne(n);let r=!1;for(const i of e){const s=i.query,a=t.queries.get(s);if(a){for(const l of a.wa)l.Ca(i)&&(r=!0);a.ya=i}}r&&Ha(t)}function Gy(n,e,t){const r=ne(n),i=r.queries.get(e);if(i)for(const s of i.wa)s.onError(t);r.queries.delete(e)}function Ha(n){n.Da.forEach(e=>{e.next()})}var zo,Xc;(Xc=zo||(zo={})).Fa="default",Xc.Cache="cache";class ld{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new sr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;const r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=sr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==zo.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(e){this.key=e}}class ud{constructor(e){this.key=e}}class Ky{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=oe(),this.mutatedKeys=oe(),this.Xa=Ch(e),this.eu=new Kn(this.Xa)}get tu(){return this.Ha}nu(e,t){const r=t?t.ru:new Kc,i=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1;const d=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,A)=>{const k=i.get(g),C=Ls(this.query,A)?A:null,x=!!k&&this.mutatedKeys.has(k.key),N=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let M=!1;k&&C?k.data.isEqual(C.data)?x!==N&&(r.track({type:3,doc:C}),M=!0):this.iu(k,C)||(r.track({type:2,doc:C}),M=!0,(d&&this.Xa(C,d)>0||f&&this.Xa(C,f)<0)&&(l=!0)):!k&&C?(r.track({type:0,doc:C}),M=!0):k&&!C&&(r.track({type:1,doc:k}),M=!0,(d||f)&&(l=!0)),M&&(C?(a=a.add(C),s=N?s.add(g):s.delete(g)):(a=a.delete(g),s=s.delete(g)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const g=this.query.limitType==="F"?a.last():a.first();a=a.delete(g.key),s=s.delete(g.key),r.track({type:1,doc:g})}return{eu:a,ru:r,Ds:l,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const a=e.ru.pa();a.sort((g,A)=>function(C,x){const N=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return X(20277,{At:M})}};return N(C)-N(x)}(g.type,A.type)||this.Xa(g.doc,A.doc)),this.su(r),i=i!=null&&i;const l=t&&!i?this.ou():[],d=this.Za.size===0&&this.current&&!i?1:0,f=d!==this.Ya;return this.Ya=d,a.length!==0||f?{snapshot:new sr(this.query,e.eu,s,a,e.mutatedKeys,d===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:l}:{_u:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Kc,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=oe(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});const t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new ud(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new cd(r))}),t}uu(e){this.Ha=e.qs,this.Za=oe();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return sr.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const Wa="SyncEngine";class Qy{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Xy{constructor(e){this.key=e,this.lu=!1}}class Yy{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new An(l=>Sh(l),Ns),this.Tu=new Map,this.Iu=new Set,this.du=new ke(K.comparator),this.Eu=new Map,this.Au=new Na,this.Ru={},this.Vu=new Map,this.mu=ir.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function Jy(n,e,t=!0){const r=gd(n);let i;const s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=await hd(r,e,t,!0),i}async function Zy(n,e){const t=gd(n);await hd(t,e,!0,!1)}async function hd(n,e,t,r){const i=await _y(n.localStore,vt(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t);let l;return r&&(l=await ev(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&ed(n.remoteStore,i),l}async function ev(n,e,t,r,i){n.gu=(A,k,C)=>async function(N,M,z,q){let W=M.view.nu(z);W.Ds&&(W=await $c(N.localStore,M.query,!1).then(({documents:E})=>M.view.nu(E,W)));const L=q&&q.targetChanges.get(M.targetId),O=q&&q.targetMismatches.get(M.targetId)!=null,P=M.view.applyChanges(W,N.isPrimaryClient,L,O);return Jc(N,M.targetId,P._u),P.snapshot}(n,A,k,C);const s=await $c(n.localStore,e,!0),a=new Ky(e,s.qs),l=a.nu(s.documents),d=li.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),f=a.applyChanges(l,n.isPrimaryClient,d);Jc(n,t,f._u);const g=new Qy(e,t,a);return n.Pu.set(e,g),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),f.snapshot}async function tv(n,e,t){const r=ne(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(a=>!Ns(a,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await jo(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Fa(r.remoteStore,i.targetId),qo(r,i.targetId)}).catch(ur)):(qo(r,i.targetId),await jo(r.localStore,i.targetId,!0))}async function nv(n,e){const t=ne(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Fa(t.remoteStore,r.targetId))}async function rv(n,e,t){const r=hv(n);try{const i=await function(a,l){const d=ne(a),f=Ie.now(),g=l.reduce((C,x)=>C.add(x.key),oe());let A,k;return d.persistence.runTransaction("Locally write mutations","readwrite",C=>{let x=Bt(),N=oe();return d.Os.getEntries(C,g).next(M=>{x=M,x.forEach((z,q)=>{q.isValidDocument()||(N=N.add(z))})}).next(()=>d.localDocuments.getOverlayedDocuments(C,x)).next(M=>{A=M;const z=[];for(const q of l){const W=_g(q,A.get(q.key).overlayedDocument);W!=null&&z.push(new Sn(q.key,W,_h(W.value.mapValue),_t.exists(!0)))}return d.mutationQueue.addMutationBatch(C,f,z,l)}).next(M=>{k=M;const z=M.applyToLocalDocumentSet(A,N);return d.documentOverlayCache.saveOverlays(C,M.batchId,z)})}).then(()=>({batchId:k.batchId,changes:Rh(A)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,l,d){let f=a.Ru[a.currentUser.toKey()];f||(f=new ke(se)),f=f.insert(l,d),a.Ru[a.currentUser.toKey()]=f}(r,i.batchId,t),await ui(r,i.changes),await $s(r.remoteStore)}catch(i){const s=qa(i,"Failed to persist write");t.reject(s)}}async function dd(n,e){const t=ne(n);try{const r=await gy(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Eu.get(s);a&&(me(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?me(a.lu,14607):i.removedDocuments.size>0&&(me(a.lu,42227),a.lu=!1))}),await ui(t,r,e)}catch(r){await ur(r)}}function Yc(n,e,t){const r=ne(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Pu.forEach((s,a)=>{const l=a.view.va(e);l.snapshot&&i.push(l.snapshot)}),function(a,l){const d=ne(a);d.onlineState=l;let f=!1;d.queries.forEach((g,A)=>{for(const k of A.wa)k.va(l)&&(f=!0)}),f&&Ha(d)}(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function iv(n,e,t){const r=ne(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Eu.get(e),s=i&&i.key;if(s){let a=new ke(K.comparator);a=a.insert(s,tt.newNoDocument(s,ee.min()));const l=oe().add(s),d=new Fs(ee.min(),new Map,new ke(se),a,l);await dd(r,d),r.du=r.du.remove(s),r.Eu.delete(e),Ga(r)}else await jo(r.localStore,e,!1).then(()=>qo(r,e,t)).catch(ur)}async function sv(n,e){const t=ne(n),r=e.batch.batchId;try{const i=await py(t.localStore,e);md(t,r,null),fd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await ui(t,i)}catch(i){await ur(i)}}async function ov(n,e,t){const r=ne(n);try{const i=await function(a,l){const d=ne(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let g;return d.mutationQueue.lookupMutationBatch(f,l).next(A=>(me(A!==null,37113),g=A.keys(),d.mutationQueue.removeMutationBatch(f,A))).next(()=>d.mutationQueue.performConsistencyCheck(f)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(f,g,l)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g)).next(()=>d.localDocuments.getDocuments(f,g))})}(r.localStore,e);md(r,e,t),fd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await ui(r,i)}catch(i){await ur(i)}}function fd(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function md(n,e,t){const r=ne(n);let i=r.Ru[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function qo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||pd(n,r)})}function pd(n,e){n.Iu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Fa(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),Ga(n))}function Jc(n,e,t){for(const r of t)r instanceof cd?(n.Au.addReference(r.key,e),av(n,r)):r instanceof ud?(H(Wa,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||pd(n,r.key)):X(19791,{yu:r})}function av(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(H(Wa,"New document in limbo: "+t),n.Iu.add(r),Ga(n))}function Ga(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Iu.values().next().value;n.Iu.delete(e);const t=new K(Te.fromString(e)),r=n.mu.next();n.Eu.set(r,new Xy(t)),n.du=n.du.insert(t,r),ed(n.remoteStore,new zt(vt(Bs(t.path)),r,"TargetPurposeLimboResolution",Ps.ue))}}async function ui(n,e,t){const r=ne(n),i=[],s=[],a=[];r.Pu.isEmpty()||(r.Pu.forEach((l,d)=>{a.push(r.gu(d,e,t).then(f=>{var g;if((f||t)&&r.isPrimaryClient){const A=f?!f.fromCache:(g=t?.targetChanges.get(d.targetId))===null||g===void 0?void 0:g.current;r.sharedClientState.updateQueryState(d.targetId,A?"current":"not-current")}if(f){i.push(f);const A=Ma.Es(d.targetId,f);s.push(A)}}))}),await Promise.all(a),r.hu.J_(i),await async function(d,f){const g=ne(d);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>U.forEach(f,k=>U.forEach(k.Is,C=>g.persistence.referenceDelegate.addReference(A,k.targetId,C)).next(()=>U.forEach(k.ds,C=>g.persistence.referenceDelegate.removeReference(A,k.targetId,C)))))}catch(A){if(!hr(A))throw A;H(Oa,"Failed to update sequence numbers: "+A)}for(const A of f){const k=A.targetId;if(!A.fromCache){const C=g.Fs.get(k),x=C.snapshotVersion,N=C.withLastLimboFreeSnapshotVersion(x);g.Fs=g.Fs.insert(k,N)}}}(r.localStore,s))}async function lv(n,e){const t=ne(n);if(!t.currentUser.isEqual(e)){H(Wa,"User change. New user:",e.toKey());const r=await Xh(t.localStore,e);t.currentUser=e,function(s,a){s.Vu.forEach(l=>{l.forEach(d=>{d.reject(new G(j.CANCELLED,a))})}),s.Vu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await ui(t,r.Bs)}}function uv(n,e){const t=ne(n),r=t.Eu.get(e);if(r&&r.lu)return oe().add(r.key);{let i=oe();const s=t.Tu.get(e);if(!s)return i;for(const a of s){const l=t.Pu.get(a);i=i.unionWith(l.view.tu)}return i}}function gd(n){const e=ne(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=dd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=iv.bind(null,e),e.hu.J_=Wy.bind(null,e.eventManager),e.hu.pu=Gy.bind(null,e.eventManager),e}function hv(n){const e=ne(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ov.bind(null,e),e}class Ts{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Us(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return my(this.persistence,new hy,e.initialUser,this.serializer)}Du(e){return new Qh(La.Vi,this.serializer)}bu(e){return new wy}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ts.provider={build:()=>new Ts};class dv extends Ts{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){me(this.persistence.referenceDelegate instanceof Es,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Xg(r,e.asyncQueue,t)}Du(e){const t=this.cacheSizeBytes!==void 0?rt.withCacheSize(this.cacheSizeBytes):rt.DEFAULT;return new Qh(r=>Es.Vi(r,t),this.serializer)}}class Ho{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Yc(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=lv.bind(null,this.syncEngine),await zy(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Hy}()}createDatastore(e){const t=Us(e.databaseInfo.databaseId),r=function(s){return new Sy(s)}(e.databaseInfo);return function(s,a,l,d){return new Py(s,a,l,d)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,a,l){return new Dy(r,i,s,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>Yc(this.syncEngine,t,0),function(){return Hc.C()?new Hc:new Ty}())}createSyncEngine(e,t){return function(i,s,a,l,d,f,g){const A=new Yy(i,s,a,l,d,f);return g&&(A.fu=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const s=ne(i);H(En,"RemoteStore shutting down."),s.Ia.add(5),await ci(s),s.Ea.shutdown(),s.Aa.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Ho.provider={build:()=>new Ho};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Vt("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rn="FirestoreClient";class fv{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=et.UNAUTHENTICATED,this.clientId=Ia.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async a=>{H(rn,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(H(rn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Qt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=qa(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function fo(n,e){n.asyncQueue.verifyOperationInProgress(),H(rn,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await Xh(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>{Yt("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{H("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Yt("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e}async function Zc(n,e){n.asyncQueue.verifyOperationInProgress();const t=await mv(n);H(rn,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Gc(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Gc(e.remoteStore,i)),n._onlineComponents=e}async function mv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){H(rn,"Using user provided OfflineComponentProvider");try{await fo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===j.FAILED_PRECONDITION||i.code===j.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Yt("Error using user provided cache. Falling back to memory cache: "+t),await fo(n,new Ts)}}else H(rn,"Using default OfflineComponentProvider"),await fo(n,new dv(void 0));return n._offlineComponents}async function vd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(H(rn,"Using user provided OnlineComponentProvider"),await Zc(n,n._uninitializedComponentsProvider._online)):(H(rn,"Using default OnlineComponentProvider"),await Zc(n,new Ho))),n._onlineComponents}function pv(n){return vd(n).then(e=>e.syncEngine)}async function Wo(n){const e=await vd(n),t=e.eventManager;return t.onListen=Jy.bind(null,e.syncEngine),t.onUnlisten=tv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Zy.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=nv.bind(null,e.syncEngine),t}function gv(n,e,t={}){const r=new Qt;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,l,d,f){const g=new yd({next:k=>{g.Ou(),a.enqueueAndForget(()=>ad(s,A));const C=k.docs.has(l);!C&&k.fromCache?f.reject(new G(j.UNAVAILABLE,"Failed to get document because the client is offline.")):C&&k.fromCache&&d&&d.source==="server"?f.reject(new G(j.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(k)},error:k=>f.reject(k)}),A=new ld(Bs(l.path),g,{includeMetadataChanges:!0,ka:!0});return od(s,A)}(await Wo(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _d(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eu=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ed="firestore.googleapis.com",tu=!0;class nu{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new G(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ed,this.ssl=tu}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:tu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Kh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Kg)throw new G(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Dp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_d((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new G(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new G(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new G(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zs{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new G(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new G(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ip;switch(r.type){case"firstParty":return new Cp(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new G(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=eu.get(t);r&&(H("ComponentProvider","Removing Datastore"),eu.delete(t),r.terminate())}(this),Promise.resolve()}}function yv(n,e,t,r={}){var i;n=xt(n,zs);const s=Ea(e),a=n._getSettings(),l=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),d=`${e}:${t}`;s&&(Xf(`https://${d}`),em("Firestore",!0)),a.host!==Ed&&a.host!==d&&Yt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f=Object.assign(Object.assign({},a),{host:d,ssl:s,emulatorOptions:r});if(!cs(f,l)&&(n._setSettings(f),r.mockUserToken)){let g,A;if(typeof r.mockUserToken=="string")g=r.mockUserToken,A=et.MOCK_USER;else{g=Yf(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const k=r.mockUserToken.sub||r.mockUserToken.user_id;if(!k)throw new G(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");A=new et(k)}n._authCredentials=new bp(new oh(g,A))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new qs(this.firestore,e,this._query)}}class Le{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Le(this.firestore,e,this._key)}toJSON(){return{type:Le._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(oi(t,Le._jsonSchema))return new Le(e,r||null,new K(Te.fromString(t.referencePath)))}}Le._jsonSchemaVersion="firestore/documentReference/1.0",Le._jsonSchema={type:Ne("string",Le._jsonSchemaVersion),referencePath:Ne("string")};class Xt extends qs{constructor(e,t,r){super(e,t,Bs(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Le(this.firestore,null,new K(e))}withConverter(e){return new Xt(this.firestore,e,this._path)}}function $r(n,e,...t){if(n=er(n),lh("collection","path",e),n instanceof zs){const r=Te.fromString(e,...t);return gc(r),new Xt(n,null,r)}{if(!(n instanceof Le||n instanceof Xt))throw new G(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Te.fromString(e,...t));return gc(r),new Xt(n.firestore,null,r)}}function Ka(n,e,...t){if(n=er(n),arguments.length===1&&(e=Ia.newId()),lh("doc","path",e),n instanceof zs){const r=Te.fromString(e,...t);return pc(r),new Le(n,null,new K(r))}{if(!(n instanceof Le||n instanceof Xt))throw new G(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Te.fromString(e,...t));return pc(r),new Le(n.firestore,n instanceof Xt?n.converter:null,new K(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru="AsyncQueue";class iu{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Jh(this,"async_queue_retry"),this.oc=()=>{const r=ho();r&&H(ru,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;const t=ho();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=ho();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new Qt;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!hr(e))throw e;H(ru,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,Vt("INTERNAL UNHANDLED ERROR: ",su(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const i=za.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&X(47125,{hc:su(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function su(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ou(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class or extends zs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new iu,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new iu(e),this._firestoreClient=void 0,await e}}}function vv(n,e){const t=typeof n=="object"?n:up(),r=typeof n=="string"?n:fs,i=sp(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=Kf("firestore");s&&yv(i,...s)}return i}function Qa(n){if(n._terminated)throw new G(j.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||_v(n),n._firestoreClient}function _v(n){var e,t,r;const i=n._freezeSettings(),s=function(l,d,f,g){return new zp(l,d,f,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,_d(g.experimentalLongPollingOptions),g.useFetchStreams,g.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new fv(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(l){const d=l?._online.build();return{_offline:l?._offline.build(d),_online:d}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lt(Qe.fromBase64String(e))}catch(t){throw new G(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new lt(Qe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(oi(e,lt._jsonSchema))return lt.fromBase64String(e.bytes)}}lt._jsonSchemaVersion="firestore/bytes/1.0",lt._jsonSchema={type:Ne("string",lt._jsonSchemaVersion),bytes:Ne("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new G(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wd{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new G(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new G(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:wt._jsonSchemaVersion}}static fromJSON(e){if(oi(e,wt._jsonSchema))return new wt(e.latitude,e.longitude)}}wt._jsonSchemaVersion="firestore/geoPoint/1.0",wt._jsonSchema={type:Ne("string",wt._jsonSchemaVersion),latitude:Ne("number"),longitude:Ne("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Tt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(oi(e,Tt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Tt(e.vectorValues);throw new G(j.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Tt._jsonSchemaVersion="firestore/vectorValue/1.0",Tt._jsonSchema={type:Ne("string",Tt._jsonSchemaVersion),vectorValues:Ne("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ev=/^__.*__$/;class wv{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Sn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ai(e,this.data,t,this.fieldTransforms)}}function Td(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw X(40011,{Ec:n})}}class Ya{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new Ya(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Is(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(Td(this.Ec)&&Ev.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class Tv{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Us(e)}Dc(e,t,r,i=!1){return new Ya({Ec:e,methodName:t,bc:r,path:Ke.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Iv(n){const e=n._freezeSettings(),t=Us(n._databaseId);return new Tv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function bv(n,e,t,r,i,s={}){const a=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);Sd("Data must be an object, but it was:",a,r);const l=bd(r,a);let d,f;if(s.merge)d=new mt(a.fieldMask),f=a.fieldTransforms;else if(s.mergeFields){const g=[];for(const A of s.mergeFields){const k=Av(e,A,t);if(!a.contains(k))throw new G(j.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);Cv(g,k)||g.push(k)}d=new mt(g),f=a.fieldTransforms.filter(A=>d.covers(A.field))}else d=null,f=a.fieldTransforms;return new wv(new at(l),d,f)}function Id(n,e){if(Ad(n=er(n)))return Sd("Unsupported field value:",e,n),bd(n,e);if(n instanceof wd)return function(r,i){if(!Td(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const l of r){let d=Id(l,i.yc(a));d==null&&(d={nullValue:"NULL_VALUE"}),s.push(d),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=er(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return fg(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=Ie.fromDate(r);return{timestampValue:_s(i.serializer,s)}}if(r instanceof Ie){const s=new Ie(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:_s(i.serializer,s)}}if(r instanceof wt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof lt)return{bytesValue:jh(i.serializer,r._byteString)};if(r instanceof Le){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Ba(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Tt)return function(a,l){return{mapValue:{fields:{[yh]:{stringValue:vh},[ms]:{arrayValue:{values:a.toArray().map(f=>{if(typeof f!="number")throw l.wc("VectorValues must only contain numeric values.");return Pa(l.serializer,f)})}}}}}}(r,i);throw i.wc(`Unsupported field value: ${ba(r)}`)}(n,e)}function bd(n,e){const t={};return hh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):bn(n,(r,i)=>{const s=Id(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Ad(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ie||n instanceof wt||n instanceof lt||n instanceof Le||n instanceof wd||n instanceof Tt)}function Sd(n,e,t){if(!Ad(t)||!ch(t)){const r=ba(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function Av(n,e,t){if((e=er(e))instanceof Xa)return e._internalPath;if(typeof e=="string")return Cd(n,e);throw Is("Field path arguments must be of type string or ",n,!1,void 0,t)}const Sv=new RegExp("[~\\*/\\[\\]]");function Cd(n,e,t){if(e.search(Sv)>=0)throw Is(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Xa(...e.split("."))._internalPath}catch{throw Is(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Is(n,e,t,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(s||a)&&(d+=" (found",s&&(d+=` in field ${r}`),a&&(d+=` in document ${i}`),d+=")"),new G(j.INVALID_ARGUMENT,l+n+d)}function Cv(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Le(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new kv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Rd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class kv extends kd{data(){return super.data()}}function Rd(n,e){return typeof e=="string"?Cd(n,e):e instanceof Xa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rv(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new G(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Pv{convertValue(e,t="none"){switch(tn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(en(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw X(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return bn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;const s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[ms].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>Ve(a.doubleValue));return new Tt(s)}convertGeoPoint(e){return new wt(Ve(e.latitude),Ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ds(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Jr(e));default:return null}}convertTimestamp(e){const t=Zt(e);return new Ie(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Te.fromString(e);me(Gh(r),9688,{name:e});const i=new Zr(r.get(1),r.get(3)),s=new K(r.popFirst(5));return i.isEqual(t)||Vt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xv(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class xr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class yn extends kd{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Xi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Rd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new G(j.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=yn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}yn._jsonSchemaVersion="firestore/documentSnapshot/1.0",yn._jsonSchema={type:Ne("string",yn._jsonSchemaVersion),bundleSource:Ne("string","DocumentSnapshot"),bundleName:Ne("string"),bundle:Ne("string")};class Xi extends yn{data(e={}){return super.data(e)}}class Qn{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new xr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Xi(this._firestore,this._userDataWriter,r.key,r,new xr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new G(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>{const d=new Xi(i._firestore,i._userDataWriter,l.doc.key,l.doc,new xr(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:d,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>s||l.type!==3).map(l=>{const d=new Xi(i._firestore,i._userDataWriter,l.doc.key,l.doc,new xr(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,g=-1;return l.type!==0&&(f=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),g=a.indexOf(l.doc.key)),{type:Dv(l.type),doc:d,oldIndex:f,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new G(j.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Qn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ia.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Dv(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return X(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vv(n){n=xt(n,Le);const e=xt(n.firestore,or);return gv(Qa(e),n._key).then(t=>Vd(e,n,t))}Qn._jsonSchemaVersion="firestore/querySnapshot/1.0",Qn._jsonSchema={type:Ne("string",Qn._jsonSchemaVersion),bundleSource:Ne("string","QuerySnapshot"),bundleName:Ne("string"),bundle:Ne("string")};class Pd extends Pv{constructor(e){super(),this.firestore=e}convertBytes(e){return new lt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Le(this.firestore,null,t)}}function Ja(n,e,t){n=xt(n,Le);const r=xt(n.firestore,or),i=xv(n.converter,e,t);return Dd(r,[bv(Iv(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,_t.none())])}function Bv(n){return Dd(xt(n.firestore,or),[new xa(n._key,_t.none())])}function xd(n,...e){var t,r,i;n=er(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||ou(e[a])||(s=e[a++]);const l={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(ou(e[a])){const A=e[a];e[a]=(t=A.next)===null||t===void 0?void 0:t.bind(A),e[a+1]=(r=A.error)===null||r===void 0?void 0:r.bind(A),e[a+2]=(i=A.complete)===null||i===void 0?void 0:i.bind(A)}let d,f,g;if(n instanceof Le)f=xt(n.firestore,or),g=Bs(n._key.path),d={next:A=>{e[a]&&e[a](Vd(f,n,A))},error:e[a+1],complete:e[a+2]};else{const A=xt(n,qs);f=xt(A.firestore,or),g=A._query;const k=new Pd(f);d={next:C=>{e[a]&&e[a](new Qn(f,k,A,C))},error:e[a+1],complete:e[a+2]},Rv(n._query)}return function(k,C,x,N){const M=new yd(N),z=new ld(C,M,x);return k.asyncQueue.enqueueAndForget(async()=>od(await Wo(k),z)),()=>{M.Ou(),k.asyncQueue.enqueueAndForget(async()=>ad(await Wo(k),z))}}(Qa(f),g,l,d)}function Dd(n,e){return function(r,i){const s=new Qt;return r.asyncQueue.enqueueAndForget(async()=>rv(await pv(r),i,s)),s.promise}(Qa(n),e)}function Vd(n,e,t){const r=t.docs.get(e._key),i=new Pd(n);return new yn(n,i,e._key,r,new xr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){cr=i})(cp),hs(new Qr("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),l=new or(new Ap(r.getProvider("auth-internal")),new kp(a,r.getProvider("app-check-internal")),function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new G(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zr(f.options.projectId,g)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),l._setSettings(s),l},"PUBLIC").setMultipleInstances(!0)),Gn(uc,hc,e),Gn(uc,hc,"esm2017")})();const Nv={apiKey:"AIzaSyAURA1Os8rPj_ov0ofDs-BCyO3aKhibhtw",authDomain:"webrtc-tutorial-81613.firebaseapp.com",projectId:"webrtc-tutorial-81613",storageBucket:"webrtc-tutorial-81613.firebasestorage.app",messagingSenderId:"911640820129",appId:"1:911640820129:web:b7102245c80e146013b3e0",measurementId:"G-68WFGEKPQB"},Lv=Xu(Nv),Bd=vv(Lv);let Xn=[],zr=[],ri=!1,Yi=null;const Mv=1e3;function Ov(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),a=String(n.getSeconds()).padStart(2,"0"),l=String(n.getMilliseconds()).padStart(3,"0");return`${e}-${t}-${r} ${i}:${s}:${a}.${l}`}function Za(){zr.length>0&&(Xn.push(...zr),zr=[])}function Fv(){ri||(ri=!0,Xn=[],zr=[],performance.now(),Yi=setInterval(Za,Mv),console.log("PTZ Latency evaluation started."),document.getElementById("ptzEvaluationStatus").textContent="評価中...",document.getElementById("startPtzEvaluationBtn").disabled=!0,document.getElementById("stopPtzEvaluationBtn").disabled=!1,document.getElementById("downloadPtzCsvBtn").disabled=!0)}function Uv(){ri&&(ri=!1,Yi&&(clearInterval(Yi),Yi=null),Za(),console.log("PTZ Latency evaluation stopped."),document.getElementById("ptzEvaluationStatus").textContent="評価停止中",document.getElementById("startPtzEvaluationBtn").disabled=!1,document.getElementById("stopPtzEvaluationBtn").disabled=!0,document.getElementById("downloadPtzCsvBtn").disabled=Xn.length===0)}function jv(n){if(!ri)return;const e=Ov(new Date);zr.push({timestamp:e,...n})}function $v(){if(Za(),Xn.length===0){alert("データが記録されていません。");return}const n=Object.keys(Xn[0]).join(","),e=Xn.map(s=>Object.values(s).map(a=>typeof a=="number"?a.toFixed(3):a).join(",")).join(`
`),t=`${n}
${e}`,r=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){const s=URL.createObjectURL(r);i.setAttribute("href",s),i.setAttribute("download",`ptz_latency_evaluation_${new Date().toISOString()}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}const Dr=new Map,mo={pending:{},intervalId:{},add(n,e,t,r){this.pending[n]||(this.pending[n]={}),this.pending[n][e]={value:t,id:r},this.intervalId[n]||this.startChecker(n)},startChecker(n){let r=0;this.intervalId[n]=setInterval(()=>{r+=50;const i=Pt[n],s=this.pending[n];if(!i||!s){this.stopChecker(n);return}const a=i.getSettings(),l=i.getCapabilities();let d=!0,f=r>=5e3;for(const g in s){const A=a[g],k=s[g].value,C=l[g]?.step,x=C?C*.75:g==="zoom"?.05:2;if(Math.abs(A-k)>x){d=!1;break}}if(d||f){f&&!d&&console.warn(`SENDER: PTZ command confirmation timed out for ${n}`);for(const g in s){const{id:A}=s[g];It?.readyState==="open"&&It.send(JSON.stringify({type:"command_ack",id:A,command:g,timedOut:f&&!d}))}this.stopChecker(n)}},50)},stopChecker(n){this.intervalId[n]&&(clearInterval(this.intervalId[n]),delete this.intervalId[n],delete this.pending[n])}};async function Yn(n,e,t){Yn._state||(Yn._state={lastApply:0,delay:50,pending:{}});const r=Yn._state,i=`${n}#${e}`;r.pending[i]={target:n,type:e,value:t};const s=async l=>{const d=Pt[l.target];if(document.visibilityState!=="visible"||!d||d.readyState!=="live"){console.warn(`SENDER: Cannot apply PTZ to ${l.target}. Page not visible or track not live.`);return}try{await d.applyConstraints({advanced:[{[l.type]:l.value}]})}catch(f){console.error(`SENDER: Error applying ${l.type} constraint to ${l.target}:`,f)}},a=performance.now();if(a-r.lastApply>=r.delay){const l=Object.values(r.pending);r.pending={},r.lastApply=a,l.forEach(d=>s(d))}else if(!r._timer){const l=r.delay-(a-r.lastApply);r._timer=setTimeout(()=>{r._timer=null;const d=Object.values(r.pending);r.pending={},r.lastApply=performance.now(),d.forEach(f=>s(f))},l)}}function Nd(n){console.log(`RECEIVER: Updating PTZ controls for ${n}`),Bu(n);const e=Tn[n];["zoom","pan","tilt"].forEach(t=>{const r=!!(e&&e[t]),i=document.getElementById(`${t}Slider`),s=document.getElementById(`${t}Value`);if(document.querySelectorAll(`button[id$="${t.charAt(0).toUpperCase()+t.slice(1)}Btn"]`).forEach(a=>a.disabled=!r),i&&(i.disabled=!r),r){const{min:a,max:l,step:d}=e[t];i.min=a,i.max=l,i.step=d;const f=parseFloat(i.value);i.value=Math.max(a,Math.min(l,f)),s.textContent=parseFloat(i.value).toFixed(2)}else s&&(s.textContent="N/A")})}function Ld(n,e){if(_e?.connectionState!=="connected"||It?.readyState!=="open")return console.warn("RECEIVER: Cannot send command. Connection not ready."),!1;const t=Tn[e];return!t||!t[n]?(console.warn(`RECEIVER: PTZ type '${n}' is not supported for ${e}.`),!1):!0}function bs(n,e){const t=vn;if(!Ld(n,t))return;const{min:r,max:i}=Tn[t][n],s=Math.max(r,Math.min(i,e)),a={type:"command",target:t,command:n,value:s};try{It.send(JSON.stringify(a)),document.getElementById(`${n}Slider`).value=s,document.getElementById(`${n}Value`).textContent=s.toFixed(2)}catch(l){console.error("RECEIVER: Error sending unmeasured command:",l)}}function xe(n,e,t={}){const r=vn;if(!Ld(n,r))return;const{min:i,max:s}=Tn[r][n],a=Math.max(i,Math.min(s,e)),l=`${performance.now()}-${Math.random()}`,d={type:"command",target:r,command:n,value:a,id:l};try{const f=t.startTime||performance.now();Dr.set(l,f),It.send(JSON.stringify(d)),document.getElementById(`${n}Slider`).value=a,document.getElementById(`${n}Value`).textContent=a.toFixed(2)}catch(f){console.error("RECEIVER: Error sending measured command:",f)}}function zv(){const n=_e.createDataChannel("ptz");oa(n),n.onopen=()=>{console.log("SENDER: DataChannel is open. Sending capabilities...");const e={};for(const t in Pt){const r=Pt[t];if(r){const i=r.getCapabilities();e[t]={zoom:i.zoom,pan:i.pan,tilt:i.tilt}}}n.send(JSON.stringify({type:"capabilities",data:e}))},n.onmessage=e=>{const t=JSON.parse(e.data);t.type==="command"&&Pt[t.target]&&(Yn(t.target,t.command,t.value),t.id&&mo.add(t.target,t.command,t.value,t.id))},n.onclose=()=>{console.log("SENDER: DataChannel is closed."),mo.stopChecker("camera1"),mo.stopChecker("camera2")},n.onerror=e=>console.error("SENDER: DataChannel error:",e)}function qv(n){if(n.channel.label!=="ptz")return;const e=n.channel;oa(e),e.onopen=()=>console.log("RECEIVER: DataChannel is open."),e.onmessage=t=>{const r=JSON.parse(t.data);if(r.type==="capabilities")Ef(r.data),r.data.camera2?bo.style.display="inline":(bo.style.display="none",vn==="camera2"&&(document.querySelector('input[name="ptzTarget"][value="camera1"]').checked=!0,Bu("camera1"))),ss.style.display="block",document.getElementById("ptzEvaluationControl").style.display="block",Nd(vn);else if(r.type==="command_ack"&&Dr.has(r.id)){const i=Dr.get(r.id),s=performance.now()-i,a=r.timedOut||!1;console.log(`PTZ Latency (${r.command}): ${s.toFixed(2)} ms, Timed Out: ${a}`),jv({ptzLatency:s,command:r.command,timedOut:a?1:0}),Dr.delete(r.id)}},e.onclose=()=>{ss.style.display="none",document.getElementById("ptzEvaluationControl").style.display="none",Dr.clear()},e.onerror=t=>console.error("RECEIVER: DataChannel error:",t)}async function Hv(){if(!(!_e||In!=="receiver"||_e.connectionState!=="connected"))try{const n=await _e.getStats();Hn&&Object.values(Hn).forEach(e=>{e&&e.displayElement&&(e.displayElement.style.display="none")}),n.forEach(e=>{if(e.type==="inbound-rtp"&&e.mediaType==="video"&&Hn){const t=Hn[e.trackIdentifier];t&&t.displayElement&&e.frameWidth&&e.frameHeight&&(t.displayElement.textContent=`${e.frameWidth} x ${e.frameHeight}`,t.displayElement.style.display="block")}})}catch(n){console.error("Error getting stats for resolution display:",n)}}function Wv(n,e){const t=Pt.camera1?.id,r=Pt.camera2?.id,i=new Map;n.forEach(s=>{s.type==="media-source"&&i.set(s.id,s.trackIdentifier)}),n.forEach(s=>{if(s.type==="outbound-rtp"&&s.mediaType==="video"){const a=i.get(s.mediaSourceId);if(!a)return;let l;if(a===t?l="camera1":a===r&&(l="camera2"),l){const d=Hr?.get(s.id),f=s.bytesSent-(d?.bytesSent??0),g=s.packetsSent-(d?.packetsSent??0);e[`${l}_sent_resolution`]=`${s.frameWidth}x${s.frameHeight}`,e[`${l}_sent_fps`]=s.framesPerSecond,e[`${l}_sent_bitrate_kbps`]=Math.round(Math.max(0,f)*8/1e3),e[`${l}_packets_sent_per_second`]=Math.max(0,g),e[`${l}_total_encode_time_s`]=s.totalEncodeTime,e[`${l}_keyframes_encoded`]=s.keyFramesEncoded,e[`${l}_quality_limitation_reason`]=s.qualityLimitationReason,e[`${l}_quality_limitation_resolution_changes`]=s.qualityLimitationResolutionChanges,e[`${l}_retransmitted_packets_sent`]=s.retransmittedPacketsSent,e[`${l}_nack_count`]=s.nackCount}}if(s.type==="remote-inbound-rtp"&&s.mediaType==="video"&&(e.receiver_jitter_ms=(s.jitter*1e3).toFixed(4)??"N/A",e.receiver_packets_lost=s.packetsLost,e.receiver_fraction_lost=s.fractionLost,e.rtt_rtcp_ms=(s.roundTripTime*1e3).toFixed(4)??"N/A"),s.type==="candidate-pair"&&s.nominated&&s.state==="succeeded"){e.available_outgoing_bitrate_kbps=s.availableOutgoingBitrate?Math.round(s.availableOutgoingBitrate/1e3):"N/A",e.rtt_ice_ms=(s.currentRoundTripTime*1e3).toFixed(4)??"N/A";const a=n.get(s.remoteCandidateId);if(a&&a.candidateType){let l;switch(a.candidateType){case"host":l=0;break;case"srflx":case"prflx":l=1;break;case"relay":l=2;break;default:l=-1;break}e.connection_type=l}}if(s.type==="data-channel"){const a=Hr?.get(s.id),l=s.bytesSent-(a?.bytesSent??0),d=s.bytesReceived-(a?.bytesReceived??0);e[`datachannel_${s.label}_state`]=s.state,e[`datachannel_${s.label}_messages_sent`]=s.messagesSent,e[`datachannel_${s.label}_bytes_sent_total`]=s.bytesSent,e[`datachannel_${s.label}_messages_received`]=s.messagesReceived,e[`datachannel_${s.label}_bytes_received_total`]=s.bytesReceived,e[`datachannel_${s.label}_sent_bitrate_kbps`]=Math.round(Math.max(0,l)*8/1e3),e[`datachannel_${s.label}_received_bitrate_kbps`]=Math.round(Math.max(0,d)*8/1e3)}})}function Gv(n,e){n.forEach(t=>{if(t.type==="inbound-rtp"&&t.mediaType==="video"){const r=Hn[t.trackIdentifier],i=r?r.name:null;if(i){const s=Hr?.get(t.id),a=t.bytesReceived-(s?.bytesReceived??0),l=t.packetsReceived-(s?.packetsReceived??0);e[`${i}_received_resolution`]=`${t.frameWidth}x${t.frameHeight}`,e[`${i}_received_fps`]=t.framesPerSecond,e[`${i}_received_bitrate_kbps`]=Math.round(Math.max(0,a)*8/1e3),e[`${i}_packets_received_per_second`]=Math.max(0,l),e[`${i}_jitter_ms`]=(t.jitter*1e3).toFixed(4)??"N/A",e[`${i}_fraction_lost`]=t.fractionLost,e[`${i}_packets_lost`]=t.packetsLost,e[`${i}_frames_dropped`]=t.framesDropped,e[`${i}_total_decode_time_s`]=t.totalDecodeTime,e[`${i}_keyframes_decoded`]=t.keyFramesDecoded,e[`${i}_jitter_buffer_delay_s`]=t.jitterBufferDelay,e[`${i}_fir_count`]=t.firCount,e[`${i}_pli_count`]=t.pliCount,e[`${i}_jitter_buffer_emitted_count`]=t.jitterBufferEmittedCount}}if(t.type==="candidate-pair"&&t.nominated&&t.state==="succeeded"){const r=n.get(t.remoteCandidateId);r&&r.candidateType&&(e.connection_type=r.candidateType)}if(t.type==="data-channel"){const r=Hr?.get(t.id),i=t.bytesSent-(r?.bytesSent??0),s=t.bytesReceived-(r?.bytesReceived??0);e[`datachannel_${t.label}_state`]=t.state,e[`datachannel_${t.label}_messages_sent`]=t.messagesSent,e[`datachannel_${t.label}_bytes_sent_total`]=t.bytesSent,e[`datachannel_${t.label}_messages_received`]=t.messagesReceived,e[`datachannel_${t.label}_bytes_received_total`]=t.bytesReceived,e[`datachannel_${t.label}_sent_bitrate_kbps`]=Math.round(Math.max(0,i)*8/1e3),e[`datachannel_${t.label}_received_bitrate_kbps`]=Math.round(Math.max(0,s)*8/1e3)}})}function Md(){if(!_e||na)return;Vu(!0),Du([]),ns(null),Cs.disabled=!0,ks.disabled=!1,Rs.disabled=!0,as.textContent="記録中...";const n=setInterval(async()=>{if(!_e)return;const e=await _e.getStats(),t={timestamp:new Date().toISOString()};In==="sender"?Wv(e,t):Gv(e,t),Object.keys(t).length>1&&(qt.push(t),as.textContent=`記録中... ${qt.length} 個`),ns(e)},1e3);wf(n)}function el(){na&&(clearInterval(ku),Vu(!1),ns(null),Cs.disabled=!1,ks.disabled=!0,Rs.disabled=qt.length===0,as.textContent=`記録停止。${qt.length} 個`)}function Kv(){if(qt.length===0){alert("ダウンロードするデータがありません");return}const n=new Set;qt.forEach(l=>Object.keys(l).forEach(d=>n.add(d)));const e=Array.from(n),r=[e.join(","),...qt.map(l=>e.map(d=>{const f=l[d]??"";return typeof f=="string"&&f.includes(",")?`"${f.replace(/"/g,'""')}"`:f}).join(","))].join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.download=`webrtc_stats_${In}_${new Date().toISOString().replace(/[:.]/g,"-")}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}function Qv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ot={},un={},po={},au;function Xv(){return au||(au=1,Object.defineProperty(po,"__esModule",{value:!0})),po}var Vi={},Bi={},lu;function Od(){return lu||(lu=1,function(n){(function(e){var t="undefined",r=t!==typeof Buffer&&Buffer,i=t!==typeof Uint8Array&&Uint8Array,s=t!==typeof ArrayBuffer&&ArrayBuffer,a=[0,0,0,0,0,0,0,0],l=Array.isArray||P,d=4294967296,f=16777216,g;A("Uint64BE",!0,!0),A("Int64BE",!0,!1),A("Uint64LE",!1,!0),A("Int64LE",!1,!1);function A(E,y,T){var v=y?0:4,w=y?4:0,S=y?0:3,b=y?1:2,Y=y?2:1,ae=y?3:0,be=y?q:L,Ee=y?W:O,Ae=ue.prototype,He="is"+E,ct="_"+He;return Ae.buffer=void 0,Ae.offset=0,Ae[ct]=!0,Ae.toNumber=Me,Ae.toString=ut,Ae.toJSON=Me,Ae.toArray=k,r&&(Ae.toBuffer=C),i&&(Ae.toArrayBuffer=x),ue[He]=Z,e[E]=ue,ue;function ue(te,Q,J,re){return this instanceof ue?ge(this,te,Q,J,re):new ue(te,Q,J,re)}function Z(te){return!!(te&&te[ct])}function ge(te,Q,J,re,de){if(i&&s&&(Q instanceof s&&(Q=new i(Q)),re instanceof s&&(re=new i(re))),!Q&&!J&&!re&&!g){te.buffer=z(a,0);return}if(!N(Q,J)){var Re=g||Array;de=J,re=Q,J=0,Q=g===r?r.alloc(8):new Re(8)}te.buffer=Q,te.offset=J|=0,t!==typeof re&&(typeof re=="string"?Ce(Q,J,re,de||10):N(re,de)?M(Q,J,re,de):typeof de=="number"?(Xe(Q,J+v,re),Xe(Q,J+w,de)):re>0?be(Q,J,re):re<0?Ee(Q,J,re):M(Q,J,a,0))}function Ce(te,Q,J,re){var de=0,Re=J.length,je=0,$e=0;J[0]==="-"&&de++;for(var ht=de;de<Re;){var pt=parseInt(J[de++],re);if(!(pt>=0))break;$e=$e*re+pt,je=je*re+Math.floor($e/d),$e%=d}ht&&(je=~je,$e?$e=d-$e:je++),Xe(te,Q+v,je),Xe(te,Q+w,$e)}function Me(){var te=this.buffer,Q=this.offset,J=Oe(te,Q+v),re=Oe(te,Q+w);return T||(J|=0),J?J*d+re:re}function ut(te){var Q=this.buffer,J=this.offset,re=Oe(Q,J+v),de=Oe(Q,J+w),Re="",je=!T&&re&2147483648;for(je&&(re=~re,de=d-de),te=te||10;;){var $e=re%te*d+de;if(re=Math.floor(re/te),de=Math.floor($e/te),Re=($e%te).toString(te)+Re,!re&&!de)break}return je&&(Re="-"+Re),Re}function Xe(te,Q,J){te[Q+ae]=J&255,J=J>>8,te[Q+Y]=J&255,J=J>>8,te[Q+b]=J&255,J=J>>8,te[Q+S]=J&255}function Oe(te,Q){return te[Q+S]*f+(te[Q+b]<<16)+(te[Q+Y]<<8)+te[Q+ae]}}function k(E){var y=this.buffer,T=this.offset;return g=null,E!==!1&&l(y)?y.length===8?y:y.slice(T,T+8):z(y,T)}function C(E){var y=this.buffer,T=this.offset;return g=r,E!==!1&&r.isBuffer(y)?y.length===8?y:y.slice(T,T+8):r.from(x.call(this,E))}function x(E){var y=this.buffer,T=this.offset,v=y.buffer;if(g=i,E!==!1&&!y.offset&&v instanceof s)return v.byteLength===8?v:v.slice(T,T+8);var w=new i(8);return M(w,0,y,T),w.buffer}function N(E,y){var T=E&&E.length;return y|=0,T&&y+8<=T&&typeof E[y]!="string"}function M(E,y,T,v){y|=0,v|=0;for(var w=0;w<8;w++)E[y++]=T[v++]&255}function z(E,y){return Array.prototype.slice.call(E,y,y+8)}function q(E,y,T){for(var v=y+8;v>y;)E[--v]=T&255,T/=256}function W(E,y,T){var v=y+8;for(T++;v>y;)E[--v]=-T&255^255,T/=256}function L(E,y,T){for(var v=y+8;y<v;)E[y++]=T&255,T/=256}function O(E,y,T){var v=y+8;for(T++;y<v;)E[y++]=-T&255^255,T/=256}function P(E){return!!E&&Object.prototype.toString.call(E)=="[object Array]"}})(typeof n.nodeName!="string"?n:Bi||{})}(Bi)),Bi}var go={},Ni={},Sr={},cu;function Fd(){return cu||(cu=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.byEbmlID=void 0,Sr.byEbmlID={128:{name:"ChapterDisplay",level:4,type:"m",multiple:!0,minver:1,webm:!0,description:"Contains all possible strings to use for the chapter display."},131:{name:"TrackType",level:3,type:"u",mandatory:!0,minver:1,range:"1-254",description:"A set of track types coded on 8 bits (1: video, 2: audio, 3: complex, 0x10: logo, 0x11: subtitle, 0x12: buttons, 0x20: control)."},133:{name:"ChapString",cppname:"ChapterString",level:5,type:"8",mandatory:!0,minver:1,webm:!0,description:"Contains the string to use as the chapter atom."},134:{name:"CodecID",level:3,type:"s",mandatory:!0,minver:1,description:"An ID corresponding to the codec, see the codec page for more info."},136:{name:"FlagDefault",cppname:"TrackFlagDefault",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if that track (audio, video or subs) SHOULD be active if no language found matches the user preference. (1 bit)"},137:{name:"ChapterTrackNumber",level:5,type:"u",mandatory:!0,multiple:!0,minver:1,webm:!1,range:"not 0",description:"UID of the Track to apply this chapter too. In the absense of a control track, choosing this chapter will select the listed Tracks and deselect unlisted tracks. Absense of this element indicates that the Chapter should be applied to any currently used Tracks."},145:{name:"ChapterTimeStart",level:4,type:"u",mandatory:!0,minver:1,webm:!0,description:"Timestamp of the start of Chapter (not scaled)."},146:{name:"ChapterTimeEnd",level:4,type:"u",minver:1,webm:!1,description:"Timestamp of the end of Chapter (timestamp excluded, not scaled)."},150:{name:"CueRefTime",level:5,type:"u",mandatory:!0,minver:2,webm:!1,description:"Timestamp of the referenced Block."},151:{name:"CueRefCluster",level:5,type:"u",mandatory:!0,webm:!1,description:"The Position of the Cluster containing the referenced Block."},152:{name:"ChapterFlagHidden",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a chapter is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},16980:{name:"ContentCompAlgo",level:6,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The compression algorithm used. Algorithms that have been specified so far are: 0 - zlib,   3 - Header Stripping"},16981:{name:"ContentCompSettings",level:6,type:"b",minver:1,webm:!1,description:"Settings that might be needed by the decompressor. For Header Stripping (ContentCompAlgo=3), the bytes that were removed from the beggining of each frames of the track."},17026:{name:"DocType",level:1,type:"s",mandatory:!0,default:"matroska",minver:1,description:"A string that describes the type of document that follows this EBML header. 'matroska' in our case or 'webm' for webm files."},17029:{name:"DocTypeReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum DocType version an interpreter has to support to read this file."},17030:{name:"EBMLVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of EBML parser used to create the file."},17031:{name:"DocTypeVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of DocType interpreter used to create the file."},17476:{name:"SegmentFamily",level:2,type:"b",multiple:!0,minver:1,webm:!1,bytesize:16,description:"A randomly generated unique ID that all segments related to each other must use (128 bits)."},17505:{name:"DateUTC",level:2,type:"d",minver:1,description:"Date of the origin of timestamp (value 0), i.e. production date."},17540:{name:"TagDefault",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Indication to know if this is the default/original language to use for the given tag. (1 bit)"},17541:{name:"TagBinary",level:4,type:"b",minver:1,webm:!1,description:"The values of the Tag if it is binary. Note that this cannot be used in the same SimpleTag as TagString."},17543:{name:"TagString",level:4,type:"8",minver:1,webm:!1,description:"The value of the Element."},17545:{name:"Duration",level:2,type:"f",minver:1,range:"> 0",description:"Duration of the segment (based on TimecodeScale)."},17816:{name:"ChapterFlagEnabled",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Specify wether the chapter is enabled. It can be enabled/disabled by a Control Track. When disabled, the movie should skip all the content between the TimeStart and TimeEnd of this chapter (see flag notes). (1 bit)"},18016:{name:"FileMimeType",level:3,type:"s",mandatory:!0,minver:1,webm:!1,description:"MIME type of the file."},18017:{name:"FileUsedStartTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18018:{name:"FileUsedEndTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18037:{name:"FileReferral",level:3,type:"b",webm:!1,description:"A binary value that a track/codec can refer to when the attachment is needed."},20529:{name:"ContentEncodingOrder",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Tells when this modification was used during encoding/muxing starting with 0 and counting upwards. The decoder/demuxer has to start with the highest order number it finds and work its way down. This value has to be unique over all ContentEncodingOrder elements in the segment."},20530:{name:"ContentEncodingScope",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"A bit field that describes which elements have been modified in this way. Values (big endian) can be OR'ed. Possible values: 1 - all frame contents, 2 - the track's private data, 4 - the next ContentEncoding (next ContentEncodingOrder. Either the data inside ContentCompression and/or ContentEncryption)"},20531:{name:"ContentEncodingType",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"A value describing what kind of transformation has been done. Possible values: 0 - compression, 1 - encryption"},20532:{name:"ContentCompression",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the compression used. Must be present if the value of ContentEncodingType is 0 and absent otherwise. Each block must be decompressable even if no previous block is available in order not to prevent seeking."},20533:{name:"ContentEncryption",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the encryption used. Must be present if the value of ContentEncodingType is 1 and absent otherwise."},21368:{name:"CueBlockNumber",level:4,type:"u",minver:1,default:1,range:"not 0",description:"Number of the Block in the specified Cluster."},22100:{name:"ChapterStringUID",level:4,type:"8",mandatory:!1,minver:3,webm:!0,description:"A unique string ID to identify the Chapter. Use for WebVTT cue identifier storage."},22337:{name:"WritingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Writing application ("mkvmerge-0.3.3").'},22612:{name:"SilentTracks",cppname:"ClusterSilentTracks",level:2,type:"m",minver:1,webm:!1,description:"The list of tracks that are not used in that part of the stream. It is useful when using overlay tracks on seeking. Then you should decide what track to use."},25152:{name:"ContentEncoding",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Settings for one content encoding like compression or encryption."},25188:{name:"BitDepth",cppname:"AudioBitDepth",level:4,type:"u",minver:1,range:"not 0",description:"Bits per sample, mostly used for PCM."},25906:{name:"SignedElement",level:3,type:"b",multiple:!0,webm:!1,description:"An element ID whose data will be used to compute the signature."},26148:{name:"TrackTranslate",level:3,type:"m",multiple:!0,minver:1,webm:!1,description:"The track identification for the given Chapter Codec."},26897:{name:"ChapProcessCommand",cppname:"ChapterProcessCommand",level:5,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26914:{name:"ChapProcessTime",cppname:"ChapterProcessTime",level:6,type:"u",mandatory:!0,minver:1,webm:!1,description:"Defines when the process command should be handled (0: during the whole chapter, 1: before starting playback, 2: after playback of the chapter)."},26916:{name:"ChapterTranslate",level:2,type:"m",multiple:!0,minver:1,webm:!1,description:"A tuple of corresponding ID used by chapter codecs to represent this segment."},26931:{name:"ChapProcessData",cppname:"ChapterProcessData",level:6,type:"b",mandatory:!0,minver:1,webm:!1,description:"Contains the command information. The data should be interpreted depending on the ChapProcessCodecID value. For ChapProcessCodecID = 1, the data correspond to the binary DVD cell pre/post commands."},26948:{name:"ChapProcess",cppname:"ChapterProcess",level:4,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26965:{name:"ChapProcessCodecID",cppname:"ChapterProcessCodecID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Contains the type of the codec used for the processing. A value of 0 means native Matroska processing (to be defined), a value of 1 means the DVD command set is used. More codec IDs can be added later."},29555:{name:"Tag",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters."},29572:{name:"SegmentFilename",level:2,type:"8",minver:1,webm:!1,description:"A filename corresponding to this segment."},29766:{name:"AttachmentLink",cppname:"TrackAttachmentLink",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"The UID of an attachment that is used by this codec."},2459272:{name:"CodecName",level:3,type:"8",minver:1,description:"A human-readable string specifying the codec."},408125543:{name:"Segment",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"This element contains all other top-level (level 1) elements. Typically a Matroska file is composed of 1 segment."},17530:{name:"TagLanguage",level:4,type:"s",mandatory:!0,minver:1,webm:!1,default:"und",description:"Specifies the language of the tag specified, in the Matroska languages form."},17827:{name:"TagName",level:4,type:"8",mandatory:!0,minver:1,webm:!1,description:"The name of the Tag that is going to be stored."},26568:{name:"SimpleTag",cppname:"TagSimple",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contains general information about the target."},25542:{name:"TagAttachmentUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Attachment(s) the tags belong to. If the value is 0 at this level, the tags apply to all the attachments in the Segment."},25540:{name:"TagChapterUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Chapter(s) the tags belong to. If the value is 0 at this level, the tags apply to all chapters in the Segment."},25545:{name:"TagEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the EditionEntry(s) the tags belong to. If the value is 0 at this level, the tags apply to all editions in the Segment."},25541:{name:"TagTrackUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Track(s) the tags belong to. If the value is 0 at this level, the tags apply to all tracks in the Segment."},25546:{name:"TargetType",cppname:"TagTargetType",level:4,type:"s",minver:1,webm:!1,strong:"informational",description:'An  string that can be used to display the logical level of the target like "ALBUM", "TRACK", "MOVIE", "CHAPTER", etc (see TargetType).'},26826:{name:"TargetTypeValue",cppname:"TagTargetTypeValue",level:4,type:"u",minver:1,webm:!1,default:50,description:"A number to indicate the logical level of the target (see TargetType)."},25536:{name:"Targets",cppname:"TagTargets",level:3,type:"m",mandatory:!0,minver:1,webm:!1,description:"Contain all UIDs where the specified meta data apply. It is empty to describe everything in the segment."},307544935:{name:"Tags",level:1,type:"m",multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters. A list of valid tags can be found here."},17677:{name:"ChapProcessPrivate",cppname:"ChapterProcessPrivate",level:5,type:"b",minver:1,webm:!1,description:'Some optional data attached to the ChapProcessCodecID information. For ChapProcessCodecID = 1, it is the "DVD level" equivalent.'},17278:{name:"ChapCountry",cppname:"ChapterCountry",level:5,type:"s",multiple:!0,minver:1,webm:!1,description:"The countries corresponding to the string, same 2 octets as in Internet domains."},17276:{name:"ChapLanguage",cppname:"ChapterLanguage",level:5,type:"s",mandatory:!0,multiple:!0,minver:1,webm:!0,default:"eng",description:"The languages corresponding to the string, in the bibliographic ISO-639-2 form."},143:{name:"ChapterTrack",level:4,type:"m",minver:1,webm:!1,description:"List of tracks on which the chapter applies. If this element is not present, all tracks apply"},25539:{name:"ChapterPhysicalEquiv",level:4,type:"u",minver:1,webm:!1,description:'Specify the physical equivalent of this ChapterAtom like "DVD" (60) or "SIDE" (50), see complete list of values.'},28348:{name:"ChapterSegmentEditionUID",level:4,type:"u",minver:1,webm:!1,range:"not 0",description:"The EditionUID to play from the segment linked in ChapterSegmentUID."},28263:{name:"ChapterSegmentUID",level:4,type:"b",minver:1,webm:!1,range:">0",bytesize:16,description:"A segment to play in place of this chapter. Edition ChapterSegmentEditionUID should be used for this segment, otherwise no edition is used."},29636:{name:"ChapterUID",level:4,type:"u",mandatory:!0,minver:1,webm:!0,range:"not 0",description:"A unique ID to identify the Chapter."},182:{name:"ChapterAtom",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains the atom information to use as the chapter atom (apply to all tracks)."},17885:{name:"EditionFlagOrdered",level:3,type:"u",minver:1,webm:!1,default:0,range:"0-1",description:"Specify if the chapters can be defined multiple times and the order to play them is enforced. (1 bit)"},17883:{name:"EditionFlagDefault",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a flag is set (1) the edition should be used as the default one. (1 bit)"},17853:{name:"EditionFlagHidden",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If an edition is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},17852:{name:"EditionUID",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"A unique ID to identify the edition. It's useful for tagging an edition."},17849:{name:"EditionEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains all information about a segment edition."},272869232:{name:"Chapters",level:1,type:"m",minver:1,webm:!0,description:"A system to define basic menus and partition data. For more detailed information, look at the Chapters Explanation."},18094:{name:"FileUID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,range:"not 0",description:"Unique ID representing the file, as random as possible."},18012:{name:"FileData",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The data of the file."},18030:{name:"FileName",level:3,type:"8",mandatory:!0,minver:1,webm:!1,description:"Filename of the attached file."},18046:{name:"FileDescription",level:3,type:"8",minver:1,webm:!1,description:"A human-friendly name for the attached file."},24999:{name:"AttachedFile",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"An attached file."},423732329:{name:"Attachments",level:1,type:"m",minver:1,webm:!1,description:"Contain attached files."},235:{name:"CueRefCodecState",level:5,type:"u",webm:!1,default:0,description:"The position of the Codec State corresponding to this referenced element. 0 means that the data is taken from the initial Track Entry."},21343:{name:"CueRefNumber",level:5,type:"u",webm:!1,default:1,range:"not 0",description:"Number of the referenced Block of Track X in the specified Cluster."},219:{name:"CueReference",level:4,type:"m",multiple:!0,minver:2,webm:!1,description:"The Clusters containing the required referenced Blocks."},234:{name:"CueCodecState",level:4,type:"u",minver:2,webm:!1,default:0,description:"The position of the Codec State corresponding to this Cue element. 0 means that the data is taken from the initial Track Entry."},178:{name:"CueDuration",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The duration of the block according to the segment time base. If missing the track's DefaultDuration does not apply and no duration information is available in terms of the cues."},240:{name:"CueRelativePosition",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The relative position of the referenced block inside the cluster with 0 being the first possible position for an element inside that cluster.",position:"clusterRelative"},241:{name:"CueClusterPosition",level:4,type:"u",mandatory:!0,minver:1,description:"The position of the Cluster containing the required Block.",position:"segment"},247:{name:"CueTrack",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track for which a position is given."},183:{name:"CueTrackPositions",level:3,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contain positions for different tracks corresponding to the timestamp."},179:{name:"CueTime",level:3,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp according to the segment time base."},187:{name:"CuePoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains all information relative to a seek point in the segment."},475249515:{name:"Cues",level:1,type:"m",minver:1,description:'A top-level element to speed seeking access. All entries are local to the segment. Should be mandatory for non "live" streams.'},18406:{name:"ContentSigHashAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The hash algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - SHA1-160 2 - MD5"},18405:{name:"ContentSigAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - RSA"},18404:{name:"ContentSigKeyID",level:6,type:"b",minver:1,webm:!1,description:"This is the ID of the private key the data was signed with."},18403:{name:"ContentSignature",level:6,type:"b",minver:1,webm:!1,description:"A cryptographic signature of the contents."},18402:{name:"ContentEncKeyID",level:6,type:"b",minver:1,webm:!1,description:"For public key algorithms this is the ID of the public key the the data was encrypted with."},18401:{name:"ContentEncAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The encryption algorithm used. The value '0' means that the contents have not been encrypted but only signed. Predefined values: 1 - DES, 2 - 3DES, 3 - Twofish, 4 - Blowfish, 5 - AES"},28032:{name:"ContentEncodings",level:3,type:"m",minver:1,webm:!1,description:"Settings for several content encoding mechanisms like compression or encryption."},196:{name:"TrickMasterTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},199:{name:"TrickMasterTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},198:{name:"TrickTrackFlag",level:3,type:"u",divx:!0,default:0,description:"DivX trick track extenstions"},193:{name:"TrickTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},192:{name:"TrickTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},237:{name:"TrackJoinUID",level:5,type:"u",mandatory:!0,multiple:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of a track whose blocks are used to create this virtual track."},233:{name:"TrackJoinBlocks",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all tracks whose Blocks need to be combined to create this virtual track"},230:{name:"TrackPlaneType",level:6,type:"u",mandatory:!0,minver:3,webm:!1,description:"The kind of plane this track corresponds to (0: left eye, 1: right eye, 2: background)."},229:{name:"TrackPlaneUID",level:6,type:"u",mandatory:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of the track representing the plane."},228:{name:"TrackPlane",level:5,type:"m",mandatory:!0,multiple:!0,minver:3,webm:!1,description:"Contains a video plane track that need to be combined to create this 3D track"},227:{name:"TrackCombinePlanes",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all video plane tracks that need to be combined to create this 3D track"},226:{name:"TrackOperation",level:3,type:"m",minver:3,webm:!1,description:"Operation that needs to be applied on tracks to create this virtual track. For more details look at the Specification Notes on the subject."},32123:{name:"ChannelPositions",cppname:"AudioPosition",level:4,type:"b",webm:!1,description:"Table of horizontal angles for each successive channel, see appendix."},159:{name:"Channels",cppname:"AudioChannels",level:4,type:"u",mandatory:!0,minver:1,default:1,range:"not 0",description:"Numbers of channels in the track."},30901:{name:"OutputSamplingFrequency",cppname:"AudioOutputSamplingFreq",level:4,type:"f",minver:1,default:"Sampling Frequency",range:"> 0",description:"Real output sampling frequency in Hz (used for SBR techniques)."},181:{name:"SamplingFrequency",cppname:"AudioSamplingFreq",level:4,type:"f",mandatory:!0,minver:1,default:8e3,range:"> 0",description:"Sampling frequency in Hz."},225:{name:"Audio",cppname:"TrackAudio",level:3,type:"m",minver:1,description:"Audio settings."},2327523:{name:"FrameRate",cppname:"VideoFrameRate",level:4,type:"f",range:"> 0",strong:"Informational",description:"Number of frames per second.  only."},3126563:{name:"GammaValue",cppname:"VideoGamma",level:4,type:"f",webm:!1,range:"> 0",description:"Gamma Value."},3061028:{name:"ColourSpace",cppname:"VideoColourSpace",level:4,type:"b",minver:1,webm:!1,bytesize:4,description:"Same value as in AVI (32 bits)."},21683:{name:"AspectRatioType",cppname:"VideoAspectRatio",level:4,type:"u",minver:1,default:0,description:"Specify the possible modifications to the aspect ratio (0: free resizing, 1: keep aspect ratio, 2: fixed)."},21682:{name:"DisplayUnit",cppname:"VideoDisplayUnit",level:4,type:"u",minver:1,default:0,description:"How DisplayWidth & DisplayHeight should be interpreted (0: pixels, 1: centimeters, 2: inches, 3: Display Aspect Ratio)."},21690:{name:"DisplayHeight",cppname:"VideoDisplayHeight",level:4,type:"u",minver:1,default:"PixelHeight",range:"not 0",description:"Height of the video frames to display. The default value is only valid when DisplayUnit is 0."},21680:{name:"DisplayWidth",cppname:"VideoDisplayWidth",level:4,type:"u",minver:1,default:"PixelWidth",range:"not 0",description:"Width of the video frames to display. The default value is only valid when DisplayUnit is 0."},21725:{name:"PixelCropRight",cppname:"VideoPixelCropRight",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the right of the image."},21708:{name:"PixelCropLeft",cppname:"VideoPixelCropLeft",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the left of the image."},21691:{name:"PixelCropTop",cppname:"VideoPixelCropTop",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the top of the image."},21674:{name:"PixelCropBottom",cppname:"VideoPixelCropBottom",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the bottom of the image (for HDTV content)."},186:{name:"PixelHeight",cppname:"VideoPixelHeight",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Height of the encoded video frames in pixels."},176:{name:"PixelWidth",cppname:"VideoPixelWidth",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Width of the encoded video frames in pixels."},21433:{name:"OldStereoMode",level:4,type:"u",maxver:"0",webm:!1,divx:!1,description:"DEPRECATED, DO NOT USE. Bogus StereoMode value used in old versions of libmatroska. (0: mono, 1: right eye, 2: left eye, 3: both eyes)."},21440:{name:"AlphaMode",cppname:"VideoAlphaMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Alpha Video Mode. Presence of this element indicates that the BlockAdditional element could contain Alpha data."},21432:{name:"StereoMode",cppname:"VideoStereoMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Stereo-3D video mode (0: mono, 1: side by side (left eye is first), 2: top-bottom (right eye is first), 3: top-bottom (left eye is first), 4: checkboard (right is first), 5: checkboard (left is first), 6: row interleaved (right is first), 7: row interleaved (left is first), 8: column interleaved (right is first), 9: column interleaved (left is first), 10: anaglyph (cyan/red), 11: side by side (right eye is first), 12: anaglyph (green/magenta), 13 both eyes laced in one Block (left eye is first), 14 both eyes laced in one Block (right eye is first)) . There are some more details on 3D support in the Specification Notes."},154:{name:"FlagInterlaced",cppname:"VideoFlagInterlaced",level:4,type:"u",mandatory:!0,minver:2,webm:!0,default:0,range:"0-1",description:"Set if the video is interlaced. (1 bit)"},224:{name:"Video",cppname:"TrackVideo",level:3,type:"m",minver:1,description:"Video settings."},26277:{name:"TrackTranslateTrackID",level:4,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this track in the chapter codec data. The format depends on the ChapProcessCodecID used."},26303:{name:"TrackTranslateCodec",level:4,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},26364:{name:"TrackTranslateEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this translation applies. When not specified, it means for all editions found in the segment."},22203:{name:"SeekPreRoll",level:3,type:"u",mandatory:!0,multiple:!1,default:0,minver:4,webm:!0,description:"After a discontinuity, SeekPreRoll is the duration in nanoseconds of the data the decoder must decode before the decoded data is valid."},22186:{name:"CodecDelay",level:3,type:"u",multiple:!1,default:0,minver:4,webm:!0,description:"CodecDelay is The codec-built-in delay in nanoseconds. This value must be subtracted from each block timestamp in order to get the actual timestamp. The value should be small so the muxing of tracks with the same actual timestamp are in the same Cluster."},28587:{name:"TrackOverlay",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify that this track is an overlay track for the Track specified (in the u-integer). That means when this track has a gap (see SilentTracks) the overlay track should be used instead. The order of multiple TrackOverlay matters, the first one is the one that should be used. If not found it should be the second, etc."},170:{name:"CodecDecodeAll",level:3,type:"u",mandatory:!0,minver:2,webm:!1,default:1,range:"0-1",description:"The codec can decode potentially damaged data (1 bit)."},2536e3:{name:"CodecDownloadURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to download about the codec used."},3883072:{name:"CodecInfoURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to find information about the codec used."},3839639:{name:"CodecSettings",level:3,type:"8",webm:!1,description:"A string describing the encoding setting used."},25506:{name:"CodecPrivate",level:3,type:"b",minver:1,description:"Private data only known to the codec."},2274716:{name:"Language",cppname:"TrackLanguage",level:3,type:"s",minver:1,default:"eng",description:"Specifies the language of the track in the Matroska languages form."},21358:{name:"Name",cppname:"TrackName",level:3,type:"8",minver:1,description:"A human-readable track name."},21998:{name:"MaxBlockAdditionID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The maximum value of BlockAdditions for this track."},21375:{name:"TrackOffset",level:3,type:"i",webm:!1,default:0,description:"A value to add to the Block's Timestamp. This can be used to adjust the playback offset of a track."},2306383:{name:"TrackTimecodeScale",level:3,type:"f",mandatory:!0,minver:1,maxver:"3",webm:!1,default:1,range:"> 0",description:"DEPRECATED, DO NOT USE. The scale to apply on this track to work at normal speed in relation with other tracks (mostly used to adjust video speed when the audio length differs)."},2313850:{name:"DefaultDecodedFieldDuration",cppname:"TrackDefaultDecodedFieldDuration",level:3,type:"u",minver:4,range:"not 0",description:`The period in nanoseconds (not scaled by TimcodeScale)
between two successive fields at the output of the decoding process (see the notes)`},2352003:{name:"DefaultDuration",cppname:"TrackDefaultDuration",level:3,type:"u",minver:1,range:"not 0",description:"Number of nanoseconds (not scaled via TimecodeScale) per frame ('frame' in the Matroska sense -- one element put into a (Simple)Block)."},28152:{name:"MaxCache",cppname:"TrackMaxCache",level:3,type:"u",minver:1,webm:!1,description:"The maximum cache size required to store referenced frames in and the current frame. 0 means no cache is needed."},28135:{name:"MinCache",cppname:"TrackMinCache",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The minimum number of frames a player should be able to cache during playback. If set to 0, the reference pseudo-cache system is not used."},156:{name:"FlagLacing",cppname:"TrackFlagLacing",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if the track may contain blocks using lacing. (1 bit)"},21930:{name:"FlagForced",cppname:"TrackFlagForced",level:3,type:"u",mandatory:!0,minver:1,default:0,range:"0-1",description:"Set if that track MUST be active during playback. There can be many forced track for a kind (audio, video or subs), the player should select the one which language matches the user preference or the default + forced track. Overlay MAY happen between a forced and non-forced track of the same kind. (1 bit)"},185:{name:"FlagEnabled",cppname:"TrackFlagEnabled",level:3,type:"u",mandatory:!0,minver:2,webm:!0,default:1,range:"0-1",description:"Set if the track is usable. (1 bit)"},29637:{name:"TrackUID",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"A unique ID to identify the Track. This should be kept the same when making a direct stream copy of the Track to another file."},215:{name:"TrackNumber",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track number as used in the Block Header (using more than 127 tracks is not encouraged, though the design allows an unlimited number)."},174:{name:"TrackEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Describes a track with all elements."},374648427:{name:"Tracks",level:1,type:"m",multiple:!0,minver:1,description:"A top-level block of information with many tracks described."},175:{name:"EncryptedBlock",level:2,type:"b",multiple:!0,webm:!1,description:"Similar to EncryptedBlock Structure)"},202:{name:"ReferenceTimeCode",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},201:{name:"ReferenceOffset",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},200:{name:"ReferenceFrame",level:3,type:"m",multiple:!1,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},207:{name:"SliceDuration",level:5,type:"u",default:0,description:"The (scaled) duration to apply to the element."},206:{name:"Delay",cppname:"SliceDelay",level:5,type:"u",default:0,description:"The (scaled) delay to apply to the element."},203:{name:"BlockAdditionID",cppname:"SliceBlockAddID",level:5,type:"u",default:0,description:"The ID of the BlockAdditional element (0 is the main Block)."},205:{name:"FrameNumber",cppname:"SliceFrameNumber",level:5,type:"u",default:0,description:"The number of the frame to generate from this lace with this delay (allow you to generate many frames from the same Block/Frame)."},204:{name:"LaceNumber",cppname:"SliceLaceNumber",level:5,type:"u",minver:1,default:0,divx:!1,description:"The reverse number of the frame in the lace (0 is the last frame, 1 is the next to last, etc). While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},232:{name:"TimeSlice",level:4,type:"m",multiple:!0,minver:1,divx:!1,description:"Contains extra time information about the data contained in the Block. While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},142:{name:"Slices",level:3,type:"m",minver:1,divx:!1,description:"Contains slices description."},30114:{name:"DiscardPadding",level:3,type:"i",minver:4,webm:!0,description:"Duration in nanoseconds of the silent data added to the Block (padding at the end of the Block for positive value, at the beginning of the Block for negative value). The duration of DiscardPadding is not calculated in the duration of the TrackEntry and should be discarded during playback."},164:{name:"CodecState",level:3,type:"b",minver:2,webm:!1,description:"The new codec state to use. Data interpretation is private to the codec. This information should always be referenced by a seek entry."},253:{name:"ReferenceVirtual",level:3,type:"i",webm:!1,description:"Relative position of the data that should be in position of the virtual block."},251:{name:"ReferenceBlock",level:3,type:"i",multiple:!0,minver:1,description:"Timestamp of another frame used as a reference (ie: B or P frame). The timestamp is relative to the block it's attached to."},250:{name:"ReferencePriority",cppname:"FlagReferenced",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"This frame is referenced and has the specified cache priority. In cache only a frame of the same or higher priority can replace this frame. A value of 0 means the frame is not referenced."},155:{name:"BlockDuration",level:3,type:"u",minver:1,default:"TrackDuration",description:'The duration of the Block (based on TimecodeScale). This element is mandatory when DefaultDuration is set for the track (but can be omitted as other default values). When not written and with no DefaultDuration, the value is assumed to be the difference between the timestamp of this Block and the timestamp of the next Block in "display" order (not coding order). This element can be useful at the end of a Track (as there is not other Block available), or when there is a break in a track like for subtitle tracks. When set to 0 that means the frame is not a keyframe.'},165:{name:"BlockAdditional",level:5,type:"b",mandatory:!0,minver:1,webm:!1,description:"Interpreted by the codec as it wishes (using the BlockAddID)."},238:{name:"BlockAddID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"An ID to identify the BlockAdditional level."},166:{name:"BlockMore",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contain the BlockAdditional and some parameters."},30113:{name:"BlockAdditions",level:3,type:"m",minver:1,webm:!1,description:"Contain additional blocks to complete the main one. An EBML parser that has no knowledge of the Block structure could still see and use/skip these data."},162:{name:"BlockVirtual",level:3,type:"b",webm:!1,description:"A Block with no data. It must be stored in the stream at the place the real Block should be in display order. (see Block Virtual)"},161:{name:"Block",level:3,type:"b",mandatory:!0,minver:1,description:"Block containing the actual data to be rendered and a timestamp relative to the Cluster Timecode. (see Block Structure)"},160:{name:"BlockGroup",level:2,type:"m",multiple:!0,minver:1,description:"Basic container of information containing a single Block or BlockVirtual, and information specific to that Block/VirtualBlock."},163:{name:"SimpleBlock",level:2,type:"b",multiple:!0,minver:2,webm:!0,divx:!0,description:"Similar to SimpleBlock Structure"},171:{name:"PrevSize",cppname:"ClusterPrevSize",level:2,type:"u",minver:1,description:"Size of the previous Cluster, in octets. Can be useful for backward playing.",position:"prevCluster"},167:{name:"Position",cppname:"ClusterPosition",level:2,type:"u",minver:1,webm:!1,description:"The Position of the Cluster in the segment (0 in live broadcast streams). It might help to resynchronise offset on damaged streams.",position:"segment"},22743:{name:"SilentTrackNumber",cppname:"ClusterSilentTrackNumber",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"One of the track number that are not used from now on in the stream. It could change later if not specified as silent in a further Cluster."},231:{name:"Timecode",cppname:"ClusterTimecode",level:2,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp of the cluster (based on TimecodeScale)."},524531317:{name:"Cluster",level:1,type:"m",multiple:!0,minver:1,description:"The lower level element containing the (monolithic) Block structure."},19840:{name:"MuxingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Muxing application or library ("libmatroska-0.4.3").'},31657:{name:"Title",level:2,type:"8",minver:1,webm:!1,description:"General name of the segment."},2807730:{name:"TimecodeScaleDenominator",level:2,type:"u",mandatory:!0,minver:4,default:"1000000000",description:"Timestamp scale numerator, see TimecodeScale."},2807729:{name:"TimecodeScale",level:2,type:"u",mandatory:!0,minver:1,default:"1000000",description:"Timestamp scale in nanoseconds (1.000.000 means all timestamps in the segment are expressed in milliseconds)."},27045:{name:"ChapterTranslateID",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this segment in the chapter codec data. The format depends on the ChapProcessCodecID used."},27071:{name:"ChapterTranslateCodec",level:3,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},27132:{name:"ChapterTranslateEditionUID",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this correspondance applies. When not specified, it means for all editions found in the segment."},4096955:{name:"NextFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the next segment."},4110627:{name:"NextUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the next chained segment (128 bits)."},3965867:{name:"PrevFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the previous segment."},3979555:{name:"PrevUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the previous chained segment (128 bits)."},29604:{name:"SegmentUID",level:2,type:"b",minver:1,webm:!1,range:"not 0",bytesize:16,description:"A randomly generated unique ID to identify the current segment between many others (128 bits)."},357149030:{name:"Info",level:1,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains miscellaneous general information and statistics on the file."},21420:{name:"SeekPosition",level:3,type:"u",mandatory:!0,minver:1,description:"The position of the element in the segment in octets (0 = first level 1 element).",position:"segment"},21419:{name:"SeekID",level:3,type:"b",mandatory:!0,minver:1,description:"The binary ID corresponding to the element name.",type2:"ebmlID"},19899:{name:"Seek",cppname:"SeekPoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains a single seek entry to an EBML element."},290298740:{name:"SeekHead",cppname:"SeekHeader",level:1,type:"m",multiple:!0,minver:1,description:"Contains the position of other level 1 elements."},32379:{name:"SignatureElementList",level:2,type:"m",multiple:!0,webm:!1,i:"Cluster|Block|BlockAdditional",description:"A list consists of a number of consecutive elements that represent one case where data is used in signature. Ex:  means that the BlockAdditional of all Blocks in all Clusters is used for encryption."},32347:{name:"SignatureElements",level:1,type:"m",webm:!1,description:"Contains elements that will be used to compute the signature."},32437:{name:"Signature",level:1,type:"b",webm:!1,description:"The signature of the data (until a new."},32421:{name:"SignaturePublicKey",level:1,type:"b",webm:!1,description:"The public key to use with the algorithm (in the case of a PKI-based signature)."},32410:{name:"SignatureHash",level:1,type:"u",webm:!1,description:"Hash algorithm used (1=SHA1-160, 2=MD5)."},32394:{name:"SignatureAlgo",level:1,type:"u",webm:!1,description:"Signature algorithm used (1=RSA, 2=elliptic)."},458458727:{name:"SignatureSlot",level:-1,type:"m",multiple:!0,webm:!1,description:"Contain signature of some (coming) elements in the stream."},191:{name:"CRC-32",level:-1,type:"b",minver:1,webm:!1,description:"The CRC is computed on all the data of the Master element it's in. The CRC element should be the first in it's parent master for easier reading. All level 1 elements should include a CRC-32. The CRC in use is the IEEE CRC32 Little Endian",crc:!0},236:{name:"Void",level:-1,type:"b",minver:1,description:"Used to void damaged data, to avoid unexpected behaviors when using damaged data. The content is discarded. Also used to reserve space in a sub-element for later use."},17139:{name:"EBMLMaxSizeLength",level:1,type:"u",mandatory:!0,default:8,minver:1,description:"The maximum length of the sizes you'll find in this file (8 or less in Matroska). This does not override the element size indicated at the beginning of an element. Elements that have an indicated size which is larger than what is allowed by EBMLMaxSizeLength shall be considered invalid."},17138:{name:"EBMLMaxIDLength",level:1,type:"u",mandatory:!0,default:4,minver:1,description:"The maximum length of the IDs you'll find in this file (4 or less in Matroska)."},17143:{name:"EBMLReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum EBML version a parser has to support to read this file."},440786851:{name:"EBML",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"Set the EBML characteristics of the data to follow. Each EBML document has to start with this."},21936:{name:"Colour",level:"4",type:"m",mandatory:!0,multiple:!0,description:"Settings describing the colour format."},21937:{name:"MatrixCoefficients",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The Matrix Coefficients of the video used to derive luma and chroma values from red, green, and blue color primaries. For clarity, the value and meanings for MatrixCoefficients are adopted from Table 4 of ISO/IEC 23001-8:2016 or ITU-T H.273."},21945:{name:"Range",level:"5",type:"u",mandatory:!0,multiple:!0,description:"Clipping of the color ranges."},21946:{name:"TransferCharacteristics",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The transfer characteristics of the video."},21947:{name:"Primaries",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The colour primaries of the video. For clarity, the value and meanings for Primaries are adopted from Table 2 of ISO/IEC 23091-4 or ITU-T H.273."}}),Sr}var uu;function Ud(){if(uu)return Ni;uu=1,Object.defineProperty(Ni,"__esModule",{value:!0});var n=wn(),e=wn(),t=Fd(),r=function(){function i(){this._schema=t.byEbmlID,this._buffers=[],this._stack=[]}return i.prototype.encode=function(s){var a=this;return n.concat(s.reduce(function(l,d){return l.concat(a.encodeChunk(d))},[])).buffer},i.prototype.encodeChunk=function(s){return s.type==="m"?s.isEnd?this.endTag(s):this.startTag(s):(s.data=e.Buffer.from(s.data),this.writeTag(s)),this.flush()},i.prototype.flush=function(){var s=this._buffers;return this._buffers=[],s},i.prototype.getSchemaInfo=function(s){for(var a=Object.keys(this._schema).map(Number),l=0;l<a.length;l++){var d=a[l];if(this._schema[d].name===s)return new e.Buffer(d.toString(16),"hex")}return null},i.prototype.writeTag=function(s){var a=s.name,l=this.getSchemaInfo(a),d=s.data;if(l==null)throw new Error("No schema entry found for "+a);var f=n.encodeTag(l,d);if(this._stack.length>0){var g=this._stack[this._stack.length-1];g.children.push({tagId:l,elm:s,children:[],data:f});return}this._buffers=this._buffers.concat(f)},i.prototype.startTag=function(s){var a=s.name,l=this.getSchemaInfo(a);if(l==null)throw new Error("No schema entry found for "+a);if(s.unknownSize){var d=n.encodeTag(l,new e.Buffer(0),s.unknownSize);this._buffers=this._buffers.concat(d);return}var f={tagId:l,elm:s,children:[],data:null};this._stack.length>0&&this._stack[this._stack.length-1].children.push(f),this._stack.push(f)},i.prototype.endTag=function(s){s.name;var a=this._stack.pop();if(a==null)throw new Error("EBML structure is broken");if(a.elm.name!==s.name)throw new Error("EBML structure is broken");var l=a.children.reduce(function(f,g){if(g.data===null)throw new Error("EBML structure is broken");return f.concat(g.data)},[]),d=n.concat(l);a.elm.type==="m"?a.data=n.encodeTag(a.tagId,d,a.elm.unknownSize):a.data=n.encodeTag(a.tagId,d),this._stack.length<1&&(this._buffers=this._buffers.concat(a.data))},i}();return Ni.default=r,Ni}var yo={},Cr={},hu;function Yv(){if(hu)return Cr;hu=1,Cr.byteLength=l,Cr.toByteArray=f,Cr.fromByteArray=k;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=r.length;i<s;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function a(C){var x=C.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var N=C.indexOf("=");N===-1&&(N=x);var M=N===x?0:4-N%4;return[N,M]}function l(C){var x=a(C),N=x[0],M=x[1];return(N+M)*3/4-M}function d(C,x,N){return(x+N)*3/4-N}function f(C){var x,N=a(C),M=N[0],z=N[1],q=new t(d(C,M,z)),W=0,L=z>0?M-4:M,O;for(O=0;O<L;O+=4)x=e[C.charCodeAt(O)]<<18|e[C.charCodeAt(O+1)]<<12|e[C.charCodeAt(O+2)]<<6|e[C.charCodeAt(O+3)],q[W++]=x>>16&255,q[W++]=x>>8&255,q[W++]=x&255;return z===2&&(x=e[C.charCodeAt(O)]<<2|e[C.charCodeAt(O+1)]>>4,q[W++]=x&255),z===1&&(x=e[C.charCodeAt(O)]<<10|e[C.charCodeAt(O+1)]<<4|e[C.charCodeAt(O+2)]>>2,q[W++]=x>>8&255,q[W++]=x&255),q}function g(C){return n[C>>18&63]+n[C>>12&63]+n[C>>6&63]+n[C&63]}function A(C,x,N){for(var M,z=[],q=x;q<N;q+=3)M=(C[q]<<16&16711680)+(C[q+1]<<8&65280)+(C[q+2]&255),z.push(g(M));return z.join("")}function k(C){for(var x,N=C.length,M=N%3,z=[],q=16383,W=0,L=N-M;W<L;W+=q)z.push(A(C,W,W+q>L?L:W+q));return M===1?(x=C[N-1],z.push(n[x>>2]+n[x<<4&63]+"==")):M===2&&(x=(C[N-2]<<8)+C[N-1],z.push(n[x>>10]+n[x>>4&63]+n[x<<2&63]+"=")),z.join("")}return Cr}var Li={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var du;function Jv(){return du||(du=1,Li.read=function(n,e,t,r,i){var s,a,l=i*8-r-1,d=(1<<l)-1,f=d>>1,g=-7,A=t?i-1:0,k=t?-1:1,C=n[e+A];for(A+=k,s=C&(1<<-g)-1,C>>=-g,g+=l;g>0;s=s*256+n[e+A],A+=k,g-=8);for(a=s&(1<<-g)-1,s>>=-g,g+=r;g>0;a=a*256+n[e+A],A+=k,g-=8);if(s===0)s=1-f;else{if(s===d)return a?NaN:(C?-1:1)*(1/0);a=a+Math.pow(2,r),s=s-f}return(C?-1:1)*a*Math.pow(2,s-r)},Li.write=function(n,e,t,r,i,s){var a,l,d,f=s*8-i-1,g=(1<<f)-1,A=g>>1,k=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=r?0:s-1,x=r?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=g):(a=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-a))<1&&(a--,d*=2),a+A>=1?e+=k/d:e+=k*Math.pow(2,1-A),e*d>=2&&(a++,d/=2),a+A>=g?(l=0,a=g):a+A>=1?(l=(e*d-1)*Math.pow(2,i),a=a+A):(l=e*Math.pow(2,A-1)*Math.pow(2,i),a=0));i>=8;n[t+C]=l&255,C+=x,l/=256,i-=8);for(a=a<<i|l,f+=i;f>0;n[t+C]=a&255,C+=x,a/=256,f-=8);n[t+C-x]|=N*128}),Li}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var fu;function Zv(){return fu||(fu=1,function(n){const e=Yv(),t=Jv(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=l,n.SlowBuffer=q,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i,l.TYPED_ARRAY_SUPPORT=s(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const p=new Uint8Array(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,Uint8Array.prototype),Object.setPrototypeOf(p,u),p.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function a(p){if(p>i)throw new RangeError('The value "'+p+'" is invalid for option "size"');const u=new Uint8Array(p);return Object.setPrototypeOf(u,l.prototype),u}function l(p,u,h){if(typeof p=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return A(p)}return d(p,u,h)}l.poolSize=8192;function d(p,u,h){if(typeof p=="string")return k(p,u);if(ArrayBuffer.isView(p))return x(p);if(p==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p);if(st(p,ArrayBuffer)||p&&st(p.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(st(p,SharedArrayBuffer)||p&&st(p.buffer,SharedArrayBuffer)))return N(p,u,h);if(typeof p=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const I=p.valueOf&&p.valueOf();if(I!=null&&I!==p)return l.from(I,u,h);const R=M(p);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof p[Symbol.toPrimitive]=="function")return l.from(p[Symbol.toPrimitive]("string"),u,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p)}l.from=function(p,u,h){return d(p,u,h)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function f(p){if(typeof p!="number")throw new TypeError('"size" argument must be of type number');if(p<0)throw new RangeError('The value "'+p+'" is invalid for option "size"')}function g(p,u,h){return f(p),p<=0?a(p):u!==void 0?typeof h=="string"?a(p).fill(u,h):a(p).fill(u):a(p)}l.alloc=function(p,u,h){return g(p,u,h)};function A(p){return f(p),a(p<0?0:z(p)|0)}l.allocUnsafe=function(p){return A(p)},l.allocUnsafeSlow=function(p){return A(p)};function k(p,u){if((typeof u!="string"||u==="")&&(u="utf8"),!l.isEncoding(u))throw new TypeError("Unknown encoding: "+u);const h=W(p,u)|0;let I=a(h);const R=I.write(p,u);return R!==h&&(I=I.slice(0,R)),I}function C(p){const u=p.length<0?0:z(p.length)|0,h=a(u);for(let I=0;I<u;I+=1)h[I]=p[I]&255;return h}function x(p){if(st(p,Uint8Array)){const u=new Uint8Array(p);return N(u.buffer,u.byteOffset,u.byteLength)}return C(p)}function N(p,u,h){if(u<0||p.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(p.byteLength<u+(h||0))throw new RangeError('"length" is outside of buffer bounds');let I;return u===void 0&&h===void 0?I=new Uint8Array(p):h===void 0?I=new Uint8Array(p,u):I=new Uint8Array(p,u,h),Object.setPrototypeOf(I,l.prototype),I}function M(p){if(l.isBuffer(p)){const u=z(p.length)|0,h=a(u);return h.length===0||p.copy(h,0,0,u),h}if(p.length!==void 0)return typeof p.length!="number"||sn(p.length)?a(0):C(p);if(p.type==="Buffer"&&Array.isArray(p.data))return C(p.data)}function z(p){if(p>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return p|0}function q(p){return+p!=p&&(p=0),l.alloc(+p)}l.isBuffer=function(u){return u!=null&&u._isBuffer===!0&&u!==l.prototype},l.compare=function(u,h){if(st(u,Uint8Array)&&(u=l.from(u,u.offset,u.byteLength)),st(h,Uint8Array)&&(h=l.from(h,h.offset,h.byteLength)),!l.isBuffer(u)||!l.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(u===h)return 0;let I=u.length,R=h.length;for(let V=0,F=Math.min(I,R);V<F;++V)if(u[V]!==h[V]){I=u[V],R=h[V];break}return I<R?-1:R<I?1:0},l.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(u,h){if(!Array.isArray(u))throw new TypeError('"list" argument must be an Array of Buffers');if(u.length===0)return l.alloc(0);let I;if(h===void 0)for(h=0,I=0;I<u.length;++I)h+=u[I].length;const R=l.allocUnsafe(h);let V=0;for(I=0;I<u.length;++I){let F=u[I];if(st(F,Uint8Array))V+F.length>R.length?(l.isBuffer(F)||(F=l.from(F)),F.copy(R,V)):Uint8Array.prototype.set.call(R,F,V);else if(l.isBuffer(F))F.copy(R,V);else throw new TypeError('"list" argument must be an Array of Buffers');V+=F.length}return R};function W(p,u){if(l.isBuffer(p))return p.length;if(ArrayBuffer.isView(p)||st(p,ArrayBuffer))return p.byteLength;if(typeof p!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof p);const h=p.length,I=arguments.length>2&&arguments[2]===!0;if(!I&&h===0)return 0;let R=!1;for(;;)switch(u){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return ht(p).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return gt(p).length;default:if(R)return I?-1:ht(p).length;u=(""+u).toLowerCase(),R=!0}}l.byteLength=W;function L(p,u,h){let I=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,u>>>=0,h<=u))return"";for(p||(p="utf8");;)switch(p){case"hex":return He(this,u,h);case"utf8":case"utf-8":return Y(this,u,h);case"ascii":return Ee(this,u,h);case"latin1":case"binary":return Ae(this,u,h);case"base64":return b(this,u,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ct(this,u,h);default:if(I)throw new TypeError("Unknown encoding: "+p);p=(p+"").toLowerCase(),I=!0}}l.prototype._isBuffer=!0;function O(p,u,h){const I=p[u];p[u]=p[h],p[h]=I}l.prototype.swap16=function(){const u=this.length;if(u%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<u;h+=2)O(this,h,h+1);return this},l.prototype.swap32=function(){const u=this.length;if(u%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<u;h+=4)O(this,h,h+3),O(this,h+1,h+2);return this},l.prototype.swap64=function(){const u=this.length;if(u%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<u;h+=8)O(this,h,h+7),O(this,h+1,h+6),O(this,h+2,h+5),O(this,h+3,h+4);return this},l.prototype.toString=function(){const u=this.length;return u===0?"":arguments.length===0?Y(this,0,u):L.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(u){if(!l.isBuffer(u))throw new TypeError("Argument must be a Buffer");return this===u?!0:l.compare(this,u)===0},l.prototype.inspect=function(){let u="";const h=n.INSPECT_MAX_BYTES;return u=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(u+=" ... "),"<Buffer "+u+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(u,h,I,R,V){if(st(u,Uint8Array)&&(u=l.from(u,u.offset,u.byteLength)),!l.isBuffer(u))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof u);if(h===void 0&&(h=0),I===void 0&&(I=u?u.length:0),R===void 0&&(R=0),V===void 0&&(V=this.length),h<0||I>u.length||R<0||V>this.length)throw new RangeError("out of range index");if(R>=V&&h>=I)return 0;if(R>=V)return-1;if(h>=I)return 1;if(h>>>=0,I>>>=0,R>>>=0,V>>>=0,this===u)return 0;let F=V-R,ie=I-h;const ye=Math.min(F,ie),ve=this.slice(R,V),Se=u.slice(h,I);for(let fe=0;fe<ye;++fe)if(ve[fe]!==Se[fe]){F=ve[fe],ie=Se[fe];break}return F<ie?-1:ie<F?1:0};function P(p,u,h,I,R){if(p.length===0)return-1;if(typeof h=="string"?(I=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,sn(h)&&(h=R?0:p.length-1),h<0&&(h=p.length+h),h>=p.length){if(R)return-1;h=p.length-1}else if(h<0)if(R)h=0;else return-1;if(typeof u=="string"&&(u=l.from(u,I)),l.isBuffer(u))return u.length===0?-1:E(p,u,h,I,R);if(typeof u=="number")return u=u&255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(p,u,h):Uint8Array.prototype.lastIndexOf.call(p,u,h):E(p,[u],h,I,R);throw new TypeError("val must be string, number or Buffer")}function E(p,u,h,I,R){let V=1,F=p.length,ie=u.length;if(I!==void 0&&(I=String(I).toLowerCase(),I==="ucs2"||I==="ucs-2"||I==="utf16le"||I==="utf-16le")){if(p.length<2||u.length<2)return-1;V=2,F/=2,ie/=2,h/=2}function ye(Se,fe){return V===1?Se[fe]:Se.readUInt16BE(fe*V)}let ve;if(R){let Se=-1;for(ve=h;ve<F;ve++)if(ye(p,ve)===ye(u,Se===-1?0:ve-Se)){if(Se===-1&&(Se=ve),ve-Se+1===ie)return Se*V}else Se!==-1&&(ve-=ve-Se),Se=-1}else for(h+ie>F&&(h=F-ie),ve=h;ve>=0;ve--){let Se=!0;for(let fe=0;fe<ie;fe++)if(ye(p,ve+fe)!==ye(u,fe)){Se=!1;break}if(Se)return ve}return-1}l.prototype.includes=function(u,h,I){return this.indexOf(u,h,I)!==-1},l.prototype.indexOf=function(u,h,I){return P(this,u,h,I,!0)},l.prototype.lastIndexOf=function(u,h,I){return P(this,u,h,I,!1)};function y(p,u,h,I){h=Number(h)||0;const R=p.length-h;I?(I=Number(I),I>R&&(I=R)):I=R;const V=u.length;I>V/2&&(I=V/2);let F;for(F=0;F<I;++F){const ie=parseInt(u.substr(F*2,2),16);if(sn(ie))return F;p[h+F]=ie}return F}function T(p,u,h,I){return St(ht(u,p.length-h),p,h,I)}function v(p,u,h,I){return St(pt(u),p,h,I)}function w(p,u,h,I){return St(gt(u),p,h,I)}function S(p,u,h,I){return St(kn(u,p.length-h),p,h,I)}l.prototype.write=function(u,h,I,R){if(h===void 0)R="utf8",I=this.length,h=0;else if(I===void 0&&typeof h=="string")R=h,I=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(I)?(I=I>>>0,R===void 0&&(R="utf8")):(R=I,I=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const V=this.length-h;if((I===void 0||I>V)&&(I=V),u.length>0&&(I<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");R||(R="utf8");let F=!1;for(;;)switch(R){case"hex":return y(this,u,h,I);case"utf8":case"utf-8":return T(this,u,h,I);case"ascii":case"latin1":case"binary":return v(this,u,h,I);case"base64":return w(this,u,h,I);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,u,h,I);default:if(F)throw new TypeError("Unknown encoding: "+R);R=(""+R).toLowerCase(),F=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function b(p,u,h){return u===0&&h===p.length?e.fromByteArray(p):e.fromByteArray(p.slice(u,h))}function Y(p,u,h){h=Math.min(p.length,h);const I=[];let R=u;for(;R<h;){const V=p[R];let F=null,ie=V>239?4:V>223?3:V>191?2:1;if(R+ie<=h){let ye,ve,Se,fe;switch(ie){case 1:V<128&&(F=V);break;case 2:ye=p[R+1],(ye&192)===128&&(fe=(V&31)<<6|ye&63,fe>127&&(F=fe));break;case 3:ye=p[R+1],ve=p[R+2],(ye&192)===128&&(ve&192)===128&&(fe=(V&15)<<12|(ye&63)<<6|ve&63,fe>2047&&(fe<55296||fe>57343)&&(F=fe));break;case 4:ye=p[R+1],ve=p[R+2],Se=p[R+3],(ye&192)===128&&(ve&192)===128&&(Se&192)===128&&(fe=(V&15)<<18|(ye&63)<<12|(ve&63)<<6|Se&63,fe>65535&&fe<1114112&&(F=fe))}}F===null?(F=65533,ie=1):F>65535&&(F-=65536,I.push(F>>>10&1023|55296),F=56320|F&1023),I.push(F),R+=ie}return be(I)}const ae=4096;function be(p){const u=p.length;if(u<=ae)return String.fromCharCode.apply(String,p);let h="",I=0;for(;I<u;)h+=String.fromCharCode.apply(String,p.slice(I,I+=ae));return h}function Ee(p,u,h){let I="";h=Math.min(p.length,h);for(let R=u;R<h;++R)I+=String.fromCharCode(p[R]&127);return I}function Ae(p,u,h){let I="";h=Math.min(p.length,h);for(let R=u;R<h;++R)I+=String.fromCharCode(p[R]);return I}function He(p,u,h){const I=p.length;(!u||u<0)&&(u=0),(!h||h<0||h>I)&&(h=I);let R="";for(let V=u;V<h;++V)R+=fr[p[V]];return R}function ct(p,u,h){const I=p.slice(u,h);let R="";for(let V=0;V<I.length-1;V+=2)R+=String.fromCharCode(I[V]+I[V+1]*256);return R}l.prototype.slice=function(u,h){const I=this.length;u=~~u,h=h===void 0?I:~~h,u<0?(u+=I,u<0&&(u=0)):u>I&&(u=I),h<0?(h+=I,h<0&&(h=0)):h>I&&(h=I),h<u&&(h=u);const R=this.subarray(u,h);return Object.setPrototypeOf(R,l.prototype),R};function ue(p,u,h){if(p%1!==0||p<0)throw new RangeError("offset is not uint");if(p+u>h)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(u,h,I){u=u>>>0,h=h>>>0,I||ue(u,h,this.length);let R=this[u],V=1,F=0;for(;++F<h&&(V*=256);)R+=this[u+F]*V;return R},l.prototype.readUintBE=l.prototype.readUIntBE=function(u,h,I){u=u>>>0,h=h>>>0,I||ue(u,h,this.length);let R=this[u+--h],V=1;for(;h>0&&(V*=256);)R+=this[u+--h]*V;return R},l.prototype.readUint8=l.prototype.readUInt8=function(u,h){return u=u>>>0,h||ue(u,1,this.length),this[u]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(u,h){return u=u>>>0,h||ue(u,2,this.length),this[u]|this[u+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(u,h){return u=u>>>0,h||ue(u,2,this.length),this[u]<<8|this[u+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),(this[u]|this[u+1]<<8|this[u+2]<<16)+this[u+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]*16777216+(this[u+1]<<16|this[u+2]<<8|this[u+3])},l.prototype.readBigUInt64LE=dt(function(u){u=u>>>0,de(u,"offset");const h=this[u],I=this[u+7];(h===void 0||I===void 0)&&Re(u,this.length-8);const R=h+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24,V=this[++u]+this[++u]*2**8+this[++u]*2**16+I*2**24;return BigInt(R)+(BigInt(V)<<BigInt(32))}),l.prototype.readBigUInt64BE=dt(function(u){u=u>>>0,de(u,"offset");const h=this[u],I=this[u+7];(h===void 0||I===void 0)&&Re(u,this.length-8);const R=h*2**24+this[++u]*2**16+this[++u]*2**8+this[++u],V=this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+I;return(BigInt(R)<<BigInt(32))+BigInt(V)}),l.prototype.readIntLE=function(u,h,I){u=u>>>0,h=h>>>0,I||ue(u,h,this.length);let R=this[u],V=1,F=0;for(;++F<h&&(V*=256);)R+=this[u+F]*V;return V*=128,R>=V&&(R-=Math.pow(2,8*h)),R},l.prototype.readIntBE=function(u,h,I){u=u>>>0,h=h>>>0,I||ue(u,h,this.length);let R=h,V=1,F=this[u+--R];for(;R>0&&(V*=256);)F+=this[u+--R]*V;return V*=128,F>=V&&(F-=Math.pow(2,8*h)),F},l.prototype.readInt8=function(u,h){return u=u>>>0,h||ue(u,1,this.length),this[u]&128?(255-this[u]+1)*-1:this[u]},l.prototype.readInt16LE=function(u,h){u=u>>>0,h||ue(u,2,this.length);const I=this[u]|this[u+1]<<8;return I&32768?I|4294901760:I},l.prototype.readInt16BE=function(u,h){u=u>>>0,h||ue(u,2,this.length);const I=this[u+1]|this[u]<<8;return I&32768?I|4294901760:I},l.prototype.readInt32LE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]|this[u+1]<<8|this[u+2]<<16|this[u+3]<<24},l.prototype.readInt32BE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]<<24|this[u+1]<<16|this[u+2]<<8|this[u+3]},l.prototype.readBigInt64LE=dt(function(u){u=u>>>0,de(u,"offset");const h=this[u],I=this[u+7];(h===void 0||I===void 0)&&Re(u,this.length-8);const R=this[u+4]+this[u+5]*2**8+this[u+6]*2**16+(I<<24);return(BigInt(R)<<BigInt(32))+BigInt(h+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24)}),l.prototype.readBigInt64BE=dt(function(u){u=u>>>0,de(u,"offset");const h=this[u],I=this[u+7];(h===void 0||I===void 0)&&Re(u,this.length-8);const R=(h<<24)+this[++u]*2**16+this[++u]*2**8+this[++u];return(BigInt(R)<<BigInt(32))+BigInt(this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+I)}),l.prototype.readFloatLE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),t.read(this,u,!0,23,4)},l.prototype.readFloatBE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),t.read(this,u,!1,23,4)},l.prototype.readDoubleLE=function(u,h){return u=u>>>0,h||ue(u,8,this.length),t.read(this,u,!0,52,8)},l.prototype.readDoubleBE=function(u,h){return u=u>>>0,h||ue(u,8,this.length),t.read(this,u,!1,52,8)};function Z(p,u,h,I,R,V){if(!l.isBuffer(p))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>R||u<V)throw new RangeError('"value" argument is out of bounds');if(h+I>p.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(u,h,I,R){if(u=+u,h=h>>>0,I=I>>>0,!R){const ie=Math.pow(2,8*I)-1;Z(this,u,h,I,ie,0)}let V=1,F=0;for(this[h]=u&255;++F<I&&(V*=256);)this[h+F]=u/V&255;return h+I},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(u,h,I,R){if(u=+u,h=h>>>0,I=I>>>0,!R){const ie=Math.pow(2,8*I)-1;Z(this,u,h,I,ie,0)}let V=I-1,F=1;for(this[h+V]=u&255;--V>=0&&(F*=256);)this[h+V]=u/F&255;return h+I},l.prototype.writeUint8=l.prototype.writeUInt8=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,1,255,0),this[h]=u&255,h+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,2,65535,0),this[h]=u&255,this[h+1]=u>>>8,h+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,2,65535,0),this[h]=u>>>8,this[h+1]=u&255,h+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,4,4294967295,0),this[h+3]=u>>>24,this[h+2]=u>>>16,this[h+1]=u>>>8,this[h]=u&255,h+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,4,4294967295,0),this[h]=u>>>24,this[h+1]=u>>>16,this[h+2]=u>>>8,this[h+3]=u&255,h+4};function ge(p,u,h,I,R){re(u,I,R,p,h,7);let V=Number(u&BigInt(4294967295));p[h++]=V,V=V>>8,p[h++]=V,V=V>>8,p[h++]=V,V=V>>8,p[h++]=V;let F=Number(u>>BigInt(32)&BigInt(4294967295));return p[h++]=F,F=F>>8,p[h++]=F,F=F>>8,p[h++]=F,F=F>>8,p[h++]=F,h}function Ce(p,u,h,I,R){re(u,I,R,p,h,7);let V=Number(u&BigInt(4294967295));p[h+7]=V,V=V>>8,p[h+6]=V,V=V>>8,p[h+5]=V,V=V>>8,p[h+4]=V;let F=Number(u>>BigInt(32)&BigInt(4294967295));return p[h+3]=F,F=F>>8,p[h+2]=F,F=F>>8,p[h+1]=F,F=F>>8,p[h]=F,h+8}l.prototype.writeBigUInt64LE=dt(function(u,h=0){return ge(this,u,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=dt(function(u,h=0){return Ce(this,u,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(u,h,I,R){if(u=+u,h=h>>>0,!R){const ye=Math.pow(2,8*I-1);Z(this,u,h,I,ye-1,-ye)}let V=0,F=1,ie=0;for(this[h]=u&255;++V<I&&(F*=256);)u<0&&ie===0&&this[h+V-1]!==0&&(ie=1),this[h+V]=(u/F>>0)-ie&255;return h+I},l.prototype.writeIntBE=function(u,h,I,R){if(u=+u,h=h>>>0,!R){const ye=Math.pow(2,8*I-1);Z(this,u,h,I,ye-1,-ye)}let V=I-1,F=1,ie=0;for(this[h+V]=u&255;--V>=0&&(F*=256);)u<0&&ie===0&&this[h+V+1]!==0&&(ie=1),this[h+V]=(u/F>>0)-ie&255;return h+I},l.prototype.writeInt8=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,1,127,-128),u<0&&(u=255+u+1),this[h]=u&255,h+1},l.prototype.writeInt16LE=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,2,32767,-32768),this[h]=u&255,this[h+1]=u>>>8,h+2},l.prototype.writeInt16BE=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,2,32767,-32768),this[h]=u>>>8,this[h+1]=u&255,h+2},l.prototype.writeInt32LE=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,4,2147483647,-2147483648),this[h]=u&255,this[h+1]=u>>>8,this[h+2]=u>>>16,this[h+3]=u>>>24,h+4},l.prototype.writeInt32BE=function(u,h,I){return u=+u,h=h>>>0,I||Z(this,u,h,4,2147483647,-2147483648),u<0&&(u=4294967295+u+1),this[h]=u>>>24,this[h+1]=u>>>16,this[h+2]=u>>>8,this[h+3]=u&255,h+4},l.prototype.writeBigInt64LE=dt(function(u,h=0){return ge(this,u,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=dt(function(u,h=0){return Ce(this,u,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Me(p,u,h,I,R,V){if(h+I>p.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function ut(p,u,h,I,R){return u=+u,h=h>>>0,R||Me(p,u,h,4),t.write(p,u,h,I,23,4),h+4}l.prototype.writeFloatLE=function(u,h,I){return ut(this,u,h,!0,I)},l.prototype.writeFloatBE=function(u,h,I){return ut(this,u,h,!1,I)};function Xe(p,u,h,I,R){return u=+u,h=h>>>0,R||Me(p,u,h,8),t.write(p,u,h,I,52,8),h+8}l.prototype.writeDoubleLE=function(u,h,I){return Xe(this,u,h,!0,I)},l.prototype.writeDoubleBE=function(u,h,I){return Xe(this,u,h,!1,I)},l.prototype.copy=function(u,h,I,R){if(!l.isBuffer(u))throw new TypeError("argument should be a Buffer");if(I||(I=0),!R&&R!==0&&(R=this.length),h>=u.length&&(h=u.length),h||(h=0),R>0&&R<I&&(R=I),R===I||u.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(I<0||I>=this.length)throw new RangeError("Index out of range");if(R<0)throw new RangeError("sourceEnd out of bounds");R>this.length&&(R=this.length),u.length-h<R-I&&(R=u.length-h+I);const V=R-I;return this===u&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,I,R):Uint8Array.prototype.set.call(u,this.subarray(I,R),h),V},l.prototype.fill=function(u,h,I,R){if(typeof u=="string"){if(typeof h=="string"?(R=h,h=0,I=this.length):typeof I=="string"&&(R=I,I=this.length),R!==void 0&&typeof R!="string")throw new TypeError("encoding must be a string");if(typeof R=="string"&&!l.isEncoding(R))throw new TypeError("Unknown encoding: "+R);if(u.length===1){const F=u.charCodeAt(0);(R==="utf8"&&F<128||R==="latin1")&&(u=F)}}else typeof u=="number"?u=u&255:typeof u=="boolean"&&(u=Number(u));if(h<0||this.length<h||this.length<I)throw new RangeError("Out of range index");if(I<=h)return this;h=h>>>0,I=I===void 0?this.length:I>>>0,u||(u=0);let V;if(typeof u=="number")for(V=h;V<I;++V)this[V]=u;else{const F=l.isBuffer(u)?u:l.from(u,R),ie=F.length;if(ie===0)throw new TypeError('The value "'+u+'" is invalid for argument "value"');for(V=0;V<I-h;++V)this[V+h]=F[V%ie]}return this};const Oe={};function te(p,u,h){Oe[p]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:u.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${p}]`,this.stack,delete this.name}get code(){return p}set code(R){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:R,writable:!0})}toString(){return`${this.name} [${p}]: ${this.message}`}}}te("ERR_BUFFER_OUT_OF_BOUNDS",function(p){return p?`${p} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),te("ERR_INVALID_ARG_TYPE",function(p,u){return`The "${p}" argument must be of type number. Received type ${typeof u}`},TypeError),te("ERR_OUT_OF_RANGE",function(p,u,h){let I=`The value of "${p}" is out of range.`,R=h;return Number.isInteger(h)&&Math.abs(h)>2**32?R=Q(String(h)):typeof h=="bigint"&&(R=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(R=Q(R)),R+="n"),I+=` It must be ${u}. Received ${R}`,I},RangeError);function Q(p){let u="",h=p.length;const I=p[0]==="-"?1:0;for(;h>=I+4;h-=3)u=`_${p.slice(h-3,h)}${u}`;return`${p.slice(0,h)}${u}`}function J(p,u,h){de(u,"offset"),(p[u]===void 0||p[u+h]===void 0)&&Re(u,p.length-(h+1))}function re(p,u,h,I,R,V){if(p>h||p<u){const F=typeof u=="bigint"?"n":"";let ie;throw u===0||u===BigInt(0)?ie=`>= 0${F} and < 2${F} ** ${(V+1)*8}${F}`:ie=`>= -(2${F} ** ${(V+1)*8-1}${F}) and < 2 ** ${(V+1)*8-1}${F}`,new Oe.ERR_OUT_OF_RANGE("value",ie,p)}J(I,R,V)}function de(p,u){if(typeof p!="number")throw new Oe.ERR_INVALID_ARG_TYPE(u,"number",p)}function Re(p,u,h){throw Math.floor(p)!==p?(de(p,h),new Oe.ERR_OUT_OF_RANGE("offset","an integer",p)):u<0?new Oe.ERR_BUFFER_OUT_OF_BOUNDS:new Oe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${u}`,p)}const je=/[^+/0-9A-Za-z-_]/g;function $e(p){if(p=p.split("=")[0],p=p.trim().replace(je,""),p.length<2)return"";for(;p.length%4!==0;)p=p+"=";return p}function ht(p,u){u=u||1/0;let h;const I=p.length;let R=null;const V=[];for(let F=0;F<I;++F){if(h=p.charCodeAt(F),h>55295&&h<57344){if(!R){if(h>56319){(u-=3)>-1&&V.push(239,191,189);continue}else if(F+1===I){(u-=3)>-1&&V.push(239,191,189);continue}R=h;continue}if(h<56320){(u-=3)>-1&&V.push(239,191,189),R=h;continue}h=(R-55296<<10|h-56320)+65536}else R&&(u-=3)>-1&&V.push(239,191,189);if(R=null,h<128){if((u-=1)<0)break;V.push(h)}else if(h<2048){if((u-=2)<0)break;V.push(h>>6|192,h&63|128)}else if(h<65536){if((u-=3)<0)break;V.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((u-=4)<0)break;V.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return V}function pt(p){const u=[];for(let h=0;h<p.length;++h)u.push(p.charCodeAt(h)&255);return u}function kn(p,u){let h,I,R;const V=[];for(let F=0;F<p.length&&!((u-=2)<0);++F)h=p.charCodeAt(F),I=h>>8,R=h%256,V.push(R),V.push(I);return V}function gt(p){return e.toByteArray($e(p))}function St(p,u,h,I){let R;for(R=0;R<I&&!(R+h>=u.length||R>=p.length);++R)u[R+h]=p[R];return R}function st(p,u){return p instanceof u||p!=null&&p.constructor!=null&&p.constructor.name!=null&&p.constructor.name===u.name}function sn(p){return p!==p}const fr=function(){const p="0123456789abcdef",u=new Array(256);for(let h=0;h<16;++h){const I=h*16;for(let R=0;R<16;++R)u[I+R]=p[h]+p[R]}return u}();function dt(p){return typeof BigInt>"u"?ze:p}function ze(){throw new Error("BigInt not supported")}}(yo)),yo}var Ft={},mu;function e_(){if(mu)return Ft;mu=1;var n=Ft&&Ft.__assign||function(){return n=Object.assign||function(i){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(i[d]=s[d])}return i},n.apply(this,arguments)},e=Ft&&Ft.__spreadArray||function(i,s,a){if(a||arguments.length===2)for(var l=0,d=s.length,f;l<d;l++)(f||!(l in s))&&(f||(f=Array.prototype.slice.call(s,0,l)),f[l]=s[l]);return i.concat(f||Array.prototype.slice.call(s))};Object.defineProperty(Ft,"__esModule",{value:!0});var t=wn(),r=function(){function i(){}return i.readVint=function(s,a){a===void 0&&(a=0);var l=8-Math.floor(Math.log2(s[a]));if(l>8){var d=i.readHexString(s,a,a+l);throw new Error("Unrepresentable length: ".concat(l," ").concat(d))}if(a+l>s.length)return null;for(var f=s[a]&(1<<8-l)-1,g=1;g<l;g+=1){if(g===7&&f>=Math.pow(2,8)&&s[a+7]>0)return{length:l,value:-1};f*=Math.pow(2,8),f+=s[a+g]}return{length:l,value:f}},i.writeVint=function(s){if(s<0||s>Math.pow(2,53))throw new Error("Unrepresentable value: ".concat(s));var a=1;for(a=1;a<=8&&!(s<Math.pow(2,7*a)-1);a+=1);for(var l=t.Buffer.alloc(a),d=s,f=1;f<=a;f+=1){var g=d&255;l[a-f]=g,d-=g,d/=Math.pow(2,8)}return l[0]|=1<<8-a,l},i.concatenate=function(s,a){return!s&&!a?t.Buffer.from([]):!s||s.byteLength===0?a:!a||a.byteLength===0?s:t.Buffer.from(e(e([],s,!0),a,!0))},i.readHexString=function(s,a,l){return a===void 0&&(a=0),l===void 0&&(l=s.byteLength),Array.from(s.slice(a,l)).map(function(d){return Number(d).toString(16)}).reduce(function(d,f){return"".concat(d).concat(f.padStart(2,"0"))},"")},i.readUtf8=function(s){try{return t.Buffer.from(s).toString("utf8")}catch{return null}},i.readUnsigned=function(s){var a=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(s.byteLength){case 1:return a.getUint8(0);case 2:return a.getUint16(0);case 4:return a.getUint32(0)}return s.byteLength<=6?s.reduce(function(l,d){return l*256+d},0):i.readHexString(s,0,s.byteLength)},i.readSigned=function(s){var a=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(s.byteLength){case 1:return a.getInt8(0);case 2:return a.getInt16(0);case 4:return a.getInt32(0);default:return NaN}},i.readFloat=function(s){var a=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(s.byteLength){case 4:return a.getFloat32(0);case 8:return a.getFloat64(0);default:return NaN}},i.readDate=function(s){var a=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(s.byteLength){case 1:return new Date(a.getUint8(0));case 2:return new Date(a.getUint16(0));case 4:return new Date(a.getUint32(0));case 8:return new Date(Number.parseInt(i.readHexString(s),16));default:return new Date(0)}},i.readDataFromTag=function(s,a){var l=s.type,d=s.name,f=s.track,g=s.discardable||!1,A=s.keyframe||!1,k=null,C;switch(l){case"u":C=i.readUnsigned(a);break;case"f":C=i.readFloat(a);break;case"i":C=i.readSigned(a);break;case"s":C=String.fromCharCode.apply(String,a);break;case"8":C=i.readUtf8(a);break;case"d":C=i.readDate(a);break}if(d==="SimpleBlock"||d==="Block"){var x=0,N=i.readVint(a,x),M=N.length,z=N.value;x+=M,f=z,C=i.readSigned(a.subarray(x,x+2)),x+=2,d==="SimpleBlock"&&(A=!!(a[M+2]&128),g=!!(a[M+2]&1)),x+=1,k=a.subarray(x)}return n(n({},s),{data:a,discardable:g,keyframe:A,payload:k,track:f,value:C})},i}();return Ft.default=r,Ft}var vo,pu;function t_(){return pu||(pu=1,vo=function(n,e,t){e=e||0;for(var r=1;r<=8&&!(n[e]>=Math.pow(2,8-r));r++);if(r>8)throw new Error("Unrepresentable length: "+r+" "+n.toString("hex",e,e+r));if(e+r>n.length)return null;var i,s=n[e]&(1<<8-r)-1;for(i=1;i<r;i++){if(i===7&&s>=Math.pow(2,45)&&n[e+7]>0)return{length:r,value:-1};s*=Math.pow(2,8),s+=n[e+i]}return t&&(s-=Math.pow(2,r*7-1)-1),{length:r,value:s}}),vo}var _o,gu;function n_(){if(gu)return _o;gu=1;var n=t_();function e(t){this.buffer=t,this.offset=0}return e.prototype.nextInt16BE=function(){var t=this.buffer.readInt16BE(this.offset);return this.offset+=2,t},e.prototype.nextUInt8=function(){var t=this.buffer.readUInt8(this.offset);return this.offset+=1,t},e.prototype.nextUIntV=function(){var t=n(this.buffer,this.offset);return this.offset+=t.length,t.value},e.prototype.nextIntV=function(){var t=n(this.buffer,this.offset,!0);return this.offset+=t.length,t.value},e.prototype.nextBuffer=function(t){var r=t?this.buffer.slice(this.offset,this.offset+t):this.buffer.slice(this.offset);return this.offset+=t||this.length,r},Object.defineProperty(e.prototype,"length",{get:function(){return this.buffer.length-this.offset}}),_o=e,_o}var Eo,yu;function r_(){if(yu)return Eo;yu=1;var n=n_(),e=1,t=3,r=2;Eo=function(s){var a={},l=new n(s);a.trackNumber=l.nextUIntV(),a.timecode=l.nextInt16BE();var d=l.nextUInt8();a.invisible=!!(d&8),a.keyframe=!!(d&128),a.discardable=!!(d&1);var f=(d&6)>>1;return a.frames=i(l,f),a};function i(s,a){if(!a)return[s.nextBuffer()];var l,d,f=[],g=s.nextUInt8()+1;if(a===r){if(s.length%g!==0)throw new Error("Fixed-Size Lacing Error");for(d=s.length/g,l=0;l<g;l++)f.push(s.nextBuffer(d));return f}var A=[];if(a===e)for(l=0;l<g-1;l++){var k;d=0;do k=s.nextUInt8(),d+=k;while(k===255);A.push(d)}else if(a===t)for(d=s.nextUIntV(),A.push(d),l=1;l<g-1;l++)d+=s.nextIntV(),A.push(d);for(l=0;l<g-1;l++)f.push(s.nextBuffer(A[l]));return f.push(s.nextBuffer()),f}return Eo}var vu;function wn(){return vu||(vu=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertEBMLDateToJSDate=n.createFloatBuffer=n.createIntBuffer=n.createUIntBuffer=n.encodeValueToBuffer=n.concat=n.putRefinedMetaData=n.extractElement=n.removeElement=n.makeMetadataSeekable=n.createRIFFChunk=n.VP8BitStreamToRiffWebPBuffer=n.WebPBlockFilter=n.encodeTag=n.readBlock=n.ebmlBlock=n.writeVint=n.readVint=n.Buffer=void 0;var e=Od(),t=Ud(),r=Zv(),i=e_(),s=r_();n.Buffer=r.Buffer,n.readVint=i.default.readVint,n.writeVint=i.default.writeVint,n.ebmlBlock=s;function a(v){return(0,n.ebmlBlock)(new n.Buffer(v))}n.readBlock=a;function l(v,w,S){return S===void 0&&(S=!1),L([v,S?new n.Buffer("01ffffffffffffff","hex"):(0,n.writeVint)(w.length),w])}n.encodeTag=l;function d(v){return v.reduce(function(w,S){if(S.type!=="b"||S.name!=="SimpleBlock")return w;var b=(0,n.ebmlBlock)(S.data),Y=b.frames.some(function(ae){var be=ae.slice(3,6).toString("hex");return be==="9d012a"});return Y?w.concat(S):w},[])}n.WebPBlockFilter=d;function f(v){var w=g("VP8 ",v),S=L([new n.Buffer("WEBP","ascii"),w]);return g("RIFF",S)}n.VP8BitStreamToRiffWebPBuffer=f;function g(v,w){var S=new n.Buffer(4);return S.writeUInt32LE(w.byteLength,0),L([new n.Buffer(v.substr(0,4),"ascii"),S,w,new n.Buffer(w.byteLength%2===0?0:1)])}n.createRIFFChunk=g;function A(v,w,S){var b=C("EBML",v),Y=N(b),ae=Y+12,be=v[v.length-1].dataEnd-ae,Ee=C("Info",v);k("Duration",Ee),Ee.splice(1,0,{name:"Duration",type:"f",data:y(w,8)});for(var Ae=N(Ee),He=C("Tracks",v),ct=N(He),ue=47,Z=[],ge=5+S.length*15,Ce=[],Me=-1,ut=10,Xe=function(re){var de=ue,Re=de+Ae,je=Re+ct,$e=je+ge,ht=$e-be;if(Z=[],Z.push({name:"SeekHead",type:"m",isEnd:!1}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([21,73,169,102])}),Z.push({name:"SeekPosition",type:"u",data:P(de)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([22,84,174,107])}),Z.push({name:"SeekPosition",type:"u",data:P(Re)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([28,83,187,107])}),Z.push({name:"SeekPosition",type:"u",data:P(je)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"SeekHead",type:"m",isEnd:!0}),ue=N(Z),Ce=[],Ce.push({name:"Cues",type:"m",isEnd:!1}),S.forEach(function(pt){var kn=pt.CueTrack,gt=pt.CueClusterPosition,St=pt.CueTime;Ce.push({name:"CuePoint",type:"m",isEnd:!1}),Ce.push({name:"CueTime",type:"u",data:P(St)}),Ce.push({name:"CueTrackPositions",type:"m",isEnd:!1}),Ce.push({name:"CueTrack",type:"u",data:P(kn)}),gt-=ae,gt+=ht,Ce.push({name:"CueClusterPosition",type:"u",data:P(gt)}),Ce.push({name:"CueTrackPositions",type:"m",isEnd:!0}),Ce.push({name:"CuePoint",type:"m",isEnd:!0})}),Ce.push({name:"Cues",type:"m",isEnd:!0}),ge=N(Ce),Me!==ht){if(Me=ht,re===ut-1)throw new Error("Failed to converge to a stable metadata size")}else return"break"},Oe=0;Oe<ut;Oe++){var te=Xe(Oe);if(te==="break")break}var Q=[].concat.apply([],[b,{name:"Segment",type:"m",isEnd:!1,unknownSize:!0},Z,Ee,He,Ce]),J=new t.default().encode(Q);return J}n.makeMetadataSeekable=A;function k(v,w){for(var S=-1,b=0;b<w.length;b++){var Y=w[b];if(Y.name===v)if(Y.type==="m")if(!Y.isEnd)S=b;else{if(S==-1)throw new Error("Detected ".concat(v," closing element before finding the start"));w.splice(S,b-S+1);return}else{w.splice(b,1);return}}}n.removeElement=k;function C(v,w){for(var S=[],b=-1,Y=0;Y<w.length;Y++){var ae=w[Y];if(ae.name===v)if(ae.type==="m")if(!ae.isEnd)b=Y;else{if(b==-1)throw new Error("Detected ".concat(v," closing element before finding the start"));S=w.slice(b,Y+1);break}else{S.push(w[Y]);break}}return S}n.extractElement=C;function x(v,w){Array.isArray(w.cueInfos)&&!Array.isArray(w.cues)&&(console.warn("putRefinedMetaData: info.cueInfos property is deprecated. please use info.cues"),w.cues=w.cueInfos);for(var S=[],b=[],Y=0;Y<v.length;Y++){var ae=v[Y];if(ae.type==="m"&&ae.name==="Segment"){if(S=v.slice(0,Y),b=v.slice(Y),ae.unknownSize){b.shift();break}throw new Error("this metadata is not streaming webm file")}}if(!(b[b.length-1].dataEnd>0))throw new Error("metadata dataEnd has wrong number");var be=b[b.length-1].dataEnd,Ee=S[S.length-1].dataEnd,Ae=new t.default().encode(S).byteLength,He=Ae-Ee,ct=be-b[0].tagStart;b[0].tagStart-Ee,b[0].tagStart;var ue=new n.Buffer([24,83,128,103]),Z=new n.Buffer("01ffffffffffffff","hex"),ge=ue.byteLength+Z.byteLength,Ce=ct,Me;for(Me=1;Me<20;Me++){var ut=Ee+ge+Ce,Xe=ut-be,Oe=He+Xe,te=M(b,Oe,w),Q=new t.default().encode(te).byteLength;if(Q===Ce)return new t.default().encode([].concat(S,[{type:"m",name:"Segment",isEnd:!1,unknownSize:!0}],te));Ce=Q}throw new Error("unable to refine metadata, stable size could not be found in "+Me+" iterations!")}n.putRefinedMetaData=x;function N(v){var w=new t.default;return v.reduce(function(S,b){return S.concat(w.encode([b]))},[]).reduce(function(S,b){return S+b.byteLength},0)}function M(v,w,S){var b=S.duration,Y=S.clusterPtrs,ae=S.cues,be=v.slice(0);if(typeof b=="number"){var Ee=!1;be.forEach(function(He){He.type==="f"&&He.name==="Duration"&&(Ee=!0,He.data=y(b,8))}),Ee||W(be,"Info",[{name:"Duration",type:"f",data:y(b,8)}])}Array.isArray(ae)&&W(be,"Cues",q(ae,w));var Ae=[];return Array.isArray(Y)&&(console.warn("append cluster pointers to seekhead is deprecated. please use cues"),Ae=z(Y,w)),W(be,"SeekHead",Ae,!0),be}function z(v,w){var S=[];return v.forEach(function(b){S.push({name:"Seek",type:"m",isEnd:!1}),S.push({name:"SeekID",type:"b",data:new n.Buffer([31,67,182,117])}),S.push({name:"SeekPosition",type:"u",data:P(b+w)}),S.push({name:"Seek",type:"m",isEnd:!0})}),S}function q(v,w){var S=[];return v.forEach(function(b){var Y=b.CueTrack,ae=b.CueClusterPosition,be=b.CueTime;S.push({name:"CuePoint",type:"m",isEnd:!1}),S.push({name:"CueTime",type:"u",data:P(be)}),S.push({name:"CueTrackPositions",type:"m",isEnd:!1}),S.push({name:"CueTrack",type:"u",data:P(Y)}),S.push({name:"CueClusterPosition",type:"u",data:P(ae+w)}),S.push({name:"CueTrackPositions",type:"m",isEnd:!0}),S.push({name:"CuePoint",type:"m",isEnd:!0})}),S}function W(v,w,S,b){b===void 0&&(b=!1);for(var Y=-1,ae=0;ae<v.length;ae++){var be=v[ae];if(be.type==="m"&&be.name===w&&be.isEnd===!1){Y=ae;break}}Y>=0?Array.prototype.splice.apply(v,[Y+1,0].concat(S)):b?[].concat([{name:w,type:"m",isEnd:!1}],S,[{name:w,type:"m",isEnd:!0}]).reverse().forEach(function(Ee){v.unshift(Ee)}):(v.push({name:w,type:"m",isEnd:!1}),S.forEach(function(Ee){v.push(Ee)}),v.push({name:w,type:"m",isEnd:!0}))}function L(v){return n.Buffer.concat(v)}n.concat=L;function O(v){var w=new n.Buffer(0);if(v.type==="m")return v;switch(v.type){case"u":w=P(v.value);break;case"i":w=E(v.value);break;case"f":w=y(v.value);break;case"s":w=new n.Buffer(v.value,"ascii");break;case"8":w=new n.Buffer(v.value,"utf8");break;case"b":w=v.value;break;case"d":w=new e.Int64BE(v.value.getTime().toString()).toBuffer();break}return Object.assign({},v,{data:w})}n.encodeValueToBuffer=O;function P(v){for(var w=1;v>=Math.pow(2,8*w);w++);if(w>=7)return console.warn("7bit or more bigger uint not supported."),new e.Uint64BE(v).toBuffer();var S=new n.Buffer(w);return S.writeUIntBE(v,0,w),S}n.createUIntBuffer=P;function E(v){for(var w=1;v>=Math.pow(2,8*w);w++);if(w>=7)return console.warn("7bit or more bigger uint not supported."),new e.Int64BE(v).toBuffer();var S=new n.Buffer(w);return S.writeIntBE(v,0,w),S}n.createIntBuffer=E;function y(v,w){if(w===void 0&&(w=8),w===8){var S=new n.Buffer(8);return S.writeDoubleBE(v,0),S}else if(w===4){var S=new n.Buffer(4);return S.writeFloatBE(v,0),S}else throw new Error("float type bits must 4bytes or 8bytes")}n.createFloatBuffer=y;function T(v){return v instanceof Date?v:new Date(new Date("2001-01-01T00:00:00.000Z").getTime()+Number(v)/1e3/1e3)}n.convertEBMLDateToJSDate=T}(go)),go}var _u;function i_(){if(_u)return Vi;_u=1,Object.defineProperty(Vi,"__esModule",{value:!0});var n=Od(),e=wn(),t=wn(),r=Fd(),i;(function(a){a[a.STATE_TAG=1]="STATE_TAG",a[a.STATE_SIZE=2]="STATE_SIZE",a[a.STATE_CONTENT=3]="STATE_CONTENT"})(i||(i={}));var s=function(){function a(){this._buffer=new e.Buffer(0),this._tag_stack=[],this._state=i.STATE_TAG,this._cursor=0,this._total=0,this._schema=r.byEbmlID,this._result=[]}return a.prototype.decode=function(l){this.readChunk(l);var d=this._result;return this._result=[],d},a.prototype.readChunk=function(l){for(this._buffer=t.concat([this._buffer,new e.Buffer(l)]);this._cursor<this._buffer.length&&!(this._state===i.STATE_TAG&&!this.readTag()||this._state===i.STATE_SIZE&&!this.readSize()||this._state===i.STATE_CONTENT&&!this.readContent()););},a.prototype.getSchemaInfo=function(l){return this._schema[l]||{name:"unknown",level:-1,type:"unknown",description:"unknown"}},a.prototype.readTag=function(){if(this._cursor>=this._buffer.length)return!1;var l=(0,e.readVint)(this._buffer,this._cursor);if(l==null)return!1;var d=this._buffer.slice(this._cursor,this._cursor+l.length),f=d.reduce(function(k,C,x,N){return k+C*Math.pow(16,2*(N.length-1-x))},0),g=this.getSchemaInfo(f),A={EBML_ID:f.toString(16),schema:g,type:g.type,name:g.name,level:g.level,tagStart:this._total,tagEnd:this._total+l.length,sizeStart:this._total+l.length,sizeEnd:null,dataStart:null,dataEnd:null,dataSize:null,data:null};return this._tag_stack.push(A),this._cursor+=l.length,this._total+=l.length,this._state=i.STATE_SIZE,!0},a.prototype.readSize=function(){if(this._cursor>=this._buffer.length)return!1;var l=(0,e.readVint)(this._buffer,this._cursor);if(l==null)return!1;var d=this._tag_stack[this._tag_stack.length-1];return d.sizeEnd=d.sizeStart+l.length,d.dataStart=d.sizeEnd,d.dataSize=l.value,l.value===-1?(d.dataEnd=-1,d.type==="m"&&(d.unknownSize=!0)):d.dataEnd=d.sizeEnd+l.value,this._cursor+=l.length,this._total+=l.length,this._state=i.STATE_CONTENT,!0},a.prototype.readContent=function(){var l=this._tag_stack[this._tag_stack.length-1];if(l.type==="m"){if(l.isEnd=!1,this._result.push(l),this._state=i.STATE_TAG,l.dataSize===0){var d=Object.assign({},l,{isEnd:!0});this._result.push(d),this._tag_stack.pop()}return!0}if(this._buffer.length<this._cursor+l.dataSize)return!1;var f=this._buffer.slice(this._cursor,this._cursor+l.dataSize);switch(this._buffer=this._buffer.slice(this._cursor+l.dataSize),l.data=f,l.type){case"u":l.value=f.readUIntBE(0,f.length);break;case"i":l.value=f.readIntBE(0,f.length);break;case"f":l.value=l.dataSize===4?f.readFloatBE(0):l.dataSize===8?f.readDoubleBE(0):(console.warn("cannot read ".concat(l.dataSize," octets float. failback to 0")),0);break;case"s":l.value=f.toString("ascii");break;case"8":l.value=f.toString("utf8");break;case"b":l.value=f;break;case"d":l.value=(0,e.convertEBMLDateToJSDate)(new n.Int64BE(f).toNumber());break}if(l.value===null)throw new Error("unknown tag type:"+l.type);for(this._result.push(l),this._total+=l.dataSize,this._state=i.STATE_TAG,this._cursor=0,this._tag_stack.pop();this._tag_stack.length>0;){var g=this._tag_stack[this._tag_stack.length-1];if(g.dataEnd<0)return this._tag_stack.pop(),!0;if(this._total<g.dataEnd)break;if(g.type!=="m")throw new Error("parent element is not master element");var d=Object.assign({},g,{isEnd:!0});this._result.push(d),this._tag_stack.pop()}return!0},a}();return Vi.default=s,Vi}var Vn={},Mi={exports:{}},Eu;function s_(){if(Eu)return Mi.exports;Eu=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(O,P,E){return Function.prototype.apply.call(O,P,E)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(O){return Object.getOwnPropertyNames(O).concat(Object.getOwnPropertySymbols(O))}:t=function(O){return Object.getOwnPropertyNames(O)};function r(L){console&&console.warn&&console.warn(L)}var i=Number.isNaN||function(O){return O!==O};function s(){s.init.call(this)}Mi.exports=s,Mi.exports.once=z,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function l(L){if(typeof L!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof L)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(L){if(typeof L!="number"||L<0||i(L))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+L+".");a=L}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(O){if(typeof O!="number"||O<0||i(O))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+O+".");return this._maxListeners=O,this};function d(L){return L._maxListeners===void 0?s.defaultMaxListeners:L._maxListeners}s.prototype.getMaxListeners=function(){return d(this)},s.prototype.emit=function(O){for(var P=[],E=1;E<arguments.length;E++)P.push(arguments[E]);var y=O==="error",T=this._events;if(T!==void 0)y=y&&T.error===void 0;else if(!y)return!1;if(y){var v;if(P.length>0&&(v=P[0]),v instanceof Error)throw v;var w=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw w.context=v,w}var S=T[O];if(S===void 0)return!1;if(typeof S=="function")e(S,this,P);else for(var b=S.length,Y=x(S,b),E=0;E<b;++E)e(Y[E],this,P);return!0};function f(L,O,P,E){var y,T,v;if(l(P),T=L._events,T===void 0?(T=L._events=Object.create(null),L._eventsCount=0):(T.newListener!==void 0&&(L.emit("newListener",O,P.listener?P.listener:P),T=L._events),v=T[O]),v===void 0)v=T[O]=P,++L._eventsCount;else if(typeof v=="function"?v=T[O]=E?[P,v]:[v,P]:E?v.unshift(P):v.push(P),y=d(L),y>0&&v.length>y&&!v.warned){v.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=L,w.type=O,w.count=v.length,r(w)}return L}s.prototype.addListener=function(O,P){return f(this,O,P,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(O,P){return f(this,O,P,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function A(L,O,P){var E={fired:!1,wrapFn:void 0,target:L,type:O,listener:P},y=g.bind(E);return y.listener=P,E.wrapFn=y,y}s.prototype.once=function(O,P){return l(P),this.on(O,A(this,O,P)),this},s.prototype.prependOnceListener=function(O,P){return l(P),this.prependListener(O,A(this,O,P)),this},s.prototype.removeListener=function(O,P){var E,y,T,v,w;if(l(P),y=this._events,y===void 0)return this;if(E=y[O],E===void 0)return this;if(E===P||E.listener===P)--this._eventsCount===0?this._events=Object.create(null):(delete y[O],y.removeListener&&this.emit("removeListener",O,E.listener||P));else if(typeof E!="function"){for(T=-1,v=E.length-1;v>=0;v--)if(E[v]===P||E[v].listener===P){w=E[v].listener,T=v;break}if(T<0)return this;T===0?E.shift():N(E,T),E.length===1&&(y[O]=E[0]),y.removeListener!==void 0&&this.emit("removeListener",O,w||P)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(O){var P,E,y;if(E=this._events,E===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[O]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete E[O]),this;if(arguments.length===0){var T=Object.keys(E),v;for(y=0;y<T.length;++y)v=T[y],v!=="removeListener"&&this.removeAllListeners(v);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(P=E[O],typeof P=="function")this.removeListener(O,P);else if(P!==void 0)for(y=P.length-1;y>=0;y--)this.removeListener(O,P[y]);return this};function k(L,O,P){var E=L._events;if(E===void 0)return[];var y=E[O];return y===void 0?[]:typeof y=="function"?P?[y.listener||y]:[y]:P?M(y):x(y,y.length)}s.prototype.listeners=function(O){return k(this,O,!0)},s.prototype.rawListeners=function(O){return k(this,O,!1)},s.listenerCount=function(L,O){return typeof L.listenerCount=="function"?L.listenerCount(O):C.call(L,O)},s.prototype.listenerCount=C;function C(L){var O=this._events;if(O!==void 0){var P=O[L];if(typeof P=="function")return 1;if(P!==void 0)return P.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function x(L,O){for(var P=new Array(O),E=0;E<O;++E)P[E]=L[E];return P}function N(L,O){for(;O+1<L.length;O++)L[O]=L[O+1];L.pop()}function M(L){for(var O=new Array(L.length),P=0;P<O.length;++P)O[P]=L[P].listener||L[P];return O}function z(L,O){return new Promise(function(P,E){function y(v){L.removeListener(O,T),E(v)}function T(){typeof L.removeListener=="function"&&L.removeListener("error",y),P([].slice.call(arguments))}W(L,O,T,{once:!0}),O!=="error"&&q(L,y,{once:!0})})}function q(L,O,P){typeof L.on=="function"&&W(L,"error",O,P)}function W(L,O,P,E){if(typeof L.on=="function")E.once?L.once(O,P):L.on(O,P);else if(typeof L.addEventListener=="function")L.addEventListener(O,function y(T){E.once&&L.removeEventListener(O,y),P(T)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof L)}return Mi.exports}var wu;function o_(){if(wu)return Vn;wu=1;var n=Vn&&Vn.__extends||function(){var i=function(s,a){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(l[f]=d[f])},i(s,a)};return function(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");i(s,a);function l(){this.constructor=s}s.prototype=a===null?Object.create(a):(l.prototype=a.prototype,new l)}}();Object.defineProperty(Vn,"__esModule",{value:!0});var e=s_(),t=wn(),r=function(i){n(s,i);function s(){var a=i.call(this)||this;return a.logGroup="",a.hasLoggingStarted=!1,a.metadataloaded=!1,a.chunks=[],a.stack=[],a.segmentOffset=0,a.last2SimpleBlockVideoTrackTimecode=[0,0],a.last2SimpleBlockAudioTrackTimecode=[0,0],a.lastClusterTimecode=0,a.lastClusterPosition=0,a.timecodeScale=1e6,a.metadataSize=0,a.metadatas=[],a.cues=[],a.firstVideoBlockRead=!1,a.firstAudioBlockRead=!1,a.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null},a.trackTypes=[],a.trackDefaultDuration=[],a.trackCodecDelay=[],a.trackInfo={type:"nothing"},a.ended=!1,a.logging=!1,a.use_duration_every_simpleblock=!1,a.use_webp=!1,a.use_segment_info=!0,a.drop_default_duration=!0,a}return s.prototype.stop=function(){for(this.ended=!0,this.emit_segment_info();this.stack.length;)this.stack.pop(),this.logging&&console.groupEnd();this.logging&&this.hasLoggingStarted&&this.logGroup&&console.groupEnd()},s.prototype.emit_segment_info=function(){var a=this.chunks;if(this.chunks=[],this.metadataloaded){if(!this.use_segment_info)return;var f=this.lastClusterTimecode,g=this.duration,A=this.timecodeScale;this.emit("cluster",{timecode:f,data:a}),this.emit("duration",{timecodeScale:A,duration:g})}else{this.metadataloaded=!0,this.metadatas=a;var l=this.trackTypes.indexOf(1),d=this.trackTypes.indexOf(2);if(this.trackInfo=l>=0&&d>=0?{type:"both",trackNumber:l}:l>=0?{type:"video",trackNumber:l}:d>=0?{type:"audio",trackNumber:d}:{type:"nothing"},!this.use_segment_info)return;this.emit("metadata",{data:a,metadataSize:this.metadataSize})}},s.prototype.read=function(a){var l=this,d=!1;if(!this.ended){if(a.type==="m")if(a.isEnd)this.stack.pop();else{var f=this.stack[this.stack.length-1];if(f!=null&&f.level>=a.level){this.stack.pop(),this.logging&&console.groupEnd(),f.dataEnd=a.dataEnd,f.dataSize=a.dataEnd-f.dataStart,f.unknownSize=!1;var g=Object.assign({},f,{name:f.name,type:f.type,isEnd:!0});this.chunks.push(g)}this.stack.push(a)}if(a.type==="m"&&a.name=="Segment")this.segmentOffset!=0&&console.warn("Multiple segments detected!"),this.segmentOffset=a.dataStart,this.emit("segment_offset",this.segmentOffset);else if(a.type==="b"&&a.name==="SimpleBlock"){var A=t.ebmlBlock(a.data),k=A.timecode,C=A.trackNumber,x=A.frames;if(this.trackTypes[C]===1){if(!this.firstVideoBlockRead&&(this.firstVideoBlockRead=!0,this.trackInfo.type==="both"||this.trackInfo.type==="video")){var N=this.lastClusterTimecode+k;this.cues.push({CueTrack:C,CueClusterPosition:this.lastClusterPosition,CueTime:N}),this.emit("cue_info",{CueTrack:C,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:C,CueClusterPosition:this.lastClusterPosition,CueTime:N})}this.last2SimpleBlockVideoTrackTimecode=[this.last2SimpleBlockVideoTrackTimecode[1],k]}else if(this.trackTypes[C]===2){if(!this.firstAudioBlockRead&&(this.firstAudioBlockRead=!0,this.trackInfo.type==="audio")){var N=this.lastClusterTimecode+k;this.cues.push({CueTrack:C,CueClusterPosition:this.lastClusterPosition,CueTime:N}),this.emit("cue_info",{CueTrack:C,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:C,CueClusterPosition:this.lastClusterPosition,CueTime:N})}this.last2SimpleBlockAudioTrackTimecode=[this.last2SimpleBlockAudioTrackTimecode[1],k]}this.use_duration_every_simpleblock&&this.emit("duration",{timecodeScale:this.timecodeScale,duration:this.duration}),this.use_webp&&x.forEach(function(M){var z=M.slice(3,6).toString("hex");if(z==="9d012a"){var q=t.VP8BitStreamToRiffWebPBuffer(M),W=new Blob([q],{type:"image/webp"}),L=l.duration;l.emit("webp",{currentTime:L,webp:W})}})}else a.type==="m"&&a.name==="Cluster"&&a.isEnd===!1?(this.firstVideoBlockRead=!1,this.firstAudioBlockRead=!1,this.emit_segment_info(),this.emit("cluster_ptr",a.tagStart),this.lastClusterPosition=a.tagStart):a.type==="u"&&a.name==="Timecode"?this.lastClusterTimecode=a.value:a.type==="u"&&a.name==="TimecodeScale"?this.timecodeScale=a.value:a.type==="m"&&a.name==="TrackEntry"?a.isEnd?(this.trackTypes[this.currentTrack.TrackNumber]=this.currentTrack.TrackType,this.trackDefaultDuration[this.currentTrack.TrackNumber]=this.currentTrack.DefaultDuration,this.trackCodecDelay[this.currentTrack.TrackNumber]=this.currentTrack.CodecDelay):this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null}:a.type==="u"&&a.name==="TrackType"?this.currentTrack.TrackType=a.value:a.type==="u"&&a.name==="TrackNumber"?this.currentTrack.TrackNumber=a.value:a.type==="u"&&a.name==="CodecDelay"?this.currentTrack.CodecDelay=a.value:a.type==="u"&&a.name==="DefaultDuration"?this.drop_default_duration?(console.warn("DefaultDuration detected!, remove it"),d=!0):this.currentTrack.DefaultDuration=a.value:a.name==="unknown"&&console.warn(a);!this.metadataloaded&&a.dataEnd>0&&(this.metadataSize=a.dataEnd),d||this.chunks.push(a),this.logging&&this.put(a)}},Object.defineProperty(s.prototype,"duration",{get:function(){if(this.trackInfo.type==="nothing")return console.warn("no video, no audio track"),0;var a=0,l=0,d=0,f=this.trackDefaultDuration[this.trackInfo.trackNumber];if(typeof f=="number")a=f;else if(this.trackInfo.type==="both")if(this.last2SimpleBlockAudioTrackTimecode[1]>this.last2SimpleBlockVideoTrackTimecode[1]){a=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale;var g=this.trackCodecDelay[this.trackTypes.indexOf(2)];typeof g=="number"&&(l=g),d=this.last2SimpleBlockAudioTrackTimecode[1]}else{a=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale;var g=this.trackCodecDelay[this.trackTypes.indexOf(1)];typeof g=="number"&&(l=g),d=this.last2SimpleBlockVideoTrackTimecode[1]}else if(this.trackInfo.type==="video"){a=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale;var g=this.trackCodecDelay[this.trackInfo.trackNumber];typeof g=="number"&&(l=g),d=this.last2SimpleBlockVideoTrackTimecode[1]}else if(this.trackInfo.type==="audio"){a=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale;var g=this.trackCodecDelay[this.trackInfo.trackNumber];typeof g=="number"&&(l=g),d=this.last2SimpleBlockAudioTrackTimecode[1]}var A=(this.lastClusterTimecode+d)*this.timecodeScale+a-l,k=A/this.timecodeScale;return Math.floor(k)},enumerable:!1,configurable:!0}),s.prototype.addListener=function(a,l){return i.prototype.addListener.call(this,a,l)},s.prototype.put=function(a){this.hasLoggingStarted||(this.hasLoggingStarted=!0,this.logging&&this.logGroup&&console.groupCollapsed(this.logGroup)),a.type==="m"?a.isEnd?console.groupEnd():console.group(a.name+":"+a.tagStart):a.type==="b"?console.log(a.name,a.type):console.log(a.name,a.tagStart,a.type,a.value)},s}(e.EventEmitter);return Vn.default=r,Vn}var Tu;function a_(){return Tu||(Tu=1,function(n){var e=un&&un.__createBinding||(Object.create?function(l,d,f,g){g===void 0&&(g=f),Object.defineProperty(l,g,{enumerable:!0,get:function(){return d[f]}})}:function(l,d,f,g){g===void 0&&(g=f),l[g]=d[f]}),t=un&&un.__exportStar||function(l,d){for(var f in l)f!=="default"&&!Object.prototype.hasOwnProperty.call(d,f)&&e(d,l,f)};Object.defineProperty(n,"__esModule",{value:!0}),n.tools=n.Reader=n.Encoder=n.Decoder=void 0,t(Xv(),n);var r=i_();n.Decoder=r.default;var i=Ud();n.Encoder=i.default;var s=o_();n.Reader=s.default;var a=wn();n.tools=a}(un)),un}var Iu;function l_(){if(Iu)return Ot;Iu=1;var n=Ot&&Ot.__awaiter||function(i,s,a,l){function d(f){return f instanceof a?f:new a(function(g){g(f)})}return new(a||(a=Promise))(function(f,g){function A(x){try{C(l.next(x))}catch(N){g(N)}}function k(x){try{C(l.throw(x))}catch(N){g(N)}}function C(x){x.done?f(x.value):d(x.value).then(A,k)}C((l=l.apply(i,s||[])).next())})},e=Ot&&Ot.__generator||function(i,s){var a={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},l,d,f,g;return g={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function A(C){return function(x){return k([C,x])}}function k(C){if(l)throw new TypeError("Generator is already executing.");for(;a;)try{if(l=1,d&&(f=C[0]&2?d.return:C[0]?d.throw||((f=d.return)&&f.call(d),0):d.next)&&!(f=f.call(d,C[1])).done)return f;switch(d=0,f&&(C=[C[0]&2,f.value]),C[0]){case 0:case 1:f=C;break;case 4:return a.label++,{value:C[1],done:!1};case 5:a.label++,d=C[1],C=[0];continue;case 7:C=a.ops.pop(),a.trys.pop();continue;default:if(f=a.trys,!(f=f.length>0&&f[f.length-1])&&(C[0]===6||C[0]===2)){a=0;continue}if(C[0]===3&&(!f||C[1]>f[0]&&C[1]<f[3])){a.label=C[1];break}if(C[0]===6&&a.label<f[1]){a.label=f[1],f=C;break}if(f&&a.label<f[2]){a.label=f[2],a.ops.push(C);break}f[2]&&a.ops.pop(),a.trys.pop();continue}C=s.call(i,a)}catch(x){C=[6,x],d=0}finally{l=f=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}};Object.defineProperty(Ot,"__esModule",{value:!0});var t=a_();function r(i){return n(this,void 0,void 0,function(){var s,a,l,d,f,g,A,k,C,x,N,M;return e(this,function(z){switch(z.label){case 0:if(!i)throw Error("call to fixWebmDuration requires a blob");s=new t.Decoder,a=new t.Reader,l=i.stream(),d=l.getReader(),z.label=1;case 1:return[4,d.read()];case 2:return f=z.sent(),g=f.done,A=f.value,g?(a.stop(),[3,3]):(k=s.decode(A),k=k?.filter(function(q){return q.type!=="unknown"}),k.forEach(function(q){a.read(q)}),A=null,[3,1]);case 3:return C=t.tools.makeMetadataSeekable(a.metadatas,a.duration,a.cues),x=new Blob([C],{type:i.type}),N=i.slice(a.metadataSize),M=new Blob([x,N],{type:i.type}),[2,M]}})})}return Ot.default=r,Ot}var c_=l_();const u_=Qv(c_);function bu(n){if(ra[n]||In!=="receiver")return;const e=n==="camera1"?ca:ua;if(!e||!e.srcObject){alert(`${n} のビデオストリームが見つかりません。`);return}const t=e.srcObject;Lu(n,[]),is(n,!0);const r=jd(n);try{const i=new MediaRecorder(t,{mimeType:"video/webm; codecs=vp9"});Nu(n,i),i.ondataavailable=s=>{s.data.size>0&&Nr[n].push(s.data)},i.onstop=()=>{console.log(`Recording stopped for ${n}. Total chunks:`,Nr[n].length),r.startBtn.disabled=!1,r.stopBtn.disabled=!0,r.downloadBtn.disabled=Nr[n].length===0,r.status.textContent="録画停止。"},i.start(100),console.log(`Recording started for ${n}.`),r.startBtn.disabled=!0,r.stopBtn.disabled=!1,r.downloadBtn.disabled=!0,r.status.textContent="録画中..."}catch(i){console.error(`Error starting MediaRecorder for ${n}:`,i),alert(`${n} の録画開始に失敗しました。`),is(n,!1)}}function ar(n){const e=Br[n];!ra[n]||!e||e.state==="inactive"||(e.stop(),is(n,!1))}async function Au(n){const e=Nr[n];if(e.length===0){alert("ダウンロードする録画データがありません。");return}const t=jd(n);t.status.textContent="動画ファイルを処理中...",t.downloadBtn.disabled=!0;try{const r=new Blob(e,{type:"video/webm"}),i=await u_(r),s=URL.createObjectURL(i),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=s,a.download=`recording_${n}_${new Date().toISOString().replace(/[:.]/g,"-")}.webm`,a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),t.status.textContent=""}catch(r){console.error(`Error fixing or downloading video for ${n}:`,r),alert("動画の処理またはダウンロード中にエラーが発生しました。"),t.status.textContent="エラー"}finally{t.downloadBtn.disabled=!1}}function jd(n){return n==="camera1"?{startBtn:fa,stopBtn:ma,downloadBtn:pa,status:Fu}:{startBtn:ga,stopBtn:ya,downloadBtn:va,status:Uu}}let Jn=[],qr=[],ii=!1,Ji=null;const h_=1e3;function d_(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),a=String(n.getSeconds()).padStart(2,"0"),l=String(n.getMilliseconds()).padStart(3,"0");return`${e}-${t}-${r} ${i}:${s}:${a}.${l}`}function tl(){qr.length>0&&(Jn.push(...qr),qr=[])}function f_(){ii||(ii=!0,Jn=[],qr=[],performance.now(),Ji=setInterval(tl,h_),console.log("Evaluation started."),document.getElementById("evaluationStatus").textContent="評価中...",document.getElementById("startEvaluationBtn").disabled=!0,document.getElementById("stopEvaluationBtn").disabled=!1,document.getElementById("downloadCsvBtn").disabled=!0)}function m_(){ii&&(ii=!1,Ji&&(clearInterval(Ji),Ji=null),tl(),console.log("Evaluation stopped."),document.getElementById("evaluationStatus").textContent="評価停止中",document.getElementById("startEvaluationBtn").disabled=!1,document.getElementById("stopEvaluationBtn").disabled=!0,document.getElementById("downloadCsvBtn").disabled=Jn.length===0)}function Su(n){if(!ii)return;const e=d_(new Date);qr.push({timestamp:e,...n})}function p_(){if(tl(),Jn.length===0){alert("データが記録されていません。");return}const n=Object.keys(Jn[0]).join(","),e=Jn.map(s=>Object.values(s).map(a=>typeof a=="number"?a.toFixed(3):a).join(",")).join(`
`),t=`${n}
${e}`,r=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){const s=URL.createObjectURL(r);i.setAttribute("href",s),i.setAttribute("download",`tracking_evaluation_${new Date().toISOString()}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}const Cu=320,g_=4,y_=5;let ot,De,pn,As,si=!1,gn,Zi;const Bn={pan:{Kp:84e3,Ki:0,Kd:0},tilt:{Kp:-85e3,Ki:0,Kd:0}};let $n={integral:0,previousError:0},zn={integral:0,previousError:0},Go=0,Ko=0,Qo=0,$d,Ut,qn,es,ts,Xo;const v_=new Promise(n=>{const e=()=>{typeof cv<"u"?(console.log("OpenCV.jsのオブジェクト 'cv' を確認しました。ランタイムの初期化を待ちます。"),cv.onRuntimeInitialized=()=>{console.log("OpenCV.jsのランタイムが初期化されました。");const t=cv.getPredefinedDictionary(cv.DICT_4X4_50),r=new cv.aruco_DetectorParameters,i=new cv.aruco_RefineParameters(10,3,!0);$d=new cv.aruco_ArucoDetector(t,r,i),Ut=new cv.Mat,qn=new cv.Mat,es=new cv.Mat,ts=new cv.MatVector,Xo=new cv.Mat,n()}):(console.log("OpenCV.jsの 'cv' オブジェクトを待機中..."),setTimeout(e,100))};e()});async function __(n){if(!si){if(Zi=n,ot=n==="camera1"?Gr:fn,!ot||!ot.srcObject||ot.readyState<3){alert("対象のビデオストリームが準備できていません。");return}Zn.textContent="OpenCVを初期化中",await v_,Zn.textContent="追跡を開始します",si=!0,$n={integral:0,previousError:0},zn={integral:0,previousError:0},Go=performance.now(),Ko=0,Qo=0,De=document.createElement("canvas"),ot.parentElement.appendChild(De),De.style.position="absolute",De.style.pointerEvents="none",pn=document.createElement("canvas"),As=pn.getContext("2d",{willReadFrequently:!0}),Vr()}}function Vr(){if(!si){gn=requestAnimationFrame(Vr);return}try{if(Ko++,Ko%g_!==0){gn=requestAnimationFrame(Vr);return}const n=ot.videoWidth,e=ot.videoHeight;if(n===0||e===0){gn=requestAnimationFrame(Vr);return}const t=Cu/n,r=Cu,i=Math.round(e*t);(pn.width!==r||pn.height!==i)&&(pn.width=r,pn.height=i),(De.width!==n||De.height!==e)&&(De.width=n,De.height=e,De.style.width=ot.clientWidth+"px",De.style.height=ot.clientHeight+"px",De.style.top=ot.offsetTop+"px",De.style.left=ot.offsetLeft+"px"),As.drawImage(ot,0,0,r,i),(Ut.cols!==r||Ut.rows!==i)&&(Ut.isDeleted()||Ut.delete(),qn.isDeleted()||qn.delete(),es.isDeleted()||es.delete(),Ut=new cv.Mat(i,r,cv.CV_8UC4),qn=new cv.Mat(i,r,cv.CV_8UC1),es=new cv.Mat(i,r,cv.CV_8UC3));const s=As.getImageData(0,0,r,i);Ut.data.set(s.data),cv.cvtColor(Ut,qn,cv.COLOR_RGBA2GRAY),$d.detectMarkers(qn,ts,Xo),Qo++;const a=Qo%y_===0,l=De.getContext("2d");if(l.clearRect(0,0,De.width,De.height),Xo.rows>0){const d=E_(ts.get(0),r,i);a&&Su({detected:1,...d});const f=ts.get(0).data32F;l.strokeStyle="red",l.lineWidth=3,l.beginPath(),l.moveTo(f[0]/t,f[1]/t);for(let g=2;g<f.length;g+=2)l.lineTo(f[g]/t,f[g+1]/t);l.closePath(),l.stroke()}else a&&Su({detected:0,markerX:null,markerY:null,errorX:null,errorY:null,panAdjustment:null,tiltAdjustment:null})}catch(n){console.error("ArUco追跡中にエラー:",n),Zn.textContent="エラーが発生しました",nl()}gn=requestAnimationFrame(Vr)}function E_(n,e,t){const r=performance.now(),i=(r-Go)/1e3;Go=r;let s=0,a=0;for(let x=0;x<4;++x)s+=n.data32F[x*2],a+=n.data32F[x*2+1];s/=4,a/=4;const l=(s-e/2)/e,d=(a-t/2)/t;Zn.textContent=`マーカー検出: (x: ${Math.round(s)}, y: ${Math.round(a)})`;const f=Pt[Zi];if(!f)return null;const g=f.getSettings(),A=f.getCapabilities();let k=0,C=0;if(g.pan!==void 0&&A.pan){$n.integral=Math.max(-1,Math.min(1,$n.integral+l*i));const x=(l-$n.previousError)/i;$n.previousError=l,k=Bn.pan.Kp*l+Bn.pan.Ki*$n.integral+Bn.pan.Kd*x;const N=Math.max(A.pan.min,Math.min(A.pan.max,g.pan+k));Yn(Zi,"pan",N)}if(g.tilt!==void 0&&A.tilt){zn.integral=Math.max(-1,Math.min(1,zn.integral+d*i));const x=(d-zn.previousError)/i;zn.previousError=d,C=Bn.tilt.Kp*d+Bn.tilt.Ki*zn.integral+Bn.tilt.Kd*x;const N=Math.max(A.tilt.min,Math.min(A.tilt.max,g.tilt+C));Yn(Zi,"tilt",N)}return{markerX:s,markerY:a,errorX:l,errorY:d,panAdjustment:k,tiltAdjustment:C}}function nl(){si&&(si=!1,gn&&(cancelAnimationFrame(gn),gn=null),De&&(De.getContext("2d").clearRect(0,0,De.width,De.height),De.remove(),De=null),pn=null,As=null,Zn.textContent="停止しました",console.log("ArUco tracking stopped."))}const w_={vga:{width:640,height:360},qhd:{width:960,height:540},hd:{width:1280,height:720},fhd:{width:1920,height:1080},fourK:{width:3840,height:2160}},T_={iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"turn:a.relay.metered.ca:80",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:80?transport=tcp",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:443",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:443?transport=tcp",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"}],iceCandidatePoolSize:10};function zd(){const n=new RTCPeerConnection(T_);return n.onconnectionstatechange=()=>{console.log(`PeerConnection state changed to: ${n.connectionState}`);const e=n.connectionState==="connected";if(Mu.style.display=e?"block":"none",e&&Md(),e&&In==="receiver"){if(!Ht){const t=setInterval(Hv,1e3);rs(t)}}else Ht&&(clearInterval(Ht),rs(null)),ha.style.display="none",da.style.display="none";e||(el(),ar("camera1"),ar("camera2"))},n}function I_(n,e){const t=n.split(`\r
`),r=[];if(t.forEach((l,d)=>{l.startsWith("m=video")&&r.push(d)}),r.length===0)return n;const i=new RegExp(`a=rtpmap:(\\d+) ${e}/90000`,"i"),s=t.find(l=>i.test(l));if(!s)return n;const a=s.match(i)[1];return r.forEach(l=>{const d=t[l].split(" ");if(d.slice(3).includes(a)){const f=[a,...d.slice(3).filter(g=>g!==a)];t[l]=[...d.slice(0,3),...f].join(" ")}}),t.join(`\r
`)}function qd(n,e){n.onicecandidate=t=>{t.candidate&&Ja(Ka(e),t.candidate.toJSON())}}function Hd(n){xd(n,e=>{e.docChanges().forEach(t=>{if(t.type==="added"&&_e){const r=new RTCIceCandidate(t.doc.data());_e.addIceCandidate(r).catch(i=>console.error("Error adding ICE candidate:",i))}})})}async function b_(){nl(),el(),ar("camera1"),ar("camera2"),Ht&&(clearInterval(Ht),rs(null)),To&&(To.forEach(n=>n.getTracks().forEach(e=>e.stop())),Ru([])),_e&&(_e.close(),ia(null)),Io&&(await Bv(Io).catch(n=>console.error("Error deleting document: ",n)),sa(null)),Pu({}),xu({}),Kr()}async function A_(){Wr.disabled=!0;const n=parseInt(la.value,10),e=Cf.value,t=parseInt(kf.value,10),r=Rf.value,i={...w_[e],frameRate:{ideal:t},pan:!0,tilt:!0,zoom:!0},s=[],a={};try{const d={video:{deviceId:{exact:Mn.value},...i},audio:!1},f=await navigator.mediaDevices.getUserMedia(d);if(s.push(f),a.camera1=f.getVideoTracks()[0],Gr.srcObject=f,Gr.style.display="block",n===2){const z={video:{deviceId:{exact:hn.value},...i},audio:!1},q=await navigator.mediaDevices.getUserMedia(z);s.push(q),a.camera2=q.getVideoTracks()[0],fn.srcObject=q,fn.style.display="block"}else fn.srcObject=null,fn.style.display="none";Ru(s),Pu(a);const g=zd();ia(g),s.forEach(M=>{M.getTracks().forEach(z=>_e.addTrack(z,M))}),zv();const A=Ka($r(Bd,"calls"));sa(A);const k=$r(A,"offerCandidates"),C=$r(A,"answerCandidates");qd(_e,k),Hd(C);const x=await _e.createOffer(),N=I_(x.sdp,r);await _e.setLocalDescription({type:x.type,sdp:N}),await Ja(A,{offer:{type:x.type,sdp:N},cameraCount:n}),Ss.textContent=A.id,aa.style.display="block",xd(A,M=>{const z=M.data();z?.answer&&_e&&!_e.currentRemoteDescription&&_e.setRemoteDescription(new RTCSessionDescription(z.answer))})}catch(l){console.error("Error starting camera or creating call:",l),alert("カメラへのアクセスに失敗しました。"),Kr()}}async function S_(){const n=Ou.value.trim();if(!n){alert("Call ID を入力してください。");return}os.disabled=!0;try{const e=Ka(Bd,"calls",n);sa(e);const t=await Vv(e),r=t.data();if(!t.exists()||!r.offer){alert("無効なCall IDです。"),Kr();return}const i=r.offer,s=r.cameraCount||2;Wn.style.display=s===2?"inline-block":"none",bo.style.display=s===2?"inline":"none";const a=zd();ia(a);const l=$r(e,"offerCandidates"),d=$r(e,"answerCandidates"),f=[ca,ua],g=[Lr,Wn],A=[ha,da],k={};let C=0;const x=["camera1","camera2"];_e.ontrack=M=>{if(M.track.kind==="video"&&C<s){f[C].srcObject=M.streams[0],g[C].style.display="inline-block";const z=x[C];k[M.track.id]={displayElement:A[C],name:z},C++}},xu(k),_e.ondatachannel=qv,qd(_e,d),Hd(l),await _e.setRemoteDescription(new RTCSessionDescription(i));const N=await _e.createAnswer();await _e.setLocalDescription(N),await Ja(e,{answer:N},{merge:!0}),Ss.textContent=e.id,aa.style.display="block"}catch(e){console.error("Error joining call:",e),alert("通話への参加中にエラーが発生しました。Call IDを確認してください。"),Kr()}finally{os.disabled=!1}}let Rt=null,Wd=!1;const C_=50,k_=.5,R_=200;let Yo=C_,Gd=k_,Jo=R_,Zo=!1,Oi=0,Nn=null,Ln=null,jt=null,$t=null,ea=3600,ta=1,Fi=0,Ui=0,Kd=1,Qd=1,wo={pitchOffset:0,yawOffset:0};const P_="ws://127.0.0.1:8181";function x_(n=P_){Rt||(Rt=new WebSocket(n),Rt.onopen=()=>console.log("IMU WebSocket connected"),Rt.onclose=()=>console.log("IMU WebSocket closed"),Rt.onerror=e=>console.error("IMU WebSocket error",e),Rt.onmessage=e=>{try{const t=JSON.parse(e.data);M_(t)}catch{console.warn("Invalid IMU message",e.data)}})}function D_(){Rt&&(Rt.close(),Rt=null)}function V_(n){Wd=!!n}function B_(n={}){n.minIntervalMs!==void 0&&(Yo=n.minIntervalMs),n.smoothingAlpha!==void 0&&(Gd=n.smoothingAlpha),n.smoothingTauMs!==void 0&&(Jo=n.smoothingTauMs),n.useSmoothing!==void 0&&(Zo=!!n.useSmoothing),n.deltaRatio!==void 0&&n.deltaRatio,n.unitsPerDegree!==void 0&&(ea=n.unitsPerDegree),n.degreeThreshold!==void 0&&(ta=n.degreeThreshold),n.panSign!==void 0&&(Kd=n.panSign),n.tiltSign!==void 0&&(Qd=n.tiltSign)}function N_(){jt!==null&&(wo.pitchOffset=jt),$t!==null&&(wo.yawOffset=$t),console.log("IMU calibrated. Offsets:",wo)}function L_(n){let e,t,r;return Array.isArray(n)?[e,t,r]=n:n&&typeof n=="object"&&(e=n.roll,t=n.pitch!==void 0?n.pitch:n.p,r=n.yaw!==void 0?n.yaw:n.y),typeof t!="number"||typeof r!="number"?null:{roll:Number(e),pitch:Number(t),yaw:Number(r)}}function M_(n){if(!Wd)return;const e=L_(n);if(!e)return;const{pitch:t,yaw:r}=e,s=Tn[vn||"camera1"];if(!s)return;const a=Math.max(-180,Math.min(180,t)),l=Math.max(-180,Math.min(180,r));jt===null&&(jt=a),$t===null&&($t=l);const d=a-jt,f=l-$t,g=L=>L>180?L-360:L<-180?L+360:L,A=g(d),k=g(f),C=performance.now(),x=Oi?Math.max(1,C-Oi):Math.max(1,Yo),N=Jo>0?1-Math.exp(-x/Jo):Gd;if(Fi+=A,Ui+=k,C-Oi<Yo){jt=a,$t=l;return}if(Math.abs(Fi)<ta&&Math.abs(Ui)<ta){jt=a,$t=l;return}const M=Fi,z=Ui,q=M*ea*(Qd||1),W=z*ea*(Kd||1);if(console.debug("IMU -> applying delta degrees (pitch,yaw):",M,z,"units:",q,W),s.tilt&&Math.abs(q)>0){const L=document.getElementById("tiltSlider"),P=parseFloat(L.value||0)+q;let E;Zo?(Ln===null&&(Ln=P),Ln=N*P+(1-N)*Ln,E=Ln):(E=P,Ln=P),It?.readyState==="open"?bs("tilt",E):console.warn("IMU: cannot send tilt - ptzChannel not open")}if(s.pan&&Math.abs(W)>0){const L=document.getElementById("panSlider"),P=parseFloat(L.value||0)+W;let E;Zo?(Nn===null&&(Nn=P),Nn=N*P+(1-N)*Nn,E=Nn):(E=P,Nn=P),It?.readyState==="open"?bs("pan",E):console.warn("IMU: cannot send pan - ptzChannel not open")}Fi=0,Ui=0,jt=a,$t=l,Oi=C}function O_(){If.forEach(P=>{P.addEventListener("change",E=>ju(E.target.value))}),la.addEventListener("change",$u),ji.addEventListener("click",async()=>{const P=Ss.textContent.trim();if(P)try{await navigator.clipboard.writeText(P),ji.textContent="コピー済み",setTimeout(()=>{ji.textContent="コピー"},1500)}catch(E){alert("コピーに失敗"),console.error("Failed to copy Call ID: ",E)}}),Wr.addEventListener("click",()=>{const P=document.getElementById("enableArucoCheckbox").checked,E=document.getElementById("arucoControls");E.style.display=P?"block":"none",A_()}),os.addEventListener("click",S_),Pf.addEventListener("click",b_),Cs.addEventListener("click",Md),ks.addEventListener("click",el),Rs.addEventListener("click",Kv),fa.addEventListener("click",()=>bu("camera1")),ma.addEventListener("click",()=>ar("camera1")),pa.addEventListener("click",()=>Au("camera1")),ga.addEventListener("click",()=>bu("camera2")),ya.addEventListener("click",()=>ar("camera2")),va.addEventListener("click",()=>Au("camera2")),zi.addEventListener("click",()=>{const P=$i.value;__(P),zi.disabled=!0,qi.disabled=!1,$i.disabled=!0}),qi.addEventListener("click",()=>{nl(),zi.disabled=!1,qi.disabled=!0,$i.disabled=!1}),Nf.forEach(P=>{P.addEventListener("change",E=>{E.target.checked&&Nd(E.target.value)})});const n=P=>parseFloat(document.getElementById(`${P}Slider`).value),e=()=>Tn[vn]||{},t=P=>{const E=document.getElementById(P==="zoom"?"zoomInBtn":P==="pan"?"panRightBtn":"tiltUpBtn"),y=document.getElementById(P==="zoom"?"zoomOutBtn":P==="pan"?"panLeftBtn":"tiltDownBtn"),T=document.getElementById(`${P}Slider`),v=document.getElementById(`${P}StepInput`);E.addEventListener("click",()=>{const w=parseFloat(v.value);if(isNaN(w))return;const S=parseFloat(T.value)+w;xe(P,S)}),y.addEventListener("click",()=>{const w=parseFloat(v.value);if(isNaN(w))return;const S=parseFloat(T.value)-w;xe(P,S)})};t("zoom"),t("pan"),t("tilt"),xf.addEventListener("input",()=>xe("zoom",n("zoom"))),Df.addEventListener("input",()=>xe("tilt",n("tilt"))),Vf.addEventListener("input",()=>xe("pan",n("pan"))),Bf.addEventListener("click",()=>{const P=e();P.zoom&&xe("zoom",P.zoom.min),P.tilt&&xe("tilt",0),P.pan&&xe("pan",0)}),window.addEventListener("keydown",P=>{if(In!=="receiver"||ss.style.display==="none"||["INPUT","SELECT","TEXTAREA"].includes(document.activeElement.tagName))return;let E=!1;const y=e(),T=parseFloat(document.getElementById("panStepInput").value)||0,v=parseFloat(document.getElementById("tiltStepInput").value)||0,w=parseFloat(document.getElementById("zoomStepInput").value)||0;switch(P.key){case"ArrowUp":y.tilt&&(xe("tilt",n("tilt")+v),E=!0);break;case"ArrowDown":y.tilt&&(xe("tilt",n("tilt")-v),E=!0);break;case"ArrowLeft":y.pan&&(xe("pan",n("pan")-T),E=!0);break;case"ArrowRight":y.pan&&(xe("pan",n("pan")+T),E=!0);break;case"+":case"PageUp":y.zoom&&(xe("zoom",n("zoom")+w),E=!0);break;case"-":case"PageDown":y.zoom&&(xe("zoom",n("zoom")-w),E=!0);break;case"r":case"R":y.zoom&&xe("zoom",y.zoom.min),y.tilt&&xe("tilt",0),y.pan&&xe("pan",0),E=!0;break}E&&P.preventDefault()}),Kl.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():Lr.requestFullscreen().catch(P=>{alert(`フルスクリーンにできませんでした: ${P.message} (${P.name})`)})}),Ql.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():Wn.requestFullscreen().catch(P=>{alert(`フルスクリーンにできませんでした: ${P.message} (${P.name})`)})}),document.addEventListener("fullscreenchange",()=>{const P=!!document.fullscreenElement;Kl.textContent=P&&document.fullscreenElement===Lr?"通常表示":"フルスクリーン",Ql.textContent=P&&document.fullscreenElement===Wn?"通常表示":"フルスクリーン"});let r=!1,i=0,s=0,a=null,l=null;const d=50;let f=0,g={pan:null,tilt:null};const A=P=>{r&&(l||(l=setTimeout(()=>{const T=P.clientX-i,v=P.clientY-s;i=P.clientX,s=P.clientY;const w=e();let S=n("pan"),b=n("tilt");w.pan&&(S+=T*(w.pan.step/1),bs("pan",S)),w.tilt&&(b-=v*(w.tilt.step/1),bs("tilt",b)),g={pan:S,tilt:b},l=null},d)))},k=P=>{P.preventDefault();const E=e();if(E.zoom){const v=n("zoom")-P.deltaY*(E.zoom.step/20);xe("zoom",v)}},C=P=>{P.button===0&&(r=!0,i=P.clientX,s=P.clientY,a=P.currentTarget,a.classList.add("dragging"),f=performance.now(),g={pan:n("pan"),tilt:n("tilt")})},x=()=>{r&&(r=!1,a&&(a.classList.remove("dragging"),a=null),f>0&&g.pan!==null&&(xe("pan",g.pan,{startTime:f}),xe("tilt",g.tilt,{startTime:f})),f=0,g={pan:null,tilt:null})},N=P=>{P.addEventListener("mousedown",C),P.addEventListener("mousemove",A),P.addEventListener("wheel",k)};window.addEventListener("mouseup",x),N(Lr),N(Wn);const M=document.getElementById("startEvaluationBtn"),z=document.getElementById("stopEvaluationBtn"),q=document.getElementById("downloadCsvBtn");M.addEventListener("click",f_),z.addEventListener("click",m_),q.addEventListener("click",p_);const W=document.getElementById("startPtzEvaluationBtn"),L=document.getElementById("stopPtzEvaluationBtn"),O=document.getElementById("downloadPtzCsvBtn");W.addEventListener("click",Fv),L.addEventListener("click",Uv),O.addEventListener("click",$v),Si&&Ci&&Xl&&(Si.addEventListener("click",()=>{x_(),B_({panSign:-1,tiltSign:1}),Si.disabled=!0,Ci.disabled=!1}),Ci.addEventListener("click",()=>{D_(),Si.disabled=!1,Ci.disabled=!0}),Xl.addEventListener("change",P=>{V_(P.target.checked)}),Yl&&Yl.addEventListener("click",()=>{N_();const P=e();P.pan&&xe("pan",0),P.tilt&&xe("tilt",0)}))}ju(document.querySelector('input[name="role"]:checked').value);O_();Mf();
