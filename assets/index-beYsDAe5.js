(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();let ve,no=[],ro,Vr,ls={},Ft={},Mn={},nu,Ut=[],Vo=!1,yn="sender",Br=null,jt=null,Nr="camera1",br={camera1:null,camera2:null},Ir={camera1:[],camera2:[]},Bo={camera1:!1,camera2:!1};function No(n){ve=n}function ru(n){no=n}function Lo(n){ro=n}function Mo(n){Vr=n}function qd(n){ls=n}function iu(n){Ft=n}function su(n){Mn=n}function Hd(n){nu=n}function ou(n){Ut=n}function au(n){Vo=n}function Gd(n){yn=n}function Fi(n){Br=n}function Ui(n){jt=n}function lu(n){Nr=n}function cu(n,e){br[n]=e}function uu(n,e){Ir[n]=e}function ji(n,e){Bo[n]=e}const Wd=document.querySelectorAll('input[name="role"]'),Kd=document.getElementById("senderControls"),Qd=document.getElementById("receiverControls"),Oo=document.getElementById("callControls"),hu=document.getElementById("statsControls"),zi=document.getElementById("ptzControls"),Fo=document.getElementById("cameraCount"),Rn=document.getElementById("cameraSelect1"),an=document.getElementById("cameraSelect2"),Xd=document.getElementById("cameraSelect2Container"),Yd=document.getElementById("resolution"),Jd=document.getElementById("framerate"),Zd=document.getElementById("codecSelect"),Lr=document.getElementById("startCamera"),$i=document.getElementById("joinCall"),ef=document.getElementById("hangUpBtn"),du=document.getElementById("callIdInput"),cs=document.getElementById("callIdDisplay"),Ai=document.getElementById("copyCallId"),Mr=document.getElementById("localVideo1"),cn=document.getElementById("localVideo2"),Uo=document.getElementById("remoteVideo1"),jo=document.getElementById("remoteVideo2"),Ar=document.getElementById("remoteVideoContainer1"),On=document.getElementById("remoteVideoContainer2"),zo=document.getElementById("resolutionDisplay1"),$o=document.getElementById("resolutionDisplay2"),Il=document.getElementById("fullscreenBtn1"),Al=document.getElementById("fullscreenBtn2"),us=document.getElementById("startStatsRecording"),hs=document.getElementById("stopStatsRecording"),ds=document.getElementById("downloadStats"),qi=document.getElementById("statsDisplay"),tf=document.getElementById("zoomInBtn"),nf=document.getElementById("zoomOutBtn"),rf=document.getElementById("zoomSlider");document.getElementById("zoomValue");const sf=document.getElementById("tiltUpBtn"),of=document.getElementById("tiltDownBtn"),af=document.getElementById("tiltSlider");document.getElementById("tiltValue");const lf=document.getElementById("panLeftBtn"),cf=document.getElementById("panRightBtn"),uf=document.getElementById("panSlider");document.getElementById("panValue");const hf=document.getElementById("ptzResetBtn"),df=document.querySelectorAll('input[name="ptzTarget"]'),io=document.getElementById("ptzTargetCamera2Label"),qo=document.getElementById("startRecording1"),Ho=document.getElementById("stopRecording1"),Go=document.getElementById("downloadVideo1"),fu=document.getElementById("recordingStatus1"),Wo=document.getElementById("startRecording2"),Ko=document.getElementById("stopRecording2"),Qo=document.getElementById("downloadVideo2"),mu=document.getElementById("recordingStatus2"),pu=document.getElementById("arucoControls"),Ci=document.getElementById("arucoTargetSelect"),Si=document.getElementById("startArucoTrackingBtn"),ki=document.getElementById("stopArucoTrackingBtn"),$n=document.getElementById("arucoTrackingStatus");function Or(){Mr.srcObject=null,cn.srcObject=null,Uo.srcObject=null,jo.srcObject=null,Mr.style.display="none",cn.style.display="none",Ar.style.display="none",On.style.display="none",zo.style.display="none",$o.style.display="none",zi.style.display="none",Oo.style.display="none",hu.style.display="none",pu.style.display="none",cs.textContent="",du.value="",Ai.textContent="コピー",Lr.disabled=!1,$i.disabled=!1,qi.textContent="",ou([]),Fi(null),us.disabled=!1,hs.disabled=!0,ds.disabled=!0,Si.disabled=!1,ki.disabled=!0,Ci.disabled=!1,$n.textContent="",["camera1","camera2"].forEach(n=>{br[n]&&br[n].state!=="inactive"&&br[n].stop(),cu(n,null),uu(n,[]),ji(n,!1)}),qo.disabled=!1,Ho.disabled=!0,Go.disabled=!0,fu.textContent="",Wo.disabled=!1,Ko.disabled=!0,Qo.disabled=!0,mu.textContent="",Vr&&(Vr.close(),Mo(null)),jt&&(clearInterval(jt),Ui(null))}function gu(n){Gd(n),Kd.style.display=n==="sender"?"block":"none",Qd.style.display=n==="receiver"?"block":"none",Or()}async function ff(){try{const e=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput");if(Rn.innerHTML="",an.innerHTML="",e.length===0){const t="<option>カメラが見つかりません</option>";Rn.innerHTML=t,an.innerHTML=t,Rn.disabled=!0,an.disabled=!0,Lr.disabled=!0;return}e.forEach((t,r)=>{const i=document.createElement("option");i.value=t.deviceId,i.text=t.label||`カメラ ${r+1}`,Rn.appendChild(i);const s=document.createElement("option");s.value=t.deviceId,s.text=t.label||`カメラ ${r+1}`,an.appendChild(s)}),e.length>1&&(an.selectedIndex=1),Rn.disabled=!1,an.disabled=e.length<2,Lr.disabled=!1,yu()}catch(n){console.error("Error enumerating devices:",n),alert("カメラデバイスの取得に失敗しました。")}}function yu(){const n=parseInt(Fo.value,10);Xd.style.display=n===2?"block":"none"}const mf=()=>{};var Cl={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _u=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},pf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],a=n[t++],l=n[t++],d=((i&7)<<18|(s&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(d>>10)),e[r++]=String.fromCharCode(56320+(d&1023))}else{const s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},vu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],a=i+1<n.length,l=a?n[i+1]:0,d=i+2<n.length,m=d?n[i+2]:0,g=s>>2,C=(s&3)<<4|l>>4;let k=(l&15)<<2|m>>6,E=m&63;d||(E=64,a||(k=64)),r.push(t[g],t[C],t[k],t[E])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(_u(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):pf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const m=i<n.length?t[n.charAt(i)]:64;++i;const C=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||l==null||m==null||C==null)throw new gf;const k=s<<2|l>>4;if(r.push(k),m!==64){const E=l<<4&240|m>>2;if(r.push(E),C!==64){const P=m<<6&192|C;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class gf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yf=function(n){const e=_u(n);return vu.encodeByteArray(e,!0)},Hi=function(n){return yf(n).replace(/\./g,"")},_f=function(n){try{return vu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ef=()=>vf().__FIREBASE_DEFAULTS__,Tf=()=>{if(typeof process>"u"||typeof Cl>"u")return;const n=Cl.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},wf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&_f(n[1]);return e&&JSON.parse(e)},Xo=()=>{try{return mf()||Ef()||Tf()||wf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},bf=n=>{var e,t;return(t=(e=Xo())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},If=n=>{const e=bf(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Eu=()=>{var n;return(n=Xo())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yo(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Cf(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Hi(JSON.stringify(t)),Hi(JSON.stringify(a)),""].join(".")}const Cr={};function kf(){const n={prod:[],emulator:[]};for(const e of Object.keys(Cr))Cr[e]?n.emulator.push(e):n.prod.push(e);return n}function Rf(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Sl=!1;function Pf(n,e){if(typeof window>"u"||typeof document>"u"||!Yo(window.location.host)||Cr[n]===e||Cr[n]||Sl)return;Cr[n]=e;function t(k){return`__firebase__banner__${k}`}const r="__firebase__banner",s=kf().prod.length>0;function a(){const k=document.getElementById(r);k&&k.remove()}function l(k){k.style.display="flex",k.style.background="#7faaf0",k.style.position="fixed",k.style.bottom="5px",k.style.left="5px",k.style.padding=".5em",k.style.borderRadius="5px",k.style.alignItems="center"}function d(k,E){k.setAttribute("width","24"),k.setAttribute("id",E),k.setAttribute("height","24"),k.setAttribute("viewBox","0 0 24 24"),k.setAttribute("fill","none"),k.style.marginLeft="-6px"}function m(){const k=document.createElement("span");return k.style.cursor="pointer",k.style.marginLeft="16px",k.style.fontSize="24px",k.innerHTML=" &times;",k.onclick=()=>{Sl=!0,a()},k}function g(k,E){k.setAttribute("id",E),k.innerText="Learn more",k.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",k.setAttribute("target","__blank"),k.style.paddingLeft="5px",k.style.textDecoration="underline"}function C(){const k=Rf(r),E=t("text"),P=document.getElementById(E)||document.createElement("span"),V=t("learnmore"),N=document.getElementById(V)||document.createElement("a"),$=t("preprendIcon"),q=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(k.created){const G=k.element;l(G),g(N,V);const O=m();d(q,$),G.append(q,P,N,O),document.body.appendChild(G)}s?(P.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",E)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",C):C()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xf(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Df(){var n;const e=(n=Xo())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Vf(){return!Df()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Bf(){try{return typeof indexedDB=="object"}catch{return!1}}function Nf(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lf="FirebaseError";class Jn extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Lf,Object.setPrototypeOf(this,Jn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Tu.prototype.create)}}class Tu{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?Mf(s,r):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Jn(i,l,r)}}function Mf(n,e){return n.replace(Of,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Of=/\{\$([^}]+)}/g;function Gi(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],a=e[i];if(kl(s)&&kl(a)){if(!Gi(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function kl(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(n){return n&&n._delegate?n._delegate:n}class Fr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ln="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Af;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(jf(e))try{this.getOrInitializeService({instanceIdentifier:ln})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=ln){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ln){return this.instances.has(e)}getOptions(e=ln){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);r===l&&a.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Uf(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ln){return this.component?this.component.multipleInstances?e:ln:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Uf(n){return n===ln?void 0:n}function jf(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ff(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ce;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ce||(ce={}));const $f={debug:ce.DEBUG,verbose:ce.VERBOSE,info:ce.INFO,warn:ce.WARN,error:ce.ERROR,silent:ce.SILENT},qf=ce.INFO,Hf={[ce.DEBUG]:"log",[ce.VERBOSE]:"log",[ce.INFO]:"info",[ce.WARN]:"warn",[ce.ERROR]:"error"},Gf=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=Hf[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wu{constructor(e){this.name=e,this._logLevel=qf,this._logHandler=Gf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ce))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?$f[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ce.DEBUG,...e),this._logHandler(this,ce.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ce.VERBOSE,...e),this._logHandler(this,ce.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ce.INFO,...e),this._logHandler(this,ce.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ce.WARN,...e),this._logHandler(this,ce.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ce.ERROR,...e),this._logHandler(this,ce.ERROR,...e)}}const Wf=(n,e)=>e.some(t=>n instanceof t);let Rl,Pl;function Kf(){return Rl||(Rl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Qf(){return Pl||(Pl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bu=new WeakMap,so=new WeakMap,Iu=new WeakMap,zs=new WeakMap,Jo=new WeakMap;function Xf(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(zt(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&bu.set(t,n)}).catch(()=>{}),Jo.set(e,n),e}function Yf(n){if(so.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});so.set(n,e)}let oo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return so.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Iu.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return zt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Jf(n){oo=n(oo)}function Zf(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call($s(this),e,...t);return Iu.set(r,e.sort?e.sort():[e]),zt(r)}:Qf().includes(n)?function(...e){return n.apply($s(this),e),zt(bu.get(this))}:function(...e){return zt(n.apply($s(this),e))}}function em(n){return typeof n=="function"?Zf(n):(n instanceof IDBTransaction&&Yf(n),Wf(n,Kf())?new Proxy(n,oo):n)}function zt(n){if(n instanceof IDBRequest)return Xf(n);if(zs.has(n))return zs.get(n);const e=em(n);return e!==n&&(zs.set(n,e),Jo.set(e,n)),e}const $s=n=>Jo.get(n);function tm(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(n,e),l=zt(a);return r&&a.addEventListener("upgradeneeded",d=>{r(zt(a.result),d.oldVersion,d.newVersion,zt(a.transaction),d)}),t&&a.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),l.then(d=>{s&&d.addEventListener("close",()=>s()),i&&d.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),l}const nm=["get","getKey","getAll","getAllKeys","count"],rm=["put","add","delete","clear"],qs=new Map;function xl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(qs.get(e))return qs.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=rm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||nm.includes(t)))return;const s=async function(a,...l){const d=this.transaction(a,i?"readwrite":"readonly");let m=d.store;return r&&(m=m.index(l.shift())),(await Promise.all([m[t](...l),i&&d.done]))[0]};return qs.set(e,s),s}Jf(n=>({...n,get:(e,t,r)=>xl(e,t)||n.get(e,t,r),has:(e,t)=>!!xl(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class im{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(sm(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function sm(n){const e=n.getComponent();return e?.type==="VERSION"}const ao="@firebase/app",Dl="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rt=new wu("@firebase/app"),om="@firebase/app-compat",am="@firebase/analytics-compat",lm="@firebase/analytics",cm="@firebase/app-check-compat",um="@firebase/app-check",hm="@firebase/auth",dm="@firebase/auth-compat",fm="@firebase/database",mm="@firebase/data-connect",pm="@firebase/database-compat",gm="@firebase/functions",ym="@firebase/functions-compat",_m="@firebase/installations",vm="@firebase/installations-compat",Em="@firebase/messaging",Tm="@firebase/messaging-compat",wm="@firebase/performance",bm="@firebase/performance-compat",Im="@firebase/remote-config",Am="@firebase/remote-config-compat",Cm="@firebase/storage",Sm="@firebase/storage-compat",km="@firebase/firestore",Rm="@firebase/ai",Pm="@firebase/firestore-compat",xm="firebase",Dm="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lo="[DEFAULT]",Vm={[ao]:"fire-core",[om]:"fire-core-compat",[lm]:"fire-analytics",[am]:"fire-analytics-compat",[um]:"fire-app-check",[cm]:"fire-app-check-compat",[hm]:"fire-auth",[dm]:"fire-auth-compat",[fm]:"fire-rtdb",[mm]:"fire-data-connect",[pm]:"fire-rtdb-compat",[gm]:"fire-fn",[ym]:"fire-fn-compat",[_m]:"fire-iid",[vm]:"fire-iid-compat",[Em]:"fire-fcm",[Tm]:"fire-fcm-compat",[wm]:"fire-perf",[bm]:"fire-perf-compat",[Im]:"fire-rc",[Am]:"fire-rc-compat",[Cm]:"fire-gcs",[Sm]:"fire-gcs-compat",[km]:"fire-fst",[Pm]:"fire-fst-compat",[Rm]:"fire-vertex","fire-js":"fire-js",[xm]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wi=new Map,Bm=new Map,co=new Map;function Vl(n,e){try{n.container.addComponent(e)}catch(t){Rt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ki(n){const e=n.name;if(co.has(e))return Rt.debug(`There were multiple attempts to register component ${e}.`),!1;co.set(e,n);for(const t of Wi.values())Vl(t,n);for(const t of Bm.values())Vl(t,n);return!0}function Nm(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Lm(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},$t=new Tu("app","Firebase",Mm);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Fr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $t.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fm=Dm;function Au(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:lo,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw $t.create("bad-app-name",{appName:String(i)});if(t||(t=Eu()),!t)throw $t.create("no-options");const s=Wi.get(i);if(s){if(Gi(t,s.options)&&Gi(r,s.config))return s;throw $t.create("duplicate-app",{appName:i})}const a=new zf(i);for(const d of co.values())a.addComponent(d);const l=new Om(t,r,a);return Wi.set(i,l),l}function Um(n=lo){const e=Wi.get(n);if(!e&&n===lo&&Eu())return Au();if(!e)throw $t.create("no-app",{appName:n});return e}function Fn(n,e,t){var r;let i=(r=Vm[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const l=[`Unable to register library "${i}" with version "${e}":`];s&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Rt.warn(l.join(" "));return}Ki(new Fr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jm="firebase-heartbeat-database",zm=1,Ur="firebase-heartbeat-store";let Hs=null;function Cu(){return Hs||(Hs=tm(jm,zm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ur)}catch(t){console.warn(t)}}}}).catch(n=>{throw $t.create("idb-open",{originalErrorMessage:n.message})})),Hs}async function $m(n){try{const t=(await Cu()).transaction(Ur),r=await t.objectStore(Ur).get(Su(n));return await t.done,r}catch(e){if(e instanceof Jn)Rt.warn(e.message);else{const t=$t.create("idb-get",{originalErrorMessage:e?.message});Rt.warn(t.message)}}}async function Bl(n,e){try{const r=(await Cu()).transaction(Ur,"readwrite");await r.objectStore(Ur).put(e,Su(n)),await r.done}catch(t){if(t instanceof Jn)Rt.warn(t.message);else{const r=$t.create("idb-set",{originalErrorMessage:t?.message});Rt.warn(r.message)}}}function Su(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qm=1024,Hm=30;class Gm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Km(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Nl();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>Hm){const a=Qm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Rt.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Nl(),{heartbeatsToSend:r,unsentEntries:i}=Wm(this._heartbeatsCache.heartbeats),s=Hi(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Rt.warn(t),""}}}function Nl(){return new Date().toISOString().substring(0,10)}function Wm(n,e=qm){const t=[];let r=n.slice();for(const i of n){const s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),Ll(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Ll(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Km{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Bf()?Nf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await $m(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Bl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Bl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Ll(n){return Hi(JSON.stringify({version:2,heartbeats:n})).length}function Qm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xm(n){Ki(new Fr("platform-logger",e=>new im(e),"PRIVATE")),Ki(new Fr("heartbeat",e=>new Gm(e),"PRIVATE")),Fn(ao,Dl,n),Fn(ao,Dl,"esm2017"),Fn("fire-js","")}Xm("");var Ym="firebase",Jm="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Fn(Ym,Jm,"app");var Ml=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var qt,ku;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,y){function T(){}T.prototype=y.prototype,A.D=y.prototype,A.prototype=new T,A.prototype.constructor=A,A.C=function(_,b,S){for(var I=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)I[Y-2]=arguments[Y];return y.prototype[b].apply(_,I)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(A,y,T){T||(T=0);var _=Array(16);if(typeof y=="string")for(var b=0;16>b;++b)_[b]=y.charCodeAt(T++)|y.charCodeAt(T++)<<8|y.charCodeAt(T++)<<16|y.charCodeAt(T++)<<24;else for(b=0;16>b;++b)_[b]=y[T++]|y[T++]<<8|y[T++]<<16|y[T++]<<24;y=A.g[0],T=A.g[1],b=A.g[2];var S=A.g[3],I=y+(S^T&(b^S))+_[0]+3614090360&4294967295;y=T+(I<<7&4294967295|I>>>25),I=S+(b^y&(T^b))+_[1]+3905402710&4294967295,S=y+(I<<12&4294967295|I>>>20),I=b+(T^S&(y^T))+_[2]+606105819&4294967295,b=S+(I<<17&4294967295|I>>>15),I=T+(y^b&(S^y))+_[3]+3250441966&4294967295,T=b+(I<<22&4294967295|I>>>10),I=y+(S^T&(b^S))+_[4]+4118548399&4294967295,y=T+(I<<7&4294967295|I>>>25),I=S+(b^y&(T^b))+_[5]+1200080426&4294967295,S=y+(I<<12&4294967295|I>>>20),I=b+(T^S&(y^T))+_[6]+2821735955&4294967295,b=S+(I<<17&4294967295|I>>>15),I=T+(y^b&(S^y))+_[7]+4249261313&4294967295,T=b+(I<<22&4294967295|I>>>10),I=y+(S^T&(b^S))+_[8]+1770035416&4294967295,y=T+(I<<7&4294967295|I>>>25),I=S+(b^y&(T^b))+_[9]+2336552879&4294967295,S=y+(I<<12&4294967295|I>>>20),I=b+(T^S&(y^T))+_[10]+4294925233&4294967295,b=S+(I<<17&4294967295|I>>>15),I=T+(y^b&(S^y))+_[11]+2304563134&4294967295,T=b+(I<<22&4294967295|I>>>10),I=y+(S^T&(b^S))+_[12]+1804603682&4294967295,y=T+(I<<7&4294967295|I>>>25),I=S+(b^y&(T^b))+_[13]+4254626195&4294967295,S=y+(I<<12&4294967295|I>>>20),I=b+(T^S&(y^T))+_[14]+2792965006&4294967295,b=S+(I<<17&4294967295|I>>>15),I=T+(y^b&(S^y))+_[15]+1236535329&4294967295,T=b+(I<<22&4294967295|I>>>10),I=y+(b^S&(T^b))+_[1]+4129170786&4294967295,y=T+(I<<5&4294967295|I>>>27),I=S+(T^b&(y^T))+_[6]+3225465664&4294967295,S=y+(I<<9&4294967295|I>>>23),I=b+(y^T&(S^y))+_[11]+643717713&4294967295,b=S+(I<<14&4294967295|I>>>18),I=T+(S^y&(b^S))+_[0]+3921069994&4294967295,T=b+(I<<20&4294967295|I>>>12),I=y+(b^S&(T^b))+_[5]+3593408605&4294967295,y=T+(I<<5&4294967295|I>>>27),I=S+(T^b&(y^T))+_[10]+38016083&4294967295,S=y+(I<<9&4294967295|I>>>23),I=b+(y^T&(S^y))+_[15]+3634488961&4294967295,b=S+(I<<14&4294967295|I>>>18),I=T+(S^y&(b^S))+_[4]+3889429448&4294967295,T=b+(I<<20&4294967295|I>>>12),I=y+(b^S&(T^b))+_[9]+568446438&4294967295,y=T+(I<<5&4294967295|I>>>27),I=S+(T^b&(y^T))+_[14]+3275163606&4294967295,S=y+(I<<9&4294967295|I>>>23),I=b+(y^T&(S^y))+_[3]+4107603335&4294967295,b=S+(I<<14&4294967295|I>>>18),I=T+(S^y&(b^S))+_[8]+1163531501&4294967295,T=b+(I<<20&4294967295|I>>>12),I=y+(b^S&(T^b))+_[13]+2850285829&4294967295,y=T+(I<<5&4294967295|I>>>27),I=S+(T^b&(y^T))+_[2]+4243563512&4294967295,S=y+(I<<9&4294967295|I>>>23),I=b+(y^T&(S^y))+_[7]+1735328473&4294967295,b=S+(I<<14&4294967295|I>>>18),I=T+(S^y&(b^S))+_[12]+2368359562&4294967295,T=b+(I<<20&4294967295|I>>>12),I=y+(T^b^S)+_[5]+4294588738&4294967295,y=T+(I<<4&4294967295|I>>>28),I=S+(y^T^b)+_[8]+2272392833&4294967295,S=y+(I<<11&4294967295|I>>>21),I=b+(S^y^T)+_[11]+1839030562&4294967295,b=S+(I<<16&4294967295|I>>>16),I=T+(b^S^y)+_[14]+4259657740&4294967295,T=b+(I<<23&4294967295|I>>>9),I=y+(T^b^S)+_[1]+2763975236&4294967295,y=T+(I<<4&4294967295|I>>>28),I=S+(y^T^b)+_[4]+1272893353&4294967295,S=y+(I<<11&4294967295|I>>>21),I=b+(S^y^T)+_[7]+4139469664&4294967295,b=S+(I<<16&4294967295|I>>>16),I=T+(b^S^y)+_[10]+3200236656&4294967295,T=b+(I<<23&4294967295|I>>>9),I=y+(T^b^S)+_[13]+681279174&4294967295,y=T+(I<<4&4294967295|I>>>28),I=S+(y^T^b)+_[0]+3936430074&4294967295,S=y+(I<<11&4294967295|I>>>21),I=b+(S^y^T)+_[3]+3572445317&4294967295,b=S+(I<<16&4294967295|I>>>16),I=T+(b^S^y)+_[6]+76029189&4294967295,T=b+(I<<23&4294967295|I>>>9),I=y+(T^b^S)+_[9]+3654602809&4294967295,y=T+(I<<4&4294967295|I>>>28),I=S+(y^T^b)+_[12]+3873151461&4294967295,S=y+(I<<11&4294967295|I>>>21),I=b+(S^y^T)+_[15]+530742520&4294967295,b=S+(I<<16&4294967295|I>>>16),I=T+(b^S^y)+_[2]+3299628645&4294967295,T=b+(I<<23&4294967295|I>>>9),I=y+(b^(T|~S))+_[0]+4096336452&4294967295,y=T+(I<<6&4294967295|I>>>26),I=S+(T^(y|~b))+_[7]+1126891415&4294967295,S=y+(I<<10&4294967295|I>>>22),I=b+(y^(S|~T))+_[14]+2878612391&4294967295,b=S+(I<<15&4294967295|I>>>17),I=T+(S^(b|~y))+_[5]+4237533241&4294967295,T=b+(I<<21&4294967295|I>>>11),I=y+(b^(T|~S))+_[12]+1700485571&4294967295,y=T+(I<<6&4294967295|I>>>26),I=S+(T^(y|~b))+_[3]+2399980690&4294967295,S=y+(I<<10&4294967295|I>>>22),I=b+(y^(S|~T))+_[10]+4293915773&4294967295,b=S+(I<<15&4294967295|I>>>17),I=T+(S^(b|~y))+_[1]+2240044497&4294967295,T=b+(I<<21&4294967295|I>>>11),I=y+(b^(T|~S))+_[8]+1873313359&4294967295,y=T+(I<<6&4294967295|I>>>26),I=S+(T^(y|~b))+_[15]+4264355552&4294967295,S=y+(I<<10&4294967295|I>>>22),I=b+(y^(S|~T))+_[6]+2734768916&4294967295,b=S+(I<<15&4294967295|I>>>17),I=T+(S^(b|~y))+_[13]+1309151649&4294967295,T=b+(I<<21&4294967295|I>>>11),I=y+(b^(T|~S))+_[4]+4149444226&4294967295,y=T+(I<<6&4294967295|I>>>26),I=S+(T^(y|~b))+_[11]+3174756917&4294967295,S=y+(I<<10&4294967295|I>>>22),I=b+(y^(S|~T))+_[2]+718787259&4294967295,b=S+(I<<15&4294967295|I>>>17),I=T+(S^(b|~y))+_[9]+3951481745&4294967295,A.g[0]=A.g[0]+y&4294967295,A.g[1]=A.g[1]+(b+(I<<21&4294967295|I>>>11))&4294967295,A.g[2]=A.g[2]+b&4294967295,A.g[3]=A.g[3]+S&4294967295}r.prototype.u=function(A,y){y===void 0&&(y=A.length);for(var T=y-this.blockSize,_=this.B,b=this.h,S=0;S<y;){if(b==0)for(;S<=T;)i(this,A,S),S+=this.blockSize;if(typeof A=="string"){for(;S<y;)if(_[b++]=A.charCodeAt(S++),b==this.blockSize){i(this,_),b=0;break}}else for(;S<y;)if(_[b++]=A[S++],b==this.blockSize){i(this,_),b=0;break}}this.h=b,this.o+=y},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var y=1;y<A.length-8;++y)A[y]=0;var T=8*this.o;for(y=A.length-8;y<A.length;++y)A[y]=T&255,T/=256;for(this.u(A),A=Array(16),y=T=0;4>y;++y)for(var _=0;32>_;_+=8)A[T++]=this.g[y]>>>_&255;return A};function s(A,y){var T=l;return Object.prototype.hasOwnProperty.call(T,A)?T[A]:T[A]=y(A)}function a(A,y){this.h=y;for(var T=[],_=!0,b=A.length-1;0<=b;b--){var S=A[b]|0;_&&S==y||(T[b]=S,_=!1)}this.g=T}var l={};function d(A){return-128<=A&&128>A?s(A,function(y){return new a([y|0],0>y?-1:0)}):new a([A|0],0>A?-1:0)}function m(A){if(isNaN(A)||!isFinite(A))return C;if(0>A)return N(m(-A));for(var y=[],T=1,_=0;A>=T;_++)y[_]=A/T|0,T*=4294967296;return new a(y,0)}function g(A,y){if(A.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(A.charAt(0)=="-")return N(g(A.substring(1),y));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=m(Math.pow(y,8)),_=C,b=0;b<A.length;b+=8){var S=Math.min(8,A.length-b),I=parseInt(A.substring(b,b+S),y);8>S?(S=m(Math.pow(y,S)),_=_.j(S).add(m(I))):(_=_.j(T),_=_.add(m(I)))}return _}var C=d(0),k=d(1),E=d(16777216);n=a.prototype,n.m=function(){if(V(this))return-N(this).m();for(var A=0,y=1,T=0;T<this.g.length;T++){var _=this.i(T);A+=(0<=_?_:4294967296+_)*y,y*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(P(this))return"0";if(V(this))return"-"+N(this).toString(A);for(var y=m(Math.pow(A,6)),T=this,_="";;){var b=O(T,y).g;T=$(T,b.j(y));var S=((0<T.g.length?T.g[0]:T.h)>>>0).toString(A);if(T=b,P(T))return S+_;for(;6>S.length;)S="0"+S;_=S+_}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function P(A){if(A.h!=0)return!1;for(var y=0;y<A.g.length;y++)if(A.g[y]!=0)return!1;return!0}function V(A){return A.h==-1}n.l=function(A){return A=$(this,A),V(A)?-1:P(A)?0:1};function N(A){for(var y=A.g.length,T=[],_=0;_<y;_++)T[_]=~A.g[_];return new a(T,~A.h).add(k)}n.abs=function(){return V(this)?N(this):this},n.add=function(A){for(var y=Math.max(this.g.length,A.g.length),T=[],_=0,b=0;b<=y;b++){var S=_+(this.i(b)&65535)+(A.i(b)&65535),I=(S>>>16)+(this.i(b)>>>16)+(A.i(b)>>>16);_=I>>>16,S&=65535,I&=65535,T[b]=I<<16|S}return new a(T,T[T.length-1]&-2147483648?-1:0)};function $(A,y){return A.add(N(y))}n.j=function(A){if(P(this)||P(A))return C;if(V(this))return V(A)?N(this).j(N(A)):N(N(this).j(A));if(V(A))return N(this.j(N(A)));if(0>this.l(E)&&0>A.l(E))return m(this.m()*A.m());for(var y=this.g.length+A.g.length,T=[],_=0;_<2*y;_++)T[_]=0;for(_=0;_<this.g.length;_++)for(var b=0;b<A.g.length;b++){var S=this.i(_)>>>16,I=this.i(_)&65535,Y=A.i(b)>>>16,ae=A.i(b)&65535;T[2*_+2*b]+=I*ae,q(T,2*_+2*b),T[2*_+2*b+1]+=S*ae,q(T,2*_+2*b+1),T[2*_+2*b+1]+=I*Y,q(T,2*_+2*b+1),T[2*_+2*b+2]+=S*Y,q(T,2*_+2*b+2)}for(_=0;_<y;_++)T[_]=T[2*_+1]<<16|T[2*_];for(_=y;_<2*y;_++)T[_]=0;return new a(T,0)};function q(A,y){for(;(A[y]&65535)!=A[y];)A[y+1]+=A[y]>>>16,A[y]&=65535,y++}function G(A,y){this.g=A,this.h=y}function O(A,y){if(P(y))throw Error("division by zero");if(P(A))return new G(C,C);if(V(A))return y=O(N(A),y),new G(N(y.g),N(y.h));if(V(y))return y=O(A,N(y)),new G(N(y.g),y.h);if(30<A.g.length){if(V(A)||V(y))throw Error("slowDivide_ only works with positive integers.");for(var T=k,_=y;0>=_.l(A);)T=L(T),_=L(_);var b=U(T,1),S=U(_,1);for(_=U(_,2),T=U(T,2);!P(_);){var I=S.add(_);0>=I.l(A)&&(b=b.add(T),S=I),_=U(_,1),T=U(T,1)}return y=$(A,b.j(y)),new G(b,y)}for(b=C;0<=A.l(y);){for(T=Math.max(1,Math.floor(A.m()/y.m())),_=Math.ceil(Math.log(T)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),S=m(T),I=S.j(y);V(I)||0<I.l(A);)T-=_,S=m(T),I=S.j(y);P(S)&&(S=k),b=b.add(S),A=$(A,I)}return new G(b,A)}n.A=function(A){return O(this,A).h},n.and=function(A){for(var y=Math.max(this.g.length,A.g.length),T=[],_=0;_<y;_++)T[_]=this.i(_)&A.i(_);return new a(T,this.h&A.h)},n.or=function(A){for(var y=Math.max(this.g.length,A.g.length),T=[],_=0;_<y;_++)T[_]=this.i(_)|A.i(_);return new a(T,this.h|A.h)},n.xor=function(A){for(var y=Math.max(this.g.length,A.g.length),T=[],_=0;_<y;_++)T[_]=this.i(_)^A.i(_);return new a(T,this.h^A.h)};function L(A){for(var y=A.g.length+1,T=[],_=0;_<y;_++)T[_]=A.i(_)<<1|A.i(_-1)>>>31;return new a(T,A.h)}function U(A,y){var T=y>>5;y%=32;for(var _=A.g.length-T,b=[],S=0;S<_;S++)b[S]=0<y?A.i(S+T)>>>y|A.i(S+T+1)<<32-y:A.i(S+T);return new a(b,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ku=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=m,a.fromString=g,qt=a}).apply(typeof Ml<"u"?Ml:typeof self<"u"?self:typeof window<"u"?window:{});var pi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ru,_r,Pu,Ri,uo,xu,Du,Vu;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,f){return o==Array.prototype||o==Object.prototype||(o[c]=f.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof pi=="object"&&pi];for(var c=0;c<o.length;++c){var f=o[c];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function i(o,c){if(c)e:{var f=r;o=o.split(".");for(var v=0;v<o.length-1;v++){var x=o[v];if(!(x in f))break e;f=f[x]}o=o[o.length-1],v=f[o],c=c(v),c!=v&&c!=null&&e(f,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var f=0,v=!1,x={next:function(){if(!v&&f<o.length){var B=f++;return{value:c(B,o[B]),done:!1}}return v=!0,{done:!0,value:void 0}}};return x[Symbol.iterator]=function(){return x},x}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,f){return f})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function d(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function m(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function g(o,c,f){return o.call.apply(o.bind,arguments)}function C(o,c,f){if(!o)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var x=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(x,v),o.apply(c,x)}}return function(){return o.apply(c,arguments)}}function k(o,c,f){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:C,k.apply(null,arguments)}function E(o,c){var f=Array.prototype.slice.call(arguments,1);return function(){var v=f.slice();return v.push.apply(v,arguments),o.apply(this,v)}}function P(o,c){function f(){}f.prototype=c.prototype,o.aa=c.prototype,o.prototype=new f,o.prototype.constructor=o,o.Qb=function(v,x,B){for(var z=Array(arguments.length-2),pe=2;pe<arguments.length;pe++)z[pe-2]=arguments[pe];return c.prototype[x].apply(v,z)}}function V(o){const c=o.length;if(0<c){const f=Array(c);for(let v=0;v<c;v++)f[v]=o[v];return f}return[]}function N(o,c){for(let f=1;f<arguments.length;f++){const v=arguments[f];if(d(v)){const x=o.length||0,B=v.length||0;o.length=x+B;for(let z=0;z<B;z++)o[x+z]=v[z]}else o.push(v)}}class ${constructor(c,f){this.i=c,this.j=f,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function q(o){return/^[\s\xa0]*$/.test(o)}function G(){var o=l.navigator;return o&&(o=o.userAgent)?o:""}function O(o){return O[" "](o),o}O[" "]=function(){};var L=G().indexOf("Gecko")!=-1&&!(G().toLowerCase().indexOf("webkit")!=-1&&G().indexOf("Edge")==-1)&&!(G().indexOf("Trident")!=-1||G().indexOf("MSIE")!=-1)&&G().indexOf("Edge")==-1;function U(o,c,f){for(const v in o)c.call(f,o[v],v,o)}function A(o,c){for(const f in o)c.call(void 0,o[f],f,o)}function y(o){const c={};for(const f in o)c[f]=o[f];return c}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(o,c){let f,v;for(let x=1;x<arguments.length;x++){v=arguments[x];for(f in v)o[f]=v[f];for(let B=0;B<T.length;B++)f=T[B],Object.prototype.hasOwnProperty.call(v,f)&&(o[f]=v[f])}}function b(o){var c=1;o=o.split(":");const f=[];for(;0<c&&o.length;)f.push(o.shift()),c--;return o.length&&f.push(o.join(":")),f}function S(o){l.setTimeout(()=>{throw o},0)}function I(){var o=He;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class Y{constructor(){this.h=this.g=null}add(c,f){const v=ae.get();v.set(c,f),this.h?this.h.next=v:this.g=v,this.h=v}}var ae=new $(()=>new Ie,o=>o.reset());class Ie{constructor(){this.next=this.g=this.h=null}set(c,f){this.h=c,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let Ee,Ae=!1,He=new Y,ct=()=>{const o=l.Promise.resolve(void 0);Ee=()=>{o.then(ue)}};var ue=()=>{for(var o;o=I();){try{o.h.call(o.g)}catch(f){S(f)}var c=ae;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}Ae=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ge(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}ge.prototype.h=function(){this.defaultPrevented=!0};var ke=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const f=()=>{};l.addEventListener("test",f,c),l.removeEventListener("test",f,c)}catch{}return o}();function Me(o,c){if(ge.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var f=this.type=o.type,v=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(L){e:{try{O(c.nodeName);var x=!0;break e}catch{}x=!1}x||(c=null)}}else f=="mouseover"?c=o.fromElement:f=="mouseout"&&(c=o.toElement);this.relatedTarget=c,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:ut[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Me.aa.h.call(this)}}P(Me,ge);var ut={2:"touch",3:"pen",4:"mouse"};Me.prototype.h=function(){Me.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Xe="closure_listenable_"+(1e6*Math.random()|0),Oe=0;function te(o,c,f,v,x){this.listener=o,this.proxy=null,this.src=c,this.type=f,this.capture=!!v,this.ha=x,this.key=++Oe,this.da=this.fa=!1}function Q(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function J(o){this.src=o,this.g={},this.h=0}J.prototype.add=function(o,c,f,v,x){var B=o.toString();o=this.g[B],o||(o=this.g[B]=[],this.h++);var z=de(o,c,v,x);return-1<z?(c=o[z],f||(c.fa=!1)):(c=new te(c,this.src,B,!!v,x),c.fa=f,o.push(c)),c};function re(o,c){var f=c.type;if(f in o.g){var v=o.g[f],x=Array.prototype.indexOf.call(v,c,void 0),B;(B=0<=x)&&Array.prototype.splice.call(v,x,1),B&&(Q(c),o.g[f].length==0&&(delete o.g[f],o.h--))}}function de(o,c,f,v){for(var x=0;x<o.length;++x){var B=o[x];if(!B.da&&B.listener==c&&B.capture==!!f&&B.ha==v)return x}return-1}var Pe="closure_lm_"+(1e6*Math.random()|0),je={};function ze(o,c,f,v,x){if(Array.isArray(c)){for(var B=0;B<c.length;B++)ze(o,c[B],f,v,x);return null}return f=dt(f),o&&o[Xe]?o.K(c,f,m(v)?!!v.capture:!1,x):ht(o,c,f,!1,v,x)}function ht(o,c,f,v,x,B){if(!c)throw Error("Invalid event type");var z=m(x)?!!x.capture:!!x,pe=en(o);if(pe||(o[Pe]=pe=new J(o)),f=pe.add(c,f,v,z,B),f.proxy)return f;if(v=pt(),f.proxy=v,v.src=o,v.listener=f,o.addEventListener)ke||(x=z),x===void 0&&(x=!1),o.addEventListener(c.toString(),v,x);else if(o.attachEvent)o.attachEvent(At(c.toString()),v);else if(o.addListener&&o.removeListener)o.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return f}function pt(){function o(f){return c.call(o.src,o.listener,f)}const c=st;return o}function wn(o,c,f,v,x){if(Array.isArray(c))for(var B=0;B<c.length;B++)wn(o,c[B],f,v,x);else v=m(v)?!!v.capture:!!v,f=dt(f),o&&o[Xe]?(o=o.i,c=String(c).toString(),c in o.g&&(B=o.g[c],f=de(B,f,v,x),-1<f&&(Q(B[f]),Array.prototype.splice.call(B,f,1),B.length==0&&(delete o.g[c],o.h--)))):o&&(o=en(o))&&(c=o.g[c.toString()],o=-1,c&&(o=de(c,f,v,x)),(f=-1<o?c[o]:null)&&gt(f))}function gt(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Xe])re(c.i,o);else{var f=o.type,v=o.proxy;c.removeEventListener?c.removeEventListener(f,v,o.capture):c.detachEvent?c.detachEvent(At(f),v):c.addListener&&c.removeListener&&c.removeListener(v),(f=en(c))?(re(f,o),f.h==0&&(f.src=null,c[Pe]=null)):Q(o)}}}function At(o){return o in je?je[o]:je[o]="on"+o}function st(o,c){if(o.da)o=!0;else{c=new Me(c,this);var f=o.listener,v=o.ha||o.src;o.fa&&gt(o),o=f.call(v,c)}return o}function en(o){return o=o[Pe],o instanceof J?o:null}var rr="__closure_events_fn_"+(1e9*Math.random()>>>0);function dt(o){return typeof o=="function"?o:(o[rr]||(o[rr]=function(c){return o.handleEvent(c)}),o[rr])}function $e(){Z.call(this),this.i=new J(this),this.M=this,this.F=null}P($e,Z),$e.prototype[Xe]=!0,$e.prototype.removeEventListener=function(o,c,f,v){wn(this,o,c,f,v)};function p(o,c){var f,v=o.F;if(v)for(f=[];v;v=v.F)f.push(v);if(o=o.M,v=c.type||c,typeof c=="string")c=new ge(c,o);else if(c instanceof ge)c.target=c.target||o;else{var x=c;c=new ge(v,o),_(c,x)}if(x=!0,f)for(var B=f.length-1;0<=B;B--){var z=c.g=f[B];x=u(z,v,!0,c)&&x}if(z=c.g=o,x=u(z,v,!0,c)&&x,x=u(z,v,!1,c)&&x,f)for(B=0;B<f.length;B++)z=c.g=f[B],x=u(z,v,!1,c)&&x}$e.prototype.N=function(){if($e.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var f=o.g[c],v=0;v<f.length;v++)Q(f[v]);delete o.g[c],o.h--}}this.F=null},$e.prototype.K=function(o,c,f,v){return this.i.add(String(o),c,!1,f,v)},$e.prototype.L=function(o,c,f,v){return this.i.add(String(o),c,!0,f,v)};function u(o,c,f,v){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var x=!0,B=0;B<c.length;++B){var z=c[B];if(z&&!z.da&&z.capture==f){var pe=z.listener,Ge=z.ha||z.src;z.fa&&re(o.i,z),x=pe.call(Ge,v)!==!1&&x}}return x&&!v.defaultPrevented}function h(o,c,f){if(typeof o=="function")f&&(o=k(o,f));else if(o&&typeof o.handleEvent=="function")o=k(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:l.setTimeout(o,c||0)}function w(o){o.g=h(()=>{o.g=null,o.i&&(o.i=!1,w(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class R extends Z{constructor(c,f){super(),this.m=c,this.l=f,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:w(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function D(o){Z.call(this),this.h=o,this.g={}}P(D,Z);var M=[];function ie(o){U(o.g,function(c,f){this.g.hasOwnProperty(f)&&gt(c)},o),o.g={}}D.prototype.N=function(){D.aa.N.call(this),ie(this)},D.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ye=l.JSON.stringify,_e=l.JSON.parse,Ce=class{stringify(o){return l.JSON.stringify(o,void 0)}parse(o){return l.JSON.parse(o,void 0)}};function fe(){}fe.prototype.h=null;function Va(o){return o.h||(o.h=o.i())}function Ba(){}var ir={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ks(){ge.call(this,"d")}P(ks,ge);function Rs(){ge.call(this,"c")}P(Rs,ge);var tn={},Na=null;function ei(){return Na=Na||new $e}tn.La="serverreachability";function La(o){ge.call(this,tn.La,o)}P(La,ge);function sr(o){const c=ei();p(c,new La(c))}tn.STAT_EVENT="statevent";function Ma(o,c){ge.call(this,tn.STAT_EVENT,o),this.stat=c}P(Ma,ge);function nt(o){const c=ei();p(c,new Ma(c,o))}tn.Ma="timingevent";function Oa(o,c){ge.call(this,tn.Ma,o),this.size=c}P(Oa,ge);function or(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){o()},c)}function ar(){this.g=!0}ar.prototype.xa=function(){this.g=!1};function Td(o,c,f,v,x,B){o.info(function(){if(o.g)if(B)for(var z="",pe=B.split("&"),Ge=0;Ge<pe.length;Ge++){var he=pe[Ge].split("=");if(1<he.length){var Ye=he[0];he=he[1];var Je=Ye.split("_");z=2<=Je.length&&Je[1]=="type"?z+(Ye+"="+he+"&"):z+(Ye+"=redacted&")}}else z=null;else z=B;return"XMLHTTP REQ ("+v+") [attempt "+x+"]: "+c+`
`+f+`
`+z})}function wd(o,c,f,v,x,B,z){o.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+x+"]: "+c+`
`+f+`
`+B+" "+z})}function bn(o,c,f,v){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Id(o,f)+(v?" "+v:"")})}function bd(o,c){o.info(function(){return"TIMEOUT: "+c})}ar.prototype.info=function(){};function Id(o,c){if(!o.g)return c;if(!c)return null;try{var f=JSON.parse(c);if(f){for(o=0;o<f.length;o++)if(Array.isArray(f[o])){var v=f[o];if(!(2>v.length)){var x=v[1];if(Array.isArray(x)&&!(1>x.length)){var B=x[0];if(B!="noop"&&B!="stop"&&B!="close")for(var z=1;z<x.length;z++)x[z]=""}}}}return ye(f)}catch{return c}}var ti={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Fa={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ps;function ni(){}P(ni,fe),ni.prototype.g=function(){return new XMLHttpRequest},ni.prototype.i=function(){return{}},Ps=new ni;function Dt(o,c,f,v){this.j=o,this.i=c,this.l=f,this.R=v||1,this.U=new D(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ua}function Ua(){this.i=null,this.g="",this.h=!1}var ja={},xs={};function Ds(o,c,f){o.L=1,o.v=oi(Ct(c)),o.m=f,o.P=!0,za(o,null)}function za(o,c){o.F=Date.now(),ri(o),o.A=Ct(o.v);var f=o.A,v=o.R;Array.isArray(v)||(v=[String(v)]),nl(f.i,"t",v),o.C=0,f=o.j.J,o.h=new Ua,o.g=El(o.j,f?c:null,!o.m),0<o.O&&(o.M=new R(k(o.Y,o,o.g),o.O)),c=o.U,f=o.g,v=o.ca;var x="readystatechange";Array.isArray(x)||(x&&(M[0]=x.toString()),x=M);for(var B=0;B<x.length;B++){var z=ze(f,x[B],v||c.handleEvent,!1,c.h||c);if(!z)break;c.g[z.key]=z}c=o.H?y(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),sr(),Td(o.i,o.u,o.A,o.l,o.R,o.m)}Dt.prototype.ca=function(o){o=o.target;const c=this.M;c&&St(o)==3?c.j():this.Y(o)},Dt.prototype.Y=function(o){try{if(o==this.g)e:{const Je=St(this.g);var c=this.g.Ba();const Cn=this.g.Z();if(!(3>Je)&&(Je!=3||this.g&&(this.h.h||this.g.oa()||cl(this.g)))){this.J||Je!=4||c==7||(c==8||0>=Cn?sr(3):sr(2)),Vs(this);var f=this.g.Z();this.X=f;t:if($a(this)){var v=cl(this.g);o="";var x=v.length,B=St(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){nn(this),lr(this);var z="";break t}this.h.i=new l.TextDecoder}for(c=0;c<x;c++)this.h.h=!0,o+=this.h.i.decode(v[c],{stream:!(B&&c==x-1)});v.length=0,this.h.g+=o,this.C=0,z=this.h.g}else z=this.g.oa();if(this.o=f==200,wd(this.i,this.u,this.A,this.l,this.R,Je,f),this.o){if(this.T&&!this.K){t:{if(this.g){var pe,Ge=this.g;if((pe=Ge.g?Ge.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(pe)){var he=pe;break t}}he=null}if(f=he)bn(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Bs(this,f);else{this.o=!1,this.s=3,nt(12),nn(this),lr(this);break e}}if(this.P){f=!0;let ft;for(;!this.J&&this.C<z.length;)if(ft=Ad(this,z),ft==xs){Je==4&&(this.s=4,nt(14),f=!1),bn(this.i,this.l,null,"[Incomplete Response]");break}else if(ft==ja){this.s=4,nt(15),bn(this.i,this.l,z,"[Invalid Chunk]"),f=!1;break}else bn(this.i,this.l,ft,null),Bs(this,ft);if($a(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Je!=4||z.length!=0||this.h.h||(this.s=1,nt(16),f=!1),this.o=this.o&&f,!f)bn(this.i,this.l,z,"[Invalid Chunked Response]"),nn(this),lr(this);else if(0<z.length&&!this.W){this.W=!0;var Ye=this.j;Ye.g==this&&Ye.ba&&!Ye.M&&(Ye.j.info("Great, no buffering proxy detected. Bytes received: "+z.length),Us(Ye),Ye.M=!0,nt(11))}}else bn(this.i,this.l,z,null),Bs(this,z);Je==4&&nn(this),this.o&&!this.J&&(Je==4?gl(this.j,this):(this.o=!1,ri(this)))}else zd(this.g),f==400&&0<z.indexOf("Unknown SID")?(this.s=3,nt(12)):(this.s=0,nt(13)),nn(this),lr(this)}}}catch{}finally{}};function $a(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Ad(o,c){var f=o.C,v=c.indexOf(`
`,f);return v==-1?xs:(f=Number(c.substring(f,v)),isNaN(f)?ja:(v+=1,v+f>c.length?xs:(c=c.slice(v,v+f),o.C=v+f,c)))}Dt.prototype.cancel=function(){this.J=!0,nn(this)};function ri(o){o.S=Date.now()+o.I,qa(o,o.I)}function qa(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=or(k(o.ba,o),c)}function Vs(o){o.B&&(l.clearTimeout(o.B),o.B=null)}Dt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(bd(this.i,this.A),this.L!=2&&(sr(),nt(17)),nn(this),this.s=2,lr(this)):qa(this,this.S-o)};function lr(o){o.j.G==0||o.J||gl(o.j,o)}function nn(o){Vs(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,ie(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function Bs(o,c){try{var f=o.j;if(f.G!=0&&(f.g==o||Ns(f.h,o))){if(!o.K&&Ns(f.h,o)&&f.G==3){try{var v=f.Da.g.parse(c)}catch{v=null}if(Array.isArray(v)&&v.length==3){var x=v;if(x[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<o.F)di(f),ui(f);else break e;Fs(f),nt(18)}}else f.za=x[1],0<f.za-f.T&&37500>x[2]&&f.F&&f.v==0&&!f.C&&(f.C=or(k(f.Za,f),6e3));if(1>=Wa(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else sn(f,11)}else if((o.K||f.g==o)&&di(f),!q(c))for(x=f.Da.g.parse(c),c=0;c<x.length;c++){let he=x[c];if(f.T=he[0],he=he[1],f.G==2)if(he[0]=="c"){f.K=he[1],f.ia=he[2];const Ye=he[3];Ye!=null&&(f.la=Ye,f.j.info("VER="+f.la));const Je=he[4];Je!=null&&(f.Aa=Je,f.j.info("SVER="+f.Aa));const Cn=he[5];Cn!=null&&typeof Cn=="number"&&0<Cn&&(v=1.5*Cn,f.L=v,f.j.info("backChannelRequestTimeoutMs_="+v)),v=f;const ft=o.g;if(ft){const mi=ft.g?ft.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(mi){var B=v.h;B.g||mi.indexOf("spdy")==-1&&mi.indexOf("quic")==-1&&mi.indexOf("h2")==-1||(B.j=B.l,B.g=new Set,B.h&&(Ls(B,B.h),B.h=null))}if(v.D){const js=ft.g?ft.g.getResponseHeader("X-HTTP-Session-Id"):null;js&&(v.ya=js,Te(v.I,v.D,js))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-o.F,f.j.info("Handshake RTT: "+f.R+"ms")),v=f;var z=o;if(v.qa=vl(v,v.J?v.ia:null,v.W),z.K){Ka(v.h,z);var pe=z,Ge=v.L;Ge&&(pe.I=Ge),pe.B&&(Vs(pe),ri(pe)),v.g=z}else ml(v);0<f.i.length&&hi(f)}else he[0]!="stop"&&he[0]!="close"||sn(f,7);else f.G==3&&(he[0]=="stop"||he[0]=="close"?he[0]=="stop"?sn(f,7):Os(f):he[0]!="noop"&&f.l&&f.l.ta(he),f.v=0)}}sr(4)}catch{}}var Cd=class{constructor(o,c){this.g=o,this.map=c}};function Ha(o){this.l=o||10,l.PerformanceNavigationTiming?(o=l.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ga(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Wa(o){return o.h?1:o.g?o.g.size:0}function Ns(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Ls(o,c){o.g?o.g.add(c):o.h=c}function Ka(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}Ha.prototype.cancel=function(){if(this.i=Qa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Qa(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const f of o.g.values())c=c.concat(f.D);return c}return V(o.i)}function Sd(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(d(o)){for(var c=[],f=o.length,v=0;v<f;v++)c.push(o[v]);return c}c=[],f=0;for(v in o)c[f++]=o[v];return c}function kd(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(d(o)||typeof o=="string"){var c=[];o=o.length;for(var f=0;f<o;f++)c.push(f);return c}c=[],f=0;for(const v in o)c[f++]=v;return c}}}function Xa(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(d(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var f=kd(o),v=Sd(o),x=v.length,B=0;B<x;B++)c.call(void 0,v[B],f&&f[B],o)}var Ya=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Rd(o,c){if(o){o=o.split("&");for(var f=0;f<o.length;f++){var v=o[f].indexOf("="),x=null;if(0<=v){var B=o[f].substring(0,v);x=o[f].substring(v+1)}else B=o[f];c(B,x?decodeURIComponent(x.replace(/\+/g," ")):"")}}}function rn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof rn){this.h=o.h,ii(this,o.j),this.o=o.o,this.g=o.g,si(this,o.s),this.l=o.l;var c=o.i,f=new hr;f.i=c.i,c.g&&(f.g=new Map(c.g),f.h=c.h),Ja(this,f),this.m=o.m}else o&&(c=String(o).match(Ya))?(this.h=!1,ii(this,c[1]||"",!0),this.o=cr(c[2]||""),this.g=cr(c[3]||"",!0),si(this,c[4]),this.l=cr(c[5]||"",!0),Ja(this,c[6]||"",!0),this.m=cr(c[7]||"")):(this.h=!1,this.i=new hr(null,this.h))}rn.prototype.toString=function(){var o=[],c=this.j;c&&o.push(ur(c,Za,!0),":");var f=this.g;return(f||c=="file")&&(o.push("//"),(c=this.o)&&o.push(ur(c,Za,!0),"@"),o.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&o.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&o.push("/"),o.push(ur(f,f.charAt(0)=="/"?Dd:xd,!0))),(f=this.i.toString())&&o.push("?",f),(f=this.m)&&o.push("#",ur(f,Bd)),o.join("")};function Ct(o){return new rn(o)}function ii(o,c,f){o.j=f?cr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function si(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Ja(o,c,f){c instanceof hr?(o.i=c,Nd(o.i,o.h)):(f||(c=ur(c,Vd)),o.i=new hr(c,o.h))}function Te(o,c,f){o.i.set(c,f)}function oi(o){return Te(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function cr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function ur(o,c,f){return typeof o=="string"?(o=encodeURI(o).replace(c,Pd),f&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Pd(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Za=/[#\/\?@]/g,xd=/[#\?:]/g,Dd=/[#\?]/g,Vd=/[#\?@]/g,Bd=/#/g;function hr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Vt(o){o.g||(o.g=new Map,o.h=0,o.i&&Rd(o.i,function(c,f){o.add(decodeURIComponent(c.replace(/\+/g," ")),f)}))}n=hr.prototype,n.add=function(o,c){Vt(this),this.i=null,o=In(this,o);var f=this.g.get(o);return f||this.g.set(o,f=[]),f.push(c),this.h+=1,this};function el(o,c){Vt(o),c=In(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function tl(o,c){return Vt(o),c=In(o,c),o.g.has(c)}n.forEach=function(o,c){Vt(this),this.g.forEach(function(f,v){f.forEach(function(x){o.call(c,x,v,this)},this)},this)},n.na=function(){Vt(this);const o=Array.from(this.g.values()),c=Array.from(this.g.keys()),f=[];for(let v=0;v<c.length;v++){const x=o[v];for(let B=0;B<x.length;B++)f.push(c[v])}return f},n.V=function(o){Vt(this);let c=[];if(typeof o=="string")tl(this,o)&&(c=c.concat(this.g.get(In(this,o))));else{o=Array.from(this.g.values());for(let f=0;f<o.length;f++)c=c.concat(o[f])}return c},n.set=function(o,c){return Vt(this),this.i=null,o=In(this,o),tl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function nl(o,c,f){el(o,c),0<f.length&&(o.i=null,o.g.set(In(o,c),V(f)),o.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(var f=0;f<c.length;f++){var v=c[f];const B=encodeURIComponent(String(v)),z=this.V(v);for(v=0;v<z.length;v++){var x=B;z[v]!==""&&(x+="="+encodeURIComponent(String(z[v]))),o.push(x)}}return this.i=o.join("&")};function In(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Nd(o,c){c&&!o.j&&(Vt(o),o.i=null,o.g.forEach(function(f,v){var x=v.toLowerCase();v!=x&&(el(this,v),nl(this,x,f))},o)),o.j=c}function Ld(o,c){const f=new ar;if(l.Image){const v=new Image;v.onload=E(Bt,f,"TestLoadImage: loaded",!0,c,v),v.onerror=E(Bt,f,"TestLoadImage: error",!1,c,v),v.onabort=E(Bt,f,"TestLoadImage: abort",!1,c,v),v.ontimeout=E(Bt,f,"TestLoadImage: timeout",!1,c,v),l.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=o}else c(!1)}function Md(o,c){const f=new ar,v=new AbortController,x=setTimeout(()=>{v.abort(),Bt(f,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:v.signal}).then(B=>{clearTimeout(x),B.ok?Bt(f,"TestPingServer: ok",!0,c):Bt(f,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(x),Bt(f,"TestPingServer: error",!1,c)})}function Bt(o,c,f,v,x){try{x&&(x.onload=null,x.onerror=null,x.onabort=null,x.ontimeout=null),v(f)}catch{}}function Od(){this.g=new Ce}function Fd(o,c,f){const v=f||"";try{Xa(o,function(x,B){let z=x;m(x)&&(z=ye(x)),c.push(v+B+"="+encodeURIComponent(z))})}catch(x){throw c.push(v+"type="+encodeURIComponent("_badmap")),x}}function ai(o){this.l=o.Ub||null,this.j=o.eb||!1}P(ai,fe),ai.prototype.g=function(){return new li(this.l,this.j)},ai.prototype.i=function(o){return function(){return o}}({});function li(o,c){$e.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}P(li,$e),n=li.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,fr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||l).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,dr(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,fr(this)),this.g&&(this.readyState=3,fr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;rl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function rl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?dr(this):fr(this),this.readyState==3&&rl(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,dr(this))},n.Qa=function(o){this.g&&(this.response=o,dr(this))},n.ga=function(){this.g&&dr(this)};function dr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,fr(o)}n.setRequestHeader=function(o,c){this.u.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var f=c.next();!f.done;)f=f.value,o.push(f[0]+": "+f[1]),f=c.next();return o.join(`\r
`)};function fr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(li.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function il(o){let c="";return U(o,function(f,v){c+=v,c+=":",c+=f,c+=`\r
`}),c}function Ms(o,c,f){e:{for(v in f){var v=!1;break e}v=!0}v||(f=il(f),typeof o=="string"?f!=null&&encodeURIComponent(String(f)):Te(o,c,f))}function xe(o){$e.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}P(xe,$e);var Ud=/^https?$/i,jd=["POST","PUT"];n=xe.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,c,f,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ps.g(),this.v=this.o?Va(this.o):Va(Ps),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(B){sl(this,B);return}if(o=f||"",f=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var x in v)f.set(x,v[x]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const B of v.keys())f.set(B,v.get(B));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(f.keys()).find(B=>B.toLowerCase()=="content-type"),x=l.FormData&&o instanceof l.FormData,!(0<=Array.prototype.indexOf.call(jd,c,void 0))||v||x||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[B,z]of f)this.g.setRequestHeader(B,z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ll(this),this.u=!0,this.g.send(o),this.u=!1}catch(B){sl(this,B)}};function sl(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,ol(o),ci(o)}function ol(o){o.A||(o.A=!0,p(o,"complete"),p(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,p(this,"complete"),p(this,"abort"),ci(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ci(this,!0)),xe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?al(this):this.bb())},n.bb=function(){al(this)};function al(o){if(o.h&&typeof a<"u"&&(!o.v[1]||St(o)!=4||o.Z()!=2)){if(o.u&&St(o)==4)h(o.Ea,0,o);else if(p(o,"readystatechange"),St(o)==4){o.h=!1;try{const z=o.Z();e:switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var f;if(!(f=c)){var v;if(v=z===0){var x=String(o.D).match(Ya)[1]||null;!x&&l.self&&l.self.location&&(x=l.self.location.protocol.slice(0,-1)),v=!Ud.test(x?x.toLowerCase():"")}f=v}if(f)p(o,"complete"),p(o,"success");else{o.m=6;try{var B=2<St(o)?o.g.statusText:""}catch{B=""}o.l=B+" ["+o.Z()+"]",ol(o)}}finally{ci(o)}}}}function ci(o,c){if(o.g){ll(o);const f=o.g,v=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||p(o,"ready");try{f.onreadystatechange=v}catch{}}}function ll(o){o.I&&(l.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function St(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<St(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),_e(c)}};function cl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function zd(o){const c={};o=(o.g&&2<=St(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<o.length;v++){if(q(o[v]))continue;var f=b(o[v]);const x=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const B=c[x]||[];c[x]=B,B.push(f)}A(c,function(v){return v.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function mr(o,c,f){return f&&f.internalChannelParams&&f.internalChannelParams[o]||c}function ul(o){this.Aa=0,this.i=[],this.j=new ar,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=mr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=mr("baseRetryDelayMs",5e3,o),this.cb=mr("retryDelaySeedMs",1e4,o),this.Wa=mr("forwardChannelMaxRetries",2,o),this.wa=mr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Ha(o&&o.concurrentRequestLimit),this.Da=new Od,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ul.prototype,n.la=8,n.G=1,n.connect=function(o,c,f,v){nt(0),this.W=o,this.H=c||{},f&&v!==void 0&&(this.H.OSID=f,this.H.OAID=v),this.F=this.X,this.I=vl(this,null,this.W),hi(this)};function Os(o){if(hl(o),o.G==3){var c=o.U++,f=Ct(o.I);if(Te(f,"SID",o.K),Te(f,"RID",c),Te(f,"TYPE","terminate"),pr(o,f),c=new Dt(o,o.j,c),c.L=2,c.v=oi(Ct(f)),f=!1,l.navigator&&l.navigator.sendBeacon)try{f=l.navigator.sendBeacon(c.v.toString(),"")}catch{}!f&&l.Image&&(new Image().src=c.v,f=!0),f||(c.g=El(c.j,null),c.g.ea(c.v)),c.F=Date.now(),ri(c)}_l(o)}function ui(o){o.g&&(Us(o),o.g.cancel(),o.g=null)}function hl(o){ui(o),o.u&&(l.clearTimeout(o.u),o.u=null),di(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&l.clearTimeout(o.s),o.s=null)}function hi(o){if(!Ga(o.h)&&!o.s){o.s=!0;var c=o.Ga;Ee||ct(),Ae||(Ee(),Ae=!0),He.add(c,o),o.B=0}}function $d(o,c){return Wa(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=or(k(o.Ga,o,c),yl(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const x=new Dt(this,this.j,o);let B=this.o;if(this.S&&(B?(B=y(B),_(B,this.S)):B=this.S),this.m!==null||this.O||(x.H=B,B=null),this.P)e:{for(var c=0,f=0;f<this.i.length;f++){t:{var v=this.i[f];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(c+=v,4096<c){c=f;break e}if(c===4096||f===this.i.length-1){c=f+1;break e}}c=1e3}else c=1e3;c=fl(this,x,c),f=Ct(this.I),Te(f,"RID",o),Te(f,"CVER",22),this.D&&Te(f,"X-HTTP-Session-Id",this.D),pr(this,f),B&&(this.O?c="headers="+encodeURIComponent(String(il(B)))+"&"+c:this.m&&Ms(f,this.m,B)),Ls(this.h,x),this.Ua&&Te(f,"TYPE","init"),this.P?(Te(f,"$req",c),Te(f,"SID","null"),x.T=!0,Ds(x,f,null)):Ds(x,f,c),this.G=2}}else this.G==3&&(o?dl(this,o):this.i.length==0||Ga(this.h)||dl(this))};function dl(o,c){var f;c?f=c.l:f=o.U++;const v=Ct(o.I);Te(v,"SID",o.K),Te(v,"RID",f),Te(v,"AID",o.T),pr(o,v),o.m&&o.o&&Ms(v,o.m,o.o),f=new Dt(o,o.j,f,o.B+1),o.m===null&&(f.H=o.o),c&&(o.i=c.D.concat(o.i)),c=fl(o,f,1e3),f.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Ls(o.h,f),Ds(f,v,c)}function pr(o,c){o.H&&U(o.H,function(f,v){Te(c,v,f)}),o.l&&Xa({},function(f,v){Te(c,v,f)})}function fl(o,c,f){f=Math.min(o.i.length,f);var v=o.l?k(o.l.Na,o.l,o):null;e:{var x=o.i;let B=-1;for(;;){const z=["count="+f];B==-1?0<f?(B=x[0].g,z.push("ofs="+B)):B=0:z.push("ofs="+B);let pe=!0;for(let Ge=0;Ge<f;Ge++){let he=x[Ge].g;const Ye=x[Ge].map;if(he-=B,0>he)B=Math.max(0,x[Ge].g-100),pe=!1;else try{Fd(Ye,z,"req"+he+"_")}catch{v&&v(Ye)}}if(pe){v=z.join("&");break e}}}return o=o.i.splice(0,f),c.D=o,v}function ml(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Ee||ct(),Ae||(Ee(),Ae=!0),He.add(c,o),o.v=0}}function Fs(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=or(k(o.Fa,o),yl(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,pl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=or(k(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,nt(10),ui(this),pl(this))};function Us(o){o.A!=null&&(l.clearTimeout(o.A),o.A=null)}function pl(o){o.g=new Dt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=Ct(o.qa);Te(c,"RID","rpc"),Te(c,"SID",o.K),Te(c,"AID",o.T),Te(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&Te(c,"TO",o.ja),Te(c,"TYPE","xmlhttp"),pr(o,c),o.m&&o.o&&Ms(c,o.m,o.o),o.L&&(o.g.I=o.L);var f=o.g;o=o.ia,f.L=1,f.v=oi(Ct(c)),f.m=null,f.P=!0,za(f,o)}n.Za=function(){this.C!=null&&(this.C=null,ui(this),Fs(this),nt(19))};function di(o){o.C!=null&&(l.clearTimeout(o.C),o.C=null)}function gl(o,c){var f=null;if(o.g==c){di(o),Us(o),o.g=null;var v=2}else if(Ns(o.h,c))f=c.D,Ka(o.h,c),v=1;else return;if(o.G!=0){if(c.o)if(v==1){f=c.m?c.m.length:0,c=Date.now()-c.F;var x=o.B;v=ei(),p(v,new Oa(v,f)),hi(o)}else ml(o);else if(x=c.s,x==3||x==0&&0<c.X||!(v==1&&$d(o,c)||v==2&&Fs(o)))switch(f&&0<f.length&&(c=o.h,c.i=c.i.concat(f)),x){case 1:sn(o,5);break;case 4:sn(o,10);break;case 3:sn(o,6);break;default:sn(o,2)}}}function yl(o,c){let f=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(f*=2),f*c}function sn(o,c){if(o.j.info("Error code "+c),c==2){var f=k(o.fb,o),v=o.Xa;const x=!v;v=new rn(v||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||ii(v,"https"),oi(v),x?Ld(v.toString(),f):Md(v.toString(),f)}else nt(2);o.G=0,o.l&&o.l.sa(c),_l(o),hl(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),nt(2)):(this.j.info("Failed to ping google.com"),nt(1))};function _l(o){if(o.G=0,o.ka=[],o.l){const c=Qa(o.h);(c.length!=0||o.i.length!=0)&&(N(o.ka,c),N(o.ka,o.i),o.h.i.length=0,V(o.i),o.i.length=0),o.l.ra()}}function vl(o,c,f){var v=f instanceof rn?Ct(f):new rn(f);if(v.g!="")c&&(v.g=c+"."+v.g),si(v,v.s);else{var x=l.location;v=x.protocol,c=c?c+"."+x.hostname:x.hostname,x=+x.port;var B=new rn(null);v&&ii(B,v),c&&(B.g=c),x&&si(B,x),f&&(B.l=f),v=B}return f=o.D,c=o.ya,f&&c&&Te(v,f,c),Te(v,"VER",o.la),pr(o,v),v}function El(o,c,f){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new xe(new ai({eb:f})):new xe(o.pa),c.Ha(o.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Tl(){}n=Tl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function fi(){}fi.prototype.g=function(o,c){return new it(o,c)};function it(o,c){$e.call(this),this.g=new ul(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!q(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!q(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new An(this)}P(it,$e),it.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},it.prototype.close=function(){Os(this.g)},it.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var f={};f.__data__=o,o=f}else this.u&&(f={},f.__data__=ye(o),o=f);c.i.push(new Cd(c.Ya++,o)),c.G==3&&hi(c)},it.prototype.N=function(){this.g.l=null,delete this.j,Os(this.g),delete this.g,it.aa.N.call(this)};function wl(o){ks.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const f in c){o=f;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}P(wl,ks);function bl(){Rs.call(this),this.status=1}P(bl,Rs);function An(o){this.g=o}P(An,Tl),An.prototype.ua=function(){p(this.g,"a")},An.prototype.ta=function(o){p(this.g,new wl(o))},An.prototype.sa=function(o){p(this.g,new bl)},An.prototype.ra=function(){p(this.g,"b")},fi.prototype.createWebChannel=fi.prototype.g,it.prototype.send=it.prototype.o,it.prototype.open=it.prototype.m,it.prototype.close=it.prototype.close,Vu=function(){return new fi},Du=function(){return ei()},xu=tn,uo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ti.NO_ERROR=0,ti.TIMEOUT=8,ti.HTTP_ERROR=6,Ri=ti,Fa.COMPLETE="complete",Pu=Fa,Ba.EventType=ir,ir.OPEN="a",ir.CLOSE="b",ir.ERROR="c",ir.MESSAGE="d",$e.prototype.listen=$e.prototype.K,_r=Ba,xe.prototype.listenOnce=xe.prototype.L,xe.prototype.getLastError=xe.prototype.Ka,xe.prototype.getLastErrorCode=xe.prototype.Ba,xe.prototype.getStatus=xe.prototype.Z,xe.prototype.getResponseJson=xe.prototype.Oa,xe.prototype.getResponseText=xe.prototype.oa,xe.prototype.send=xe.prototype.ea,xe.prototype.setWithCredentials=xe.prototype.Ha,Ru=xe}).apply(typeof pi<"u"?pi:typeof self<"u"?self:typeof window<"u"?window:{});const Ol="@firebase/firestore",Fl="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}et.UNAUTHENTICATED=new et(null),et.GOOGLE_CREDENTIALS=new et("google-credentials-uid"),et.FIRST_PARTY=new et("first-party-uid"),et.MOCK_USER=new et("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zn="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mn=new wu("@firebase/firestore");function Pn(){return mn.logLevel}function H(n,...e){if(mn.logLevel<=ce.DEBUG){const t=e.map(Zo);mn.debug(`Firestore (${Zn}): ${n}`,...t)}}function Pt(n,...e){if(mn.logLevel<=ce.ERROR){const t=e.map(Zo);mn.error(`Firestore (${Zn}): ${n}`,...t)}}function Wt(n,...e){if(mn.logLevel<=ce.WARN){const t=e.map(Zo);mn.warn(`Firestore (${Zn}): ${n}`,...t)}}function Zo(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Bu(n,r,t)}function Bu(n,e,t){let r=`FIRESTORE (${Zn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Pt(r),new Error(r)}function me(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Bu(e,i,r)}function ne(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class W extends Jn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Zm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(et.UNAUTHENTICATED))}shutdown(){}}class ep{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tp{constructor(e){this.t=e,this.currentUser=et.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){me(this.o===void 0,42304);let r=this.i;const i=d=>this.i!==r?(r=this.i,t(d)):Promise.resolve();let s=new Ht;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ht,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const d=s;e.enqueueRetryable(async()=>{await d.promise,await i(this.currentUser)})},l=d=>{H("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(d=>l(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?l(d):(H("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ht)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(H("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(me(typeof r.accessToken=="string",31837,{l:r}),new Nu(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return me(e===null||typeof e=="string",2055,{h:e}),new et(e)}}class np{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=et.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class rp{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new np(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(et.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ul{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ip{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Lm(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){me(this.o===void 0,3512);const r=s=>{s.error!=null&&H("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,H("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{H("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):H("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ul(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(me(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ul(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sp(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=sp(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}}function se(n,e){return n<e?-1:n>e?1:0}function ho(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return se(r,i);{const s=Lu(),a=op(s.encode(jl(n,t)),s.encode(jl(e,t)));return a!==0?a:se(r,i)}}t+=r>65535?2:1}return se(n.length,e.length)}function jl(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function op(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return se(n[t],e[t]);return se(n.length,e.length)}function Hn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zl="__name__";class yt{constructor(e,t,r){t===void 0?t=0:t>e.length&&X(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&X(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return yt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof yt?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=yt.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return se(e.length,t.length)}static compareSegments(e,t){const r=yt.isNumericId(e),i=yt.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?yt.extractNumericId(e).compare(yt.extractNumericId(t)):ho(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return qt.fromString(e.substring(4,e.length-2))}}class we extends yt{construct(e,t,r){return new we(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new W(j.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new we(t)}static emptyPath(){return new we([])}}const ap=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ke extends yt{construct(e,t,r){return new Ke(e,t,r)}static isValidIdentifier(e){return ap.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ke.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===zl}static keyField(){return new Ke([zl])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new W(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new W(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new W(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(r+=l,i++):(s(),i++)}if(s(),a)throw new W(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ke(t)}static emptyPath(){return new Ke([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(e){this.path=e}static fromPath(e){return new K(we.fromString(e))}static fromName(e){return new K(we.fromString(e).popFirst(5))}static empty(){return new K(we.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&we.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return we.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new K(new we(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(n,e,t){if(!t)throw new W(j.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function lp(n,e,t,r){if(e===!0&&r===!0)throw new W(j.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function $l(n){if(!K.isDocumentKey(n))throw new W(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ql(n){if(K.isDocumentKey(n))throw new W(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ou(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ta(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":X(12329,{type:typeof n})}function kt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new W(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ta(n);throw new W(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n,e){const t={typeString:n};return e&&(t.value=e),t}function Qr(n,e){if(!Ou(n))throw new W(j.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new W(j.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hl=-62135596800,Gl=1e6;class be{static now(){return be.fromMillis(Date.now())}static fromDate(e){return be.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Gl);return new be(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new W(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new W(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Hl)throw new W(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new W(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Gl}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:be._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Qr(e,be._jsonSchema))return new be(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Hl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}be._jsonSchemaVersion="firestore/timestamp/1.0",be._jsonSchema={type:Ne("string",be._jsonSchemaVersion),seconds:Ne("number"),nanoseconds:Ne("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{static fromTimestamp(e){return new ee(e)}static min(){return new ee(new be(0,0))}static max(){return new ee(new be(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jr=-1;function cp(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ee.fromTimestamp(r===1e9?new be(t+1,0):new be(t,r));return new Kt(i,K.empty(),e)}function up(n){return new Kt(n.readTime,n.key,jr)}class Kt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Kt(ee.min(),K.empty(),jr)}static max(){return new Kt(ee.max(),K.empty(),jr)}}function hp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=K.comparator(n.documentKey,e.documentKey),t!==0?t:se(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fp{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function er(n){if(n.code!==j.FAILED_PRECONDITION||n.message!==dp)throw n;H("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&X(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new F((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof F?t:F.resolve(t)}catch(t){return F.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):F.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):F.reject(t)}static resolve(e){return new F((t,r)=>{t(e)})}static reject(e){return new F((t,r)=>{r(e)})}static waitFor(e){return new F((t,r)=>{let i=0,s=0,a=!1;e.forEach(l=>{++i,l.next(()=>{++s,a&&s===i&&t()},d=>r(d))}),a=!0,s===i&&t()})}static or(e){let t=F.resolve(!1);for(const r of e)t=t.next(i=>i?F.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new F((r,i)=>{const s=e.length,a=new Array(s);let l=0;for(let d=0;d<s;d++){const m=d;t(e[m]).next(g=>{a[m]=g,++l,l===s&&r(a)},g=>i(g))}})}static doWhile(e,t){return new F((r,i)=>{const s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}}function mp(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function tr(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this._e(r),this.ae=r=>t.writeSequenceNumber(r))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}fs.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na=-1;function ms(n){return n==null}function Qi(n){return n===0&&1/n==-1/0}function pp(n){return typeof n=="number"&&Number.isInteger(n)&&!Qi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fu="";function gp(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Wl(e)),e=yp(n.get(t),e);return Wl(e)}function yp(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case Fu:t+="";break;default:t+=s}}return t}function Wl(n){return n+Fu+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function _n(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Uu(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e,t){this.comparator=e,this.root=t||We.EMPTY}insert(e,t){return new Re(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,We.BLACK,null,null))}remove(e){return new Re(this.comparator,this.root.remove(e,this.comparator).copy(null,null,We.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new gi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new gi(this.root,e,this.comparator,!1)}getReverseIterator(){return new gi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new gi(this.root,e,this.comparator,!0)}}class gi{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class We{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??We.RED,this.left=i??We.EMPTY,this.right=s??We.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new We(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return We.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return We.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,We.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,We.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw X(43730,{key:this.key,value:this.value});if(this.right.isRed())throw X(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw X(27949);return e+(this.isRed()?0:1)}}We.EMPTY=null,We.RED=!0,We.BLACK=!1;We.EMPTY=new class{constructor(){this.size=0}get key(){throw X(57766)}get value(){throw X(16141)}get color(){throw X(16727)}get left(){throw X(29726)}get right(){throw X(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new We(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.comparator=e,this.data=new Re(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ql(this.data.getIterator())}getIteratorFrom(e){return new Ql(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ue)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ue(this.comparator);return t.data=e,t}}class Ql{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e){this.fields=e,e.sort(Ke.comparator)}static empty(){return new mt([])}unionWith(e){let t=new Ue(Ke.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new mt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Hn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ju("Invalid base64 string: "+s):s}}(e);return new Qe(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new Qe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qe.EMPTY_BYTE_STRING=new Qe("");const _p=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qt(n){if(me(!!n,39018),typeof n=="string"){let e=0;const t=_p.exec(n);if(me(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ve(n.seconds),nanos:Ve(n.nanos)}}function Ve(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Xt(n){return typeof n=="string"?Qe.fromBase64String(n):Qe.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zu="server_timestamp",$u="__type__",qu="__previous_value__",Hu="__local_write_time__";function ra(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[$u])===null||t===void 0?void 0:t.stringValue)===zu}function ps(n){const e=n.mapValue.fields[qu];return ra(e)?ps(e):e}function zr(n){const e=Qt(n.mapValue.fields[Hu].timestampValue);return new be(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(e,t,r,i,s,a,l,d,m,g){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=d,this.useFetchStreams=m,this.isUsingEmulator=g}}const Xi="(default)";class $r{constructor(e,t){this.projectId=e,this.database=t||Xi}static empty(){return new $r("","")}get isDefaultDatabase(){return this.database===Xi}isEqual(e){return e instanceof $r&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gu="__type__",Ep="__max__",yi={mapValue:{}},Wu="__vector__",Yi="value";function Yt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ra(n)?4:wp(n)?9007199254740991:Tp(n)?10:11:X(28295,{value:n})}function bt(n,e){if(n===e)return!0;const t=Yt(n);if(t!==Yt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zr(n).isEqual(zr(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Qt(i.timestampValue),l=Qt(s.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Xt(i.bytesValue).isEqual(Xt(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Ve(i.geoPointValue.latitude)===Ve(s.geoPointValue.latitude)&&Ve(i.geoPointValue.longitude)===Ve(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ve(i.integerValue)===Ve(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Ve(i.doubleValue),l=Ve(s.doubleValue);return a===l?Qi(a)===Qi(l):isNaN(a)&&isNaN(l)}return!1}(n,e);case 9:return Hn(n.arrayValue.values||[],e.arrayValue.values||[],bt);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},l=s.mapValue.fields||{};if(Kl(a)!==Kl(l))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(l[d]===void 0||!bt(a[d],l[d])))return!1;return!0}(n,e);default:return X(52216,{left:n})}}function qr(n,e){return(n.values||[]).find(t=>bt(t,e))!==void 0}function Gn(n,e){if(n===e)return 0;const t=Yt(n),r=Yt(e);if(t!==r)return se(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(n.booleanValue,e.booleanValue);case 2:return function(s,a){const l=Ve(s.integerValue||s.doubleValue),d=Ve(a.integerValue||a.doubleValue);return l<d?-1:l>d?1:l===d?0:isNaN(l)?isNaN(d)?0:-1:1}(n,e);case 3:return Xl(n.timestampValue,e.timestampValue);case 4:return Xl(zr(n),zr(e));case 5:return ho(n.stringValue,e.stringValue);case 6:return function(s,a){const l=Xt(s),d=Xt(a);return l.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const l=s.split("/"),d=a.split("/");for(let m=0;m<l.length&&m<d.length;m++){const g=se(l[m],d[m]);if(g!==0)return g}return se(l.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const l=se(Ve(s.latitude),Ve(a.latitude));return l!==0?l:se(Ve(s.longitude),Ve(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Yl(n.arrayValue,e.arrayValue);case 10:return function(s,a){var l,d,m,g;const C=s.fields||{},k=a.fields||{},E=(l=C[Yi])===null||l===void 0?void 0:l.arrayValue,P=(d=k[Yi])===null||d===void 0?void 0:d.arrayValue,V=se(((m=E?.values)===null||m===void 0?void 0:m.length)||0,((g=P?.values)===null||g===void 0?void 0:g.length)||0);return V!==0?V:Yl(E,P)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===yi.mapValue&&a===yi.mapValue)return 0;if(s===yi.mapValue)return 1;if(a===yi.mapValue)return-1;const l=s.fields||{},d=Object.keys(l),m=a.fields||{},g=Object.keys(m);d.sort(),g.sort();for(let C=0;C<d.length&&C<g.length;++C){const k=ho(d[C],g[C]);if(k!==0)return k;const E=Gn(l[d[C]],m[g[C]]);if(E!==0)return E}return se(d.length,g.length)}(n.mapValue,e.mapValue);default:throw X(23264,{le:t})}}function Xl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return se(n,e);const t=Qt(n),r=Qt(e),i=se(t.seconds,r.seconds);return i!==0?i:se(t.nanos,r.nanos)}function Yl(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=Gn(t[i],r[i]);if(s)return s}return se(t.length,r.length)}function Wn(n){return fo(n)}function fo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Qt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Xt(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return K.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=fo(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${fo(t.fields[a])}`;return i+"}"}(n.mapValue):X(61005,{value:n})}function Pi(n){switch(Yt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ps(n);return e?16+Pi(e):16;case 5:return 2*n.stringValue.length;case 6:return Xt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+Pi(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return _n(r.fields,(s,a)=>{i+=s.length+Pi(a)}),i}(n.mapValue);default:throw X(13486,{value:n})}}function mo(n){return!!n&&"integerValue"in n}function ia(n){return!!n&&"arrayValue"in n}function Jl(n){return!!n&&"nullValue"in n}function Zl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function xi(n){return!!n&&"mapValue"in n}function Tp(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Gu])===null||t===void 0?void 0:t.stringValue)===Wu}function Sr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return _n(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Sr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Sr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function wp(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Ep}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e){this.value=e}static empty(){return new at({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!xi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Sr(t)}setAll(e){let t=Ke.emptyPath(),r={},i=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=l.popLast()}a?r[l.lastSegment()]=Sr(a):i.push(l.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());xi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return bt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];xi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){_n(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new at(Sr(this.value))}}function Ku(n){const e=[];return _n(n.fields,(t,r)=>{const i=new Ke([t]);if(xi(r)){const s=Ku(r.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new mt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e,t,r,i,s,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=l}static newInvalidDocument(e){return new tt(e,0,ee.min(),ee.min(),ee.min(),at.empty(),0)}static newFoundDocument(e,t,r,i){return new tt(e,1,t,ee.min(),r,i,0)}static newNoDocument(e,t){return new tt(e,2,t,ee.min(),ee.min(),at.empty(),0)}static newUnknownDocument(e,t){return new tt(e,3,t,ee.min(),ee.min(),at.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ee.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=at.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=at.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e,t){this.position=e,this.inclusive=t}}function ec(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(s.field.isKeyField()?r=K.comparator(K.fromName(a.referenceValue),t.key):r=Gn(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function tc(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!bt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e,t="asc"){this.field=e,this.dir=t}}function bp(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu{}class Fe extends Qu{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ap(e,t,r):t==="array-contains"?new kp(e,r):t==="in"?new Rp(e,r):t==="not-in"?new Pp(e,r):t==="array-contains-any"?new xp(e,r):new Fe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Cp(e,r):new Sp(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Gn(t,this.value)):t!==null&&Yt(this.value)===Yt(t)&&this.matchesComparison(Gn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return X(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class It extends Qu{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new It(e,t)}matches(e){return Xu(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function Xu(n){return n.op==="and"}function Yu(n){return Ip(n)&&Xu(n)}function Ip(n){for(const e of n.filters)if(e instanceof It)return!1;return!0}function po(n){if(n instanceof Fe)return n.field.canonicalString()+n.op.toString()+Wn(n.value);if(Yu(n))return n.filters.map(e=>po(e)).join(",");{const e=n.filters.map(t=>po(t)).join(",");return`${n.op}(${e})`}}function Ju(n,e){return n instanceof Fe?function(r,i){return i instanceof Fe&&r.op===i.op&&r.field.isEqual(i.field)&&bt(r.value,i.value)}(n,e):n instanceof It?function(r,i){return i instanceof It&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,l)=>s&&Ju(a,i.filters[l]),!0):!1}(n,e):void X(19439)}function Zu(n){return n instanceof Fe?function(t){return`${t.field.canonicalString()} ${t.op} ${Wn(t.value)}`}(n):n instanceof It?function(t){return t.op.toString()+" {"+t.getFilters().map(Zu).join(" ,")+"}"}(n):"Filter"}class Ap extends Fe{constructor(e,t,r){super(e,t,r),this.key=K.fromName(r.referenceValue)}matches(e){const t=K.comparator(e.key,this.key);return this.matchesComparison(t)}}class Cp extends Fe{constructor(e,t){super(e,"in",t),this.keys=eh("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Sp extends Fe{constructor(e,t){super(e,"not-in",t),this.keys=eh("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function eh(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>K.fromName(r.referenceValue))}class kp extends Fe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ia(t)&&qr(t.arrayValue,this.value)}}class Rp extends Fe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&qr(this.value.arrayValue,t)}}class Pp extends Fe{constructor(e,t){super(e,"not-in",t)}matches(e){if(qr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!qr(this.value.arrayValue,t)}}class xp extends Fe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ia(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>qr(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,t=null,r=[],i=[],s=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=l,this.Pe=null}}function nc(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Dp(n,e,t,r,i,s,a)}function sa(n){const e=ne(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>po(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),ms(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Wn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Wn(r)).join(",")),e.Pe=t}return e.Pe}function oa(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!bp(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Ju(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!tc(n.startAt,e.startAt)&&tc(n.endAt,e.endAt)}function go(n){return K.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e,t=null,r=[],i=[],s=null,a="F",l=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=l,this.endAt=d,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function Vp(n,e,t,r,i,s,a,l){return new gs(n,e,t,r,i,s,a,l)}function ys(n){return new gs(n)}function rc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Bp(n){return n.collectionGroup!==null}function kr(n){const e=ne(n);if(e.Te===null){e.Te=[];const t=new Set;for(const s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new Ue(Ke.comparator);return a.filters.forEach(d=>{d.getFlattenedFilters().forEach(m=>{m.isInequality()&&(l=l.add(m.field))})}),l})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new Zi(s,r))}),t.has(Ke.keyField().canonicalString())||e.Te.push(new Zi(Ke.keyField(),r))}return e.Te}function _t(n){const e=ne(n);return e.Ie||(e.Ie=Np(e,kr(n))),e.Ie}function Np(n,e){if(n.limitType==="F")return nc(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new Zi(i.field,s)});const t=n.endAt?new Ji(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ji(n.startAt.position,n.startAt.inclusive):null;return nc(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function yo(n,e,t){return new gs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function _s(n,e){return oa(_t(n),_t(e))&&n.limitType===e.limitType}function th(n){return`${sa(_t(n))}|lt:${n.limitType}`}function xn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Zu(i)).join(", ")}]`),ms(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Wn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Wn(i)).join(",")),`Target(${r})`}(_t(n))}; limitType=${n.limitType})`}function vs(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):K.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of kr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,l,d){const m=ec(a,l,d);return a.inclusive?m<=0:m<0}(r.startAt,kr(r),i)||r.endAt&&!function(a,l,d){const m=ec(a,l,d);return a.inclusive?m>=0:m>0}(r.endAt,kr(r),i))}(n,e)}function Lp(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function nh(n){return(e,t)=>{let r=!1;for(const i of kr(n)){const s=Mp(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Mp(n,e,t){const r=n.field.isKeyField()?K.comparator(e.key,t.key):function(s,a,l){const d=a.data.field(s),m=l.data.field(s);return d!==null&&m!==null?Gn(d,m):X(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return X(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){_n(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Uu(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Op=new Re(K.comparator);function xt(){return Op}const rh=new Re(K.comparator);function vr(...n){let e=rh;for(const t of n)e=e.insert(t.key,t);return e}function ih(n){let e=rh;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function un(){return Rr()}function sh(){return Rr()}function Rr(){return new vn(n=>n.toString(),(n,e)=>n.isEqual(e))}const Fp=new Re(K.comparator),Up=new Ue(K.comparator);function oe(...n){let e=Up;for(const t of n)e=e.add(t);return e}const jp=new Ue(se);function zp(){return jp}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aa(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qi(e)?"-0":e}}function oh(n){return{integerValue:""+n}}function $p(n,e){return pp(e)?oh(e):aa(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(){this._=void 0}}function qp(n,e,t){return n instanceof es?function(i,s){const a={fields:{[$u]:{stringValue:zu},[Hu]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ra(s)&&(s=ps(s)),s&&(a.fields[qu]=s),{mapValue:a}}(t,e):n instanceof Hr?lh(n,e):n instanceof Gr?ch(n,e):function(i,s){const a=ah(i,s),l=ic(a)+ic(i.Ee);return mo(a)&&mo(i.Ee)?oh(l):aa(i.serializer,l)}(n,e)}function Hp(n,e,t){return n instanceof Hr?lh(n,e):n instanceof Gr?ch(n,e):t}function ah(n,e){return n instanceof ts?function(r){return mo(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class es extends Es{}class Hr extends Es{constructor(e){super(),this.elements=e}}function lh(n,e){const t=uh(e);for(const r of n.elements)t.some(i=>bt(i,r))||t.push(r);return{arrayValue:{values:t}}}class Gr extends Es{constructor(e){super(),this.elements=e}}function ch(n,e){let t=uh(e);for(const r of n.elements)t=t.filter(i=>!bt(i,r));return{arrayValue:{values:t}}}class ts extends Es{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function ic(n){return Ve(n.integerValue||n.doubleValue)}function uh(n){return ia(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Gp(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Hr&&i instanceof Hr||r instanceof Gr&&i instanceof Gr?Hn(r.elements,i.elements,bt):r instanceof ts&&i instanceof ts?bt(r.Ee,i.Ee):r instanceof es&&i instanceof es}(n.transform,e.transform)}class Wp{constructor(e,t){this.version=e,this.transformResults=t}}class vt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new vt}static exists(e){return new vt(void 0,e)}static updateTime(e){return new vt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Di(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ts{}function hh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new la(n.key,vt.none()):new Xr(n.key,n.data,vt.none());{const t=n.data,r=at.empty();let i=new Ue(Ke.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new En(n.key,r,new mt(i.toArray()),vt.none())}}function Kp(n,e,t){n instanceof Xr?function(i,s,a){const l=i.value.clone(),d=oc(i.fieldTransforms,s,a.transformResults);l.setAll(d),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):n instanceof En?function(i,s,a){if(!Di(i.precondition,s))return void s.convertToUnknownDocument(a.version);const l=oc(i.fieldTransforms,s,a.transformResults),d=s.data;d.setAll(dh(i)),d.setAll(l),s.convertToFoundDocument(a.version,d).setHasCommittedMutations()}(n,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Pr(n,e,t,r){return n instanceof Xr?function(s,a,l,d){if(!Di(s.precondition,a))return l;const m=s.value.clone(),g=ac(s.fieldTransforms,d,a);return m.setAll(g),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null}(n,e,t,r):n instanceof En?function(s,a,l,d){if(!Di(s.precondition,a))return l;const m=ac(s.fieldTransforms,d,a),g=a.data;return g.setAll(dh(s)),g.setAll(m),a.convertToFoundDocument(a.version,g).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(C=>C.field))}(n,e,t,r):function(s,a,l){return Di(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,e,t)}function Qp(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=ah(r.transform,i||null);s!=null&&(t===null&&(t=at.empty()),t.set(r.field,s))}return t||null}function sc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Hn(r,i,(s,a)=>Gp(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Xr extends Ts{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class En extends Ts{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function dh(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function oc(n,e,t){const r=new Map;me(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,l=e.data.field(s.field);r.set(s.field,Hp(a,l,t[i]))}return r}function ac(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,qp(s,a,e))}return r}class la extends Ts{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xp extends Ts{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Kp(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Pr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Pr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=sh();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let l=this.applyToLocalView(a,s.mutatedFields);l=t.has(i.key)?null:l;const d=hh(a,l);d!==null&&r.set(i.key,d),a.isValidDocument()||a.convertToNoDocument(ee.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oe())}isEqual(e){return this.batchId===e.batchId&&Hn(this.mutations,e.mutations,(t,r)=>sc(t,r))&&Hn(this.baseMutations,e.baseMutations,(t,r)=>sc(t,r))}}class ca{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){me(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=function(){return Fp}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new ca(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Be,le;function eg(n){switch(n){case j.OK:return X(64938);case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0;default:return X(15467,{code:n})}}function fh(n){if(n===void 0)return Pt("GRPC error has no .code"),j.UNKNOWN;switch(n){case Be.OK:return j.OK;case Be.CANCELLED:return j.CANCELLED;case Be.UNKNOWN:return j.UNKNOWN;case Be.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case Be.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case Be.INTERNAL:return j.INTERNAL;case Be.UNAVAILABLE:return j.UNAVAILABLE;case Be.UNAUTHENTICATED:return j.UNAUTHENTICATED;case Be.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case Be.NOT_FOUND:return j.NOT_FOUND;case Be.ALREADY_EXISTS:return j.ALREADY_EXISTS;case Be.PERMISSION_DENIED:return j.PERMISSION_DENIED;case Be.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case Be.ABORTED:return j.ABORTED;case Be.OUT_OF_RANGE:return j.OUT_OF_RANGE;case Be.UNIMPLEMENTED:return j.UNIMPLEMENTED;case Be.DATA_LOSS:return j.DATA_LOSS;default:return X(39323,{code:n})}}(le=Be||(Be={}))[le.OK=0]="OK",le[le.CANCELLED=1]="CANCELLED",le[le.UNKNOWN=2]="UNKNOWN",le[le.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",le[le.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",le[le.NOT_FOUND=5]="NOT_FOUND",le[le.ALREADY_EXISTS=6]="ALREADY_EXISTS",le[le.PERMISSION_DENIED=7]="PERMISSION_DENIED",le[le.UNAUTHENTICATED=16]="UNAUTHENTICATED",le[le.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",le[le.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",le[le.ABORTED=10]="ABORTED",le[le.OUT_OF_RANGE=11]="OUT_OF_RANGE",le[le.UNIMPLEMENTED=12]="UNIMPLEMENTED",le[le.INTERNAL=13]="INTERNAL",le[le.UNAVAILABLE=14]="UNAVAILABLE",le[le.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tg=new qt([4294967295,4294967295],0);function lc(n){const e=Lu().encode(n),t=new ku;return t.update(e),new Uint8Array(t.digest())}function cc(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new qt([t,r],0),new qt([i,s],0)]}class ua{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Er(`Invalid padding: ${t}`);if(r<0)throw new Er(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Er(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Er(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=qt.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(qt.fromNumber(r)));return i.compare(tg)===1&&(i=new qt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;const t=lc(e),[r,i]=cc(t);for(let s=0;s<this.hashCount;s++){const a=this.pe(r,i,s);if(!this.ye(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new ua(s,i,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.fe===0)return;const t=lc(e),[r,i]=cc(t);for(let s=0;s<this.hashCount;s++){const a=this.pe(r,i,s);this.we(a)}}we(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Er extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Yr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ws(ee.min(),i,new Re(se),xt(),oe())}}class Yr{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Yr(r,t,oe(),oe(),oe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}}class mh{constructor(e,t){this.targetId=e,this.De=t}}class ph{constructor(e,t,r=Qe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class uc{constructor(){this.ve=0,this.Ce=hc(),this.Fe=Qe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=oe(),t=oe(),r=oe();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:X(38017,{changeType:s})}}),new Yr(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=hc()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,me(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class ng{constructor(e){this.We=e,this.Ge=new Map,this.ze=xt(),this.je=_i(),this.Je=_i(),this.He=new Re(se)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{const r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:X(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){const t=e.targetId,r=e.De.count,i=this.st(t);if(i){const s=i.target;if(go(s))if(r===0){const a=new K(s.path);this.Xe(t,a,tt.newNoDocument(a,ee.min()))}else me(r===1,20013,{expectedCount:r});else{const a=this.ot(t);if(a!==r){const l=this._t(e),d=l?this.ut(l,e,a):1;if(d!==0){this.rt(t);const m=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,m)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let a,l;try{a=Xt(r).toUint8Array()}catch(d){if(d instanceof ju)return Wt("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{l=new ua(a,i,s)}catch(d){return Wt(d instanceof Er?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return l.fe===0?null:l}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){const r=this.We.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const a=this.We.lt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.Xe(t,s,null),i++)}),i}Pt(e){const t=new Map;this.Ge.forEach((s,a)=>{const l=this.st(a);if(l){if(s.current&&go(l.target)){const d=new K(l.target.path);this.Tt(d).has(a)||this.It(a,d)||this.Xe(a,d,tt.newNoDocument(d,e))}s.Ne&&(t.set(a,s.Le()),s.ke())}});let r=oe();this.Je.forEach((s,a)=>{let l=!0;a.forEachWhile(d=>{const m=this.st(d);return!m||m.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(e));const i=new ws(e,t,this.He,this.ze,r);return this.ze=xt(),this.je=_i(),this.Je=_i(),this.He=new Re(se),i}Ze(e,t){if(!this.nt(e))return;const r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;const i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new uc,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new Ue(se),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new Ue(se),this.je=this.je.insert(e,t)),t}nt(e){const t=this.st(e)!==null;return t||H("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new uc),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function _i(){return new Re(K.comparator)}function hc(){return new Re(K.comparator)}const rg={asc:"ASCENDING",desc:"DESCENDING"},ig={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sg={and:"AND",or:"OR"};class og{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _o(n,e){return n.useProto3Json||ms(e)?e:{value:e}}function ns(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function gh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ag(n,e){return ns(n,e.toTimestamp())}function Et(n){return me(!!n,49232),ee.fromTimestamp(function(t){const r=Qt(t);return new be(r.seconds,r.nanos)}(n))}function ha(n,e){return vo(n,e).canonicalString()}function vo(n,e){const t=function(i){return new we(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function yh(n){const e=we.fromString(n);return me(wh(e),10190,{key:e.toString()}),e}function Eo(n,e){return ha(n.databaseId,e.path)}function Gs(n,e){const t=yh(e);if(t.get(1)!==n.databaseId.projectId)throw new W(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new W(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new K(vh(t))}function _h(n,e){return ha(n.databaseId,e)}function lg(n){const e=yh(n);return e.length===4?we.emptyPath():vh(e)}function To(n){return new we(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function vh(n){return me(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function dc(n,e,t){return{name:Eo(n,e),fields:t.value.mapValue.fields}}function cg(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:X(39313,{state:m})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(m,g){return m.useProto3Json?(me(g===void 0||typeof g=="string",58123),Qe.fromBase64String(g||"")):(me(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),Qe.fromUint8Array(g||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(m){const g=m.code===void 0?j.UNKNOWN:fh(m.code);return new W(g,m.message||"")}(a);t=new ph(r,i,s,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Gs(n,r.document.name),s=Et(r.document.updateTime),a=r.document.createTime?Et(r.document.createTime):ee.min(),l=new at({mapValue:{fields:r.document.fields}}),d=tt.newFoundDocument(i,s,a,l),m=r.targetIds||[],g=r.removedTargetIds||[];t=new Vi(m,g,d.key,d)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Gs(n,r.document),s=r.readTime?Et(r.readTime):ee.min(),a=tt.newNoDocument(i,s),l=r.removedTargetIds||[];t=new Vi([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Gs(n,r.document),s=r.removedTargetIds||[];t=new Vi([],s,i,null)}else{if(!("filter"in e))return X(11601,{At:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new Zp(i,s),l=r.targetId;t=new mh(l,a)}}return t}function ug(n,e){let t;if(e instanceof Xr)t={update:dc(n,e.key,e.value)};else if(e instanceof la)t={delete:Eo(n,e.key)};else if(e instanceof En)t={update:dc(n,e.key,e.data),updateMask:vg(e.fieldMask)};else{if(!(e instanceof Xp))return X(16599,{Rt:e.type});t={verify:Eo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const l=a.transform;if(l instanceof es)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Hr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Gr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof ts)return{fieldPath:a.field.canonicalString(),increment:l.Ee};throw X(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:ag(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:X(27497)}(n,e.precondition)),t}function hg(n,e){return n&&n.length>0?(me(e!==void 0,14353),n.map(t=>function(i,s){let a=i.updateTime?Et(i.updateTime):Et(s);return a.isEqual(ee.min())&&(a=Et(s)),new Wp(a,i.transformResults||[])}(t,e))):[]}function dg(n,e){return{documents:[_h(n,e.path)]}}function fg(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=_h(n,i);const s=function(m){if(m.length!==0)return Th(It.create(m,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(m){if(m.length!==0)return m.map(g=>function(k){return{field:Dn(k.field),direction:gg(k.dir)}}(g))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=_o(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(m){return{before:m.inclusive,values:m.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{Vt:t,parent:i}}function mg(n){let e=lg(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){me(r===1,65062);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(C){const k=Eh(C);return k instanceof It&&Yu(k)?k.getFilters():[k]}(t.where));let a=[];t.orderBy&&(a=function(C){return C.map(k=>function(P){return new Zi(Vn(P.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(k))}(t.orderBy));let l=null;t.limit&&(l=function(C){let k;return k=typeof C=="object"?C.value:C,ms(k)?null:k}(t.limit));let d=null;t.startAt&&(d=function(C){const k=!!C.before,E=C.values||[];return new Ji(E,k)}(t.startAt));let m=null;return t.endAt&&(m=function(C){const k=!C.before,E=C.values||[];return new Ji(E,k)}(t.endAt)),Vp(e,i,a,s,l,"F",d,m)}function pg(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return X(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Eh(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Vn(t.unaryFilter.field);return Fe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Vn(t.unaryFilter.field);return Fe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Vn(t.unaryFilter.field);return Fe.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Vn(t.unaryFilter.field);return Fe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return X(61313);default:return X(60726)}}(n):n.fieldFilter!==void 0?function(t){return Fe.create(Vn(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return X(58110);default:return X(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return It.create(t.compositeFilter.filters.map(r=>Eh(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return X(1026)}}(t.compositeFilter.op))}(n):X(30097,{filter:n})}function gg(n){return rg[n]}function yg(n){return ig[n]}function _g(n){return sg[n]}function Dn(n){return{fieldPath:n.canonicalString()}}function Vn(n){return Ke.fromServerFormat(n.fieldPath)}function Th(n){return n instanceof Fe?function(t){if(t.op==="=="){if(Zl(t.value))return{unaryFilter:{field:Dn(t.field),op:"IS_NAN"}};if(Jl(t.value))return{unaryFilter:{field:Dn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Zl(t.value))return{unaryFilter:{field:Dn(t.field),op:"IS_NOT_NAN"}};if(Jl(t.value))return{unaryFilter:{field:Dn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dn(t.field),op:yg(t.op),value:t.value}}}(n):n instanceof It?function(t){const r=t.getFilters().map(i=>Th(i));return r.length===1?r[0]:{compositeFilter:{op:_g(t.op),filters:r}}}(n):X(54877,{filter:n})}function vg(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function wh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,t,r,i,s=ee.min(),a=ee.min(),l=Qe.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=d}withSequenceNumber(e){return new Ot(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ot(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ot(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ot(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg{constructor(e){this.gt=e}}function Tg(n){const e=mg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yo(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(){this.Dn=new bg}addToCollectionParentIndex(e,t){return this.Dn.add(t),F.resolve()}getCollectionParents(e,t){return F.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return F.resolve()}deleteFieldIndex(e,t){return F.resolve()}deleteAllFieldIndexes(e){return F.resolve()}createTargetIndexes(e,t){return F.resolve()}getDocumentsMatchingTarget(e,t){return F.resolve(null)}getIndexType(e,t){return F.resolve(0)}getFieldIndexes(e,t){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,t){return F.resolve(Kt.min())}getMinOffsetFromCollectionGroup(e,t){return F.resolve(Kt.min())}updateCollectionGroup(e,t,r){return F.resolve()}updateIndexEntries(e,t){return F.resolve()}}class bg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ue(we.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ue(we.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bh=41943040;class rt{static withCacheSize(e){return new rt(e,rt.DEFAULT_COLLECTION_PERCENTILE,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rt.DEFAULT_COLLECTION_PERCENTILE=10,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rt.DEFAULT=new rt(bh,rt.DEFAULT_COLLECTION_PERCENTILE,rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rt.DISABLED=new rt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Kn(0)}static ur(){return new Kn(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc="LruGarbageCollector",Ig=1048576;function pc([n,e],[t,r]){const i=se(n,t);return i===0?se(e,r):i}class Ag{constructor(e){this.Tr=e,this.buffer=new Ue(pc),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();pc(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Cg{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){H(mc,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){tr(t)?H(mc,"Ignoring IndexedDB error during garbage collection: ",t):await er(t)}await this.Rr(3e5)})}}class Sg{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return F.resolve(fs.ue);const r=new Ag(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(H("LruGarbageCollector","Garbage collection skipped; disabled"),F.resolve(fc)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(H("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fc):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,a,l,d,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(C=>(C>this.params.maximumSequenceNumbersToCollect?(H("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${C}`),i=this.params.maximumSequenceNumbersToCollect):i=C,a=Date.now(),this.nthSequenceNumber(e,i))).next(C=>(r=C,l=Date.now(),this.removeTargets(e,r,t))).next(C=>(s=C,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(C=>(m=Date.now(),Pn()<=ce.DEBUG&&H("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-g}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${s} targets in `+(d-l)+`ms
	Removed ${C} documents in `+(m-d)+`ms
Total Duration: ${m-g}ms`),F.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:C})))}}function kg(n,e){return new Sg(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(){this.changes=new vn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?F.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Pr(r.mutation,i,mt.empty(),be.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,oe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=oe()){const i=un();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=vr();return s.forEach((l,d)=>{a=a.insert(l,d.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=un();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oe()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,i){let s=xt();const a=Rr(),l=function(){return Rr()}();return t.forEach((d,m)=>{const g=r.get(m.key);i.has(m.key)&&(g===void 0||g.mutation instanceof En)?s=s.insert(m.key,m):g!==void 0?(a.set(m.key,g.mutation.getFieldMask()),Pr(g.mutation,m,g.mutation.getFieldMask(),be.now())):a.set(m.key,mt.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((m,g)=>a.set(m,g)),t.forEach((m,g)=>{var C;return l.set(m,new Pg(g,(C=a.get(m))!==null&&C!==void 0?C:null))}),l))}recalculateAndSaveOverlays(e,t){const r=Rr();let i=new Re((a,l)=>a-l),s=oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const l of a)l.keys().forEach(d=>{const m=t.get(d);if(m===null)return;let g=r.get(d)||mt.empty();g=l.applyToLocalView(m,g),r.set(d,g);const C=(i.get(l.batchId)||oe()).add(d);i=i.insert(l.batchId,C)})}).next(()=>{const a=[],l=i.getReverseIterator();for(;l.hasNext();){const d=l.getNext(),m=d.key,g=d.value,C=sh();g.forEach(k=>{if(!s.has(k)){const E=hh(t.get(k),r.get(k));E!==null&&C.set(k,E),s=s.add(k)}}),a.push(this.documentOverlayCache.saveOverlays(e,m,C))}return F.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return K.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Bp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):F.resolve(un());let l=jr,d=s;return a.next(m=>F.forEach(m,(g,C)=>(l<C.largestBatchId&&(l=C.largestBatchId),s.get(g)?F.resolve():this.remoteDocumentCache.getEntry(e,g).next(k=>{d=d.insert(g,k)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,d,m,oe())).next(g=>({batchId:l,changes:ih(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new K(t)).next(r=>{let i=vr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let a=vr();return this.indexManager.getCollectionParents(e,s).next(l=>F.forEach(l,d=>{const m=function(C,k){return new gs(k,null,C.explicitOrderBy.slice(),C.filters.slice(),C.limit,C.limitType,C.startAt,C.endAt)}(t,d.child(s));return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next(g=>{g.forEach((C,k)=>{a=a.insert(C,k)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((d,m)=>{const g=m.getKey();a.get(g)===null&&(a=a.insert(g,tt.newInvalidDocument(g)))});let l=vr();return a.forEach((d,m)=>{const g=s.get(d);g!==void 0&&Pr(g.mutation,m,mt.empty(),be.now()),vs(t,m)&&(l=l.insert(d,m))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return F.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Et(i.createTime)}}(t)),F.resolve()}getNamedQuery(e,t){return F.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(i){return{name:i.name,query:Tg(i.bundledQuery),readTime:Et(i.readTime)}}(t)),F.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(){this.overlays=new Re(K.comparator),this.kr=new Map}getOverlay(e,t){return F.resolve(this.overlays.get(t))}getOverlays(e,t){const r=un();return F.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),F.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),F.resolve()}getOverlaysForCollection(e,t,r){const i=un(),s=t.length+1,a=new K(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const d=l.getNext().value,m=d.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return F.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Re((m,g)=>m-g);const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>r){let g=s.get(m.largestBatchId);g===null&&(g=un(),s=s.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const l=un(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((m,g)=>l.set(m,g)),!(l.size()>=i)););return F.resolve(l)}wt(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Jp(t,r));let s=this.kr.get(t);s===void 0&&(s=oe(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(){this.sessionToken=Qe.EMPTY_BYTE_STRING}getSessionToken(e){return F.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,F.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(){this.qr=new Ue(qe.Qr),this.$r=new Ue(qe.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const r=new qe(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new qe(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){const t=new K(new we([])),r=new qe(t,e),i=new qe(t,e+1),s=[];return this.$r.forEachInRange([r,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new K(new we([])),r=new qe(t,e),i=new qe(t,e+1);let s=oe();return this.$r.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new qe(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class qe{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return K.comparator(e.key,t.key)||se(e.Hr,t.Hr)}static Ur(e,t){return se(e.Hr,t.Hr)||K.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new Ue(qe.Qr)}checkEmpty(e){return F.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Yp(s,t,r,i);this.mutationQueue.push(a);for(const l of i)this.Yr=this.Yr.add(new qe(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return F.resolve(a)}lookupMutationBatch(e,t){return F.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.Xr(r),s=i<0?0:i;return F.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(this.mutationQueue.length===0?na:this.er-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new qe(t,0),i=new qe(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],a=>{const l=this.Zr(a.Hr);s.push(l)}),F.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ue(se);return t.forEach(i=>{const s=new qe(i,0),a=new qe(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],l=>{r=r.add(l.Hr)})}),F.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;K.isDocumentKey(s)||(s=s.child(""));const a=new qe(new K(s),0);let l=new Ue(se);return this.Yr.forEachWhile(d=>{const m=d.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(l=l.add(d.Hr)),!0)},a),F.resolve(this.ei(l))}ei(e){const t=[];return e.forEach(r=>{const i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){me(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return F.forEach(t.mutations,i=>{const s=new qe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){const r=new qe(t,0),i=this.Yr.firstAfterOrEqual(r);return F.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,F.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{constructor(e){this.ni=e,this.docs=function(){return new Re(K.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return F.resolve(r?r.document.mutableCopy():tt.newInvalidDocument(t))}getEntries(e,t){let r=xt();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():tt.newInvalidDocument(i))}),F.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=xt();const a=t.path,l=new K(a.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(l);for(;d.hasNext();){const{key:m,value:{document:g}}=d.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||hp(up(g),r)<=0||(i.has(g.key)||vs(t,g))&&(s=s.insert(g.key,g.mutableCopy()))}return F.resolve(s)}getAllFromCollectionGroup(e,t,r,i){X(9500)}ri(e,t){return F.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Mg(this)}getSize(e){return F.resolve(this.size)}}class Mg extends Rg{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),F.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(e){this.persistence=e,this.ii=new vn(t=>sa(t),oa),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this.si=0,this.oi=new da,this.targetCount=0,this._i=Kn.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),F.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new Kn(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,F.resolve()}updateTargetData(e,t){return this.hr(t),F.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,F.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.ii.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),F.waitFor(s).next(()=>i)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,t){const r=this.ii.get(t)||null;return F.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),F.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),F.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),F.resolve()}getMatchingKeysForTargetId(e,t){const r=this.oi.Jr(t);return F.resolve(r)}containsKey(e,t){return F.resolve(this.oi.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(e,t){this.ai={},this.overlays={},this.ui=new fs(0),this.ci=!1,this.ci=!0,this.li=new Bg,this.referenceDelegate=e(this),this.hi=new Og(this),this.indexManager=new wg,this.remoteDocumentCache=function(i){return new Lg(i)}(r=>this.referenceDelegate.Pi(r)),this.serializer=new Eg(t),this.Ti=new Dg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Vg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new Ng(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){H("MemoryPersistence","Starting transaction:",e);const i=new Fg(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return F.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}}class Fg extends fp{constructor(e){super(),this.currentSequenceNumber=e}}class fa{constructor(e){this.persistence=e,this.Ai=new da,this.Ri=null}static Vi(e){return new fa(e)}get mi(){if(this.Ri)return this.Ri;throw X(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),F.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),F.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),F.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.mi,r=>{const i=K.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,ee.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return F.or([()=>F.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class rs{constructor(e,t){this.persistence=e,this.gi=new vn(r=>gp(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=kg(this,t)}static Vi(e,t){return new rs(e,t)}Ii(){}di(e){return F.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return F.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?F.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(l=>{l||(r++,s.removeEntry(a,ee.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),F.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),F.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),F.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),F.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Pi(e.data.value)),t}Sr(e,t,r){return F.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.gi.get(t);return F.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=oe(),i=oe();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ma(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return Vf()?8:mp(xf())>0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ps(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new Ug;return this.ws(e,t,a).next(l=>{if(s.result=l,this.Rs)return this.Ss(e,t,a,l.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Pn()<=ce.DEBUG&&H("QueryEngine","SDK will not create cache indexes for query:",xn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),F.resolve()):(Pn()<=ce.DEBUG&&H("QueryEngine","Query:",xn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Pn()<=ce.DEBUG&&H("QueryEngine","The SDK decides to create cache indexes for query:",xn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,_t(t))):F.resolve())}ps(e,t){if(rc(t))return F.resolve(null);let r=_t(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=yo(t,null,"F"),r=_t(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=oe(...s);return this.gs.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(d=>{const m=this.bs(t,l);return this.Ds(t,m,a,d.readTime)?this.ps(e,yo(t,null,"F")):this.vs(e,m,t,d)}))})))}ys(e,t,r,i){return rc(t)||i.isEqual(ee.min())?F.resolve(null):this.gs.getDocuments(e,r).next(s=>{const a=this.bs(t,s);return this.Ds(t,a,r,i)?F.resolve(null):(Pn()<=ce.DEBUG&&H("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),xn(t)),this.vs(e,a,t,cp(i,jr)).next(l=>l))})}bs(e,t){let r=new Ue(nh(e));return t.forEach((i,s)=>{vs(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return Pn()<=ce.DEBUG&&H("QueryEngine","Using full collection scan to execute query:",xn(t)),this.gs.getDocumentsMatchingQuery(e,t,Kt.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pa="LocalStore",zg=3e8;class $g{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new Re(se),this.Ms=new vn(s=>sa(s),oa),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new xg(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}function qg(n,e,t,r){return new $g(n,e,t,r)}async function Ah(n,e){const t=ne(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],l=[];let d=oe();for(const m of i){a.push(m.batchId);for(const g of m.mutations)d=d.add(g.key)}for(const m of s){l.push(m.batchId);for(const g of m.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(r,d).next(m=>({Bs:m,removedBatchIds:a,addedBatchIds:l}))})})}function Hg(n,e){const t=ne(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(l,d,m,g){const C=m.batch,k=C.keys();let E=F.resolve();return k.forEach(P=>{E=E.next(()=>g.getEntry(d,P)).next(V=>{const N=m.docVersions.get(P);me(N!==null,48541),V.version.compareTo(N)<0&&(C.applyToRemoteDocument(V,m),V.isValidDocument()&&(V.setReadTime(m.commitVersion),g.addEntry(V)))})}),E.next(()=>l.mutationQueue.removeMutationBatch(d,C))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let d=oe();for(let m=0;m<l.mutationResults.length;++m)l.mutationResults[m].transformResults.length>0&&(d=d.add(l.batch.mutations[m].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Ch(n){const e=ne(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function Gg(n,e){const t=ne(n),r=e.snapshotVersion;let i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;const l=[];e.targetChanges.forEach((g,C)=>{const k=i.get(C);if(!k)return;l.push(t.hi.removeMatchingKeys(s,g.removedDocuments,C).next(()=>t.hi.addMatchingKeys(s,g.addedDocuments,C)));let E=k.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(C)!==null?E=E.withResumeToken(Qe.EMPTY_BYTE_STRING,ee.min()).withLastLimboFreeSnapshotVersion(ee.min()):g.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(g.resumeToken,r)),i=i.insert(C,E),function(V,N,$){return V.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=zg?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(k,E,g)&&l.push(t.hi.updateTargetData(s,E))});let d=xt(),m=oe();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),l.push(Wg(s,a,e.documentUpdates).next(g=>{d=g.Ls,m=g.ks})),!r.isEqual(ee.min())){const g=t.hi.getLastRemoteSnapshotVersion(s).next(C=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));l.push(g)}return F.waitFor(l).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,m)).next(()=>d)}).then(s=>(t.Fs=i,s))}function Wg(n,e,t){let r=oe(),i=oe();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=xt();return t.forEach((l,d)=>{const m=s.get(l);d.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(l)),d.isNoDocument()&&d.version.isEqual(ee.min())?(e.removeEntry(l,d.readTime),a=a.insert(l,d)):!m.isValidDocument()||d.version.compareTo(m.version)>0||d.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(d),a=a.insert(l,d)):H(pa,"Ignoring outdated watch update for ",l,". Current version:",m.version," Watch version:",d.version)}),{Ls:a,ks:i}})}function Kg(n,e){const t=ne(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=na),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Qg(n,e){const t=ne(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,F.resolve(i)):t.hi.allocateTargetId(r).next(a=>(i=new Ot(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}async function wo(n,e,t){const r=ne(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!tr(a))throw a;H(pa,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)}function gc(n,e,t){const r=ne(n);let i=ee.min(),s=oe();return r.persistence.runTransaction("Execute query","readwrite",a=>function(d,m,g){const C=ne(d),k=C.Ms.get(g);return k!==void 0?F.resolve(C.Fs.get(k)):C.hi.getTargetData(m,g)}(r,a,_t(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(a,l.targetId).next(d=>{s=d})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:ee.min(),t?s:oe())).next(l=>(Xg(r,Lp(e),l),{documents:l,qs:s})))}function Xg(n,e,t){let r=n.xs.get(e)||ee.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}class yc{constructor(){this.activeTargetIds=zp()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Yg{constructor(){this.Fo=new yc,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new yc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{xo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _c="ConnectivityMonitor";class vc{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){H(_c,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){H(_c,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vi=null;function bo(){return vi===null?vi=function(){return 268435456+Math.round(2147483648*Math.random())}():vi++,"0x"+vi.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ws="RestConnection",Zg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ey{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===Xi?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){const a=bo(),l=this.Go(e,t.toUriEncodedString());H(Ws,`Sending RPC '${e}' ${a}:`,l,r);const d={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(d,i,s);const{host:m}=new URL(l),g=Yo(m);return this.jo(e,l,d,r,g).then(C=>(H(Ws,`Received RPC '${e}' ${a}: `,C),C),C=>{throw Wt(Ws,`RPC '${e}' ${a} failed with error: `,C,"url: ",l,"request:",r),C})}Jo(e,t,r,i,s,a){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Zn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){const r=Zg[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ze="WebChannelConnection";class ny extends ey{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){const a=bo();return new Promise((l,d)=>{const m=new Ru;m.setWithCredentials(!0),m.listenOnce(Pu.COMPLETE,()=>{try{switch(m.getLastErrorCode()){case Ri.NO_ERROR:const C=m.getResponseJson();H(Ze,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(C)),l(C);break;case Ri.TIMEOUT:H(Ze,`RPC '${e}' ${a} timed out`),d(new W(j.DEADLINE_EXCEEDED,"Request time out"));break;case Ri.HTTP_ERROR:const k=m.getStatus();if(H(Ze,`RPC '${e}' ${a} failed with status:`,k,"response text:",m.getResponseText()),k>0){let E=m.getResponseJson();Array.isArray(E)&&(E=E[0]);const P=E?.error;if(P&&P.status&&P.message){const V=function($){const q=$.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(q)>=0?q:j.UNKNOWN}(P.status);d(new W(V,P.message))}else d(new W(j.UNKNOWN,"Server responded with status "+m.getStatus()))}else d(new W(j.UNAVAILABLE,"Connection failed."));break;default:X(9055,{c_:e,streamId:a,l_:m.getLastErrorCode(),h_:m.getLastError()})}}finally{H(Ze,`RPC '${e}' ${a} completed.`)}});const g=JSON.stringify(i);H(Ze,`RPC '${e}' ${a} sending request:`,i),m.send(t,"POST",g,r,15)})}P_(e,t,r){const i=bo(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Vu(),l=Du(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(d.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(d.useFetchStreams=!0),this.zo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const g=s.join("");H(Ze,`Creating RPC '${e}' stream ${i}: ${g}`,d);const C=a.createWebChannel(g,d);this.T_(C);let k=!1,E=!1;const P=new ty({Ho:N=>{E?H(Ze,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(k||(H(Ze,`Opening RPC '${e}' stream ${i} transport.`),C.open(),k=!0),H(Ze,`RPC '${e}' stream ${i} sending:`,N),C.send(N))},Yo:()=>C.close()}),V=(N,$,q)=>{N.listen($,G=>{try{q(G)}catch(O){setTimeout(()=>{throw O},0)}})};return V(C,_r.EventType.OPEN,()=>{E||(H(Ze,`RPC '${e}' stream ${i} transport opened.`),P.s_())}),V(C,_r.EventType.CLOSE,()=>{E||(E=!0,H(Ze,`RPC '${e}' stream ${i} transport closed`),P.__(),this.I_(C))}),V(C,_r.EventType.ERROR,N=>{E||(E=!0,Wt(Ze,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),P.__(new W(j.UNAVAILABLE,"The operation could not be completed")))}),V(C,_r.EventType.MESSAGE,N=>{var $;if(!E){const q=N.data[0];me(!!q,16349);const G=q,O=G?.error||(($=G[0])===null||$===void 0?void 0:$.error);if(O){H(Ze,`RPC '${e}' stream ${i} received error:`,O);const L=O.status;let U=function(T){const _=Be[T];if(_!==void 0)return fh(_)}(L),A=O.message;U===void 0&&(U=j.INTERNAL,A="Unknown error status: "+L+" with message "+O.message),E=!0,P.__(new W(U,A)),C.close()}else H(Ze,`RPC '${e}' stream ${i} received:`,q),P.a_(q)}}),V(l,xu.STAT_EVENT,N=>{N.stat===uo.PROXY?H(Ze,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===uo.NOPROXY&&H(Ze,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{P.o_()},0),P}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function Ks(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bs(n){return new og(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&H("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ec="PersistentStream";class kh{constructor(e,t,r,i,s,a,l,d){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Sh(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(Pt(t.toString()),Pt("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{const i=new W(j.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){const r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return H(Ec,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(H(Ec,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ry extends kh{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=cg(this.serializer,e),r=function(s){if(!("targetChange"in s))return ee.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?ee.min():a.readTime?Et(a.readTime):ee.min()}(e);return this.listener.J_(t,r)}H_(e){const t={};t.database=To(this.serializer),t.addTarget=function(s,a){let l;const d=a.target;if(l=go(d)?{documents:dg(s,d)}:{query:fg(s,d).Vt},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=gh(s,a.resumeToken);const m=_o(s,a.expectedCount);m!==null&&(l.expectedCount=m)}else if(a.snapshotVersion.compareTo(ee.min())>0){l.readTime=ns(s,a.snapshotVersion.toTimestamp());const m=_o(s,a.expectedCount);m!==null&&(l.expectedCount=m)}return l}(this.serializer,e);const r=pg(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){const t={};t.database=To(this.serializer),t.removeTarget=e,this.k_(t)}}class iy extends kh{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return me(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,me(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){me(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=hg(e.writeResults,e.commitTime),r=Et(e.commitTime);return this.listener.ta(r,t)}na(){const e={};e.database=To(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>ug(this.serializer,r))};this.k_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{}class oy extends sy{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new W(j.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,vo(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new W(j.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Jo(e,vo(t,r),i,a,l,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new W(j.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class ay{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Pt(t),this._a=!1):H("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pn="RemoteStore";class ly{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{r.enqueueAndForget(async()=>{Tn(this)&&(H(pn,"Restarting streams for network reachability change."),await async function(d){const m=ne(d);m.Ia.add(4),await Jr(m),m.Aa.set("Unknown"),m.Ia.delete(4),await Is(m)}(this))})}),this.Aa=new ay(r,i)}}async function Is(n){if(Tn(n))for(const e of n.da)await e(!0)}async function Jr(n){for(const e of n.da)await e(!1)}function Rh(n,e){const t=ne(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),va(t)?_a(t):nr(t).x_()&&ya(t,e))}function ga(n,e){const t=ne(n),r=nr(t);t.Ta.delete(e),r.x_()&&Ph(t,e),t.Ta.size===0&&(r.x_()?r.B_():Tn(t)&&t.Aa.set("Unknown"))}function ya(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ee.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}nr(n).H_(e)}function Ph(n,e){n.Ra.$e(e),nr(n).Y_(e)}function _a(n){n.Ra=new ng({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),nr(n).start(),n.Aa.aa()}function va(n){return Tn(n)&&!nr(n).M_()&&n.Ta.size>0}function Tn(n){return ne(n).Ia.size===0}function xh(n){n.Ra=void 0}async function cy(n){n.Aa.set("Online")}async function uy(n){n.Ta.forEach((e,t)=>{ya(n,e)})}async function hy(n,e){xh(n),va(n)?(n.Aa.la(e),_a(n)):n.Aa.set("Unknown")}async function dy(n,e,t){if(n.Aa.set("Online"),e instanceof ph&&e.state===2&&e.cause)try{await async function(i,s){const a=s.cause;for(const l of s.targetIds)i.Ta.has(l)&&(await i.remoteSyncer.rejectListen(l,a),i.Ta.delete(l),i.Ra.removeTarget(l))}(n,e)}catch(r){H(pn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await is(n,r)}else if(e instanceof Vi?n.Ra.Ye(e):e instanceof mh?n.Ra.it(e):n.Ra.et(e),!t.isEqual(ee.min()))try{const r=await Ch(n.localStore);t.compareTo(r)>=0&&await function(s,a){const l=s.Ra.Pt(a);return l.targetChanges.forEach((d,m)=>{if(d.resumeToken.approximateByteSize()>0){const g=s.Ta.get(m);g&&s.Ta.set(m,g.withResumeToken(d.resumeToken,a))}}),l.targetMismatches.forEach((d,m)=>{const g=s.Ta.get(d);if(!g)return;s.Ta.set(d,g.withResumeToken(Qe.EMPTY_BYTE_STRING,g.snapshotVersion)),Ph(s,d);const C=new Ot(g.target,d,m,g.sequenceNumber);ya(s,C)}),s.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(r){H(pn,"Failed to raise snapshot:",r),await is(n,r)}}async function is(n,e,t){if(!tr(e))throw e;n.Ia.add(1),await Jr(n),n.Aa.set("Offline"),t||(t=()=>Ch(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{H(pn,"Retrying IndexedDB access"),await t(),n.Ia.delete(1),await Is(n)})}function Dh(n,e){return e().catch(t=>is(n,t,e))}async function As(n){const e=ne(n),t=Jt(e);let r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:na;for(;fy(e);)try{const i=await Kg(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,my(e,i)}catch(i){await is(e,i)}Vh(e)&&Bh(e)}function fy(n){return Tn(n)&&n.Pa.length<10}function my(n,e){n.Pa.push(e);const t=Jt(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function Vh(n){return Tn(n)&&!Jt(n).M_()&&n.Pa.length>0}function Bh(n){Jt(n).start()}async function py(n){Jt(n).na()}async function gy(n){const e=Jt(n);for(const t of n.Pa)e.X_(t.mutations)}async function yy(n,e,t){const r=n.Pa.shift(),i=ca.from(r,e,t);await Dh(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await As(n)}async function _y(n,e){e&&Jt(n).Z_&&await async function(r,i){if(function(a){return eg(a)&&a!==j.ABORTED}(i.code)){const s=r.Pa.shift();Jt(r).N_(),await Dh(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await As(r)}}(n,e),Vh(n)&&Bh(n)}async function Tc(n,e){const t=ne(n);t.asyncQueue.verifyOperationInProgress(),H(pn,"RemoteStore received new credentials");const r=Tn(t);t.Ia.add(3),await Jr(t),r&&t.Aa.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),await Is(t)}async function vy(n,e){const t=ne(n);e?(t.Ia.delete(2),await Is(t)):e||(t.Ia.add(2),await Jr(t),t.Aa.set("Unknown"))}function nr(n){return n.Va||(n.Va=function(t,r,i){const s=ne(t);return s.ia(),new ry(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:cy.bind(null,n),e_:uy.bind(null,n),n_:hy.bind(null,n),J_:dy.bind(null,n)}),n.da.push(async e=>{e?(n.Va.N_(),va(n)?_a(n):n.Aa.set("Unknown")):(await n.Va.stop(),xh(n))})),n.Va}function Jt(n){return n.ma||(n.ma=function(t,r,i){const s=ne(t);return s.ia(),new iy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:py.bind(null,n),n_:_y.bind(null,n),ea:gy.bind(null,n),ta:yy.bind(null,n)}),n.da.push(async e=>{e?(n.ma.N_(),await As(n)):(await n.ma.stop(),n.Pa.length>0&&(H(pn,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))})),n.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,l=new Ea(e,t,a,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new W(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ta(n,e){if(Pt("AsyncQueue",`${e}: ${n}`),tr(n))return new W(j.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{static emptySet(e){return new Un(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||K.comparator(t.key,r.key):(t,r)=>K.comparator(t.key,r.key),this.keyedMap=vr(),this.sortedSet=new Re(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Un)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Un;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(){this.fa=new Re(K.comparator)}track(e){const t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):X(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}}class Qn{constructor(e,t,r,i,s,a,l,d,m){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=m}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new Qn(e,t,Un.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_s(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ey{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class Ty{constructor(){this.queries=bc(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){const i=ne(t),s=i.queries;i.queries=bc(),s.forEach((a,l)=>{for(const d of l.wa)d.onError(r)})})(this,new W(j.ABORTED,"Firestore shutting down"))}}function bc(){return new vn(n=>th(n),_s)}async function Nh(n,e){const t=ne(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new Ey,r=e.ba()?0:1);try{switch(r){case 0:s.ya=await t.onListen(i,!0);break;case 1:s.ya=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const l=Ta(a,`Initialization of query '${xn(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&wa(t)}async function Lh(n,e){const t=ne(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const a=s.wa.indexOf(e);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function wy(n,e){const t=ne(n);let r=!1;for(const i of e){const s=i.query,a=t.queries.get(s);if(a){for(const l of a.wa)l.Ca(i)&&(r=!0);a.ya=i}}r&&wa(t)}function by(n,e,t){const r=ne(n),i=r.queries.get(e);if(i)for(const s of i.wa)s.onError(t);r.queries.delete(e)}function wa(n){n.Da.forEach(e=>{e.next()})}var Io,Ic;(Ic=Io||(Io={})).Fa="default",Ic.Cache="cache";class Mh{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Qn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;const r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=Qn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Io.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e){this.key=e}}class Fh{constructor(e){this.key=e}}class Iy{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=oe(),this.mutatedKeys=oe(),this.Xa=nh(e),this.eu=new Un(this.Xa)}get tu(){return this.Ha}nu(e,t){const r=t?t.ru:new wc,i=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1;const d=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,m=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,C)=>{const k=i.get(g),E=vs(this.query,C)?C:null,P=!!k&&this.mutatedKeys.has(k.key),V=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations);let N=!1;k&&E?k.data.isEqual(E.data)?P!==V&&(r.track({type:3,doc:E}),N=!0):this.iu(k,E)||(r.track({type:2,doc:E}),N=!0,(d&&this.Xa(E,d)>0||m&&this.Xa(E,m)<0)&&(l=!0)):!k&&E?(r.track({type:0,doc:E}),N=!0):k&&!E&&(r.track({type:1,doc:k}),N=!0,(d||m)&&(l=!0)),N&&(E?(a=a.add(E),s=V?s.add(g):s.delete(g)):(a=a.delete(g),s=s.delete(g)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const g=this.query.limitType==="F"?a.last():a.first();a=a.delete(g.key),s=s.delete(g.key),r.track({type:1,doc:g})}return{eu:a,ru:r,Ds:l,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const a=e.ru.pa();a.sort((g,C)=>function(E,P){const V=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return X(20277,{At:N})}};return V(E)-V(P)}(g.type,C.type)||this.Xa(g.doc,C.doc)),this.su(r),i=i!=null&&i;const l=t&&!i?this.ou():[],d=this.Za.size===0&&this.current&&!i?1:0,m=d!==this.Ya;return this.Ya=d,a.length!==0||m?{snapshot:new Qn(this.query,e.eu,s,a,e.mutatedKeys,d===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:l}:{_u:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new wc,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=oe(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});const t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new Fh(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new Oh(r))}),t}uu(e){this.Ha=e.qs,this.Za=oe();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return Qn.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const ba="SyncEngine";class Ay{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Cy{constructor(e){this.key=e,this.lu=!1}}class Sy{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new vn(l=>th(l),_s),this.Tu=new Map,this.Iu=new Set,this.du=new Re(K.comparator),this.Eu=new Map,this.Au=new da,this.Ru={},this.Vu=new Map,this.mu=Kn.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function ky(n,e,t=!0){const r=Hh(n);let i;const s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=await Uh(r,e,t,!0),i}async function Ry(n,e){const t=Hh(n);await Uh(t,e,!0,!1)}async function Uh(n,e,t,r){const i=await Qg(n.localStore,_t(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t);let l;return r&&(l=await Py(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Rh(n.remoteStore,i),l}async function Py(n,e,t,r,i){n.gu=(C,k,E)=>async function(V,N,$,q){let G=N.view.nu($);G.Ds&&(G=await gc(V.localStore,N.query,!1).then(({documents:A})=>N.view.nu(A,G)));const O=q&&q.targetChanges.get(N.targetId),L=q&&q.targetMismatches.get(N.targetId)!=null,U=N.view.applyChanges(G,V.isPrimaryClient,O,L);return Cc(V,N.targetId,U._u),U.snapshot}(n,C,k,E);const s=await gc(n.localStore,e,!0),a=new Iy(e,s.qs),l=a.nu(s.documents),d=Yr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),m=a.applyChanges(l,n.isPrimaryClient,d);Cc(n,t,m._u);const g=new Ay(e,t,a);return n.Pu.set(e,g),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),m.snapshot}async function xy(n,e,t){const r=ne(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(a=>!_s(a,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await wo(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ga(r.remoteStore,i.targetId),Ao(r,i.targetId)}).catch(er)):(Ao(r,i.targetId),await wo(r.localStore,i.targetId,!0))}async function Dy(n,e){const t=ne(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ga(t.remoteStore,r.targetId))}async function Vy(n,e,t){const r=Uy(n);try{const i=await function(a,l){const d=ne(a),m=be.now(),g=l.reduce((E,P)=>E.add(P.key),oe());let C,k;return d.persistence.runTransaction("Locally write mutations","readwrite",E=>{let P=xt(),V=oe();return d.Os.getEntries(E,g).next(N=>{P=N,P.forEach(($,q)=>{q.isValidDocument()||(V=V.add($))})}).next(()=>d.localDocuments.getOverlayedDocuments(E,P)).next(N=>{C=N;const $=[];for(const q of l){const G=Qp(q,C.get(q.key).overlayedDocument);G!=null&&$.push(new En(q.key,G,Ku(G.value.mapValue),vt.exists(!0)))}return d.mutationQueue.addMutationBatch(E,m,$,l)}).next(N=>{k=N;const $=N.applyToLocalDocumentSet(C,V);return d.documentOverlayCache.saveOverlays(E,N.batchId,$)})}).then(()=>({batchId:k.batchId,changes:ih(C)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,l,d){let m=a.Ru[a.currentUser.toKey()];m||(m=new Re(se)),m=m.insert(l,d),a.Ru[a.currentUser.toKey()]=m}(r,i.batchId,t),await Zr(r,i.changes),await As(r.remoteStore)}catch(i){const s=Ta(i,"Failed to persist write");t.reject(s)}}async function jh(n,e){const t=ne(n);try{const r=await Gg(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Eu.get(s);a&&(me(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?me(a.lu,14607):i.removedDocuments.size>0&&(me(a.lu,42227),a.lu=!1))}),await Zr(t,r,e)}catch(r){await er(r)}}function Ac(n,e,t){const r=ne(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Pu.forEach((s,a)=>{const l=a.view.va(e);l.snapshot&&i.push(l.snapshot)}),function(a,l){const d=ne(a);d.onlineState=l;let m=!1;d.queries.forEach((g,C)=>{for(const k of C.wa)k.va(l)&&(m=!0)}),m&&wa(d)}(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function By(n,e,t){const r=ne(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Eu.get(e),s=i&&i.key;if(s){let a=new Re(K.comparator);a=a.insert(s,tt.newNoDocument(s,ee.min()));const l=oe().add(s),d=new ws(ee.min(),new Map,new Re(se),a,l);await jh(r,d),r.du=r.du.remove(s),r.Eu.delete(e),Ia(r)}else await wo(r.localStore,e,!1).then(()=>Ao(r,e,t)).catch(er)}async function Ny(n,e){const t=ne(n),r=e.batch.batchId;try{const i=await Hg(t.localStore,e);$h(t,r,null),zh(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Zr(t,i)}catch(i){await er(i)}}async function Ly(n,e,t){const r=ne(n);try{const i=await function(a,l){const d=ne(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let g;return d.mutationQueue.lookupMutationBatch(m,l).next(C=>(me(C!==null,37113),g=C.keys(),d.mutationQueue.removeMutationBatch(m,C))).next(()=>d.mutationQueue.performConsistencyCheck(m)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(m,g,l)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,g)).next(()=>d.localDocuments.getDocuments(m,g))})}(r.localStore,e);$h(r,e,t),zh(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Zr(r,i)}catch(i){await er(i)}}function zh(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function $h(n,e,t){const r=ne(n);let i=r.Ru[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function Ao(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||qh(n,r)})}function qh(n,e){n.Iu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ga(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),Ia(n))}function Cc(n,e,t){for(const r of t)r instanceof Oh?(n.Au.addReference(r.key,e),My(n,r)):r instanceof Fh?(H(ba,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||qh(n,r.key)):X(19791,{yu:r})}function My(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(H(ba,"New document in limbo: "+t),n.Iu.add(r),Ia(n))}function Ia(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Iu.values().next().value;n.Iu.delete(e);const t=new K(we.fromString(e)),r=n.mu.next();n.Eu.set(r,new Cy(t)),n.du=n.du.insert(t,r),Rh(n.remoteStore,new Ot(_t(ys(t.path)),r,"TargetPurposeLimboResolution",fs.ue))}}async function Zr(n,e,t){const r=ne(n),i=[],s=[],a=[];r.Pu.isEmpty()||(r.Pu.forEach((l,d)=>{a.push(r.gu(d,e,t).then(m=>{var g;if((m||t)&&r.isPrimaryClient){const C=m?!m.fromCache:(g=t?.targetChanges.get(d.targetId))===null||g===void 0?void 0:g.current;r.sharedClientState.updateQueryState(d.targetId,C?"current":"not-current")}if(m){i.push(m);const C=ma.Es(d.targetId,m);s.push(C)}}))}),await Promise.all(a),r.hu.J_(i),await async function(d,m){const g=ne(d);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",C=>F.forEach(m,k=>F.forEach(k.Is,E=>g.persistence.referenceDelegate.addReference(C,k.targetId,E)).next(()=>F.forEach(k.ds,E=>g.persistence.referenceDelegate.removeReference(C,k.targetId,E)))))}catch(C){if(!tr(C))throw C;H(pa,"Failed to update sequence numbers: "+C)}for(const C of m){const k=C.targetId;if(!C.fromCache){const E=g.Fs.get(k),P=E.snapshotVersion,V=E.withLastLimboFreeSnapshotVersion(P);g.Fs=g.Fs.insert(k,V)}}}(r.localStore,s))}async function Oy(n,e){const t=ne(n);if(!t.currentUser.isEqual(e)){H(ba,"User change. New user:",e.toKey());const r=await Ah(t.localStore,e);t.currentUser=e,function(s,a){s.Vu.forEach(l=>{l.forEach(d=>{d.reject(new W(j.CANCELLED,a))})}),s.Vu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Zr(t,r.Bs)}}function Fy(n,e){const t=ne(n),r=t.Eu.get(e);if(r&&r.lu)return oe().add(r.key);{let i=oe();const s=t.Tu.get(e);if(!s)return i;for(const a of s){const l=t.Pu.get(a);i=i.unionWith(l.view.tu)}return i}}function Hh(n){const e=ne(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=jh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Fy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=By.bind(null,e),e.hu.J_=wy.bind(null,e.eventManager),e.hu.pu=by.bind(null,e.eventManager),e}function Uy(n){const e=ne(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ny.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ly.bind(null,e),e}class ss{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=bs(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return qg(this.persistence,new jg,e.initialUser,this.serializer)}Du(e){return new Ih(fa.Vi,this.serializer)}bu(e){return new Yg}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ss.provider={build:()=>new ss};class jy extends ss{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){me(this.persistence.referenceDelegate instanceof rs,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Cg(r,e.asyncQueue,t)}Du(e){const t=this.cacheSizeBytes!==void 0?rt.withCacheSize(this.cacheSizeBytes):rt.DEFAULT;return new Ih(r=>rs.Vi(r,t),this.serializer)}}class Co{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ac(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Oy.bind(null,this.syncEngine),await vy(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Ty}()}createDatastore(e){const t=bs(e.databaseInfo.databaseId),r=function(s){return new ny(s)}(e.databaseInfo);return function(s,a,l,d){return new oy(s,a,l,d)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,a,l){return new ly(r,i,s,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>Ac(this.syncEngine,t,0),function(){return vc.C()?new vc:new Jg}())}createSyncEngine(e,t){return function(i,s,a,l,d,m,g){const C=new Sy(i,s,a,l,d,m);return g&&(C.fu=!0),C}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const s=ne(i);H(pn,"RemoteStore shutting down."),s.Ia.add(5),await Jr(s),s.Ea.shutdown(),s.Aa.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Co.provider={build:()=>new Co};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Pt("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zt="FirestoreClient";class zy{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=et.UNAUTHENTICATED,this.clientId=ea.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async a=>{H(Zt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(H(Zt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ta(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Qs(n,e){n.asyncQueue.verifyOperationInProgress(),H(Zt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await Ah(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>{Wt("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{H("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Wt("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e}async function Sc(n,e){n.asyncQueue.verifyOperationInProgress();const t=await $y(n);H(Zt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Tc(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Tc(e.remoteStore,i)),n._onlineComponents=e}async function $y(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){H(Zt,"Using user provided OfflineComponentProvider");try{await Qs(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===j.FAILED_PRECONDITION||i.code===j.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Wt("Error using user provided cache. Falling back to memory cache: "+t),await Qs(n,new ss)}}else H(Zt,"Using default OfflineComponentProvider"),await Qs(n,new jy(void 0));return n._offlineComponents}async function Wh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(H(Zt,"Using user provided OnlineComponentProvider"),await Sc(n,n._uninitializedComponentsProvider._online)):(H(Zt,"Using default OnlineComponentProvider"),await Sc(n,new Co))),n._onlineComponents}function qy(n){return Wh(n).then(e=>e.syncEngine)}async function So(n){const e=await Wh(n),t=e.eventManager;return t.onListen=ky.bind(null,e.syncEngine),t.onUnlisten=xy.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ry.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Dy.bind(null,e.syncEngine),t}function Hy(n,e,t={}){const r=new Ht;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,l,d,m){const g=new Gh({next:k=>{g.Ou(),a.enqueueAndForget(()=>Lh(s,C));const E=k.docs.has(l);!E&&k.fromCache?m.reject(new W(j.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&k.fromCache&&d&&d.source==="server"?m.reject(new W(j.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(k)},error:k=>m.reject(k)}),C=new Mh(ys(l.path),g,{includeMetadataChanges:!0,ka:!0});return Nh(s,C)}(await So(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kh(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qh="firestore.googleapis.com",Rc=!0;class Pc{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new W(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Qh,this.ssl=Rc}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Rc;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=bh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Ig)throw new W(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}lp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Kh((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new W(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new W(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new W(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Cs{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Pc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new W(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new W(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Pc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Zm;switch(r.type){case"firstParty":return new rp(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new W(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=kc.get(t);r&&(H("ComponentProvider","Removing Datastore"),kc.delete(t),r.terminate())}(this),Promise.resolve()}}function Gy(n,e,t,r={}){var i;n=kt(n,Cs);const s=Yo(e),a=n._getSettings(),l=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),d=`${e}:${t}`;s&&(Cf(`https://${d}`),Pf("Firestore",!0)),a.host!==Qh&&a.host!==d&&Wt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m=Object.assign(Object.assign({},a),{host:d,ssl:s,emulatorOptions:r});if(!Gi(m,l)&&(n._setSettings(m),r.mockUserToken)){let g,C;if(typeof r.mockUserToken=="string")g=r.mockUserToken,C=et.MOCK_USER;else{g=Sf(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const k=r.mockUserToken.sub||r.mockUserToken.user_id;if(!k)throw new W(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new et(k)}n._authCredentials=new ep(new Nu(g,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ss(this.firestore,e,this._query)}}class Le{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Le(this.firestore,e,this._key)}toJSON(){return{type:Le._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Qr(t,Le._jsonSchema))return new Le(e,r||null,new K(we.fromString(t.referencePath)))}}Le._jsonSchemaVersion="firestore/documentReference/1.0",Le._jsonSchema={type:Ne("string",Le._jsonSchemaVersion),referencePath:Ne("string")};class Gt extends Ss{constructor(e,t,r){super(e,t,ys(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Le(this.firestore,null,new K(e))}withConverter(e){return new Gt(this.firestore,e,this._path)}}function xr(n,e,...t){if(n=qn(n),Mu("collection","path",e),n instanceof Cs){const r=we.fromString(e,...t);return ql(r),new Gt(n,null,r)}{if(!(n instanceof Le||n instanceof Gt))throw new W(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(we.fromString(e,...t));return ql(r),new Gt(n.firestore,null,r)}}function Aa(n,e,...t){if(n=qn(n),arguments.length===1&&(e=ea.newId()),Mu("doc","path",e),n instanceof Cs){const r=we.fromString(e,...t);return $l(r),new Le(n,null,new K(r))}{if(!(n instanceof Le||n instanceof Gt))throw new W(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(we.fromString(e,...t));return $l(r),new Le(n.firestore,n instanceof Gt?n.converter:null,new K(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xc="AsyncQueue";class Dc{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Sh(this,"async_queue_retry"),this.oc=()=>{const r=Ks();r&&H(xc,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;const t=Ks();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=Ks();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const t=new Ht;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!tr(e))throw e;H(xc,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,Pt("INTERNAL UNHANDLED ERROR: ",Vc(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const i=Ea.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&X(47125,{hc:Vc(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function Vc(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class Xn extends Cs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Dc,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Dc(e),this._firestoreClient=void 0,await e}}}function Wy(n,e){const t=typeof n=="object"?n:Um(),r=typeof n=="string"?n:Xi,i=Nm(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=If("firestore");s&&Gy(i,...s)}return i}function Ca(n){if(n._terminated)throw new W(j.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Ky(n),n._firestoreClient}function Ky(n){var e,t,r;const i=n._freezeSettings(),s=function(l,d,m,g){return new vp(l,d,m,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,Kh(g.experimentalLongPollingOptions),g.useFetchStreams,g.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new zy(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(l){const d=l?._online.build();return{_offline:l?._offline.build(d),_online:d}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lt(Qe.fromBase64String(e))}catch(t){throw new W(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new lt(Qe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Qr(e,lt._jsonSchema))return lt.fromBase64String(e.bytes)}}lt._jsonSchemaVersion="firestore/bytes/1.0",lt._jsonSchema={type:Ne("string",lt._jsonSchemaVersion),bytes:Ne("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new W(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xh{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new W(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new W(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Tt._jsonSchemaVersion}}static fromJSON(e){if(Qr(e,Tt._jsonSchema))return new Tt(e.latitude,e.longitude)}}Tt._jsonSchemaVersion="firestore/geoPoint/1.0",Tt._jsonSchema={type:Ne("string",Tt._jsonSchemaVersion),latitude:Ne("number"),longitude:Ne("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:wt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Qr(e,wt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new wt(e.vectorValues);throw new W(j.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}wt._jsonSchemaVersion="firestore/vectorValue/1.0",wt._jsonSchema={type:Ne("string",wt._jsonSchemaVersion),vectorValues:Ne("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy=/^__.*__$/;class Xy{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new En(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xr(e,this.data,t,this.fieldTransforms)}}function Yh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw X(40011,{Ec:n})}}class ka{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new ka(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return os(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(Yh(this.Ec)&&Qy.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class Yy{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||bs(e)}Dc(e,t,r,i=!1){return new ka({Ec:e,methodName:t,bc:r,path:Ke.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Jy(n){const e=n._freezeSettings(),t=bs(n._databaseId);return new Yy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Zy(n,e,t,r,i,s={}){const a=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);td("Data must be an object, but it was:",a,r);const l=Zh(r,a);let d,m;if(s.merge)d=new mt(a.fieldMask),m=a.fieldTransforms;else if(s.mergeFields){const g=[];for(const C of s.mergeFields){const k=e_(e,C,t);if(!a.contains(k))throw new W(j.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);n_(g,k)||g.push(k)}d=new mt(g),m=a.fieldTransforms.filter(C=>d.covers(C.field))}else d=null,m=a.fieldTransforms;return new Xy(new at(l),d,m)}function Jh(n,e){if(ed(n=qn(n)))return td("Unsupported field value:",e,n),Zh(n,e);if(n instanceof Xh)return function(r,i){if(!Yh(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const l of r){let d=Jh(l,i.yc(a));d==null&&(d={nullValue:"NULL_VALUE"}),s.push(d),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=qn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return $p(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=be.fromDate(r);return{timestampValue:ns(i.serializer,s)}}if(r instanceof be){const s=new be(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ns(i.serializer,s)}}if(r instanceof Tt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof lt)return{bytesValue:gh(i.serializer,r._byteString)};if(r instanceof Le){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ha(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof wt)return function(a,l){return{mapValue:{fields:{[Gu]:{stringValue:Wu},[Yi]:{arrayValue:{values:a.toArray().map(m=>{if(typeof m!="number")throw l.wc("VectorValues must only contain numeric values.");return aa(l.serializer,m)})}}}}}}(r,i);throw i.wc(`Unsupported field value: ${ta(r)}`)}(n,e)}function Zh(n,e){const t={};return Uu(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_n(n,(r,i)=>{const s=Jh(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function ed(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof be||n instanceof Tt||n instanceof lt||n instanceof Le||n instanceof Xh||n instanceof wt)}function td(n,e,t){if(!ed(t)||!Ou(t)){const r=ta(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function e_(n,e,t){if((e=qn(e))instanceof Sa)return e._internalPath;if(typeof e=="string")return nd(n,e);throw os("Field path arguments must be of type string or ",n,!1,void 0,t)}const t_=new RegExp("[~\\*/\\[\\]]");function nd(n,e,t){if(e.search(t_)>=0)throw os(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Sa(...e.split("."))._internalPath}catch{throw os(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function os(n,e,t,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(s||a)&&(d+=" (found",s&&(d+=` in field ${r}`),a&&(d+=` in document ${i}`),d+=")"),new W(j.INVALID_ARGUMENT,l+n+d)}function n_(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Le(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new r_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(id("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class r_ extends rd{data(){return super.data()}}function id(n,e){return typeof e=="string"?nd(n,e):e instanceof Sa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i_(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new W(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class s_{convertValue(e,t="none"){switch(Yt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Xt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw X(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return _n(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;const s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Yi].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>Ve(a.doubleValue));return new wt(s)}convertGeoPoint(e){return new Tt(Ve(e.latitude),Ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=ps(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zr(e));default:return null}}convertTimestamp(e){const t=Qt(e);return new be(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=we.fromString(e);me(wh(r),9688,{name:e});const i=new $r(r.get(1),r.get(3)),s=new K(r.popFirst(5));return i.isEqual(t)||Pt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o_(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Tr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fn extends rd{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Bi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(id("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new W(j.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=fn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}fn._jsonSchemaVersion="firestore/documentSnapshot/1.0",fn._jsonSchema={type:Ne("string",fn._jsonSchemaVersion),bundleSource:Ne("string","DocumentSnapshot"),bundleName:Ne("string"),bundle:Ne("string")};class Bi extends fn{data(e={}){return super.data(e)}}class jn{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Tr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Bi(this._firestore,this._userDataWriter,r.key,r,new Tr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new W(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>{const d=new Bi(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Tr(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:d,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>s||l.type!==3).map(l=>{const d=new Bi(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Tr(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,g=-1;return l.type!==0&&(m=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),g=a.indexOf(l.doc.key)),{type:a_(l.type),doc:d,oldIndex:m,newIndex:g}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new W(j.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=jn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ea.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function a_(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return X(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l_(n){n=kt(n,Le);const e=kt(n.firestore,Xn);return Hy(Ca(e),n._key).then(t=>ld(e,n,t))}jn._jsonSchemaVersion="firestore/querySnapshot/1.0",jn._jsonSchema={type:Ne("string",jn._jsonSchemaVersion),bundleSource:Ne("string","QuerySnapshot"),bundleName:Ne("string"),bundle:Ne("string")};class sd extends s_{constructor(e){super(),this.firestore=e}convertBytes(e){return new lt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Le(this.firestore,null,t)}}function Ra(n,e,t){n=kt(n,Le);const r=kt(n.firestore,Xn),i=o_(n.converter,e,t);return ad(r,[Zy(Jy(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,vt.none())])}function c_(n){return ad(kt(n.firestore,Xn),[new la(n._key,vt.none())])}function od(n,...e){var t,r,i;n=qn(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Bc(e[a])||(s=e[a++]);const l={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Bc(e[a])){const C=e[a];e[a]=(t=C.next)===null||t===void 0?void 0:t.bind(C),e[a+1]=(r=C.error)===null||r===void 0?void 0:r.bind(C),e[a+2]=(i=C.complete)===null||i===void 0?void 0:i.bind(C)}let d,m,g;if(n instanceof Le)m=kt(n.firestore,Xn),g=ys(n._key.path),d={next:C=>{e[a]&&e[a](ld(m,n,C))},error:e[a+1],complete:e[a+2]};else{const C=kt(n,Ss);m=kt(C.firestore,Xn),g=C._query;const k=new sd(m);d={next:E=>{e[a]&&e[a](new jn(m,k,C,E))},error:e[a+1],complete:e[a+2]},i_(n._query)}return function(k,E,P,V){const N=new Gh(V),$=new Mh(E,N,P);return k.asyncQueue.enqueueAndForget(async()=>Nh(await So(k),$)),()=>{N.Ou(),k.asyncQueue.enqueueAndForget(async()=>Lh(await So(k),$))}}(Ca(m),g,l,d)}function ad(n,e){return function(r,i){const s=new Ht;return r.asyncQueue.enqueueAndForget(async()=>Vy(await qy(r),i,s)),s.promise}(Ca(n),e)}function ld(n,e,t){const r=t.docs.get(e._key),i=new sd(n);return new fn(n,i,e._key,r,new Tr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Zn=i})(Fm),Ki(new Fr("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),l=new Xn(new tp(r.getProvider("auth-internal")),new ip(a,r.getProvider("app-check-internal")),function(m,g){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new W(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $r(m.options.projectId,g)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),l._setSettings(s),l},"PUBLIC").setMultipleInstances(!0)),Fn(Ol,Fl,e),Fn(Ol,Fl,"esm2017")})();const u_={apiKey:"AIzaSyAURA1Os8rPj_ov0ofDs-BCyO3aKhibhtw",authDomain:"webrtc-tutorial-81613.firebaseapp.com",projectId:"webrtc-tutorial-81613",storageBucket:"webrtc-tutorial-81613.firebasestorage.app",messagingSenderId:"911640820129",appId:"1:911640820129:web:b7102245c80e146013b3e0",measurementId:"G-68WFGEKPQB"},h_=Au(u_),cd=Wy(h_);async function ko(n,e,t){const r=Ft[n];if(document.visibilityState!=="visible"||!r||r.readyState!=="live"){console.warn(`SENDER: Cannot apply PTZ to ${n}. Page not visible or track not live.`);return}try{await r.applyConstraints({advanced:[{[e]:t}]})}catch(i){console.error(`SENDER: Error applying ${e} constraint to ${n}:`,i)}}function ud(n){console.log(`RECEIVER: Updating PTZ controls for ${n}`),lu(n);const e=ls[n];["zoom","pan","tilt"].forEach(t=>{const r=!!(e&&e[t]),i=document.getElementById(`${t}Slider`),s=document.getElementById(`${t}Value`);if(document.querySelectorAll(`button[id$="${t.charAt(0).toUpperCase()+t.slice(1)}Btn"]`).forEach(a=>a.disabled=!r),i&&(i.disabled=!r),r){const{min:a,max:l,step:d}=e[t];i.min=a,i.max=l,i.step=d;const m=parseFloat(i.value);i.value=Math.max(a,Math.min(l,m)),s.textContent=parseFloat(i.value).toFixed(2)}else s&&(s.textContent="N/A")})}function Se(n,e){const t=Nr,r=ls[t];if(ve?.connectionState!=="connected"||Vr?.readyState!=="open"){console.warn("RECEIVER: Cannot send command. Connection not ready.");return}if(!r||!r[n]){console.warn(`RECEIVER: PTZ type '${n}' is not supported for ${t}.`);return}const{min:i,max:s}=r[n],a=Math.max(i,Math.min(s,e)),l={type:"command",target:t,command:n,value:a};try{Vr.send(JSON.stringify(l)),document.getElementById(`${n}Slider`).value=a,document.getElementById(`${n}Value`).textContent=a.toFixed(2)}catch(d){console.error("RECEIVER: Error sending command via DataChannel:",d)}}function d_(){const n=ve.createDataChannel("ptz");Mo(n),n.onopen=()=>{console.log("SENDER: DataChannel is open. Sending capabilities...");const e={};for(const t in Ft){const r=Ft[t];if(r){const i=r.getCapabilities();e[t]={zoom:i.zoom,pan:i.pan,tilt:i.tilt}}}n.send(JSON.stringify({type:"capabilities",data:e}))},n.onmessage=e=>{const t=JSON.parse(e.data);t.type==="command"&&Ft[t.target]&&ko(t.target,t.command,t.value)},n.onclose=()=>console.log("SENDER: DataChannel is closed."),n.onerror=e=>console.error("SENDER: DataChannel error:",e)}function f_(n){if(n.channel.label!=="ptz")return;const e=n.channel;Mo(e),e.onopen=()=>console.log("RECEIVER: DataChannel is open."),e.onmessage=t=>{const r=JSON.parse(t.data);r.type==="capabilities"&&(qd(r.data),r.data.camera2?io.style.display="inline":(io.style.display="none",Nr==="camera2"&&(document.querySelector('input[name="ptzTarget"][value="camera1"]').checked=!0,lu("camera1"))),zi.style.display="block",ud(Nr))},e.onclose=()=>{zi.style.display="none"},e.onerror=t=>console.error("RECEIVER: DataChannel error:",t)}async function m_(){if(!(!ve||yn!=="receiver"||ve.connectionState!=="connected"))try{const n=await ve.getStats();Mn&&Object.values(Mn).forEach(e=>{e&&e.displayElement&&(e.displayElement.style.display="none")}),n.forEach(e=>{if(e.type==="inbound-rtp"&&e.mediaType==="video"&&Mn){const t=Mn[e.trackIdentifier];t&&t.displayElement&&e.frameWidth&&e.frameHeight&&(t.displayElement.textContent=`${e.frameWidth} x ${e.frameHeight}`,t.displayElement.style.display="block")}})}catch(n){console.error("Error getting stats for resolution display:",n)}}function p_(n,e){const t=Ft.camera1?.id,r=Ft.camera2?.id,i=new Map;n.forEach(s=>{s.type==="media-source"&&i.set(s.id,s.trackIdentifier)}),n.forEach(s=>{if(s.type==="outbound-rtp"&&s.mediaType==="video"){const a=i.get(s.mediaSourceId);if(!a)return;let l;if(a===t?l="camera1":a===r&&(l="camera2"),l){const d=Br?.get(s.id),m=s.bytesSent-(d?.bytesSent??0),g=s.packetsSent-(d?.packetsSent??0);e[`${l}_sent_resolution`]=`${s.frameWidth}x${s.frameHeight}`,e[`${l}_sent_fps`]=s.framesPerSecond,e[`${l}_sent_bitrate_kbps`]=Math.round(Math.max(0,m)*8/1e3),e[`${l}_packets_sent_per_second`]=Math.max(0,g),e[`${l}_total_encode_time_s`]=s.totalEncodeTime,e[`${l}_keyframes_encoded`]=s.keyFramesEncoded,e[`${l}_quality_limitation_reason`]=s.qualityLimitationReason,e[`${l}_quality_limitation_resolution_changes`]=s.qualityLimitationResolutionChanges,e[`${l}_retransmitted_packets_sent`]=s.retransmittedPacketsSent,e[`${l}_nack_count`]=s.nackCount}}if(s.type==="remote-inbound-rtp"&&s.mediaType==="video"&&(e.receiver_jitter_ms=(s.jitter*1e3).toFixed(4)??"N/A",e.receiver_packets_lost=s.packetsLost,e.receiver_fraction_lost=s.fractionLost,e.rtt_rtcp_ms=(s.roundTripTime*1e3).toFixed(4)??"N/A"),s.type==="candidate-pair"&&s.nominated&&s.state==="succeeded"){e.available_outgoing_bitrate_kbps=s.availableOutgoingBitrate?Math.round(s.availableOutgoingBitrate/1e3):"N/A",e.rtt_ice_ms=(s.currentRoundTripTime*1e3).toFixed(4)??"N/A";const a=n.get(s.remoteCandidateId);if(a&&a.candidateType){let l;switch(a.candidateType){case"host":l=0;break;case"srflx":case"prflx":l=1;break;case"relay":l=2;break;default:l=-1;break}e.connection_type=l}}if(s.type==="data-channel"){const a=Br?.get(s.id),l=s.bytesSent-(a?.bytesSent??0),d=s.bytesReceived-(a?.bytesReceived??0);e[`datachannel_${s.label}_state`]=s.state,e[`datachannel_${s.label}_messages_sent`]=s.messagesSent,e[`datachannel_${s.label}_bytes_sent_total`]=s.bytesSent,e[`datachannel_${s.label}_messages_received`]=s.messagesReceived,e[`datachannel_${s.label}_bytes_received_total`]=s.bytesReceived,e[`datachannel_${s.label}_sent_bitrate_kbps`]=Math.round(Math.max(0,l)*8/1e3),e[`datachannel_${s.label}_received_bitrate_kbps`]=Math.round(Math.max(0,d)*8/1e3)}})}function g_(n,e){n.forEach(t=>{if(t.type==="inbound-rtp"&&t.mediaType==="video"){const r=Mn[t.trackIdentifier],i=r?r.name:null;if(i){const s=Br?.get(t.id),a=t.bytesReceived-(s?.bytesReceived??0),l=t.packetsReceived-(s?.packetsReceived??0);e[`${i}_received_resolution`]=`${t.frameWidth}x${t.frameHeight}`,e[`${i}_received_fps`]=t.framesPerSecond,e[`${i}_received_bitrate_kbps`]=Math.round(Math.max(0,a)*8/1e3),e[`${i}_packets_received_per_second`]=Math.max(0,l),e[`${i}_jitter_ms`]=(t.jitter*1e3).toFixed(4)??"N/A",e[`${i}_fraction_lost`]=t.fractionLost,e[`${i}_packets_lost`]=t.packetsLost,e[`${i}_frames_dropped`]=t.framesDropped,e[`${i}_total_decode_time_s`]=t.totalDecodeTime,e[`${i}_keyframes_decoded`]=t.keyFramesDecoded,e[`${i}_jitter_buffer_delay_s`]=t.jitterBufferDelay,e[`${i}_fir_count`]=t.firCount,e[`${i}_pli_count`]=t.pliCount,e[`${i}_jitter_buffer_emitted_count`]=t.jitterBufferEmittedCount}}if(t.type==="candidate-pair"&&t.nominated&&t.state==="succeeded"){const r=n.get(t.remoteCandidateId);r&&r.candidateType&&(e.connection_type=r.candidateType)}if(t.type==="data-channel"){const r=Br?.get(t.id),i=t.bytesSent-(r?.bytesSent??0),s=t.bytesReceived-(r?.bytesReceived??0);e[`datachannel_${t.label}_state`]=t.state,e[`datachannel_${t.label}_messages_sent`]=t.messagesSent,e[`datachannel_${t.label}_bytes_sent_total`]=t.bytesSent,e[`datachannel_${t.label}_messages_received`]=t.messagesReceived,e[`datachannel_${t.label}_bytes_received_total`]=t.bytesReceived,e[`datachannel_${t.label}_sent_bitrate_kbps`]=Math.round(Math.max(0,i)*8/1e3),e[`datachannel_${t.label}_received_bitrate_kbps`]=Math.round(Math.max(0,s)*8/1e3)}})}function hd(){if(!ve||Vo)return;au(!0),ou([]),Fi(null),us.disabled=!0,hs.disabled=!1,ds.disabled=!0,qi.textContent="記録中...";const n=setInterval(async()=>{if(!ve)return;const e=await ve.getStats(),t={timestamp:new Date().toISOString()};yn==="sender"?p_(e,t):g_(e,t),Object.keys(t).length>1&&(Ut.push(t),qi.textContent=`記録中... ${Ut.length} 個`),Fi(e)},1e3);Hd(n)}function Pa(){Vo&&(clearInterval(nu),au(!1),Fi(null),us.disabled=!1,hs.disabled=!0,ds.disabled=Ut.length===0,qi.textContent=`記録停止。${Ut.length} 個`)}function y_(){if(Ut.length===0){alert("ダウンロードするデータがありません");return}const n=new Set;Ut.forEach(l=>Object.keys(l).forEach(d=>n.add(d)));const e=Array.from(n),r=[e.join(","),...Ut.map(l=>e.map(d=>{const m=l[d]??"";return typeof m=="string"&&m.includes(",")?`"${m.replace(/"/g,'""')}"`:m}).join(","))].join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.download=`webrtc_stats_${yn}_${new Date().toISOString().replace(/[:.]/g,"-")}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}function __(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Nt={},on={},Xs={},Nc;function v_(){return Nc||(Nc=1,Object.defineProperty(Xs,"__esModule",{value:!0})),Xs}var Ei={},Ti={},Lc;function dd(){return Lc||(Lc=1,function(n){(function(e){var t="undefined",r=t!==typeof Buffer&&Buffer,i=t!==typeof Uint8Array&&Uint8Array,s=t!==typeof ArrayBuffer&&ArrayBuffer,a=[0,0,0,0,0,0,0,0],l=Array.isArray||U,d=4294967296,m=16777216,g;C("Uint64BE",!0,!0),C("Int64BE",!0,!1),C("Uint64LE",!1,!0),C("Int64LE",!1,!1);function C(A,y,T){var _=y?0:4,b=y?4:0,S=y?0:3,I=y?1:2,Y=y?2:1,ae=y?3:0,Ie=y?q:O,Ee=y?G:L,Ae=ue.prototype,He="is"+A,ct="_"+He;return Ae.buffer=void 0,Ae.offset=0,Ae[ct]=!0,Ae.toNumber=Me,Ae.toString=ut,Ae.toJSON=Me,Ae.toArray=k,r&&(Ae.toBuffer=E),i&&(Ae.toArrayBuffer=P),ue[He]=Z,e[A]=ue,ue;function ue(te,Q,J,re){return this instanceof ue?ge(this,te,Q,J,re):new ue(te,Q,J,re)}function Z(te){return!!(te&&te[ct])}function ge(te,Q,J,re,de){if(i&&s&&(Q instanceof s&&(Q=new i(Q)),re instanceof s&&(re=new i(re))),!Q&&!J&&!re&&!g){te.buffer=$(a,0);return}if(!V(Q,J)){var Pe=g||Array;de=J,re=Q,J=0,Q=g===r?r.alloc(8):new Pe(8)}te.buffer=Q,te.offset=J|=0,t!==typeof re&&(typeof re=="string"?ke(Q,J,re,de||10):V(re,de)?N(Q,J,re,de):typeof de=="number"?(Xe(Q,J+_,re),Xe(Q,J+b,de)):re>0?Ie(Q,J,re):re<0?Ee(Q,J,re):N(Q,J,a,0))}function ke(te,Q,J,re){var de=0,Pe=J.length,je=0,ze=0;J[0]==="-"&&de++;for(var ht=de;de<Pe;){var pt=parseInt(J[de++],re);if(!(pt>=0))break;ze=ze*re+pt,je=je*re+Math.floor(ze/d),ze%=d}ht&&(je=~je,ze?ze=d-ze:je++),Xe(te,Q+_,je),Xe(te,Q+b,ze)}function Me(){var te=this.buffer,Q=this.offset,J=Oe(te,Q+_),re=Oe(te,Q+b);return T||(J|=0),J?J*d+re:re}function ut(te){var Q=this.buffer,J=this.offset,re=Oe(Q,J+_),de=Oe(Q,J+b),Pe="",je=!T&&re&2147483648;for(je&&(re=~re,de=d-de),te=te||10;;){var ze=re%te*d+de;if(re=Math.floor(re/te),de=Math.floor(ze/te),Pe=(ze%te).toString(te)+Pe,!re&&!de)break}return je&&(Pe="-"+Pe),Pe}function Xe(te,Q,J){te[Q+ae]=J&255,J=J>>8,te[Q+Y]=J&255,J=J>>8,te[Q+I]=J&255,J=J>>8,te[Q+S]=J&255}function Oe(te,Q){return te[Q+S]*m+(te[Q+I]<<16)+(te[Q+Y]<<8)+te[Q+ae]}}function k(A){var y=this.buffer,T=this.offset;return g=null,A!==!1&&l(y)?y.length===8?y:y.slice(T,T+8):$(y,T)}function E(A){var y=this.buffer,T=this.offset;return g=r,A!==!1&&r.isBuffer(y)?y.length===8?y:y.slice(T,T+8):r.from(P.call(this,A))}function P(A){var y=this.buffer,T=this.offset,_=y.buffer;if(g=i,A!==!1&&!y.offset&&_ instanceof s)return _.byteLength===8?_:_.slice(T,T+8);var b=new i(8);return N(b,0,y,T),b.buffer}function V(A,y){var T=A&&A.length;return y|=0,T&&y+8<=T&&typeof A[y]!="string"}function N(A,y,T,_){y|=0,_|=0;for(var b=0;b<8;b++)A[y++]=T[_++]&255}function $(A,y){return Array.prototype.slice.call(A,y,y+8)}function q(A,y,T){for(var _=y+8;_>y;)A[--_]=T&255,T/=256}function G(A,y,T){var _=y+8;for(T++;_>y;)A[--_]=-T&255^255,T/=256}function O(A,y,T){for(var _=y+8;y<_;)A[y++]=T&255,T/=256}function L(A,y,T){var _=y+8;for(T++;y<_;)A[y++]=-T&255^255,T/=256}function U(A){return!!A&&Object.prototype.toString.call(A)=="[object Array]"}})(typeof n.nodeName!="string"?n:Ti||{})}(Ti)),Ti}var Ys={},wi={},gr={},Mc;function fd(){return Mc||(Mc=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.byEbmlID=void 0,gr.byEbmlID={128:{name:"ChapterDisplay",level:4,type:"m",multiple:!0,minver:1,webm:!0,description:"Contains all possible strings to use for the chapter display."},131:{name:"TrackType",level:3,type:"u",mandatory:!0,minver:1,range:"1-254",description:"A set of track types coded on 8 bits (1: video, 2: audio, 3: complex, 0x10: logo, 0x11: subtitle, 0x12: buttons, 0x20: control)."},133:{name:"ChapString",cppname:"ChapterString",level:5,type:"8",mandatory:!0,minver:1,webm:!0,description:"Contains the string to use as the chapter atom."},134:{name:"CodecID",level:3,type:"s",mandatory:!0,minver:1,description:"An ID corresponding to the codec, see the codec page for more info."},136:{name:"FlagDefault",cppname:"TrackFlagDefault",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if that track (audio, video or subs) SHOULD be active if no language found matches the user preference. (1 bit)"},137:{name:"ChapterTrackNumber",level:5,type:"u",mandatory:!0,multiple:!0,minver:1,webm:!1,range:"not 0",description:"UID of the Track to apply this chapter too. In the absense of a control track, choosing this chapter will select the listed Tracks and deselect unlisted tracks. Absense of this element indicates that the Chapter should be applied to any currently used Tracks."},145:{name:"ChapterTimeStart",level:4,type:"u",mandatory:!0,minver:1,webm:!0,description:"Timestamp of the start of Chapter (not scaled)."},146:{name:"ChapterTimeEnd",level:4,type:"u",minver:1,webm:!1,description:"Timestamp of the end of Chapter (timestamp excluded, not scaled)."},150:{name:"CueRefTime",level:5,type:"u",mandatory:!0,minver:2,webm:!1,description:"Timestamp of the referenced Block."},151:{name:"CueRefCluster",level:5,type:"u",mandatory:!0,webm:!1,description:"The Position of the Cluster containing the referenced Block."},152:{name:"ChapterFlagHidden",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a chapter is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},16980:{name:"ContentCompAlgo",level:6,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The compression algorithm used. Algorithms that have been specified so far are: 0 - zlib,   3 - Header Stripping"},16981:{name:"ContentCompSettings",level:6,type:"b",minver:1,webm:!1,description:"Settings that might be needed by the decompressor. For Header Stripping (ContentCompAlgo=3), the bytes that were removed from the beggining of each frames of the track."},17026:{name:"DocType",level:1,type:"s",mandatory:!0,default:"matroska",minver:1,description:"A string that describes the type of document that follows this EBML header. 'matroska' in our case or 'webm' for webm files."},17029:{name:"DocTypeReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum DocType version an interpreter has to support to read this file."},17030:{name:"EBMLVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of EBML parser used to create the file."},17031:{name:"DocTypeVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of DocType interpreter used to create the file."},17476:{name:"SegmentFamily",level:2,type:"b",multiple:!0,minver:1,webm:!1,bytesize:16,description:"A randomly generated unique ID that all segments related to each other must use (128 bits)."},17505:{name:"DateUTC",level:2,type:"d",minver:1,description:"Date of the origin of timestamp (value 0), i.e. production date."},17540:{name:"TagDefault",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Indication to know if this is the default/original language to use for the given tag. (1 bit)"},17541:{name:"TagBinary",level:4,type:"b",minver:1,webm:!1,description:"The values of the Tag if it is binary. Note that this cannot be used in the same SimpleTag as TagString."},17543:{name:"TagString",level:4,type:"8",minver:1,webm:!1,description:"The value of the Element."},17545:{name:"Duration",level:2,type:"f",minver:1,range:"> 0",description:"Duration of the segment (based on TimecodeScale)."},17816:{name:"ChapterFlagEnabled",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Specify wether the chapter is enabled. It can be enabled/disabled by a Control Track. When disabled, the movie should skip all the content between the TimeStart and TimeEnd of this chapter (see flag notes). (1 bit)"},18016:{name:"FileMimeType",level:3,type:"s",mandatory:!0,minver:1,webm:!1,description:"MIME type of the file."},18017:{name:"FileUsedStartTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18018:{name:"FileUsedEndTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18037:{name:"FileReferral",level:3,type:"b",webm:!1,description:"A binary value that a track/codec can refer to when the attachment is needed."},20529:{name:"ContentEncodingOrder",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Tells when this modification was used during encoding/muxing starting with 0 and counting upwards. The decoder/demuxer has to start with the highest order number it finds and work its way down. This value has to be unique over all ContentEncodingOrder elements in the segment."},20530:{name:"ContentEncodingScope",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"A bit field that describes which elements have been modified in this way. Values (big endian) can be OR'ed. Possible values: 1 - all frame contents, 2 - the track's private data, 4 - the next ContentEncoding (next ContentEncodingOrder. Either the data inside ContentCompression and/or ContentEncryption)"},20531:{name:"ContentEncodingType",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"A value describing what kind of transformation has been done. Possible values: 0 - compression, 1 - encryption"},20532:{name:"ContentCompression",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the compression used. Must be present if the value of ContentEncodingType is 0 and absent otherwise. Each block must be decompressable even if no previous block is available in order not to prevent seeking."},20533:{name:"ContentEncryption",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the encryption used. Must be present if the value of ContentEncodingType is 1 and absent otherwise."},21368:{name:"CueBlockNumber",level:4,type:"u",minver:1,default:1,range:"not 0",description:"Number of the Block in the specified Cluster."},22100:{name:"ChapterStringUID",level:4,type:"8",mandatory:!1,minver:3,webm:!0,description:"A unique string ID to identify the Chapter. Use for WebVTT cue identifier storage."},22337:{name:"WritingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Writing application ("mkvmerge-0.3.3").'},22612:{name:"SilentTracks",cppname:"ClusterSilentTracks",level:2,type:"m",minver:1,webm:!1,description:"The list of tracks that are not used in that part of the stream. It is useful when using overlay tracks on seeking. Then you should decide what track to use."},25152:{name:"ContentEncoding",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Settings for one content encoding like compression or encryption."},25188:{name:"BitDepth",cppname:"AudioBitDepth",level:4,type:"u",minver:1,range:"not 0",description:"Bits per sample, mostly used for PCM."},25906:{name:"SignedElement",level:3,type:"b",multiple:!0,webm:!1,description:"An element ID whose data will be used to compute the signature."},26148:{name:"TrackTranslate",level:3,type:"m",multiple:!0,minver:1,webm:!1,description:"The track identification for the given Chapter Codec."},26897:{name:"ChapProcessCommand",cppname:"ChapterProcessCommand",level:5,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26914:{name:"ChapProcessTime",cppname:"ChapterProcessTime",level:6,type:"u",mandatory:!0,minver:1,webm:!1,description:"Defines when the process command should be handled (0: during the whole chapter, 1: before starting playback, 2: after playback of the chapter)."},26916:{name:"ChapterTranslate",level:2,type:"m",multiple:!0,minver:1,webm:!1,description:"A tuple of corresponding ID used by chapter codecs to represent this segment."},26931:{name:"ChapProcessData",cppname:"ChapterProcessData",level:6,type:"b",mandatory:!0,minver:1,webm:!1,description:"Contains the command information. The data should be interpreted depending on the ChapProcessCodecID value. For ChapProcessCodecID = 1, the data correspond to the binary DVD cell pre/post commands."},26948:{name:"ChapProcess",cppname:"ChapterProcess",level:4,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26965:{name:"ChapProcessCodecID",cppname:"ChapterProcessCodecID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Contains the type of the codec used for the processing. A value of 0 means native Matroska processing (to be defined), a value of 1 means the DVD command set is used. More codec IDs can be added later."},29555:{name:"Tag",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters."},29572:{name:"SegmentFilename",level:2,type:"8",minver:1,webm:!1,description:"A filename corresponding to this segment."},29766:{name:"AttachmentLink",cppname:"TrackAttachmentLink",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"The UID of an attachment that is used by this codec."},2459272:{name:"CodecName",level:3,type:"8",minver:1,description:"A human-readable string specifying the codec."},408125543:{name:"Segment",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"This element contains all other top-level (level 1) elements. Typically a Matroska file is composed of 1 segment."},17530:{name:"TagLanguage",level:4,type:"s",mandatory:!0,minver:1,webm:!1,default:"und",description:"Specifies the language of the tag specified, in the Matroska languages form."},17827:{name:"TagName",level:4,type:"8",mandatory:!0,minver:1,webm:!1,description:"The name of the Tag that is going to be stored."},26568:{name:"SimpleTag",cppname:"TagSimple",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contains general information about the target."},25542:{name:"TagAttachmentUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Attachment(s) the tags belong to. If the value is 0 at this level, the tags apply to all the attachments in the Segment."},25540:{name:"TagChapterUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Chapter(s) the tags belong to. If the value is 0 at this level, the tags apply to all chapters in the Segment."},25545:{name:"TagEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the EditionEntry(s) the tags belong to. If the value is 0 at this level, the tags apply to all editions in the Segment."},25541:{name:"TagTrackUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Track(s) the tags belong to. If the value is 0 at this level, the tags apply to all tracks in the Segment."},25546:{name:"TargetType",cppname:"TagTargetType",level:4,type:"s",minver:1,webm:!1,strong:"informational",description:'An  string that can be used to display the logical level of the target like "ALBUM", "TRACK", "MOVIE", "CHAPTER", etc (see TargetType).'},26826:{name:"TargetTypeValue",cppname:"TagTargetTypeValue",level:4,type:"u",minver:1,webm:!1,default:50,description:"A number to indicate the logical level of the target (see TargetType)."},25536:{name:"Targets",cppname:"TagTargets",level:3,type:"m",mandatory:!0,minver:1,webm:!1,description:"Contain all UIDs where the specified meta data apply. It is empty to describe everything in the segment."},307544935:{name:"Tags",level:1,type:"m",multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters. A list of valid tags can be found here."},17677:{name:"ChapProcessPrivate",cppname:"ChapterProcessPrivate",level:5,type:"b",minver:1,webm:!1,description:'Some optional data attached to the ChapProcessCodecID information. For ChapProcessCodecID = 1, it is the "DVD level" equivalent.'},17278:{name:"ChapCountry",cppname:"ChapterCountry",level:5,type:"s",multiple:!0,minver:1,webm:!1,description:"The countries corresponding to the string, same 2 octets as in Internet domains."},17276:{name:"ChapLanguage",cppname:"ChapterLanguage",level:5,type:"s",mandatory:!0,multiple:!0,minver:1,webm:!0,default:"eng",description:"The languages corresponding to the string, in the bibliographic ISO-639-2 form."},143:{name:"ChapterTrack",level:4,type:"m",minver:1,webm:!1,description:"List of tracks on which the chapter applies. If this element is not present, all tracks apply"},25539:{name:"ChapterPhysicalEquiv",level:4,type:"u",minver:1,webm:!1,description:'Specify the physical equivalent of this ChapterAtom like "DVD" (60) or "SIDE" (50), see complete list of values.'},28348:{name:"ChapterSegmentEditionUID",level:4,type:"u",minver:1,webm:!1,range:"not 0",description:"The EditionUID to play from the segment linked in ChapterSegmentUID."},28263:{name:"ChapterSegmentUID",level:4,type:"b",minver:1,webm:!1,range:">0",bytesize:16,description:"A segment to play in place of this chapter. Edition ChapterSegmentEditionUID should be used for this segment, otherwise no edition is used."},29636:{name:"ChapterUID",level:4,type:"u",mandatory:!0,minver:1,webm:!0,range:"not 0",description:"A unique ID to identify the Chapter."},182:{name:"ChapterAtom",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains the atom information to use as the chapter atom (apply to all tracks)."},17885:{name:"EditionFlagOrdered",level:3,type:"u",minver:1,webm:!1,default:0,range:"0-1",description:"Specify if the chapters can be defined multiple times and the order to play them is enforced. (1 bit)"},17883:{name:"EditionFlagDefault",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a flag is set (1) the edition should be used as the default one. (1 bit)"},17853:{name:"EditionFlagHidden",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If an edition is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},17852:{name:"EditionUID",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"A unique ID to identify the edition. It's useful for tagging an edition."},17849:{name:"EditionEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains all information about a segment edition."},272869232:{name:"Chapters",level:1,type:"m",minver:1,webm:!0,description:"A system to define basic menus and partition data. For more detailed information, look at the Chapters Explanation."},18094:{name:"FileUID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,range:"not 0",description:"Unique ID representing the file, as random as possible."},18012:{name:"FileData",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The data of the file."},18030:{name:"FileName",level:3,type:"8",mandatory:!0,minver:1,webm:!1,description:"Filename of the attached file."},18046:{name:"FileDescription",level:3,type:"8",minver:1,webm:!1,description:"A human-friendly name for the attached file."},24999:{name:"AttachedFile",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"An attached file."},423732329:{name:"Attachments",level:1,type:"m",minver:1,webm:!1,description:"Contain attached files."},235:{name:"CueRefCodecState",level:5,type:"u",webm:!1,default:0,description:"The position of the Codec State corresponding to this referenced element. 0 means that the data is taken from the initial Track Entry."},21343:{name:"CueRefNumber",level:5,type:"u",webm:!1,default:1,range:"not 0",description:"Number of the referenced Block of Track X in the specified Cluster."},219:{name:"CueReference",level:4,type:"m",multiple:!0,minver:2,webm:!1,description:"The Clusters containing the required referenced Blocks."},234:{name:"CueCodecState",level:4,type:"u",minver:2,webm:!1,default:0,description:"The position of the Codec State corresponding to this Cue element. 0 means that the data is taken from the initial Track Entry."},178:{name:"CueDuration",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The duration of the block according to the segment time base. If missing the track's DefaultDuration does not apply and no duration information is available in terms of the cues."},240:{name:"CueRelativePosition",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The relative position of the referenced block inside the cluster with 0 being the first possible position for an element inside that cluster.",position:"clusterRelative"},241:{name:"CueClusterPosition",level:4,type:"u",mandatory:!0,minver:1,description:"The position of the Cluster containing the required Block.",position:"segment"},247:{name:"CueTrack",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track for which a position is given."},183:{name:"CueTrackPositions",level:3,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contain positions for different tracks corresponding to the timestamp."},179:{name:"CueTime",level:3,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp according to the segment time base."},187:{name:"CuePoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains all information relative to a seek point in the segment."},475249515:{name:"Cues",level:1,type:"m",minver:1,description:'A top-level element to speed seeking access. All entries are local to the segment. Should be mandatory for non "live" streams.'},18406:{name:"ContentSigHashAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The hash algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - SHA1-160 2 - MD5"},18405:{name:"ContentSigAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - RSA"},18404:{name:"ContentSigKeyID",level:6,type:"b",minver:1,webm:!1,description:"This is the ID of the private key the data was signed with."},18403:{name:"ContentSignature",level:6,type:"b",minver:1,webm:!1,description:"A cryptographic signature of the contents."},18402:{name:"ContentEncKeyID",level:6,type:"b",minver:1,webm:!1,description:"For public key algorithms this is the ID of the public key the the data was encrypted with."},18401:{name:"ContentEncAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The encryption algorithm used. The value '0' means that the contents have not been encrypted but only signed. Predefined values: 1 - DES, 2 - 3DES, 3 - Twofish, 4 - Blowfish, 5 - AES"},28032:{name:"ContentEncodings",level:3,type:"m",minver:1,webm:!1,description:"Settings for several content encoding mechanisms like compression or encryption."},196:{name:"TrickMasterTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},199:{name:"TrickMasterTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},198:{name:"TrickTrackFlag",level:3,type:"u",divx:!0,default:0,description:"DivX trick track extenstions"},193:{name:"TrickTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},192:{name:"TrickTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},237:{name:"TrackJoinUID",level:5,type:"u",mandatory:!0,multiple:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of a track whose blocks are used to create this virtual track."},233:{name:"TrackJoinBlocks",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all tracks whose Blocks need to be combined to create this virtual track"},230:{name:"TrackPlaneType",level:6,type:"u",mandatory:!0,minver:3,webm:!1,description:"The kind of plane this track corresponds to (0: left eye, 1: right eye, 2: background)."},229:{name:"TrackPlaneUID",level:6,type:"u",mandatory:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of the track representing the plane."},228:{name:"TrackPlane",level:5,type:"m",mandatory:!0,multiple:!0,minver:3,webm:!1,description:"Contains a video plane track that need to be combined to create this 3D track"},227:{name:"TrackCombinePlanes",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all video plane tracks that need to be combined to create this 3D track"},226:{name:"TrackOperation",level:3,type:"m",minver:3,webm:!1,description:"Operation that needs to be applied on tracks to create this virtual track. For more details look at the Specification Notes on the subject."},32123:{name:"ChannelPositions",cppname:"AudioPosition",level:4,type:"b",webm:!1,description:"Table of horizontal angles for each successive channel, see appendix."},159:{name:"Channels",cppname:"AudioChannels",level:4,type:"u",mandatory:!0,minver:1,default:1,range:"not 0",description:"Numbers of channels in the track."},30901:{name:"OutputSamplingFrequency",cppname:"AudioOutputSamplingFreq",level:4,type:"f",minver:1,default:"Sampling Frequency",range:"> 0",description:"Real output sampling frequency in Hz (used for SBR techniques)."},181:{name:"SamplingFrequency",cppname:"AudioSamplingFreq",level:4,type:"f",mandatory:!0,minver:1,default:8e3,range:"> 0",description:"Sampling frequency in Hz."},225:{name:"Audio",cppname:"TrackAudio",level:3,type:"m",minver:1,description:"Audio settings."},2327523:{name:"FrameRate",cppname:"VideoFrameRate",level:4,type:"f",range:"> 0",strong:"Informational",description:"Number of frames per second.  only."},3126563:{name:"GammaValue",cppname:"VideoGamma",level:4,type:"f",webm:!1,range:"> 0",description:"Gamma Value."},3061028:{name:"ColourSpace",cppname:"VideoColourSpace",level:4,type:"b",minver:1,webm:!1,bytesize:4,description:"Same value as in AVI (32 bits)."},21683:{name:"AspectRatioType",cppname:"VideoAspectRatio",level:4,type:"u",minver:1,default:0,description:"Specify the possible modifications to the aspect ratio (0: free resizing, 1: keep aspect ratio, 2: fixed)."},21682:{name:"DisplayUnit",cppname:"VideoDisplayUnit",level:4,type:"u",minver:1,default:0,description:"How DisplayWidth & DisplayHeight should be interpreted (0: pixels, 1: centimeters, 2: inches, 3: Display Aspect Ratio)."},21690:{name:"DisplayHeight",cppname:"VideoDisplayHeight",level:4,type:"u",minver:1,default:"PixelHeight",range:"not 0",description:"Height of the video frames to display. The default value is only valid when DisplayUnit is 0."},21680:{name:"DisplayWidth",cppname:"VideoDisplayWidth",level:4,type:"u",minver:1,default:"PixelWidth",range:"not 0",description:"Width of the video frames to display. The default value is only valid when DisplayUnit is 0."},21725:{name:"PixelCropRight",cppname:"VideoPixelCropRight",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the right of the image."},21708:{name:"PixelCropLeft",cppname:"VideoPixelCropLeft",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the left of the image."},21691:{name:"PixelCropTop",cppname:"VideoPixelCropTop",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the top of the image."},21674:{name:"PixelCropBottom",cppname:"VideoPixelCropBottom",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the bottom of the image (for HDTV content)."},186:{name:"PixelHeight",cppname:"VideoPixelHeight",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Height of the encoded video frames in pixels."},176:{name:"PixelWidth",cppname:"VideoPixelWidth",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Width of the encoded video frames in pixels."},21433:{name:"OldStereoMode",level:4,type:"u",maxver:"0",webm:!1,divx:!1,description:"DEPRECATED, DO NOT USE. Bogus StereoMode value used in old versions of libmatroska. (0: mono, 1: right eye, 2: left eye, 3: both eyes)."},21440:{name:"AlphaMode",cppname:"VideoAlphaMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Alpha Video Mode. Presence of this element indicates that the BlockAdditional element could contain Alpha data."},21432:{name:"StereoMode",cppname:"VideoStereoMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Stereo-3D video mode (0: mono, 1: side by side (left eye is first), 2: top-bottom (right eye is first), 3: top-bottom (left eye is first), 4: checkboard (right is first), 5: checkboard (left is first), 6: row interleaved (right is first), 7: row interleaved (left is first), 8: column interleaved (right is first), 9: column interleaved (left is first), 10: anaglyph (cyan/red), 11: side by side (right eye is first), 12: anaglyph (green/magenta), 13 both eyes laced in one Block (left eye is first), 14 both eyes laced in one Block (right eye is first)) . There are some more details on 3D support in the Specification Notes."},154:{name:"FlagInterlaced",cppname:"VideoFlagInterlaced",level:4,type:"u",mandatory:!0,minver:2,webm:!0,default:0,range:"0-1",description:"Set if the video is interlaced. (1 bit)"},224:{name:"Video",cppname:"TrackVideo",level:3,type:"m",minver:1,description:"Video settings."},26277:{name:"TrackTranslateTrackID",level:4,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this track in the chapter codec data. The format depends on the ChapProcessCodecID used."},26303:{name:"TrackTranslateCodec",level:4,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},26364:{name:"TrackTranslateEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this translation applies. When not specified, it means for all editions found in the segment."},22203:{name:"SeekPreRoll",level:3,type:"u",mandatory:!0,multiple:!1,default:0,minver:4,webm:!0,description:"After a discontinuity, SeekPreRoll is the duration in nanoseconds of the data the decoder must decode before the decoded data is valid."},22186:{name:"CodecDelay",level:3,type:"u",multiple:!1,default:0,minver:4,webm:!0,description:"CodecDelay is The codec-built-in delay in nanoseconds. This value must be subtracted from each block timestamp in order to get the actual timestamp. The value should be small so the muxing of tracks with the same actual timestamp are in the same Cluster."},28587:{name:"TrackOverlay",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify that this track is an overlay track for the Track specified (in the u-integer). That means when this track has a gap (see SilentTracks) the overlay track should be used instead. The order of multiple TrackOverlay matters, the first one is the one that should be used. If not found it should be the second, etc."},170:{name:"CodecDecodeAll",level:3,type:"u",mandatory:!0,minver:2,webm:!1,default:1,range:"0-1",description:"The codec can decode potentially damaged data (1 bit)."},2536e3:{name:"CodecDownloadURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to download about the codec used."},3883072:{name:"CodecInfoURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to find information about the codec used."},3839639:{name:"CodecSettings",level:3,type:"8",webm:!1,description:"A string describing the encoding setting used."},25506:{name:"CodecPrivate",level:3,type:"b",minver:1,description:"Private data only known to the codec."},2274716:{name:"Language",cppname:"TrackLanguage",level:3,type:"s",minver:1,default:"eng",description:"Specifies the language of the track in the Matroska languages form."},21358:{name:"Name",cppname:"TrackName",level:3,type:"8",minver:1,description:"A human-readable track name."},21998:{name:"MaxBlockAdditionID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The maximum value of BlockAdditions for this track."},21375:{name:"TrackOffset",level:3,type:"i",webm:!1,default:0,description:"A value to add to the Block's Timestamp. This can be used to adjust the playback offset of a track."},2306383:{name:"TrackTimecodeScale",level:3,type:"f",mandatory:!0,minver:1,maxver:"3",webm:!1,default:1,range:"> 0",description:"DEPRECATED, DO NOT USE. The scale to apply on this track to work at normal speed in relation with other tracks (mostly used to adjust video speed when the audio length differs)."},2313850:{name:"DefaultDecodedFieldDuration",cppname:"TrackDefaultDecodedFieldDuration",level:3,type:"u",minver:4,range:"not 0",description:`The period in nanoseconds (not scaled by TimcodeScale)
between two successive fields at the output of the decoding process (see the notes)`},2352003:{name:"DefaultDuration",cppname:"TrackDefaultDuration",level:3,type:"u",minver:1,range:"not 0",description:"Number of nanoseconds (not scaled via TimecodeScale) per frame ('frame' in the Matroska sense -- one element put into a (Simple)Block)."},28152:{name:"MaxCache",cppname:"TrackMaxCache",level:3,type:"u",minver:1,webm:!1,description:"The maximum cache size required to store referenced frames in and the current frame. 0 means no cache is needed."},28135:{name:"MinCache",cppname:"TrackMinCache",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The minimum number of frames a player should be able to cache during playback. If set to 0, the reference pseudo-cache system is not used."},156:{name:"FlagLacing",cppname:"TrackFlagLacing",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if the track may contain blocks using lacing. (1 bit)"},21930:{name:"FlagForced",cppname:"TrackFlagForced",level:3,type:"u",mandatory:!0,minver:1,default:0,range:"0-1",description:"Set if that track MUST be active during playback. There can be many forced track for a kind (audio, video or subs), the player should select the one which language matches the user preference or the default + forced track. Overlay MAY happen between a forced and non-forced track of the same kind. (1 bit)"},185:{name:"FlagEnabled",cppname:"TrackFlagEnabled",level:3,type:"u",mandatory:!0,minver:2,webm:!0,default:1,range:"0-1",description:"Set if the track is usable. (1 bit)"},29637:{name:"TrackUID",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"A unique ID to identify the Track. This should be kept the same when making a direct stream copy of the Track to another file."},215:{name:"TrackNumber",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track number as used in the Block Header (using more than 127 tracks is not encouraged, though the design allows an unlimited number)."},174:{name:"TrackEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Describes a track with all elements."},374648427:{name:"Tracks",level:1,type:"m",multiple:!0,minver:1,description:"A top-level block of information with many tracks described."},175:{name:"EncryptedBlock",level:2,type:"b",multiple:!0,webm:!1,description:"Similar to EncryptedBlock Structure)"},202:{name:"ReferenceTimeCode",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},201:{name:"ReferenceOffset",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},200:{name:"ReferenceFrame",level:3,type:"m",multiple:!1,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},207:{name:"SliceDuration",level:5,type:"u",default:0,description:"The (scaled) duration to apply to the element."},206:{name:"Delay",cppname:"SliceDelay",level:5,type:"u",default:0,description:"The (scaled) delay to apply to the element."},203:{name:"BlockAdditionID",cppname:"SliceBlockAddID",level:5,type:"u",default:0,description:"The ID of the BlockAdditional element (0 is the main Block)."},205:{name:"FrameNumber",cppname:"SliceFrameNumber",level:5,type:"u",default:0,description:"The number of the frame to generate from this lace with this delay (allow you to generate many frames from the same Block/Frame)."},204:{name:"LaceNumber",cppname:"SliceLaceNumber",level:5,type:"u",minver:1,default:0,divx:!1,description:"The reverse number of the frame in the lace (0 is the last frame, 1 is the next to last, etc). While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},232:{name:"TimeSlice",level:4,type:"m",multiple:!0,minver:1,divx:!1,description:"Contains extra time information about the data contained in the Block. While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},142:{name:"Slices",level:3,type:"m",minver:1,divx:!1,description:"Contains slices description."},30114:{name:"DiscardPadding",level:3,type:"i",minver:4,webm:!0,description:"Duration in nanoseconds of the silent data added to the Block (padding at the end of the Block for positive value, at the beginning of the Block for negative value). The duration of DiscardPadding is not calculated in the duration of the TrackEntry and should be discarded during playback."},164:{name:"CodecState",level:3,type:"b",minver:2,webm:!1,description:"The new codec state to use. Data interpretation is private to the codec. This information should always be referenced by a seek entry."},253:{name:"ReferenceVirtual",level:3,type:"i",webm:!1,description:"Relative position of the data that should be in position of the virtual block."},251:{name:"ReferenceBlock",level:3,type:"i",multiple:!0,minver:1,description:"Timestamp of another frame used as a reference (ie: B or P frame). The timestamp is relative to the block it's attached to."},250:{name:"ReferencePriority",cppname:"FlagReferenced",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"This frame is referenced and has the specified cache priority. In cache only a frame of the same or higher priority can replace this frame. A value of 0 means the frame is not referenced."},155:{name:"BlockDuration",level:3,type:"u",minver:1,default:"TrackDuration",description:'The duration of the Block (based on TimecodeScale). This element is mandatory when DefaultDuration is set for the track (but can be omitted as other default values). When not written and with no DefaultDuration, the value is assumed to be the difference between the timestamp of this Block and the timestamp of the next Block in "display" order (not coding order). This element can be useful at the end of a Track (as there is not other Block available), or when there is a break in a track like for subtitle tracks. When set to 0 that means the frame is not a keyframe.'},165:{name:"BlockAdditional",level:5,type:"b",mandatory:!0,minver:1,webm:!1,description:"Interpreted by the codec as it wishes (using the BlockAddID)."},238:{name:"BlockAddID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"An ID to identify the BlockAdditional level."},166:{name:"BlockMore",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contain the BlockAdditional and some parameters."},30113:{name:"BlockAdditions",level:3,type:"m",minver:1,webm:!1,description:"Contain additional blocks to complete the main one. An EBML parser that has no knowledge of the Block structure could still see and use/skip these data."},162:{name:"BlockVirtual",level:3,type:"b",webm:!1,description:"A Block with no data. It must be stored in the stream at the place the real Block should be in display order. (see Block Virtual)"},161:{name:"Block",level:3,type:"b",mandatory:!0,minver:1,description:"Block containing the actual data to be rendered and a timestamp relative to the Cluster Timecode. (see Block Structure)"},160:{name:"BlockGroup",level:2,type:"m",multiple:!0,minver:1,description:"Basic container of information containing a single Block or BlockVirtual, and information specific to that Block/VirtualBlock."},163:{name:"SimpleBlock",level:2,type:"b",multiple:!0,minver:2,webm:!0,divx:!0,description:"Similar to SimpleBlock Structure"},171:{name:"PrevSize",cppname:"ClusterPrevSize",level:2,type:"u",minver:1,description:"Size of the previous Cluster, in octets. Can be useful for backward playing.",position:"prevCluster"},167:{name:"Position",cppname:"ClusterPosition",level:2,type:"u",minver:1,webm:!1,description:"The Position of the Cluster in the segment (0 in live broadcast streams). It might help to resynchronise offset on damaged streams.",position:"segment"},22743:{name:"SilentTrackNumber",cppname:"ClusterSilentTrackNumber",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"One of the track number that are not used from now on in the stream. It could change later if not specified as silent in a further Cluster."},231:{name:"Timecode",cppname:"ClusterTimecode",level:2,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp of the cluster (based on TimecodeScale)."},524531317:{name:"Cluster",level:1,type:"m",multiple:!0,minver:1,description:"The lower level element containing the (monolithic) Block structure."},19840:{name:"MuxingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Muxing application or library ("libmatroska-0.4.3").'},31657:{name:"Title",level:2,type:"8",minver:1,webm:!1,description:"General name of the segment."},2807730:{name:"TimecodeScaleDenominator",level:2,type:"u",mandatory:!0,minver:4,default:"1000000000",description:"Timestamp scale numerator, see TimecodeScale."},2807729:{name:"TimecodeScale",level:2,type:"u",mandatory:!0,minver:1,default:"1000000",description:"Timestamp scale in nanoseconds (1.000.000 means all timestamps in the segment are expressed in milliseconds)."},27045:{name:"ChapterTranslateID",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this segment in the chapter codec data. The format depends on the ChapProcessCodecID used."},27071:{name:"ChapterTranslateCodec",level:3,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},27132:{name:"ChapterTranslateEditionUID",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this correspondance applies. When not specified, it means for all editions found in the segment."},4096955:{name:"NextFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the next segment."},4110627:{name:"NextUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the next chained segment (128 bits)."},3965867:{name:"PrevFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the previous segment."},3979555:{name:"PrevUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the previous chained segment (128 bits)."},29604:{name:"SegmentUID",level:2,type:"b",minver:1,webm:!1,range:"not 0",bytesize:16,description:"A randomly generated unique ID to identify the current segment between many others (128 bits)."},357149030:{name:"Info",level:1,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains miscellaneous general information and statistics on the file."},21420:{name:"SeekPosition",level:3,type:"u",mandatory:!0,minver:1,description:"The position of the element in the segment in octets (0 = first level 1 element).",position:"segment"},21419:{name:"SeekID",level:3,type:"b",mandatory:!0,minver:1,description:"The binary ID corresponding to the element name.",type2:"ebmlID"},19899:{name:"Seek",cppname:"SeekPoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains a single seek entry to an EBML element."},290298740:{name:"SeekHead",cppname:"SeekHeader",level:1,type:"m",multiple:!0,minver:1,description:"Contains the position of other level 1 elements."},32379:{name:"SignatureElementList",level:2,type:"m",multiple:!0,webm:!1,i:"Cluster|Block|BlockAdditional",description:"A list consists of a number of consecutive elements that represent one case where data is used in signature. Ex:  means that the BlockAdditional of all Blocks in all Clusters is used for encryption."},32347:{name:"SignatureElements",level:1,type:"m",webm:!1,description:"Contains elements that will be used to compute the signature."},32437:{name:"Signature",level:1,type:"b",webm:!1,description:"The signature of the data (until a new."},32421:{name:"SignaturePublicKey",level:1,type:"b",webm:!1,description:"The public key to use with the algorithm (in the case of a PKI-based signature)."},32410:{name:"SignatureHash",level:1,type:"u",webm:!1,description:"Hash algorithm used (1=SHA1-160, 2=MD5)."},32394:{name:"SignatureAlgo",level:1,type:"u",webm:!1,description:"Signature algorithm used (1=RSA, 2=elliptic)."},458458727:{name:"SignatureSlot",level:-1,type:"m",multiple:!0,webm:!1,description:"Contain signature of some (coming) elements in the stream."},191:{name:"CRC-32",level:-1,type:"b",minver:1,webm:!1,description:"The CRC is computed on all the data of the Master element it's in. The CRC element should be the first in it's parent master for easier reading. All level 1 elements should include a CRC-32. The CRC in use is the IEEE CRC32 Little Endian",crc:!0},236:{name:"Void",level:-1,type:"b",minver:1,description:"Used to void damaged data, to avoid unexpected behaviors when using damaged data. The content is discarded. Also used to reserve space in a sub-element for later use."},17139:{name:"EBMLMaxSizeLength",level:1,type:"u",mandatory:!0,default:8,minver:1,description:"The maximum length of the sizes you'll find in this file (8 or less in Matroska). This does not override the element size indicated at the beginning of an element. Elements that have an indicated size which is larger than what is allowed by EBMLMaxSizeLength shall be considered invalid."},17138:{name:"EBMLMaxIDLength",level:1,type:"u",mandatory:!0,default:4,minver:1,description:"The maximum length of the IDs you'll find in this file (4 or less in Matroska)."},17143:{name:"EBMLReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum EBML version a parser has to support to read this file."},440786851:{name:"EBML",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"Set the EBML characteristics of the data to follow. Each EBML document has to start with this."},21936:{name:"Colour",level:"4",type:"m",mandatory:!0,multiple:!0,description:"Settings describing the colour format."},21937:{name:"MatrixCoefficients",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The Matrix Coefficients of the video used to derive luma and chroma values from red, green, and blue color primaries. For clarity, the value and meanings for MatrixCoefficients are adopted from Table 4 of ISO/IEC 23001-8:2016 or ITU-T H.273."},21945:{name:"Range",level:"5",type:"u",mandatory:!0,multiple:!0,description:"Clipping of the color ranges."},21946:{name:"TransferCharacteristics",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The transfer characteristics of the video."},21947:{name:"Primaries",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The colour primaries of the video. For clarity, the value and meanings for Primaries are adopted from Table 2 of ISO/IEC 23091-4 or ITU-T H.273."}}),gr}var Oc;function md(){if(Oc)return wi;Oc=1,Object.defineProperty(wi,"__esModule",{value:!0});var n=gn(),e=gn(),t=fd(),r=function(){function i(){this._schema=t.byEbmlID,this._buffers=[],this._stack=[]}return i.prototype.encode=function(s){var a=this;return n.concat(s.reduce(function(l,d){return l.concat(a.encodeChunk(d))},[])).buffer},i.prototype.encodeChunk=function(s){return s.type==="m"?s.isEnd?this.endTag(s):this.startTag(s):(s.data=e.Buffer.from(s.data),this.writeTag(s)),this.flush()},i.prototype.flush=function(){var s=this._buffers;return this._buffers=[],s},i.prototype.getSchemaInfo=function(s){for(var a=Object.keys(this._schema).map(Number),l=0;l<a.length;l++){var d=a[l];if(this._schema[d].name===s)return new e.Buffer(d.toString(16),"hex")}return null},i.prototype.writeTag=function(s){var a=s.name,l=this.getSchemaInfo(a),d=s.data;if(l==null)throw new Error("No schema entry found for "+a);var m=n.encodeTag(l,d);if(this._stack.length>0){var g=this._stack[this._stack.length-1];g.children.push({tagId:l,elm:s,children:[],data:m});return}this._buffers=this._buffers.concat(m)},i.prototype.startTag=function(s){var a=s.name,l=this.getSchemaInfo(a);if(l==null)throw new Error("No schema entry found for "+a);if(s.unknownSize){var d=n.encodeTag(l,new e.Buffer(0),s.unknownSize);this._buffers=this._buffers.concat(d);return}var m={tagId:l,elm:s,children:[],data:null};this._stack.length>0&&this._stack[this._stack.length-1].children.push(m),this._stack.push(m)},i.prototype.endTag=function(s){s.name;var a=this._stack.pop();if(a==null)throw new Error("EBML structure is broken");if(a.elm.name!==s.name)throw new Error("EBML structure is broken");var l=a.children.reduce(function(m,g){if(g.data===null)throw new Error("EBML structure is broken");return m.concat(g.data)},[]),d=n.concat(l);a.elm.type==="m"?a.data=n.encodeTag(a.tagId,d,a.elm.unknownSize):a.data=n.encodeTag(a.tagId,d),this._stack.length<1&&(this._buffers=this._buffers.concat(a.data))},i}();return wi.default=r,wi}var Js={},yr={},Fc;function E_(){if(Fc)return yr;Fc=1,yr.byteLength=l,yr.toByteArray=m,yr.fromByteArray=k;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=r.length;i<s;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function a(E){var P=E.length;if(P%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var V=E.indexOf("=");V===-1&&(V=P);var N=V===P?0:4-V%4;return[V,N]}function l(E){var P=a(E),V=P[0],N=P[1];return(V+N)*3/4-N}function d(E,P,V){return(P+V)*3/4-V}function m(E){var P,V=a(E),N=V[0],$=V[1],q=new t(d(E,N,$)),G=0,O=$>0?N-4:N,L;for(L=0;L<O;L+=4)P=e[E.charCodeAt(L)]<<18|e[E.charCodeAt(L+1)]<<12|e[E.charCodeAt(L+2)]<<6|e[E.charCodeAt(L+3)],q[G++]=P>>16&255,q[G++]=P>>8&255,q[G++]=P&255;return $===2&&(P=e[E.charCodeAt(L)]<<2|e[E.charCodeAt(L+1)]>>4,q[G++]=P&255),$===1&&(P=e[E.charCodeAt(L)]<<10|e[E.charCodeAt(L+1)]<<4|e[E.charCodeAt(L+2)]>>2,q[G++]=P>>8&255,q[G++]=P&255),q}function g(E){return n[E>>18&63]+n[E>>12&63]+n[E>>6&63]+n[E&63]}function C(E,P,V){for(var N,$=[],q=P;q<V;q+=3)N=(E[q]<<16&16711680)+(E[q+1]<<8&65280)+(E[q+2]&255),$.push(g(N));return $.join("")}function k(E){for(var P,V=E.length,N=V%3,$=[],q=16383,G=0,O=V-N;G<O;G+=q)$.push(C(E,G,G+q>O?O:G+q));return N===1?(P=E[V-1],$.push(n[P>>2]+n[P<<4&63]+"==")):N===2&&(P=(E[V-2]<<8)+E[V-1],$.push(n[P>>10]+n[P>>4&63]+n[P<<2&63]+"=")),$.join("")}return yr}var bi={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Uc;function T_(){return Uc||(Uc=1,bi.read=function(n,e,t,r,i){var s,a,l=i*8-r-1,d=(1<<l)-1,m=d>>1,g=-7,C=t?i-1:0,k=t?-1:1,E=n[e+C];for(C+=k,s=E&(1<<-g)-1,E>>=-g,g+=l;g>0;s=s*256+n[e+C],C+=k,g-=8);for(a=s&(1<<-g)-1,s>>=-g,g+=r;g>0;a=a*256+n[e+C],C+=k,g-=8);if(s===0)s=1-m;else{if(s===d)return a?NaN:(E?-1:1)*(1/0);a=a+Math.pow(2,r),s=s-m}return(E?-1:1)*a*Math.pow(2,s-r)},bi.write=function(n,e,t,r,i,s){var a,l,d,m=s*8-i-1,g=(1<<m)-1,C=g>>1,k=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=r?0:s-1,P=r?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=g):(a=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-a))<1&&(a--,d*=2),a+C>=1?e+=k/d:e+=k*Math.pow(2,1-C),e*d>=2&&(a++,d/=2),a+C>=g?(l=0,a=g):a+C>=1?(l=(e*d-1)*Math.pow(2,i),a=a+C):(l=e*Math.pow(2,C-1)*Math.pow(2,i),a=0));i>=8;n[t+E]=l&255,E+=P,l/=256,i-=8);for(a=a<<i|l,m+=i;m>0;n[t+E]=a&255,E+=P,a/=256,m-=8);n[t+E-P]|=V*128}),bi}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var jc;function w_(){return jc||(jc=1,function(n){const e=E_(),t=T_(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=l,n.SlowBuffer=q,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i,l.TYPED_ARRAY_SUPPORT=s(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const p=new Uint8Array(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,Uint8Array.prototype),Object.setPrototypeOf(p,u),p.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function a(p){if(p>i)throw new RangeError('The value "'+p+'" is invalid for option "size"');const u=new Uint8Array(p);return Object.setPrototypeOf(u,l.prototype),u}function l(p,u,h){if(typeof p=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return C(p)}return d(p,u,h)}l.poolSize=8192;function d(p,u,h){if(typeof p=="string")return k(p,u);if(ArrayBuffer.isView(p))return P(p);if(p==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p);if(st(p,ArrayBuffer)||p&&st(p.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(st(p,SharedArrayBuffer)||p&&st(p.buffer,SharedArrayBuffer)))return V(p,u,h);if(typeof p=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const w=p.valueOf&&p.valueOf();if(w!=null&&w!==p)return l.from(w,u,h);const R=N(p);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof p[Symbol.toPrimitive]=="function")return l.from(p[Symbol.toPrimitive]("string"),u,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p)}l.from=function(p,u,h){return d(p,u,h)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function m(p){if(typeof p!="number")throw new TypeError('"size" argument must be of type number');if(p<0)throw new RangeError('The value "'+p+'" is invalid for option "size"')}function g(p,u,h){return m(p),p<=0?a(p):u!==void 0?typeof h=="string"?a(p).fill(u,h):a(p).fill(u):a(p)}l.alloc=function(p,u,h){return g(p,u,h)};function C(p){return m(p),a(p<0?0:$(p)|0)}l.allocUnsafe=function(p){return C(p)},l.allocUnsafeSlow=function(p){return C(p)};function k(p,u){if((typeof u!="string"||u==="")&&(u="utf8"),!l.isEncoding(u))throw new TypeError("Unknown encoding: "+u);const h=G(p,u)|0;let w=a(h);const R=w.write(p,u);return R!==h&&(w=w.slice(0,R)),w}function E(p){const u=p.length<0?0:$(p.length)|0,h=a(u);for(let w=0;w<u;w+=1)h[w]=p[w]&255;return h}function P(p){if(st(p,Uint8Array)){const u=new Uint8Array(p);return V(u.buffer,u.byteOffset,u.byteLength)}return E(p)}function V(p,u,h){if(u<0||p.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(p.byteLength<u+(h||0))throw new RangeError('"length" is outside of buffer bounds');let w;return u===void 0&&h===void 0?w=new Uint8Array(p):h===void 0?w=new Uint8Array(p,u):w=new Uint8Array(p,u,h),Object.setPrototypeOf(w,l.prototype),w}function N(p){if(l.isBuffer(p)){const u=$(p.length)|0,h=a(u);return h.length===0||p.copy(h,0,0,u),h}if(p.length!==void 0)return typeof p.length!="number"||en(p.length)?a(0):E(p);if(p.type==="Buffer"&&Array.isArray(p.data))return E(p.data)}function $(p){if(p>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return p|0}function q(p){return+p!=p&&(p=0),l.alloc(+p)}l.isBuffer=function(u){return u!=null&&u._isBuffer===!0&&u!==l.prototype},l.compare=function(u,h){if(st(u,Uint8Array)&&(u=l.from(u,u.offset,u.byteLength)),st(h,Uint8Array)&&(h=l.from(h,h.offset,h.byteLength)),!l.isBuffer(u)||!l.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(u===h)return 0;let w=u.length,R=h.length;for(let D=0,M=Math.min(w,R);D<M;++D)if(u[D]!==h[D]){w=u[D],R=h[D];break}return w<R?-1:R<w?1:0},l.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(u,h){if(!Array.isArray(u))throw new TypeError('"list" argument must be an Array of Buffers');if(u.length===0)return l.alloc(0);let w;if(h===void 0)for(h=0,w=0;w<u.length;++w)h+=u[w].length;const R=l.allocUnsafe(h);let D=0;for(w=0;w<u.length;++w){let M=u[w];if(st(M,Uint8Array))D+M.length>R.length?(l.isBuffer(M)||(M=l.from(M)),M.copy(R,D)):Uint8Array.prototype.set.call(R,M,D);else if(l.isBuffer(M))M.copy(R,D);else throw new TypeError('"list" argument must be an Array of Buffers');D+=M.length}return R};function G(p,u){if(l.isBuffer(p))return p.length;if(ArrayBuffer.isView(p)||st(p,ArrayBuffer))return p.byteLength;if(typeof p!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof p);const h=p.length,w=arguments.length>2&&arguments[2]===!0;if(!w&&h===0)return 0;let R=!1;for(;;)switch(u){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return ht(p).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return gt(p).length;default:if(R)return w?-1:ht(p).length;u=(""+u).toLowerCase(),R=!0}}l.byteLength=G;function O(p,u,h){let w=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,u>>>=0,h<=u))return"";for(p||(p="utf8");;)switch(p){case"hex":return He(this,u,h);case"utf8":case"utf-8":return Y(this,u,h);case"ascii":return Ee(this,u,h);case"latin1":case"binary":return Ae(this,u,h);case"base64":return I(this,u,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ct(this,u,h);default:if(w)throw new TypeError("Unknown encoding: "+p);p=(p+"").toLowerCase(),w=!0}}l.prototype._isBuffer=!0;function L(p,u,h){const w=p[u];p[u]=p[h],p[h]=w}l.prototype.swap16=function(){const u=this.length;if(u%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<u;h+=2)L(this,h,h+1);return this},l.prototype.swap32=function(){const u=this.length;if(u%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<u;h+=4)L(this,h,h+3),L(this,h+1,h+2);return this},l.prototype.swap64=function(){const u=this.length;if(u%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<u;h+=8)L(this,h,h+7),L(this,h+1,h+6),L(this,h+2,h+5),L(this,h+3,h+4);return this},l.prototype.toString=function(){const u=this.length;return u===0?"":arguments.length===0?Y(this,0,u):O.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(u){if(!l.isBuffer(u))throw new TypeError("Argument must be a Buffer");return this===u?!0:l.compare(this,u)===0},l.prototype.inspect=function(){let u="";const h=n.INSPECT_MAX_BYTES;return u=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(u+=" ... "),"<Buffer "+u+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(u,h,w,R,D){if(st(u,Uint8Array)&&(u=l.from(u,u.offset,u.byteLength)),!l.isBuffer(u))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof u);if(h===void 0&&(h=0),w===void 0&&(w=u?u.length:0),R===void 0&&(R=0),D===void 0&&(D=this.length),h<0||w>u.length||R<0||D>this.length)throw new RangeError("out of range index");if(R>=D&&h>=w)return 0;if(R>=D)return-1;if(h>=w)return 1;if(h>>>=0,w>>>=0,R>>>=0,D>>>=0,this===u)return 0;let M=D-R,ie=w-h;const ye=Math.min(M,ie),_e=this.slice(R,D),Ce=u.slice(h,w);for(let fe=0;fe<ye;++fe)if(_e[fe]!==Ce[fe]){M=_e[fe],ie=Ce[fe];break}return M<ie?-1:ie<M?1:0};function U(p,u,h,w,R){if(p.length===0)return-1;if(typeof h=="string"?(w=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,en(h)&&(h=R?0:p.length-1),h<0&&(h=p.length+h),h>=p.length){if(R)return-1;h=p.length-1}else if(h<0)if(R)h=0;else return-1;if(typeof u=="string"&&(u=l.from(u,w)),l.isBuffer(u))return u.length===0?-1:A(p,u,h,w,R);if(typeof u=="number")return u=u&255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(p,u,h):Uint8Array.prototype.lastIndexOf.call(p,u,h):A(p,[u],h,w,R);throw new TypeError("val must be string, number or Buffer")}function A(p,u,h,w,R){let D=1,M=p.length,ie=u.length;if(w!==void 0&&(w=String(w).toLowerCase(),w==="ucs2"||w==="ucs-2"||w==="utf16le"||w==="utf-16le")){if(p.length<2||u.length<2)return-1;D=2,M/=2,ie/=2,h/=2}function ye(Ce,fe){return D===1?Ce[fe]:Ce.readUInt16BE(fe*D)}let _e;if(R){let Ce=-1;for(_e=h;_e<M;_e++)if(ye(p,_e)===ye(u,Ce===-1?0:_e-Ce)){if(Ce===-1&&(Ce=_e),_e-Ce+1===ie)return Ce*D}else Ce!==-1&&(_e-=_e-Ce),Ce=-1}else for(h+ie>M&&(h=M-ie),_e=h;_e>=0;_e--){let Ce=!0;for(let fe=0;fe<ie;fe++)if(ye(p,_e+fe)!==ye(u,fe)){Ce=!1;break}if(Ce)return _e}return-1}l.prototype.includes=function(u,h,w){return this.indexOf(u,h,w)!==-1},l.prototype.indexOf=function(u,h,w){return U(this,u,h,w,!0)},l.prototype.lastIndexOf=function(u,h,w){return U(this,u,h,w,!1)};function y(p,u,h,w){h=Number(h)||0;const R=p.length-h;w?(w=Number(w),w>R&&(w=R)):w=R;const D=u.length;w>D/2&&(w=D/2);let M;for(M=0;M<w;++M){const ie=parseInt(u.substr(M*2,2),16);if(en(ie))return M;p[h+M]=ie}return M}function T(p,u,h,w){return At(ht(u,p.length-h),p,h,w)}function _(p,u,h,w){return At(pt(u),p,h,w)}function b(p,u,h,w){return At(gt(u),p,h,w)}function S(p,u,h,w){return At(wn(u,p.length-h),p,h,w)}l.prototype.write=function(u,h,w,R){if(h===void 0)R="utf8",w=this.length,h=0;else if(w===void 0&&typeof h=="string")R=h,w=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(w)?(w=w>>>0,R===void 0&&(R="utf8")):(R=w,w=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const D=this.length-h;if((w===void 0||w>D)&&(w=D),u.length>0&&(w<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");R||(R="utf8");let M=!1;for(;;)switch(R){case"hex":return y(this,u,h,w);case"utf8":case"utf-8":return T(this,u,h,w);case"ascii":case"latin1":case"binary":return _(this,u,h,w);case"base64":return b(this,u,h,w);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,u,h,w);default:if(M)throw new TypeError("Unknown encoding: "+R);R=(""+R).toLowerCase(),M=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(p,u,h){return u===0&&h===p.length?e.fromByteArray(p):e.fromByteArray(p.slice(u,h))}function Y(p,u,h){h=Math.min(p.length,h);const w=[];let R=u;for(;R<h;){const D=p[R];let M=null,ie=D>239?4:D>223?3:D>191?2:1;if(R+ie<=h){let ye,_e,Ce,fe;switch(ie){case 1:D<128&&(M=D);break;case 2:ye=p[R+1],(ye&192)===128&&(fe=(D&31)<<6|ye&63,fe>127&&(M=fe));break;case 3:ye=p[R+1],_e=p[R+2],(ye&192)===128&&(_e&192)===128&&(fe=(D&15)<<12|(ye&63)<<6|_e&63,fe>2047&&(fe<55296||fe>57343)&&(M=fe));break;case 4:ye=p[R+1],_e=p[R+2],Ce=p[R+3],(ye&192)===128&&(_e&192)===128&&(Ce&192)===128&&(fe=(D&15)<<18|(ye&63)<<12|(_e&63)<<6|Ce&63,fe>65535&&fe<1114112&&(M=fe))}}M===null?(M=65533,ie=1):M>65535&&(M-=65536,w.push(M>>>10&1023|55296),M=56320|M&1023),w.push(M),R+=ie}return Ie(w)}const ae=4096;function Ie(p){const u=p.length;if(u<=ae)return String.fromCharCode.apply(String,p);let h="",w=0;for(;w<u;)h+=String.fromCharCode.apply(String,p.slice(w,w+=ae));return h}function Ee(p,u,h){let w="";h=Math.min(p.length,h);for(let R=u;R<h;++R)w+=String.fromCharCode(p[R]&127);return w}function Ae(p,u,h){let w="";h=Math.min(p.length,h);for(let R=u;R<h;++R)w+=String.fromCharCode(p[R]);return w}function He(p,u,h){const w=p.length;(!u||u<0)&&(u=0),(!h||h<0||h>w)&&(h=w);let R="";for(let D=u;D<h;++D)R+=rr[p[D]];return R}function ct(p,u,h){const w=p.slice(u,h);let R="";for(let D=0;D<w.length-1;D+=2)R+=String.fromCharCode(w[D]+w[D+1]*256);return R}l.prototype.slice=function(u,h){const w=this.length;u=~~u,h=h===void 0?w:~~h,u<0?(u+=w,u<0&&(u=0)):u>w&&(u=w),h<0?(h+=w,h<0&&(h=0)):h>w&&(h=w),h<u&&(h=u);const R=this.subarray(u,h);return Object.setPrototypeOf(R,l.prototype),R};function ue(p,u,h){if(p%1!==0||p<0)throw new RangeError("offset is not uint");if(p+u>h)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(u,h,w){u=u>>>0,h=h>>>0,w||ue(u,h,this.length);let R=this[u],D=1,M=0;for(;++M<h&&(D*=256);)R+=this[u+M]*D;return R},l.prototype.readUintBE=l.prototype.readUIntBE=function(u,h,w){u=u>>>0,h=h>>>0,w||ue(u,h,this.length);let R=this[u+--h],D=1;for(;h>0&&(D*=256);)R+=this[u+--h]*D;return R},l.prototype.readUint8=l.prototype.readUInt8=function(u,h){return u=u>>>0,h||ue(u,1,this.length),this[u]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(u,h){return u=u>>>0,h||ue(u,2,this.length),this[u]|this[u+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(u,h){return u=u>>>0,h||ue(u,2,this.length),this[u]<<8|this[u+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),(this[u]|this[u+1]<<8|this[u+2]<<16)+this[u+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]*16777216+(this[u+1]<<16|this[u+2]<<8|this[u+3])},l.prototype.readBigUInt64LE=dt(function(u){u=u>>>0,de(u,"offset");const h=this[u],w=this[u+7];(h===void 0||w===void 0)&&Pe(u,this.length-8);const R=h+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24,D=this[++u]+this[++u]*2**8+this[++u]*2**16+w*2**24;return BigInt(R)+(BigInt(D)<<BigInt(32))}),l.prototype.readBigUInt64BE=dt(function(u){u=u>>>0,de(u,"offset");const h=this[u],w=this[u+7];(h===void 0||w===void 0)&&Pe(u,this.length-8);const R=h*2**24+this[++u]*2**16+this[++u]*2**8+this[++u],D=this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+w;return(BigInt(R)<<BigInt(32))+BigInt(D)}),l.prototype.readIntLE=function(u,h,w){u=u>>>0,h=h>>>0,w||ue(u,h,this.length);let R=this[u],D=1,M=0;for(;++M<h&&(D*=256);)R+=this[u+M]*D;return D*=128,R>=D&&(R-=Math.pow(2,8*h)),R},l.prototype.readIntBE=function(u,h,w){u=u>>>0,h=h>>>0,w||ue(u,h,this.length);let R=h,D=1,M=this[u+--R];for(;R>0&&(D*=256);)M+=this[u+--R]*D;return D*=128,M>=D&&(M-=Math.pow(2,8*h)),M},l.prototype.readInt8=function(u,h){return u=u>>>0,h||ue(u,1,this.length),this[u]&128?(255-this[u]+1)*-1:this[u]},l.prototype.readInt16LE=function(u,h){u=u>>>0,h||ue(u,2,this.length);const w=this[u]|this[u+1]<<8;return w&32768?w|4294901760:w},l.prototype.readInt16BE=function(u,h){u=u>>>0,h||ue(u,2,this.length);const w=this[u+1]|this[u]<<8;return w&32768?w|4294901760:w},l.prototype.readInt32LE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]|this[u+1]<<8|this[u+2]<<16|this[u+3]<<24},l.prototype.readInt32BE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]<<24|this[u+1]<<16|this[u+2]<<8|this[u+3]},l.prototype.readBigInt64LE=dt(function(u){u=u>>>0,de(u,"offset");const h=this[u],w=this[u+7];(h===void 0||w===void 0)&&Pe(u,this.length-8);const R=this[u+4]+this[u+5]*2**8+this[u+6]*2**16+(w<<24);return(BigInt(R)<<BigInt(32))+BigInt(h+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24)}),l.prototype.readBigInt64BE=dt(function(u){u=u>>>0,de(u,"offset");const h=this[u],w=this[u+7];(h===void 0||w===void 0)&&Pe(u,this.length-8);const R=(h<<24)+this[++u]*2**16+this[++u]*2**8+this[++u];return(BigInt(R)<<BigInt(32))+BigInt(this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+w)}),l.prototype.readFloatLE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),t.read(this,u,!0,23,4)},l.prototype.readFloatBE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),t.read(this,u,!1,23,4)},l.prototype.readDoubleLE=function(u,h){return u=u>>>0,h||ue(u,8,this.length),t.read(this,u,!0,52,8)},l.prototype.readDoubleBE=function(u,h){return u=u>>>0,h||ue(u,8,this.length),t.read(this,u,!1,52,8)};function Z(p,u,h,w,R,D){if(!l.isBuffer(p))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>R||u<D)throw new RangeError('"value" argument is out of bounds');if(h+w>p.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(u,h,w,R){if(u=+u,h=h>>>0,w=w>>>0,!R){const ie=Math.pow(2,8*w)-1;Z(this,u,h,w,ie,0)}let D=1,M=0;for(this[h]=u&255;++M<w&&(D*=256);)this[h+M]=u/D&255;return h+w},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(u,h,w,R){if(u=+u,h=h>>>0,w=w>>>0,!R){const ie=Math.pow(2,8*w)-1;Z(this,u,h,w,ie,0)}let D=w-1,M=1;for(this[h+D]=u&255;--D>=0&&(M*=256);)this[h+D]=u/M&255;return h+w},l.prototype.writeUint8=l.prototype.writeUInt8=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,1,255,0),this[h]=u&255,h+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,2,65535,0),this[h]=u&255,this[h+1]=u>>>8,h+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,2,65535,0),this[h]=u>>>8,this[h+1]=u&255,h+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,4,4294967295,0),this[h+3]=u>>>24,this[h+2]=u>>>16,this[h+1]=u>>>8,this[h]=u&255,h+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,4,4294967295,0),this[h]=u>>>24,this[h+1]=u>>>16,this[h+2]=u>>>8,this[h+3]=u&255,h+4};function ge(p,u,h,w,R){re(u,w,R,p,h,7);let D=Number(u&BigInt(4294967295));p[h++]=D,D=D>>8,p[h++]=D,D=D>>8,p[h++]=D,D=D>>8,p[h++]=D;let M=Number(u>>BigInt(32)&BigInt(4294967295));return p[h++]=M,M=M>>8,p[h++]=M,M=M>>8,p[h++]=M,M=M>>8,p[h++]=M,h}function ke(p,u,h,w,R){re(u,w,R,p,h,7);let D=Number(u&BigInt(4294967295));p[h+7]=D,D=D>>8,p[h+6]=D,D=D>>8,p[h+5]=D,D=D>>8,p[h+4]=D;let M=Number(u>>BigInt(32)&BigInt(4294967295));return p[h+3]=M,M=M>>8,p[h+2]=M,M=M>>8,p[h+1]=M,M=M>>8,p[h]=M,h+8}l.prototype.writeBigUInt64LE=dt(function(u,h=0){return ge(this,u,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=dt(function(u,h=0){return ke(this,u,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(u,h,w,R){if(u=+u,h=h>>>0,!R){const ye=Math.pow(2,8*w-1);Z(this,u,h,w,ye-1,-ye)}let D=0,M=1,ie=0;for(this[h]=u&255;++D<w&&(M*=256);)u<0&&ie===0&&this[h+D-1]!==0&&(ie=1),this[h+D]=(u/M>>0)-ie&255;return h+w},l.prototype.writeIntBE=function(u,h,w,R){if(u=+u,h=h>>>0,!R){const ye=Math.pow(2,8*w-1);Z(this,u,h,w,ye-1,-ye)}let D=w-1,M=1,ie=0;for(this[h+D]=u&255;--D>=0&&(M*=256);)u<0&&ie===0&&this[h+D+1]!==0&&(ie=1),this[h+D]=(u/M>>0)-ie&255;return h+w},l.prototype.writeInt8=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,1,127,-128),u<0&&(u=255+u+1),this[h]=u&255,h+1},l.prototype.writeInt16LE=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,2,32767,-32768),this[h]=u&255,this[h+1]=u>>>8,h+2},l.prototype.writeInt16BE=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,2,32767,-32768),this[h]=u>>>8,this[h+1]=u&255,h+2},l.prototype.writeInt32LE=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,4,2147483647,-2147483648),this[h]=u&255,this[h+1]=u>>>8,this[h+2]=u>>>16,this[h+3]=u>>>24,h+4},l.prototype.writeInt32BE=function(u,h,w){return u=+u,h=h>>>0,w||Z(this,u,h,4,2147483647,-2147483648),u<0&&(u=4294967295+u+1),this[h]=u>>>24,this[h+1]=u>>>16,this[h+2]=u>>>8,this[h+3]=u&255,h+4},l.prototype.writeBigInt64LE=dt(function(u,h=0){return ge(this,u,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=dt(function(u,h=0){return ke(this,u,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Me(p,u,h,w,R,D){if(h+w>p.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function ut(p,u,h,w,R){return u=+u,h=h>>>0,R||Me(p,u,h,4),t.write(p,u,h,w,23,4),h+4}l.prototype.writeFloatLE=function(u,h,w){return ut(this,u,h,!0,w)},l.prototype.writeFloatBE=function(u,h,w){return ut(this,u,h,!1,w)};function Xe(p,u,h,w,R){return u=+u,h=h>>>0,R||Me(p,u,h,8),t.write(p,u,h,w,52,8),h+8}l.prototype.writeDoubleLE=function(u,h,w){return Xe(this,u,h,!0,w)},l.prototype.writeDoubleBE=function(u,h,w){return Xe(this,u,h,!1,w)},l.prototype.copy=function(u,h,w,R){if(!l.isBuffer(u))throw new TypeError("argument should be a Buffer");if(w||(w=0),!R&&R!==0&&(R=this.length),h>=u.length&&(h=u.length),h||(h=0),R>0&&R<w&&(R=w),R===w||u.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(w<0||w>=this.length)throw new RangeError("Index out of range");if(R<0)throw new RangeError("sourceEnd out of bounds");R>this.length&&(R=this.length),u.length-h<R-w&&(R=u.length-h+w);const D=R-w;return this===u&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,w,R):Uint8Array.prototype.set.call(u,this.subarray(w,R),h),D},l.prototype.fill=function(u,h,w,R){if(typeof u=="string"){if(typeof h=="string"?(R=h,h=0,w=this.length):typeof w=="string"&&(R=w,w=this.length),R!==void 0&&typeof R!="string")throw new TypeError("encoding must be a string");if(typeof R=="string"&&!l.isEncoding(R))throw new TypeError("Unknown encoding: "+R);if(u.length===1){const M=u.charCodeAt(0);(R==="utf8"&&M<128||R==="latin1")&&(u=M)}}else typeof u=="number"?u=u&255:typeof u=="boolean"&&(u=Number(u));if(h<0||this.length<h||this.length<w)throw new RangeError("Out of range index");if(w<=h)return this;h=h>>>0,w=w===void 0?this.length:w>>>0,u||(u=0);let D;if(typeof u=="number")for(D=h;D<w;++D)this[D]=u;else{const M=l.isBuffer(u)?u:l.from(u,R),ie=M.length;if(ie===0)throw new TypeError('The value "'+u+'" is invalid for argument "value"');for(D=0;D<w-h;++D)this[D+h]=M[D%ie]}return this};const Oe={};function te(p,u,h){Oe[p]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:u.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${p}]`,this.stack,delete this.name}get code(){return p}set code(R){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:R,writable:!0})}toString(){return`${this.name} [${p}]: ${this.message}`}}}te("ERR_BUFFER_OUT_OF_BOUNDS",function(p){return p?`${p} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),te("ERR_INVALID_ARG_TYPE",function(p,u){return`The "${p}" argument must be of type number. Received type ${typeof u}`},TypeError),te("ERR_OUT_OF_RANGE",function(p,u,h){let w=`The value of "${p}" is out of range.`,R=h;return Number.isInteger(h)&&Math.abs(h)>2**32?R=Q(String(h)):typeof h=="bigint"&&(R=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(R=Q(R)),R+="n"),w+=` It must be ${u}. Received ${R}`,w},RangeError);function Q(p){let u="",h=p.length;const w=p[0]==="-"?1:0;for(;h>=w+4;h-=3)u=`_${p.slice(h-3,h)}${u}`;return`${p.slice(0,h)}${u}`}function J(p,u,h){de(u,"offset"),(p[u]===void 0||p[u+h]===void 0)&&Pe(u,p.length-(h+1))}function re(p,u,h,w,R,D){if(p>h||p<u){const M=typeof u=="bigint"?"n":"";let ie;throw u===0||u===BigInt(0)?ie=`>= 0${M} and < 2${M} ** ${(D+1)*8}${M}`:ie=`>= -(2${M} ** ${(D+1)*8-1}${M}) and < 2 ** ${(D+1)*8-1}${M}`,new Oe.ERR_OUT_OF_RANGE("value",ie,p)}J(w,R,D)}function de(p,u){if(typeof p!="number")throw new Oe.ERR_INVALID_ARG_TYPE(u,"number",p)}function Pe(p,u,h){throw Math.floor(p)!==p?(de(p,h),new Oe.ERR_OUT_OF_RANGE("offset","an integer",p)):u<0?new Oe.ERR_BUFFER_OUT_OF_BOUNDS:new Oe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${u}`,p)}const je=/[^+/0-9A-Za-z-_]/g;function ze(p){if(p=p.split("=")[0],p=p.trim().replace(je,""),p.length<2)return"";for(;p.length%4!==0;)p=p+"=";return p}function ht(p,u){u=u||1/0;let h;const w=p.length;let R=null;const D=[];for(let M=0;M<w;++M){if(h=p.charCodeAt(M),h>55295&&h<57344){if(!R){if(h>56319){(u-=3)>-1&&D.push(239,191,189);continue}else if(M+1===w){(u-=3)>-1&&D.push(239,191,189);continue}R=h;continue}if(h<56320){(u-=3)>-1&&D.push(239,191,189),R=h;continue}h=(R-55296<<10|h-56320)+65536}else R&&(u-=3)>-1&&D.push(239,191,189);if(R=null,h<128){if((u-=1)<0)break;D.push(h)}else if(h<2048){if((u-=2)<0)break;D.push(h>>6|192,h&63|128)}else if(h<65536){if((u-=3)<0)break;D.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((u-=4)<0)break;D.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return D}function pt(p){const u=[];for(let h=0;h<p.length;++h)u.push(p.charCodeAt(h)&255);return u}function wn(p,u){let h,w,R;const D=[];for(let M=0;M<p.length&&!((u-=2)<0);++M)h=p.charCodeAt(M),w=h>>8,R=h%256,D.push(R),D.push(w);return D}function gt(p){return e.toByteArray(ze(p))}function At(p,u,h,w){let R;for(R=0;R<w&&!(R+h>=u.length||R>=p.length);++R)u[R+h]=p[R];return R}function st(p,u){return p instanceof u||p!=null&&p.constructor!=null&&p.constructor.name!=null&&p.constructor.name===u.name}function en(p){return p!==p}const rr=function(){const p="0123456789abcdef",u=new Array(256);for(let h=0;h<16;++h){const w=h*16;for(let R=0;R<16;++R)u[w+R]=p[h]+p[R]}return u}();function dt(p){return typeof BigInt>"u"?$e:p}function $e(){throw new Error("BigInt not supported")}}(Js)),Js}var Lt={},zc;function b_(){if(zc)return Lt;zc=1;var n=Lt&&Lt.__assign||function(){return n=Object.assign||function(i){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(i[d]=s[d])}return i},n.apply(this,arguments)},e=Lt&&Lt.__spreadArray||function(i,s,a){if(a||arguments.length===2)for(var l=0,d=s.length,m;l<d;l++)(m||!(l in s))&&(m||(m=Array.prototype.slice.call(s,0,l)),m[l]=s[l]);return i.concat(m||Array.prototype.slice.call(s))};Object.defineProperty(Lt,"__esModule",{value:!0});var t=gn(),r=function(){function i(){}return i.readVint=function(s,a){a===void 0&&(a=0);var l=8-Math.floor(Math.log2(s[a]));if(l>8){var d=i.readHexString(s,a,a+l);throw new Error("Unrepresentable length: ".concat(l," ").concat(d))}if(a+l>s.length)return null;for(var m=s[a]&(1<<8-l)-1,g=1;g<l;g+=1){if(g===7&&m>=Math.pow(2,8)&&s[a+7]>0)return{length:l,value:-1};m*=Math.pow(2,8),m+=s[a+g]}return{length:l,value:m}},i.writeVint=function(s){if(s<0||s>Math.pow(2,53))throw new Error("Unrepresentable value: ".concat(s));var a=1;for(a=1;a<=8&&!(s<Math.pow(2,7*a)-1);a+=1);for(var l=t.Buffer.alloc(a),d=s,m=1;m<=a;m+=1){var g=d&255;l[a-m]=g,d-=g,d/=Math.pow(2,8)}return l[0]|=1<<8-a,l},i.concatenate=function(s,a){return!s&&!a?t.Buffer.from([]):!s||s.byteLength===0?a:!a||a.byteLength===0?s:t.Buffer.from(e(e([],s,!0),a,!0))},i.readHexString=function(s,a,l){return a===void 0&&(a=0),l===void 0&&(l=s.byteLength),Array.from(s.slice(a,l)).map(function(d){return Number(d).toString(16)}).reduce(function(d,m){return"".concat(d).concat(m.padStart(2,"0"))},"")},i.readUtf8=function(s){try{return t.Buffer.from(s).toString("utf8")}catch{return null}},i.readUnsigned=function(s){var a=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(s.byteLength){case 1:return a.getUint8(0);case 2:return a.getUint16(0);case 4:return a.getUint32(0)}return s.byteLength<=6?s.reduce(function(l,d){return l*256+d},0):i.readHexString(s,0,s.byteLength)},i.readSigned=function(s){var a=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(s.byteLength){case 1:return a.getInt8(0);case 2:return a.getInt16(0);case 4:return a.getInt32(0);default:return NaN}},i.readFloat=function(s){var a=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(s.byteLength){case 4:return a.getFloat32(0);case 8:return a.getFloat64(0);default:return NaN}},i.readDate=function(s){var a=new DataView(s.buffer,s.byteOffset,s.byteLength);switch(s.byteLength){case 1:return new Date(a.getUint8(0));case 2:return new Date(a.getUint16(0));case 4:return new Date(a.getUint32(0));case 8:return new Date(Number.parseInt(i.readHexString(s),16));default:return new Date(0)}},i.readDataFromTag=function(s,a){var l=s.type,d=s.name,m=s.track,g=s.discardable||!1,C=s.keyframe||!1,k=null,E;switch(l){case"u":E=i.readUnsigned(a);break;case"f":E=i.readFloat(a);break;case"i":E=i.readSigned(a);break;case"s":E=String.fromCharCode.apply(String,a);break;case"8":E=i.readUtf8(a);break;case"d":E=i.readDate(a);break}if(d==="SimpleBlock"||d==="Block"){var P=0,V=i.readVint(a,P),N=V.length,$=V.value;P+=N,m=$,E=i.readSigned(a.subarray(P,P+2)),P+=2,d==="SimpleBlock"&&(C=!!(a[N+2]&128),g=!!(a[N+2]&1)),P+=1,k=a.subarray(P)}return n(n({},s),{data:a,discardable:g,keyframe:C,payload:k,track:m,value:E})},i}();return Lt.default=r,Lt}var Zs,$c;function I_(){return $c||($c=1,Zs=function(n,e,t){e=e||0;for(var r=1;r<=8&&!(n[e]>=Math.pow(2,8-r));r++);if(r>8)throw new Error("Unrepresentable length: "+r+" "+n.toString("hex",e,e+r));if(e+r>n.length)return null;var i,s=n[e]&(1<<8-r)-1;for(i=1;i<r;i++){if(i===7&&s>=Math.pow(2,45)&&n[e+7]>0)return{length:r,value:-1};s*=Math.pow(2,8),s+=n[e+i]}return t&&(s-=Math.pow(2,r*7-1)-1),{length:r,value:s}}),Zs}var eo,qc;function A_(){if(qc)return eo;qc=1;var n=I_();function e(t){this.buffer=t,this.offset=0}return e.prototype.nextInt16BE=function(){var t=this.buffer.readInt16BE(this.offset);return this.offset+=2,t},e.prototype.nextUInt8=function(){var t=this.buffer.readUInt8(this.offset);return this.offset+=1,t},e.prototype.nextUIntV=function(){var t=n(this.buffer,this.offset);return this.offset+=t.length,t.value},e.prototype.nextIntV=function(){var t=n(this.buffer,this.offset,!0);return this.offset+=t.length,t.value},e.prototype.nextBuffer=function(t){var r=t?this.buffer.slice(this.offset,this.offset+t):this.buffer.slice(this.offset);return this.offset+=t||this.length,r},Object.defineProperty(e.prototype,"length",{get:function(){return this.buffer.length-this.offset}}),eo=e,eo}var to,Hc;function C_(){if(Hc)return to;Hc=1;var n=A_(),e=1,t=3,r=2;to=function(s){var a={},l=new n(s);a.trackNumber=l.nextUIntV(),a.timecode=l.nextInt16BE();var d=l.nextUInt8();a.invisible=!!(d&8),a.keyframe=!!(d&128),a.discardable=!!(d&1);var m=(d&6)>>1;return a.frames=i(l,m),a};function i(s,a){if(!a)return[s.nextBuffer()];var l,d,m=[],g=s.nextUInt8()+1;if(a===r){if(s.length%g!==0)throw new Error("Fixed-Size Lacing Error");for(d=s.length/g,l=0;l<g;l++)m.push(s.nextBuffer(d));return m}var C=[];if(a===e)for(l=0;l<g-1;l++){var k;d=0;do k=s.nextUInt8(),d+=k;while(k===255);C.push(d)}else if(a===t)for(d=s.nextUIntV(),C.push(d),l=1;l<g-1;l++)d+=s.nextIntV(),C.push(d);for(l=0;l<g-1;l++)m.push(s.nextBuffer(C[l]));return m.push(s.nextBuffer()),m}return to}var Gc;function gn(){return Gc||(Gc=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertEBMLDateToJSDate=n.createFloatBuffer=n.createIntBuffer=n.createUIntBuffer=n.encodeValueToBuffer=n.concat=n.putRefinedMetaData=n.extractElement=n.removeElement=n.makeMetadataSeekable=n.createRIFFChunk=n.VP8BitStreamToRiffWebPBuffer=n.WebPBlockFilter=n.encodeTag=n.readBlock=n.ebmlBlock=n.writeVint=n.readVint=n.Buffer=void 0;var e=dd(),t=md(),r=w_(),i=b_(),s=C_();n.Buffer=r.Buffer,n.readVint=i.default.readVint,n.writeVint=i.default.writeVint,n.ebmlBlock=s;function a(_){return(0,n.ebmlBlock)(new n.Buffer(_))}n.readBlock=a;function l(_,b,S){return S===void 0&&(S=!1),O([_,S?new n.Buffer("01ffffffffffffff","hex"):(0,n.writeVint)(b.length),b])}n.encodeTag=l;function d(_){return _.reduce(function(b,S){if(S.type!=="b"||S.name!=="SimpleBlock")return b;var I=(0,n.ebmlBlock)(S.data),Y=I.frames.some(function(ae){var Ie=ae.slice(3,6).toString("hex");return Ie==="9d012a"});return Y?b.concat(S):b},[])}n.WebPBlockFilter=d;function m(_){var b=g("VP8 ",_),S=O([new n.Buffer("WEBP","ascii"),b]);return g("RIFF",S)}n.VP8BitStreamToRiffWebPBuffer=m;function g(_,b){var S=new n.Buffer(4);return S.writeUInt32LE(b.byteLength,0),O([new n.Buffer(_.substr(0,4),"ascii"),S,b,new n.Buffer(b.byteLength%2===0?0:1)])}n.createRIFFChunk=g;function C(_,b,S){var I=E("EBML",_),Y=V(I),ae=Y+12,Ie=_[_.length-1].dataEnd-ae,Ee=E("Info",_);k("Duration",Ee),Ee.splice(1,0,{name:"Duration",type:"f",data:y(b,8)});for(var Ae=V(Ee),He=E("Tracks",_),ct=V(He),ue=47,Z=[],ge=5+S.length*15,ke=[],Me=-1,ut=10,Xe=function(re){var de=ue,Pe=de+Ae,je=Pe+ct,ze=je+ge,ht=ze-Ie;if(Z=[],Z.push({name:"SeekHead",type:"m",isEnd:!1}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([21,73,169,102])}),Z.push({name:"SeekPosition",type:"u",data:U(de)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([22,84,174,107])}),Z.push({name:"SeekPosition",type:"u",data:U(Pe)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([28,83,187,107])}),Z.push({name:"SeekPosition",type:"u",data:U(je)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"SeekHead",type:"m",isEnd:!0}),ue=V(Z),ke=[],ke.push({name:"Cues",type:"m",isEnd:!1}),S.forEach(function(pt){var wn=pt.CueTrack,gt=pt.CueClusterPosition,At=pt.CueTime;ke.push({name:"CuePoint",type:"m",isEnd:!1}),ke.push({name:"CueTime",type:"u",data:U(At)}),ke.push({name:"CueTrackPositions",type:"m",isEnd:!1}),ke.push({name:"CueTrack",type:"u",data:U(wn)}),gt-=ae,gt+=ht,ke.push({name:"CueClusterPosition",type:"u",data:U(gt)}),ke.push({name:"CueTrackPositions",type:"m",isEnd:!0}),ke.push({name:"CuePoint",type:"m",isEnd:!0})}),ke.push({name:"Cues",type:"m",isEnd:!0}),ge=V(ke),Me!==ht){if(Me=ht,re===ut-1)throw new Error("Failed to converge to a stable metadata size")}else return"break"},Oe=0;Oe<ut;Oe++){var te=Xe(Oe);if(te==="break")break}var Q=[].concat.apply([],[I,{name:"Segment",type:"m",isEnd:!1,unknownSize:!0},Z,Ee,He,ke]),J=new t.default().encode(Q);return J}n.makeMetadataSeekable=C;function k(_,b){for(var S=-1,I=0;I<b.length;I++){var Y=b[I];if(Y.name===_)if(Y.type==="m")if(!Y.isEnd)S=I;else{if(S==-1)throw new Error("Detected ".concat(_," closing element before finding the start"));b.splice(S,I-S+1);return}else{b.splice(I,1);return}}}n.removeElement=k;function E(_,b){for(var S=[],I=-1,Y=0;Y<b.length;Y++){var ae=b[Y];if(ae.name===_)if(ae.type==="m")if(!ae.isEnd)I=Y;else{if(I==-1)throw new Error("Detected ".concat(_," closing element before finding the start"));S=b.slice(I,Y+1);break}else{S.push(b[Y]);break}}return S}n.extractElement=E;function P(_,b){Array.isArray(b.cueInfos)&&!Array.isArray(b.cues)&&(console.warn("putRefinedMetaData: info.cueInfos property is deprecated. please use info.cues"),b.cues=b.cueInfos);for(var S=[],I=[],Y=0;Y<_.length;Y++){var ae=_[Y];if(ae.type==="m"&&ae.name==="Segment"){if(S=_.slice(0,Y),I=_.slice(Y),ae.unknownSize){I.shift();break}throw new Error("this metadata is not streaming webm file")}}if(!(I[I.length-1].dataEnd>0))throw new Error("metadata dataEnd has wrong number");var Ie=I[I.length-1].dataEnd,Ee=S[S.length-1].dataEnd,Ae=new t.default().encode(S).byteLength,He=Ae-Ee,ct=Ie-I[0].tagStart;I[0].tagStart-Ee,I[0].tagStart;var ue=new n.Buffer([24,83,128,103]),Z=new n.Buffer("01ffffffffffffff","hex"),ge=ue.byteLength+Z.byteLength,ke=ct,Me;for(Me=1;Me<20;Me++){var ut=Ee+ge+ke,Xe=ut-Ie,Oe=He+Xe,te=N(I,Oe,b),Q=new t.default().encode(te).byteLength;if(Q===ke)return new t.default().encode([].concat(S,[{type:"m",name:"Segment",isEnd:!1,unknownSize:!0}],te));ke=Q}throw new Error("unable to refine metadata, stable size could not be found in "+Me+" iterations!")}n.putRefinedMetaData=P;function V(_){var b=new t.default;return _.reduce(function(S,I){return S.concat(b.encode([I]))},[]).reduce(function(S,I){return S+I.byteLength},0)}function N(_,b,S){var I=S.duration,Y=S.clusterPtrs,ae=S.cues,Ie=_.slice(0);if(typeof I=="number"){var Ee=!1;Ie.forEach(function(He){He.type==="f"&&He.name==="Duration"&&(Ee=!0,He.data=y(I,8))}),Ee||G(Ie,"Info",[{name:"Duration",type:"f",data:y(I,8)}])}Array.isArray(ae)&&G(Ie,"Cues",q(ae,b));var Ae=[];return Array.isArray(Y)&&(console.warn("append cluster pointers to seekhead is deprecated. please use cues"),Ae=$(Y,b)),G(Ie,"SeekHead",Ae,!0),Ie}function $(_,b){var S=[];return _.forEach(function(I){S.push({name:"Seek",type:"m",isEnd:!1}),S.push({name:"SeekID",type:"b",data:new n.Buffer([31,67,182,117])}),S.push({name:"SeekPosition",type:"u",data:U(I+b)}),S.push({name:"Seek",type:"m",isEnd:!0})}),S}function q(_,b){var S=[];return _.forEach(function(I){var Y=I.CueTrack,ae=I.CueClusterPosition,Ie=I.CueTime;S.push({name:"CuePoint",type:"m",isEnd:!1}),S.push({name:"CueTime",type:"u",data:U(Ie)}),S.push({name:"CueTrackPositions",type:"m",isEnd:!1}),S.push({name:"CueTrack",type:"u",data:U(Y)}),S.push({name:"CueClusterPosition",type:"u",data:U(ae+b)}),S.push({name:"CueTrackPositions",type:"m",isEnd:!0}),S.push({name:"CuePoint",type:"m",isEnd:!0})}),S}function G(_,b,S,I){I===void 0&&(I=!1);for(var Y=-1,ae=0;ae<_.length;ae++){var Ie=_[ae];if(Ie.type==="m"&&Ie.name===b&&Ie.isEnd===!1){Y=ae;break}}Y>=0?Array.prototype.splice.apply(_,[Y+1,0].concat(S)):I?[].concat([{name:b,type:"m",isEnd:!1}],S,[{name:b,type:"m",isEnd:!0}]).reverse().forEach(function(Ee){_.unshift(Ee)}):(_.push({name:b,type:"m",isEnd:!1}),S.forEach(function(Ee){_.push(Ee)}),_.push({name:b,type:"m",isEnd:!0}))}function O(_){return n.Buffer.concat(_)}n.concat=O;function L(_){var b=new n.Buffer(0);if(_.type==="m")return _;switch(_.type){case"u":b=U(_.value);break;case"i":b=A(_.value);break;case"f":b=y(_.value);break;case"s":b=new n.Buffer(_.value,"ascii");break;case"8":b=new n.Buffer(_.value,"utf8");break;case"b":b=_.value;break;case"d":b=new e.Int64BE(_.value.getTime().toString()).toBuffer();break}return Object.assign({},_,{data:b})}n.encodeValueToBuffer=L;function U(_){for(var b=1;_>=Math.pow(2,8*b);b++);if(b>=7)return console.warn("7bit or more bigger uint not supported."),new e.Uint64BE(_).toBuffer();var S=new n.Buffer(b);return S.writeUIntBE(_,0,b),S}n.createUIntBuffer=U;function A(_){for(var b=1;_>=Math.pow(2,8*b);b++);if(b>=7)return console.warn("7bit or more bigger uint not supported."),new e.Int64BE(_).toBuffer();var S=new n.Buffer(b);return S.writeIntBE(_,0,b),S}n.createIntBuffer=A;function y(_,b){if(b===void 0&&(b=8),b===8){var S=new n.Buffer(8);return S.writeDoubleBE(_,0),S}else if(b===4){var S=new n.Buffer(4);return S.writeFloatBE(_,0),S}else throw new Error("float type bits must 4bytes or 8bytes")}n.createFloatBuffer=y;function T(_){return _ instanceof Date?_:new Date(new Date("2001-01-01T00:00:00.000Z").getTime()+Number(_)/1e3/1e3)}n.convertEBMLDateToJSDate=T}(Ys)),Ys}var Wc;function S_(){if(Wc)return Ei;Wc=1,Object.defineProperty(Ei,"__esModule",{value:!0});var n=dd(),e=gn(),t=gn(),r=fd(),i;(function(a){a[a.STATE_TAG=1]="STATE_TAG",a[a.STATE_SIZE=2]="STATE_SIZE",a[a.STATE_CONTENT=3]="STATE_CONTENT"})(i||(i={}));var s=function(){function a(){this._buffer=new e.Buffer(0),this._tag_stack=[],this._state=i.STATE_TAG,this._cursor=0,this._total=0,this._schema=r.byEbmlID,this._result=[]}return a.prototype.decode=function(l){this.readChunk(l);var d=this._result;return this._result=[],d},a.prototype.readChunk=function(l){for(this._buffer=t.concat([this._buffer,new e.Buffer(l)]);this._cursor<this._buffer.length&&!(this._state===i.STATE_TAG&&!this.readTag()||this._state===i.STATE_SIZE&&!this.readSize()||this._state===i.STATE_CONTENT&&!this.readContent()););},a.prototype.getSchemaInfo=function(l){return this._schema[l]||{name:"unknown",level:-1,type:"unknown",description:"unknown"}},a.prototype.readTag=function(){if(this._cursor>=this._buffer.length)return!1;var l=(0,e.readVint)(this._buffer,this._cursor);if(l==null)return!1;var d=this._buffer.slice(this._cursor,this._cursor+l.length),m=d.reduce(function(k,E,P,V){return k+E*Math.pow(16,2*(V.length-1-P))},0),g=this.getSchemaInfo(m),C={EBML_ID:m.toString(16),schema:g,type:g.type,name:g.name,level:g.level,tagStart:this._total,tagEnd:this._total+l.length,sizeStart:this._total+l.length,sizeEnd:null,dataStart:null,dataEnd:null,dataSize:null,data:null};return this._tag_stack.push(C),this._cursor+=l.length,this._total+=l.length,this._state=i.STATE_SIZE,!0},a.prototype.readSize=function(){if(this._cursor>=this._buffer.length)return!1;var l=(0,e.readVint)(this._buffer,this._cursor);if(l==null)return!1;var d=this._tag_stack[this._tag_stack.length-1];return d.sizeEnd=d.sizeStart+l.length,d.dataStart=d.sizeEnd,d.dataSize=l.value,l.value===-1?(d.dataEnd=-1,d.type==="m"&&(d.unknownSize=!0)):d.dataEnd=d.sizeEnd+l.value,this._cursor+=l.length,this._total+=l.length,this._state=i.STATE_CONTENT,!0},a.prototype.readContent=function(){var l=this._tag_stack[this._tag_stack.length-1];if(l.type==="m"){if(l.isEnd=!1,this._result.push(l),this._state=i.STATE_TAG,l.dataSize===0){var d=Object.assign({},l,{isEnd:!0});this._result.push(d),this._tag_stack.pop()}return!0}if(this._buffer.length<this._cursor+l.dataSize)return!1;var m=this._buffer.slice(this._cursor,this._cursor+l.dataSize);switch(this._buffer=this._buffer.slice(this._cursor+l.dataSize),l.data=m,l.type){case"u":l.value=m.readUIntBE(0,m.length);break;case"i":l.value=m.readIntBE(0,m.length);break;case"f":l.value=l.dataSize===4?m.readFloatBE(0):l.dataSize===8?m.readDoubleBE(0):(console.warn("cannot read ".concat(l.dataSize," octets float. failback to 0")),0);break;case"s":l.value=m.toString("ascii");break;case"8":l.value=m.toString("utf8");break;case"b":l.value=m;break;case"d":l.value=(0,e.convertEBMLDateToJSDate)(new n.Int64BE(m).toNumber());break}if(l.value===null)throw new Error("unknown tag type:"+l.type);for(this._result.push(l),this._total+=l.dataSize,this._state=i.STATE_TAG,this._cursor=0,this._tag_stack.pop();this._tag_stack.length>0;){var g=this._tag_stack[this._tag_stack.length-1];if(g.dataEnd<0)return this._tag_stack.pop(),!0;if(this._total<g.dataEnd)break;if(g.type!=="m")throw new Error("parent element is not master element");var d=Object.assign({},g,{isEnd:!0});this._result.push(d),this._tag_stack.pop()}return!0},a}();return Ei.default=s,Ei}var Sn={},Ii={exports:{}},Kc;function k_(){if(Kc)return Ii.exports;Kc=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(L,U,A){return Function.prototype.apply.call(L,U,A)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(L){return Object.getOwnPropertyNames(L).concat(Object.getOwnPropertySymbols(L))}:t=function(L){return Object.getOwnPropertyNames(L)};function r(O){console&&console.warn&&console.warn(O)}var i=Number.isNaN||function(L){return L!==L};function s(){s.init.call(this)}Ii.exports=s,Ii.exports.once=$,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function l(O){if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(O){if(typeof O!="number"||O<0||i(O))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+O+".");a=O}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(L){if(typeof L!="number"||L<0||i(L))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+L+".");return this._maxListeners=L,this};function d(O){return O._maxListeners===void 0?s.defaultMaxListeners:O._maxListeners}s.prototype.getMaxListeners=function(){return d(this)},s.prototype.emit=function(L){for(var U=[],A=1;A<arguments.length;A++)U.push(arguments[A]);var y=L==="error",T=this._events;if(T!==void 0)y=y&&T.error===void 0;else if(!y)return!1;if(y){var _;if(U.length>0&&(_=U[0]),_ instanceof Error)throw _;var b=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw b.context=_,b}var S=T[L];if(S===void 0)return!1;if(typeof S=="function")e(S,this,U);else for(var I=S.length,Y=P(S,I),A=0;A<I;++A)e(Y[A],this,U);return!0};function m(O,L,U,A){var y,T,_;if(l(U),T=O._events,T===void 0?(T=O._events=Object.create(null),O._eventsCount=0):(T.newListener!==void 0&&(O.emit("newListener",L,U.listener?U.listener:U),T=O._events),_=T[L]),_===void 0)_=T[L]=U,++O._eventsCount;else if(typeof _=="function"?_=T[L]=A?[U,_]:[_,U]:A?_.unshift(U):_.push(U),y=d(O),y>0&&_.length>y&&!_.warned){_.warned=!0;var b=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(L)+" listeners added. Use emitter.setMaxListeners() to increase limit");b.name="MaxListenersExceededWarning",b.emitter=O,b.type=L,b.count=_.length,r(b)}return O}s.prototype.addListener=function(L,U){return m(this,L,U,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(L,U){return m(this,L,U,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function C(O,L,U){var A={fired:!1,wrapFn:void 0,target:O,type:L,listener:U},y=g.bind(A);return y.listener=U,A.wrapFn=y,y}s.prototype.once=function(L,U){return l(U),this.on(L,C(this,L,U)),this},s.prototype.prependOnceListener=function(L,U){return l(U),this.prependListener(L,C(this,L,U)),this},s.prototype.removeListener=function(L,U){var A,y,T,_,b;if(l(U),y=this._events,y===void 0)return this;if(A=y[L],A===void 0)return this;if(A===U||A.listener===U)--this._eventsCount===0?this._events=Object.create(null):(delete y[L],y.removeListener&&this.emit("removeListener",L,A.listener||U));else if(typeof A!="function"){for(T=-1,_=A.length-1;_>=0;_--)if(A[_]===U||A[_].listener===U){b=A[_].listener,T=_;break}if(T<0)return this;T===0?A.shift():V(A,T),A.length===1&&(y[L]=A[0]),y.removeListener!==void 0&&this.emit("removeListener",L,b||U)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(L){var U,A,y;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[L]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[L]),this;if(arguments.length===0){var T=Object.keys(A),_;for(y=0;y<T.length;++y)_=T[y],_!=="removeListener"&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(U=A[L],typeof U=="function")this.removeListener(L,U);else if(U!==void 0)for(y=U.length-1;y>=0;y--)this.removeListener(L,U[y]);return this};function k(O,L,U){var A=O._events;if(A===void 0)return[];var y=A[L];return y===void 0?[]:typeof y=="function"?U?[y.listener||y]:[y]:U?N(y):P(y,y.length)}s.prototype.listeners=function(L){return k(this,L,!0)},s.prototype.rawListeners=function(L){return k(this,L,!1)},s.listenerCount=function(O,L){return typeof O.listenerCount=="function"?O.listenerCount(L):E.call(O,L)},s.prototype.listenerCount=E;function E(O){var L=this._events;if(L!==void 0){var U=L[O];if(typeof U=="function")return 1;if(U!==void 0)return U.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function P(O,L){for(var U=new Array(L),A=0;A<L;++A)U[A]=O[A];return U}function V(O,L){for(;L+1<O.length;L++)O[L]=O[L+1];O.pop()}function N(O){for(var L=new Array(O.length),U=0;U<L.length;++U)L[U]=O[U].listener||O[U];return L}function $(O,L){return new Promise(function(U,A){function y(_){O.removeListener(L,T),A(_)}function T(){typeof O.removeListener=="function"&&O.removeListener("error",y),U([].slice.call(arguments))}G(O,L,T,{once:!0}),L!=="error"&&q(O,y,{once:!0})})}function q(O,L,U){typeof O.on=="function"&&G(O,"error",L,U)}function G(O,L,U,A){if(typeof O.on=="function")A.once?O.once(L,U):O.on(L,U);else if(typeof O.addEventListener=="function")O.addEventListener(L,function y(T){A.once&&O.removeEventListener(L,y),U(T)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof O)}return Ii.exports}var Qc;function R_(){if(Qc)return Sn;Qc=1;var n=Sn&&Sn.__extends||function(){var i=function(s,a){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(l[m]=d[m])},i(s,a)};return function(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");i(s,a);function l(){this.constructor=s}s.prototype=a===null?Object.create(a):(l.prototype=a.prototype,new l)}}();Object.defineProperty(Sn,"__esModule",{value:!0});var e=k_(),t=gn(),r=function(i){n(s,i);function s(){var a=i.call(this)||this;return a.logGroup="",a.hasLoggingStarted=!1,a.metadataloaded=!1,a.chunks=[],a.stack=[],a.segmentOffset=0,a.last2SimpleBlockVideoTrackTimecode=[0,0],a.last2SimpleBlockAudioTrackTimecode=[0,0],a.lastClusterTimecode=0,a.lastClusterPosition=0,a.timecodeScale=1e6,a.metadataSize=0,a.metadatas=[],a.cues=[],a.firstVideoBlockRead=!1,a.firstAudioBlockRead=!1,a.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null},a.trackTypes=[],a.trackDefaultDuration=[],a.trackCodecDelay=[],a.trackInfo={type:"nothing"},a.ended=!1,a.logging=!1,a.use_duration_every_simpleblock=!1,a.use_webp=!1,a.use_segment_info=!0,a.drop_default_duration=!0,a}return s.prototype.stop=function(){for(this.ended=!0,this.emit_segment_info();this.stack.length;)this.stack.pop(),this.logging&&console.groupEnd();this.logging&&this.hasLoggingStarted&&this.logGroup&&console.groupEnd()},s.prototype.emit_segment_info=function(){var a=this.chunks;if(this.chunks=[],this.metadataloaded){if(!this.use_segment_info)return;var m=this.lastClusterTimecode,g=this.duration,C=this.timecodeScale;this.emit("cluster",{timecode:m,data:a}),this.emit("duration",{timecodeScale:C,duration:g})}else{this.metadataloaded=!0,this.metadatas=a;var l=this.trackTypes.indexOf(1),d=this.trackTypes.indexOf(2);if(this.trackInfo=l>=0&&d>=0?{type:"both",trackNumber:l}:l>=0?{type:"video",trackNumber:l}:d>=0?{type:"audio",trackNumber:d}:{type:"nothing"},!this.use_segment_info)return;this.emit("metadata",{data:a,metadataSize:this.metadataSize})}},s.prototype.read=function(a){var l=this,d=!1;if(!this.ended){if(a.type==="m")if(a.isEnd)this.stack.pop();else{var m=this.stack[this.stack.length-1];if(m!=null&&m.level>=a.level){this.stack.pop(),this.logging&&console.groupEnd(),m.dataEnd=a.dataEnd,m.dataSize=a.dataEnd-m.dataStart,m.unknownSize=!1;var g=Object.assign({},m,{name:m.name,type:m.type,isEnd:!0});this.chunks.push(g)}this.stack.push(a)}if(a.type==="m"&&a.name=="Segment")this.segmentOffset!=0&&console.warn("Multiple segments detected!"),this.segmentOffset=a.dataStart,this.emit("segment_offset",this.segmentOffset);else if(a.type==="b"&&a.name==="SimpleBlock"){var C=t.ebmlBlock(a.data),k=C.timecode,E=C.trackNumber,P=C.frames;if(this.trackTypes[E]===1){if(!this.firstVideoBlockRead&&(this.firstVideoBlockRead=!0,this.trackInfo.type==="both"||this.trackInfo.type==="video")){var V=this.lastClusterTimecode+k;this.cues.push({CueTrack:E,CueClusterPosition:this.lastClusterPosition,CueTime:V}),this.emit("cue_info",{CueTrack:E,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:E,CueClusterPosition:this.lastClusterPosition,CueTime:V})}this.last2SimpleBlockVideoTrackTimecode=[this.last2SimpleBlockVideoTrackTimecode[1],k]}else if(this.trackTypes[E]===2){if(!this.firstAudioBlockRead&&(this.firstAudioBlockRead=!0,this.trackInfo.type==="audio")){var V=this.lastClusterTimecode+k;this.cues.push({CueTrack:E,CueClusterPosition:this.lastClusterPosition,CueTime:V}),this.emit("cue_info",{CueTrack:E,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:E,CueClusterPosition:this.lastClusterPosition,CueTime:V})}this.last2SimpleBlockAudioTrackTimecode=[this.last2SimpleBlockAudioTrackTimecode[1],k]}this.use_duration_every_simpleblock&&this.emit("duration",{timecodeScale:this.timecodeScale,duration:this.duration}),this.use_webp&&P.forEach(function(N){var $=N.slice(3,6).toString("hex");if($==="9d012a"){var q=t.VP8BitStreamToRiffWebPBuffer(N),G=new Blob([q],{type:"image/webp"}),O=l.duration;l.emit("webp",{currentTime:O,webp:G})}})}else a.type==="m"&&a.name==="Cluster"&&a.isEnd===!1?(this.firstVideoBlockRead=!1,this.firstAudioBlockRead=!1,this.emit_segment_info(),this.emit("cluster_ptr",a.tagStart),this.lastClusterPosition=a.tagStart):a.type==="u"&&a.name==="Timecode"?this.lastClusterTimecode=a.value:a.type==="u"&&a.name==="TimecodeScale"?this.timecodeScale=a.value:a.type==="m"&&a.name==="TrackEntry"?a.isEnd?(this.trackTypes[this.currentTrack.TrackNumber]=this.currentTrack.TrackType,this.trackDefaultDuration[this.currentTrack.TrackNumber]=this.currentTrack.DefaultDuration,this.trackCodecDelay[this.currentTrack.TrackNumber]=this.currentTrack.CodecDelay):this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null}:a.type==="u"&&a.name==="TrackType"?this.currentTrack.TrackType=a.value:a.type==="u"&&a.name==="TrackNumber"?this.currentTrack.TrackNumber=a.value:a.type==="u"&&a.name==="CodecDelay"?this.currentTrack.CodecDelay=a.value:a.type==="u"&&a.name==="DefaultDuration"?this.drop_default_duration?(console.warn("DefaultDuration detected!, remove it"),d=!0):this.currentTrack.DefaultDuration=a.value:a.name==="unknown"&&console.warn(a);!this.metadataloaded&&a.dataEnd>0&&(this.metadataSize=a.dataEnd),d||this.chunks.push(a),this.logging&&this.put(a)}},Object.defineProperty(s.prototype,"duration",{get:function(){if(this.trackInfo.type==="nothing")return console.warn("no video, no audio track"),0;var a=0,l=0,d=0,m=this.trackDefaultDuration[this.trackInfo.trackNumber];if(typeof m=="number")a=m;else if(this.trackInfo.type==="both")if(this.last2SimpleBlockAudioTrackTimecode[1]>this.last2SimpleBlockVideoTrackTimecode[1]){a=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale;var g=this.trackCodecDelay[this.trackTypes.indexOf(2)];typeof g=="number"&&(l=g),d=this.last2SimpleBlockAudioTrackTimecode[1]}else{a=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale;var g=this.trackCodecDelay[this.trackTypes.indexOf(1)];typeof g=="number"&&(l=g),d=this.last2SimpleBlockVideoTrackTimecode[1]}else if(this.trackInfo.type==="video"){a=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale;var g=this.trackCodecDelay[this.trackInfo.trackNumber];typeof g=="number"&&(l=g),d=this.last2SimpleBlockVideoTrackTimecode[1]}else if(this.trackInfo.type==="audio"){a=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale;var g=this.trackCodecDelay[this.trackInfo.trackNumber];typeof g=="number"&&(l=g),d=this.last2SimpleBlockAudioTrackTimecode[1]}var C=(this.lastClusterTimecode+d)*this.timecodeScale+a-l,k=C/this.timecodeScale;return Math.floor(k)},enumerable:!1,configurable:!0}),s.prototype.addListener=function(a,l){return i.prototype.addListener.call(this,a,l)},s.prototype.put=function(a){this.hasLoggingStarted||(this.hasLoggingStarted=!0,this.logging&&this.logGroup&&console.groupCollapsed(this.logGroup)),a.type==="m"?a.isEnd?console.groupEnd():console.group(a.name+":"+a.tagStart):a.type==="b"?console.log(a.name,a.type):console.log(a.name,a.tagStart,a.type,a.value)},s}(e.EventEmitter);return Sn.default=r,Sn}var Xc;function P_(){return Xc||(Xc=1,function(n){var e=on&&on.__createBinding||(Object.create?function(l,d,m,g){g===void 0&&(g=m),Object.defineProperty(l,g,{enumerable:!0,get:function(){return d[m]}})}:function(l,d,m,g){g===void 0&&(g=m),l[g]=d[m]}),t=on&&on.__exportStar||function(l,d){for(var m in l)m!=="default"&&!Object.prototype.hasOwnProperty.call(d,m)&&e(d,l,m)};Object.defineProperty(n,"__esModule",{value:!0}),n.tools=n.Reader=n.Encoder=n.Decoder=void 0,t(v_(),n);var r=S_();n.Decoder=r.default;var i=md();n.Encoder=i.default;var s=R_();n.Reader=s.default;var a=gn();n.tools=a}(on)),on}var Yc;function x_(){if(Yc)return Nt;Yc=1;var n=Nt&&Nt.__awaiter||function(i,s,a,l){function d(m){return m instanceof a?m:new a(function(g){g(m)})}return new(a||(a=Promise))(function(m,g){function C(P){try{E(l.next(P))}catch(V){g(V)}}function k(P){try{E(l.throw(P))}catch(V){g(V)}}function E(P){P.done?m(P.value):d(P.value).then(C,k)}E((l=l.apply(i,s||[])).next())})},e=Nt&&Nt.__generator||function(i,s){var a={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},l,d,m,g;return g={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function C(E){return function(P){return k([E,P])}}function k(E){if(l)throw new TypeError("Generator is already executing.");for(;a;)try{if(l=1,d&&(m=E[0]&2?d.return:E[0]?d.throw||((m=d.return)&&m.call(d),0):d.next)&&!(m=m.call(d,E[1])).done)return m;switch(d=0,m&&(E=[E[0]&2,m.value]),E[0]){case 0:case 1:m=E;break;case 4:return a.label++,{value:E[1],done:!1};case 5:a.label++,d=E[1],E=[0];continue;case 7:E=a.ops.pop(),a.trys.pop();continue;default:if(m=a.trys,!(m=m.length>0&&m[m.length-1])&&(E[0]===6||E[0]===2)){a=0;continue}if(E[0]===3&&(!m||E[1]>m[0]&&E[1]<m[3])){a.label=E[1];break}if(E[0]===6&&a.label<m[1]){a.label=m[1],m=E;break}if(m&&a.label<m[2]){a.label=m[2],a.ops.push(E);break}m[2]&&a.ops.pop(),a.trys.pop();continue}E=s.call(i,a)}catch(P){E=[6,P],d=0}finally{l=m=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}};Object.defineProperty(Nt,"__esModule",{value:!0});var t=P_();function r(i){return n(this,void 0,void 0,function(){var s,a,l,d,m,g,C,k,E,P,V,N;return e(this,function($){switch($.label){case 0:if(!i)throw Error("call to fixWebmDuration requires a blob");s=new t.Decoder,a=new t.Reader,l=i.stream(),d=l.getReader(),$.label=1;case 1:return[4,d.read()];case 2:return m=$.sent(),g=m.done,C=m.value,g?(a.stop(),[3,3]):(k=s.decode(C),k=k?.filter(function(q){return q.type!=="unknown"}),k.forEach(function(q){a.read(q)}),C=null,[3,1]);case 3:return E=t.tools.makeMetadataSeekable(a.metadatas,a.duration,a.cues),P=new Blob([E],{type:i.type}),V=i.slice(a.metadataSize),N=new Blob([P,V],{type:i.type}),[2,N]}})})}return Nt.default=r,Nt}var D_=x_();const V_=__(D_);function Jc(n){if(Bo[n]||yn!=="receiver")return;const e=n==="camera1"?Uo:jo;if(!e||!e.srcObject){alert(`${n} のビデオストリームが見つかりません。`);return}const t=e.srcObject;uu(n,[]),ji(n,!0);const r=pd(n);try{const i=new MediaRecorder(t,{mimeType:"video/webm; codecs=vp9"});cu(n,i),i.ondataavailable=s=>{s.data.size>0&&Ir[n].push(s.data)},i.onstop=()=>{console.log(`Recording stopped for ${n}. Total chunks:`,Ir[n].length),r.startBtn.disabled=!1,r.stopBtn.disabled=!0,r.downloadBtn.disabled=Ir[n].length===0,r.status.textContent="録画停止。"},i.start(100),console.log(`Recording started for ${n}.`),r.startBtn.disabled=!0,r.stopBtn.disabled=!1,r.downloadBtn.disabled=!0,r.status.textContent="録画中..."}catch(i){console.error(`Error starting MediaRecorder for ${n}:`,i),alert(`${n} の録画開始に失敗しました。`),ji(n,!1)}}function Yn(n){const e=br[n];!Bo[n]||!e||e.state==="inactive"||(e.stop(),ji(n,!1))}async function Zc(n){const e=Ir[n];if(e.length===0){alert("ダウンロードする録画データがありません。");return}const t=pd(n);t.status.textContent="動画ファイルを処理中...",t.downloadBtn.disabled=!0;try{const r=new Blob(e,{type:"video/webm"}),i=await V_(r),s=URL.createObjectURL(i),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=s,a.download=`recording_${n}_${new Date().toISOString().replace(/[:.]/g,"-")}.webm`,a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),t.status.textContent=""}catch(r){console.error(`Error fixing or downloading video for ${n}:`,r),alert("動画の処理またはダウンロード中にエラーが発生しました。"),t.status.textContent="エラー"}finally{t.downloadBtn.disabled=!1}}function pd(n){return n==="camera1"?{startBtn:qo,stopBtn:Ho,downloadBtn:Go,status:fu}:{startBtn:Wo,stopBtn:Ko,downloadBtn:Qo,status:mu}}let zn=[],Dr=[],Wr=!1,gd=0,Ni=null;const B_=1e3;function xa(){Dr.length>0&&(zn.push(...Dr),Dr=[])}function N_(){Wr||(Wr=!0,zn=[],Dr=[],gd=performance.now(),Ni=setInterval(xa,B_),console.log("Evaluation started."),document.getElementById("evaluationStatus").textContent="評価中...",document.getElementById("startEvaluationBtn").disabled=!0,document.getElementById("stopEvaluationBtn").disabled=!1,document.getElementById("downloadCsvBtn").disabled=!0)}function L_(){Wr&&(Wr=!1,Ni&&(clearInterval(Ni),Ni=null),xa(),console.log("Evaluation stopped."),document.getElementById("evaluationStatus").textContent="評価停止中",document.getElementById("startEvaluationBtn").disabled=!1,document.getElementById("stopEvaluationBtn").disabled=!0,document.getElementById("downloadCsvBtn").disabled=zn.length===0)}function eu(n){if(!Wr)return;const e=(performance.now()-gd)/1e3;Dr.push({timestamp:e,...n})}function M_(){if(xa(),zn.length===0){alert("データが記録されていません。");return}const n=Object.keys(zn[0]).join(","),e=zn.map(s=>Object.values(s).join(",")).join(`
`),t=`${n}
${e}`,r=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){const s=URL.createObjectURL(r);i.setAttribute("href",s),i.setAttribute("download",`tracking_evaluation_${new Date().toISOString()}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}const tu=320,O_=4,F_=5;let ot,De,hn,as,Kr=!1,dn,Li;const kn={pan:{Kp:84e3,Ki:0,Kd:0},tilt:{Kp:-85e3,Ki:0,Kd:0}};let Bn={integral:0,previousError:0},Nn={integral:0,previousError:0},Ro=0,Po=0,xo=0,yd,Mt,Ln,Mi,Oi,Do;const U_=new Promise(n=>{const e=()=>{typeof cv<"u"?(console.log("OpenCV.jsのオブジェクト 'cv' を確認しました。ランタイムの初期化を待ちます。"),cv.onRuntimeInitialized=()=>{console.log("OpenCV.jsのランタイムが初期化されました。");const t=cv.getPredefinedDictionary(cv.DICT_4X4_50),r=new cv.aruco_DetectorParameters,i=new cv.aruco_RefineParameters(10,3,!0);yd=new cv.aruco_ArucoDetector(t,r,i),Mt=new cv.Mat,Ln=new cv.Mat,Mi=new cv.Mat,Oi=new cv.MatVector,Do=new cv.Mat,n()}):(console.log("OpenCV.jsの 'cv' オブジェクトを待機中..."),setTimeout(e,100))};e()});async function j_(n){if(!Kr){if(Li=n,ot=n==="camera1"?Mr:cn,!ot||!ot.srcObject||ot.readyState<3){alert("対象のビデオストリームが準備できていません。");return}$n.textContent="OpenCVを初期化中",await U_,$n.textContent="追跡を開始します",Kr=!0,Bn={integral:0,previousError:0},Nn={integral:0,previousError:0},Ro=performance.now(),Po=0,xo=0,De=document.createElement("canvas"),ot.parentElement.appendChild(De),De.style.position="absolute",De.style.pointerEvents="none",hn=document.createElement("canvas"),as=hn.getContext("2d",{willReadFrequently:!0}),wr()}}function wr(){if(!Kr){dn=requestAnimationFrame(wr);return}try{if(Po++,Po%O_!==0){dn=requestAnimationFrame(wr);return}const n=ot.videoWidth,e=ot.videoHeight;if(n===0||e===0){dn=requestAnimationFrame(wr);return}const t=tu/n,r=tu,i=Math.round(e*t);(hn.width!==r||hn.height!==i)&&(hn.width=r,hn.height=i),(De.width!==n||De.height!==e)&&(De.width=n,De.height=e,De.style.width=ot.clientWidth+"px",De.style.height=ot.clientHeight+"px",De.style.top=ot.offsetTop+"px",De.style.left=ot.offsetLeft+"px"),as.drawImage(ot,0,0,r,i),(Mt.cols!==r||Mt.rows!==i)&&(Mt.isDeleted()||Mt.delete(),Ln.isDeleted()||Ln.delete(),Mi.isDeleted()||Mi.delete(),Mt=new cv.Mat(i,r,cv.CV_8UC4),Ln=new cv.Mat(i,r,cv.CV_8UC1),Mi=new cv.Mat(i,r,cv.CV_8UC3));const s=as.getImageData(0,0,r,i);Mt.data.set(s.data),cv.cvtColor(Mt,Ln,cv.COLOR_RGBA2GRAY),yd.detectMarkers(Ln,Oi,Do),xo++;const a=xo%F_===0,l=De.getContext("2d");if(l.clearRect(0,0,De.width,De.height),Do.rows>0){const d=z_(Oi.get(0),r,i);a&&eu({detected:1,...d});const m=Oi.get(0).data32F;l.strokeStyle="red",l.lineWidth=3,l.beginPath(),l.moveTo(m[0]/t,m[1]/t);for(let g=2;g<m.length;g+=2)l.lineTo(m[g]/t,m[g+1]/t);l.closePath(),l.stroke()}else a&&eu({detected:0,markerX:null,markerY:null,errorX:null,errorY:null,panAdjustment:null,tiltAdjustment:null})}catch(n){console.error("ArUco追跡中にエラー:",n),$n.textContent="エラーが発生しました",Da()}dn=requestAnimationFrame(wr)}function z_(n,e,t){const r=performance.now(),i=(r-Ro)/1e3;Ro=r;let s=0,a=0;for(let P=0;P<4;++P)s+=n.data32F[P*2],a+=n.data32F[P*2+1];s/=4,a/=4;const l=(s-e/2)/e,d=(a-t/2)/t;$n.textContent=`マーカー検出: (x: ${Math.round(s)}, y: ${Math.round(a)})`;const m=Ft[Li];if(!m)return null;const g=m.getSettings(),C=m.getCapabilities();let k=0,E=0;if(g.pan!==void 0&&C.pan){Bn.integral=Math.max(-1,Math.min(1,Bn.integral+l*i));const P=(l-Bn.previousError)/i;Bn.previousError=l,k=kn.pan.Kp*l+kn.pan.Ki*Bn.integral+kn.pan.Kd*P;const V=Math.max(C.pan.min,Math.min(C.pan.max,g.pan+k));ko(Li,"pan",V)}if(g.tilt!==void 0&&C.tilt){Nn.integral=Math.max(-1,Math.min(1,Nn.integral+d*i));const P=(d-Nn.previousError)/i;Nn.previousError=d,E=kn.tilt.Kp*d+kn.tilt.Ki*Nn.integral+kn.tilt.Kd*P;const V=Math.max(C.tilt.min,Math.min(C.tilt.max,g.tilt+E));ko(Li,"tilt",V)}return{markerX:s,markerY:a,errorX:l,errorY:d,panAdjustment:k,tiltAdjustment:E}}function Da(){Kr&&(Kr=!1,dn&&(cancelAnimationFrame(dn),dn=null),De&&(De.getContext("2d").clearRect(0,0,De.width,De.height),De.remove(),De=null),hn=null,as=null,$n.textContent="停止しました",console.log("ArUco tracking stopped."))}const $_={vga:{width:640,height:360},qhd:{width:960,height:540},hd:{width:1280,height:720},fhd:{width:1920,height:1080},fourK:{width:3840,height:2160}},q_={iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"turn:a.relay.metered.ca:80",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:80?transport=tcp",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:443",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:443?transport=tcp",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"}],iceCandidatePoolSize:10};function _d(){const n=new RTCPeerConnection(q_);return n.onconnectionstatechange=()=>{console.log(`PeerConnection state changed to: ${n.connectionState}`);const e=n.connectionState==="connected";if(hu.style.display=e?"block":"none",e&&hd(),e&&yn==="receiver"){if(!jt){const t=setInterval(m_,1e3);Ui(t)}}else jt&&(clearInterval(jt),Ui(null)),zo.style.display="none",$o.style.display="none";e||(Pa(),Yn("camera1"),Yn("camera2"))},n}function H_(n,e){const t=n.split(`\r
`),r=[];if(t.forEach((l,d)=>{l.startsWith("m=video")&&r.push(d)}),r.length===0)return n;const i=new RegExp(`a=rtpmap:(\\d+) ${e}/90000`,"i"),s=t.find(l=>i.test(l));if(!s)return n;const a=s.match(i)[1];return r.forEach(l=>{const d=t[l].split(" ");if(d.slice(3).includes(a)){const m=[a,...d.slice(3).filter(g=>g!==a)];t[l]=[...d.slice(0,3),...m].join(" ")}}),t.join(`\r
`)}function vd(n,e){n.onicecandidate=t=>{t.candidate&&Ra(Aa(e),t.candidate.toJSON())}}function Ed(n){od(n,e=>{e.docChanges().forEach(t=>{if(t.type==="added"&&ve){const r=new RTCIceCandidate(t.doc.data());ve.addIceCandidate(r).catch(i=>console.error("Error adding ICE candidate:",i))}})})}async function G_(){Da(),Pa(),Yn("camera1"),Yn("camera2"),jt&&(clearInterval(jt),Ui(null)),no&&(no.forEach(n=>n.getTracks().forEach(e=>e.stop())),ru([])),ve&&(ve.close(),No(null)),ro&&(await c_(ro).catch(n=>console.error("Error deleting document: ",n)),Lo(null)),iu({}),su({}),Or()}async function W_(){Lr.disabled=!0;const n=parseInt(Fo.value,10),e=Yd.value,t=parseInt(Jd.value,10),r=Zd.value,i={...$_[e],frameRate:{ideal:t},pan:!0,tilt:!0,zoom:!0},s=[],a={};try{const d={video:{deviceId:{exact:Rn.value},...i},audio:!1},m=await navigator.mediaDevices.getUserMedia(d);if(s.push(m),a.camera1=m.getVideoTracks()[0],Mr.srcObject=m,Mr.style.display="block",n===2){const $={video:{deviceId:{exact:an.value},...i},audio:!1},q=await navigator.mediaDevices.getUserMedia($);s.push(q),a.camera2=q.getVideoTracks()[0],cn.srcObject=q,cn.style.display="block"}else cn.srcObject=null,cn.style.display="none";ru(s),iu(a);const g=_d();No(g),s.forEach(N=>{N.getTracks().forEach($=>ve.addTrack($,N))}),d_();const C=Aa(xr(cd,"calls"));Lo(C);const k=xr(C,"offerCandidates"),E=xr(C,"answerCandidates");vd(ve,k),Ed(E);const P=await ve.createOffer(),V=H_(P.sdp,r);await ve.setLocalDescription({type:P.type,sdp:V}),await Ra(C,{offer:{type:P.type,sdp:V},cameraCount:n}),cs.textContent=C.id,Oo.style.display="block",pu.style.display="block",od(C,N=>{const $=N.data();$?.answer&&ve&&!ve.currentRemoteDescription&&ve.setRemoteDescription(new RTCSessionDescription($.answer))})}catch(l){console.error("Error starting camera or creating call:",l),alert("カメラへのアクセスに失敗しました。"),Or()}}async function K_(){const n=du.value.trim();if(!n){alert("Call ID を入力してください。");return}$i.disabled=!0;try{const e=Aa(cd,"calls",n);Lo(e);const t=await l_(e),r=t.data();if(!t.exists()||!r.offer){alert("無効なCall IDです。"),Or();return}const i=r.offer,s=r.cameraCount||2;On.style.display=s===2?"inline-block":"none",io.style.display=s===2?"inline":"none";const a=_d();No(a);const l=xr(e,"offerCandidates"),d=xr(e,"answerCandidates"),m=[Uo,jo],g=[Ar,On],C=[zo,$o],k={};let E=0;const P=["camera1","camera2"];ve.ontrack=N=>{if(N.track.kind==="video"&&E<s){m[E].srcObject=N.streams[0],g[E].style.display="inline-block";const $=P[E];k[N.track.id]={displayElement:C[E],name:$},E++}},su(k),ve.ondatachannel=f_,vd(ve,d),Ed(l),await ve.setRemoteDescription(new RTCSessionDescription(i));const V=await ve.createAnswer();await ve.setLocalDescription(V),await Ra(e,{answer:V},{merge:!0}),cs.textContent=e.id,Oo.style.display="block"}catch(e){console.error("Error joining call:",e),alert("通話への参加中にエラーが発生しました。Call IDを確認してください。"),Or()}finally{$i.disabled=!1}}function Q_(){Wd.forEach(E=>{E.addEventListener("change",P=>gu(P.target.value))}),Fo.addEventListener("change",yu),Ai.addEventListener("click",async()=>{const E=cs.textContent.trim();if(E)try{await navigator.clipboard.writeText(E),Ai.textContent="コピー済み",setTimeout(()=>{Ai.textContent="コピー"},1500)}catch(P){alert("コピーに失敗しました。"),console.error("Failed to copy Call ID: ",P)}}),Lr.addEventListener("click",W_),$i.addEventListener("click",K_),ef.addEventListener("click",G_),us.addEventListener("click",hd),hs.addEventListener("click",Pa),ds.addEventListener("click",y_),qo.addEventListener("click",()=>Jc("camera1")),Ho.addEventListener("click",()=>Yn("camera1")),Go.addEventListener("click",()=>Zc("camera1")),Wo.addEventListener("click",()=>Jc("camera2")),Ko.addEventListener("click",()=>Yn("camera2")),Qo.addEventListener("click",()=>Zc("camera2")),Si.addEventListener("click",()=>{const E=Ci.value;j_(E),Si.disabled=!0,ki.disabled=!1,Ci.disabled=!0}),ki.addEventListener("click",()=>{Da(),Si.disabled=!1,ki.disabled=!0,Ci.disabled=!1}),df.forEach(E=>{E.addEventListener("change",P=>{P.target.checked&&ud(P.target.value)})});const n=E=>parseFloat(document.getElementById(`${E}Slider`).value),e=()=>ls[Nr]||{};tf.addEventListener("click",()=>{const E=e();E.zoom&&Se("zoom",n("zoom")+E.zoom.step)}),nf.addEventListener("click",()=>{const E=e();E.zoom&&Se("zoom",n("zoom")-E.zoom.step)}),rf.addEventListener("input",()=>Se("zoom",n("zoom"))),sf.addEventListener("click",()=>{const E=e();E.tilt&&Se("tilt",n("tilt")+E.tilt.step)}),of.addEventListener("click",()=>{const E=e();E.tilt&&Se("tilt",n("tilt")-E.tilt.step)}),af.addEventListener("input",()=>Se("tilt",n("tilt"))),cf.addEventListener("click",()=>{const E=e();E.pan&&Se("pan",n("pan")+E.pan.step)}),lf.addEventListener("click",()=>{const E=e();E.pan&&Se("pan",n("pan")-E.pan.step)}),uf.addEventListener("input",()=>Se("pan",n("pan"))),hf.addEventListener("click",()=>{const E=e();E.zoom&&Se("zoom",E.zoom.min),E.tilt&&Se("tilt",0),E.pan&&Se("pan",0)}),window.addEventListener("keydown",E=>{if(yn!=="receiver"||zi.style.display==="none"||["INPUT","SELECT","TEXTAREA"].includes(document.activeElement.tagName))return;let P=!1;const V=e();switch(E.key){case"ArrowUp":V.tilt&&(Se("tilt",n("tilt")+V.tilt.step),P=!0);break;case"ArrowDown":V.tilt&&(Se("tilt",n("tilt")-V.tilt.step),P=!0);break;case"ArrowLeft":V.pan&&(Se("pan",n("pan")-V.pan.step),P=!0);break;case"ArrowRight":V.pan&&(Se("pan",n("pan")+V.pan.step),P=!0);break;case"+":case"PageUp":V.zoom&&(Se("zoom",n("zoom")+V.zoom.step),P=!0);break;case"-":case"PageDown":V.zoom&&(Se("zoom",n("zoom")-V.zoom.step),P=!0);break;case"r":case"R":V.zoom&&Se("zoom",V.zoom.min),V.tilt&&Se("tilt",0),V.pan&&Se("pan",0),P=!0;break}P&&E.preventDefault()}),Il.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():Ar.requestFullscreen().catch(E=>{alert(`フルスクリーンにできませんでした: ${E.message} (${E.name})`)})}),Al.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():On.requestFullscreen().catch(E=>{alert(`フルスクリーンにできませんでした: ${E.message} (${E.name})`)})}),document.addEventListener("fullscreenchange",()=>{const E=!!document.fullscreenElement;Il.textContent=E&&document.fullscreenElement===Ar?"通常表示":"フルスクリーン",Al.textContent=E&&document.fullscreenElement===On?"通常表示":"フルスクリーン"});let t=!1,r=0,i=0,s=null,a=null;const l=50,d=E=>{t&&(a||(a=setTimeout(()=>{const N=E.clientX-r,$=E.clientY-i;r=E.clientX,i=E.clientY;const q=e();if(q.pan){const G=n("pan")+N*(q.pan.step/5);Se("pan",G)}if(q.tilt){const G=n("tilt")-$*(q.tilt.step/5);Se("tilt",G)}a=null},l)))},m=E=>{E.preventDefault();const P=e();if(P.zoom){const $=n("zoom")-E.deltaY*(P.zoom.step/20);Se("zoom",$)}},g=E=>{E.button===0&&(t=!0,r=E.clientX,i=E.clientY,s=E.currentTarget,s.classList.add("dragging"))},C=()=>{t&&(t=!1,s&&(s.classList.remove("dragging"),s=null))},k=E=>{E.addEventListener("mousedown",g),E.addEventListener("mousemove",d),E.addEventListener("wheel",m)};window.addEventListener("mouseup",C),k(Ar),k(On)}gu(document.querySelector('input[name="role"]:checked').value);Q_();ff();const X_=document.getElementById("startEvaluationBtn"),Y_=document.getElementById("stopEvaluationBtn"),J_=document.getElementById("downloadCsvBtn");X_.addEventListener("click",N_);Y_.addEventListener("click",L_);J_.addEventListener("click",M_);
